
var Laya=window.Laya=(function(window,document){var Laya={__internals:[],__packages:{},__classmap:{'Object':Object,'Function':Function,'Array':Array,'String':String},__sysClass:{'object':'Object','array':'Array','string':'String','dictionary':'Dictionary'},__propun:{writable:true,enumerable:false,configurable:true},__presubstr:String.prototype.substr,__substr:function(ofs,sz){return arguments.length==1?Laya.__presubstr.call(this,ofs):Laya.__presubstr.call(this,ofs,sz>0?sz:(this.length+sz));},__init:function(_classs){_classs.forEach(function(o){o.__init$&&o.__init$();});},__isClass:function(o){return o&&(o.__isclass||o==Object||o==String||o==Array);},__newvec:function(sz,value){var d=[];d.length=sz;for(var i=0;i<sz;i++)d[i]=value;return d;},__extend:function(d,b){for(var p in b){if(!b.hasOwnProperty(p))continue;var gs=Object.getOwnPropertyDescriptor(b,p);var g=gs.get,s=gs.set;if(g||s){if(g&&s)
Object.defineProperty(d,p,gs);else{g&&Object.defineProperty(d,p,g);s&&Object.defineProperty(d,p,s);}}
else d[p]=b[p];}
function __(){Laya.un(this,'constructor',d);}__.prototype=b.prototype;d.prototype=new __();Laya.un(d.prototype,'__imps',Laya.__copy({},b.prototype.__imps));},__copy:function(dec,src){if(!src)return null;dec=dec||{};for(var i in src)dec[i]=src[i];return dec;},__package:function(name,o){if(Laya.__packages[name])return;Laya.__packages[name]=true;var p=window,strs=name.split('.');if(strs.length>1){for(var i=0,sz=strs.length-1;i<sz;i++){var c=p[strs[i]];p=c?c:(p[strs[i]]={});}}
p[strs[strs.length-1]]||(p[strs[strs.length-1]]=o||{});},__hasOwnProperty:function(name,o){o=o||this;function classHas(name,o){if(Object.hasOwnProperty.call(o.prototype,name))return true;var s=o.prototype.__super;return s==null?null:classHas(name,s);}
return(Object.hasOwnProperty.call(o,name))||classHas(name,o.__class);},__typeof:function(o,value){if(!o||!value)return false;if(value===String)return(typeof o==='string');if(value===Number)return(typeof o==='number');if(value.__interface__)value=value.__interface__;else if(typeof value!='string')return(o instanceof value);return(o.__imps&&o.__imps[value])||(o.__class==value);},__as:function(value,type){return(this.__typeof(value,type))?value:null;},__int:function(value){return value?parseInt(value):0;},interface:function(name,_super){Laya.__package(name,{});var ins=Laya.__internals;var a=ins[name]=ins[name]||{self:name};if(_super)
{var supers=_super.split(',');a.extend=[];for(var i=0;i<supers.length;i++){var nm=supers[i];ins[nm]=ins[nm]||{self:nm};a.extend.push(ins[nm]);}}
var o=window,words=name.split('.');for(var i=0;i<words.length-1;i++)o=o[words[i]];o[words[words.length-1]]={__interface__:name};},class:function(o,fullName,_super,miniName){_super&&Laya.__extend(o,_super);if(fullName){Laya.__package(fullName,o);Laya.__classmap[fullName]=o;if(fullName.indexOf('.')>0){if(fullName.indexOf('laya.')==0){var paths=fullName.split('.');miniName=miniName||paths[paths.length-1];if(Laya[miniName])console.log("Warning!,this class["+miniName+"] already exist:",Laya[miniName]);Laya[miniName]=o;}}
else{if(fullName=="Main")
window.Main=o;else{if(Laya[fullName]){console.log("Error!,this class["+fullName+"] already exist:",Laya[fullName]);}
Laya[fullName]=o;}}}
var un=Laya.un,p=o.prototype;un(p,'hasOwnProperty',Laya.__hasOwnProperty);un(p,'__class',o);un(p,'__super',_super);un(p,'__className',fullName);un(o,'__super',_super);un(o,'__className',fullName);un(o,'__isclass',true);un(o,'super',function(o){this.__super.call(o);});},imps:function(dec,src){if(!src)return null;var d=dec.__imps||Laya.un(dec,'__imps',{});function __(name){var c,exs;if(!(c=Laya.__internals[name]))return;d[name]=true;if(!(exs=c.extend))return;for(var i=0;i<exs.length;i++){__(exs[i].self);}}
for(var i in src)__(i);},superSet:function(clas,o,prop,value){var fun=clas.prototype["_$set_"+prop];fun&&fun.call(o,value);},superGet:function(clas,o,prop){var fun=clas.prototype["_$get_"+prop];return fun?fun.call(o):null;},getset:function(isStatic,o,name,getfn,setfn){if(!isStatic){getfn&&Laya.un(o,'_$get_'+name,getfn);setfn&&Laya.un(o,'_$set_'+name,setfn);}
else{getfn&&(o['_$GET_'+name]=getfn);setfn&&(o['_$SET_'+name]=setfn);}
if(getfn&&setfn)
Object.defineProperty(o,name,{get:getfn,set:setfn,enumerable:false,configurable:true});else{getfn&&Object.defineProperty(o,name,{get:getfn,enumerable:false,configurable:true});setfn&&Object.defineProperty(o,name,{set:setfn,enumerable:false,configurable:true});}},static:function(_class,def){for(var i=0,sz=def.length;i<sz;i+=2){if(def[i]=='length')
_class.length=def[i+1].call(_class);else{function tmp(){var name=def[i];var getfn=def[i+1];Object.defineProperty(_class,name,{get:function(){delete this[name];return this[name]=getfn.call(this);},set:function(v){delete this[name];this[name]=v;},enumerable:true,configurable:true});}
tmp();}}},un:function(obj,name,value){value||(value=obj[name]);Laya.__propun.value=value;Object.defineProperty(obj,name,Laya.__propun);return value;},uns:function(obj,names){names.forEach(function(o){Laya.un(obj,o)});}};window.console=window.console||({log:function(){}});window.trace=window.console.log;Error.prototype.throwError=function(){throw arguments;};Object.defineProperty(Array.prototype,'fixed',{enumerable:false});return Laya;})(window,document);(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;})(window,document,Laya);(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;Laya.interface('laya.runtime.IMarket');Laya.interface('laya.filters.IFilter');Laya.interface('laya.display.ILayout');Laya.interface('laya.resource.IDispose');Laya.interface('laya.runtime.IPlatform');Laya.interface('laya.resource.IDestroy');Laya.interface('laya.runtime.IConchNode');Laya.interface('laya.filters.IFilterAction');Laya.interface('laya.runtime.ICPlatformClass');Laya.interface('laya.resource.ICreateResource');Laya.interface('laya.runtime.IConchRenderObject');Laya.interface('laya.runtime.IPlatformClass','laya.runtime.IPlatform');var RunDriver=(function(){function RunDriver(){}
__class(RunDriver,'laya.utils.RunDriver');RunDriver.FILTER_ACTIONS=[];RunDriver.pixelRatio=-1;RunDriver._charSizeTestDiv=null;RunDriver.now=function(){return Date.now();}
RunDriver.getWindow=function(){return window;}
RunDriver.getPixelRatio=function(){if(RunDriver.pixelRatio<0){var ctx=Browser.context;var backingStore=ctx.backingStorePixelRatio||ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1;RunDriver.pixelRatio=(Browser.window.devicePixelRatio||1)/backingStore;if(RunDriver.pixelRatio<1)RunDriver.pixelRatio=1;}
return RunDriver.pixelRatio;}
RunDriver.getIncludeStr=function(name){return null;}
RunDriver.createShaderCondition=function(conditionScript){var fn="(function() {return "+conditionScript+";})";return Browser.window.eval(fn);}
RunDriver.fontMap=[];RunDriver.measureText=function(txt,font){var isChinese=RunDriver.hanzi.test(txt);if(isChinese&&RunDriver.fontMap[font]){return RunDriver.fontMap[font];};var ctx=Browser.context;ctx.font=font;var r=ctx.measureText(txt);if(isChinese)RunDriver.fontMap[font]=r;return r;}
RunDriver.getWebGLContext=function(canvas){};RunDriver.beginFlush=function(){};RunDriver.endFinish=function(){};RunDriver.addToAtlas=null;RunDriver.flashFlushImage=function(atlasWebGLCanvas){};RunDriver.drawToCanvas=function(sprite,_renderType,canvasWidth,canvasHeight,offsetX,offsetY){var canvas=HTMLCanvas.create("2D");var context=new RenderContext(canvasWidth,canvasHeight,canvas);RenderSprite.renders[_renderType]._fun(sprite,context,offsetX,offsetY);return canvas;}
RunDriver.createParticleTemplate2D=null;RunDriver.createGLTextur=null;RunDriver.createWebGLContext2D=null;RunDriver.changeWebGLSize=function(w,h){};RunDriver.createRenderSprite=function(type,next){return new RenderSprite(type,next);}
RunDriver.createFilterAction=function(type){return new ColorFilterAction();}
RunDriver.createGraphics=function(){return new Graphics();}
RunDriver.clear=function(value){Render._context.ctx.clear();}
RunDriver.cancelLoadByUrl=function(url){};RunDriver.clearAtlas=function(value){};RunDriver.isAtlas=function(bitmap){return false;}
RunDriver.addTextureToAtlas=function(value){};RunDriver.getTexturePixels=function(value,x,y,width,height){return null;}
RunDriver.skinAniSprite=function(){return null;}
RunDriver.update3DLoop=function(){};__static(RunDriver,['hanzi',function(){return this.hanzi=new RegExp("^[\u4E00-\u9FA5]$");}]);return RunDriver;})()
var ___Laya=(function(){__getset(1,Laya,'alertGlobalError',null,function(value){var erralert=0;if(value){Browser.window.onerror=function(msg,url,line,column,detail){if(erralert++<5&&detail)
alert("出错啦，请把此信息截图给研发商\n"+msg+"\n"+detail.stack||detail);}}else{Browser.window.onerror=null;}});Laya.init=function(width,height,__plugins){var plugins=[];for(var i=2,sz=arguments.length;i<sz;i++)plugins.push(arguments[i]);if(Laya._isinit)return;ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=Laya._arrayBufferSlice);Laya._isinit=true;Browser.__init__();Context.__init__();Graphics.__init__();Laya.timer=new Timer();Laya.scaleTimer=new Timer();Laya.loader=new LoaderManager();WeakObject.__init__();for(var i=0,n=plugins.length;i<n;i++){if(plugins[i].enable)plugins[i].enable();}
Font.__init__();Style.__init__();ResourceManager.__init__();CacheManager.beginCheck();Laya._currentStage=Laya.stage=new Stage();Laya.stage.conchModel&&Laya.stage.conchModel.setRootNode();Laya.getUrlPath();Laya.render=new Render(0,0);Laya.stage.size(width,height);RenderSprite.__init__();KeyBoardManager.__init__();MouseManager.instance.__init__(Laya.stage,Render.canvas);Input.__init__();SoundManager.autoStopMusic=true;LocalStorage.__init__();return Render.canvas;}
Laya.getUrlPath=function(){var location=Browser.window.location;var pathName=location.pathname;pathName=pathName.charAt(2)==':'?pathName.substring(1):pathName;URL.rootPath=URL.basePath=URL.getPath(location.protocol=="file:"?pathName:location.protocol+"//"+location.host+location.pathname);}
Laya._arrayBufferSlice=function(start,end){var arr=this;var arrU8List=new Uint8Array(arr,start,end-start);var newU8List=new Uint8Array(arrU8List.length);newU8List.set(arrU8List);return newU8List.buffer;}
Laya._runScript=function(script){return Browser.window["e"+String.fromCharCode(100+10+8)+"a"+"l"](script);}
Laya.stage=null;Laya.timer=null;Laya.scaleTimer=null;Laya.loader=null;Laya.version="1.7.17";Laya.render=null;Laya._currentStage=null;Laya._isinit=false;Laya.MiniAdpter={init:function(){if(window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MiniGame")>-1)console.error("请先引用小游戏适配库laya.wxmini.js,详细教程：https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0")}};__static(Laya,['conchMarket',function(){return this.conchMarket=window.conch?conchMarket:null;},'PlatformClass',function(){return this.PlatformClass=window.PlatformClass;}]);return Laya;})()
var Config=(function(){function Config(){}
__class(Config,'Config');Config.WebGLTextCacheCount=500;Config.atlasEnable=false;Config.showCanvasMark=false;Config.animationInterval=50;Config.isAntialias=false;Config.isAlpha=false;Config.premultipliedAlpha=true;Config.isStencil=true;Config.preserveDrawingBuffer=false;return Config;})()
var EventDispatcher=(function(){var EventHandler;function EventDispatcher(){this._events=null;}
__class(EventDispatcher,'laya.events.EventDispatcher');var __proto=EventDispatcher.prototype;__proto.hasListener=function(type){var listener=this._events&&this._events[type];return!!listener;}
__proto.event=function(type,data){if(!this._events||!this._events[type])return false;var listeners=this._events[type];if(listeners.run){if(listeners.once)delete this._events[type];data!=null?listeners.runWith(data):listeners.run();}else{for(var i=0,n=listeners.length;i<n;i++){var listener=listeners[i];if(listener){(data!=null)?listener.runWith(data):listener.run();}
if(!listener||listener.once){listeners.splice(i,1);i--;n--;}}
if(listeners.length===0&&this._events)delete this._events[type];}
return true;}
__proto.on=function(type,caller,listener,args){return this._createListener(type,caller,listener,args,false);}
__proto.once=function(type,caller,listener,args){return this._createListener(type,caller,listener,args,true);}
__proto._createListener=function(type,caller,listener,args,once,offBefore){(offBefore===void 0)&&(offBefore=true);offBefore&&this.off(type,caller,listener,once);var handler=EventHandler.create(caller||this,listener,args,once);this._events||(this._events={});var events=this._events;if(!events[type])events[type]=handler;else{if(!events[type].run)events[type].push(handler);else events[type]=[events[type],handler];}
return this;}
__proto.off=function(type,caller,listener,onceOnly){(onceOnly===void 0)&&(onceOnly=false);if(!this._events||!this._events[type])return this;var listeners=this._events[type];if(listener!=null){if(listeners.run){if((!caller||listeners.caller===caller)&&listeners.method===listener&&(!onceOnly||listeners.once)){delete this._events[type];listeners.recover();}}else{var count=0;for(var i=0,n=listeners.length;i<n;i++){var item=listeners[i];if(item&&(!caller||item.caller===caller)&&item.method===listener&&(!onceOnly||item.once)){count++;listeners[i]=null;item.recover();}}
if(count===n)delete this._events[type];}}
return this;}
__proto.offAll=function(type){var events=this._events;if(!events)return this;if(type){this._recoverHandlers(events[type]);delete events[type];}else{for(var name in events){this._recoverHandlers(events[name]);}
this._events=null;}
return this;}
__proto._recoverHandlers=function(arr){if(!arr)return;if(arr.run){arr.recover();}else{for(var i=arr.length-1;i>-1;i--){if(arr[i]){arr[i].recover();arr[i]=null;}}}}
__proto.isMouseEvent=function(type){return EventDispatcher.MOUSE_EVENTS[type];}
EventDispatcher.MOUSE_EVENTS={"rightmousedown":true,"rightmouseup":true,"rightclick":true,"mousedown":true,"mouseup":true,"mousemove":true,"mouseover":true,"mouseout":true,"click":true,"doubleclick":true};EventDispatcher.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:false,writable:true});EventHandler=(function(_super){function EventHandler(caller,method,args,once){EventHandler.__super.call(this,caller,method,args,once);}
__class(EventHandler,'',_super);var __proto=EventHandler.prototype;__proto.recover=function(){if(this._id>0){this._id=0;EventHandler._pool.push(this.clear());}}
EventHandler.create=function(caller,method,args,once){(once===void 0)&&(once=true);if(EventHandler._pool.length)return EventHandler._pool.pop().setTo(caller,method,args,once);return new EventHandler(caller,method,args,once);}
EventHandler._pool=[];return EventHandler;})(Handler)}
return EventDispatcher;})()
var Handler=(function(){function Handler(caller,method,args,once){this.once=false;this._id=0;(once===void 0)&&(once=false);this.setTo(caller,method,args,once);}
__class(Handler,'laya.utils.Handler');var __proto=Handler.prototype;__proto.setTo=function(caller,method,args,once){this._id=Handler._gid++;this.caller=caller;this.method=method;this.args=args;this.once=once;return this;}
__proto.run=function(){if(this.method==null)return null;var id=this._id;var result=this.method.apply(this.caller,this.args);this._id===id&&this.once&&this.recover();return result;}
__proto.runWith=function(data){if(this.method==null)return null;var id=this._id;if(data==null)
var result=this.method.apply(this.caller,this.args);else if(!this.args&&!data.unshift)result=this.method.call(this.caller,data);else if(this.args)result=this.method.apply(this.caller,this.args.concat(data));else result=this.method.apply(this.caller,data);this._id===id&&this.once&&this.recover();return result;}
__proto.clear=function(){this.caller=null;this.method=null;this.args=null;return this;}
__proto.recover=function(){if(this._id>0){this._id=0;Handler._pool.push(this.clear());}}
Handler.create=function(caller,method,args,once){(once===void 0)&&(once=true);if(Handler._pool.length)return Handler._pool.pop().setTo(caller,method,args,once);return new Handler(caller,method,args,once);}
Handler._pool=[];Handler._gid=1;return Handler;})()
var BitmapFont=(function(){function BitmapFont(){this._texture=null;this._fontCharDic={};this._fontWidthMap={};this._complete=null;this._path=null;this._maxWidth=0;this._spaceWidth=10;this._padding=null;this.fontSize=12;this.autoScaleSize=false;this.letterSpacing=0;}
__class(BitmapFont,'laya.display.BitmapFont');var __proto=BitmapFont.prototype;__proto.loadFont=function(path,complete){this._path=path;this._complete=complete;Laya.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],Handler.create(this,this.onLoaded));}
__proto.onLoaded=function(){this.parseFont(Loader.getRes(this._path),Loader.getRes(this._path.replace(".fnt",".png")));this._complete&&this._complete.runWith(this._texture?this:null);}
__proto.parseFont=function(xml,texture){if(xml==null||texture==null)return;this._texture=texture;var tX=0;var tScale=1;var tInfo=xml.getElementsByTagName("info");if(!tInfo[0].getAttributeNode){return this.parseFont2(xml,texture);}
this.fontSize=parseInt(tInfo[0].getAttributeNode("size").nodeValue);var tPadding=tInfo[0].getAttributeNode("padding").nodeValue;var tPaddingArray=tPadding.split(",");this._padding=[parseInt(tPaddingArray[0]),parseInt(tPaddingArray[1]),parseInt(tPaddingArray[2]),parseInt(tPaddingArray[3])];var chars;chars=xml.getElementsByTagName("char");var i=0;for(i=0;i<chars.length;i++){var tAttribute=chars[i];var tId=parseInt(tAttribute.getAttributeNode("id").nodeValue);var xOffset=parseInt(tAttribute.getAttributeNode("xoffset").nodeValue)/tScale;var yOffset=parseInt(tAttribute.getAttributeNode("yoffset").nodeValue)/tScale;var xAdvance=parseInt(tAttribute.getAttributeNode("xadvance").nodeValue)/tScale;var region=new Rectangle();region.x=parseInt(tAttribute.getAttributeNode("x").nodeValue);region.y=parseInt(tAttribute.getAttributeNode("y").nodeValue);region.width=parseInt(tAttribute.getAttributeNode("width").nodeValue);region.height=parseInt(tAttribute.getAttributeNode("height").nodeValue);var tTexture=Texture.create(texture,region.x,region.y,region.width,region.height,xOffset,yOffset);this._maxWidth=Math.max(this._maxWidth,xAdvance+this.letterSpacing);this._fontCharDic[tId]=tTexture;this._fontWidthMap[tId]=xAdvance;}}
__proto.parseFont2=function(xml,texture){if(xml==null||texture==null)return;this._texture=texture;var tX=0;var tScale=1;var tInfo=xml.getElementsByTagName("info");this.fontSize=parseInt(tInfo[0].attributes["size"].nodeValue);var tPadding=tInfo[0].attributes["padding"].nodeValue;var tPaddingArray=tPadding.split(",");this._padding=[parseInt(tPaddingArray[0]),parseInt(tPaddingArray[1]),parseInt(tPaddingArray[2]),parseInt(tPaddingArray[3])];var chars=xml.getElementsByTagName("char");var i=0;for(i=0;i<chars.length;i++){var tAttribute=chars[i].attributes;var tId=parseInt(tAttribute["id"].nodeValue);var xOffset=parseInt(tAttribute["xoffset"].nodeValue)/tScale;var yOffset=parseInt(tAttribute["yoffset"].nodeValue)/tScale;var xAdvance=parseInt(tAttribute["xadvance"].nodeValue)/tScale;var region=new Rectangle();region.x=parseInt(tAttribute["x"].nodeValue);region.y=parseInt(tAttribute["y"].nodeValue);region.width=parseInt(tAttribute["width"].nodeValue);region.height=parseInt(tAttribute["height"].nodeValue);var tTexture=Texture.create(texture,region.x,region.y,region.width,region.height,xOffset,yOffset);this._maxWidth=Math.max(this._maxWidth,xAdvance+this.letterSpacing);this._fontCharDic[tId]=tTexture;this._fontWidthMap[tId]=xAdvance;}}
__proto.getCharTexture=function(char){return this._fontCharDic[char.charCodeAt(0)];}
__proto.destroy=function(){if(this._texture){for(var p in this._fontCharDic){var tTexture=this._fontCharDic[p];if(tTexture)tTexture.destroy();}
this._texture.destroy();this._fontCharDic=null;this._fontWidthMap=null;this._texture=null;}}
__proto.setSpaceWidth=function(spaceWidth){this._spaceWidth=spaceWidth;}
__proto.getCharWidth=function(char){var code=char.charCodeAt(0);if(this._fontWidthMap[code])return this._fontWidthMap[code]+this.letterSpacing;if(char==" ")return this._spaceWidth+this.letterSpacing;return 0;}
__proto.getTextWidth=function(text){var tWidth=0;for(var i=0,n=text.length;i<n;i++){tWidth+=this.getCharWidth(text.charAt(i));}
return tWidth;}
__proto.getMaxWidth=function(){return this._maxWidth;}
__proto.getMaxHeight=function(){return this.fontSize;}
__proto.drawText=function(text,sprite,drawX,drawY,align,width){var tWidth=this.getTextWidth(text);var tTexture;var dx=0;align==="center"&&(dx=(width-tWidth)/2);align==="right"&&(dx=(width-tWidth));var tX=0;for(var i=0,n=text.length;i<n;i++){tTexture=this.getCharTexture(text.charAt(i));if(tTexture){sprite.graphics.drawTexture(tTexture,drawX+tX+dx,drawY);tX+=this.getCharWidth(text.charAt(i));}}}
return BitmapFont;})()
var Style=(function(){function Style(){this.alpha=1;this.visible=true;this.scrollRect=null;this.blendMode=null;this._type=0;this._tf=Style._TF_EMPTY;}
__class(Style,'laya.display.css.Style');var __proto=Style.prototype;__proto.getTransform=function(){return this._tf;}
__proto.setTransform=function(value){this._tf=value==='none'||!value?Style._TF_EMPTY:value;}
__proto.setTranslateX=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.translateX=value;}
__proto.setTranslateY=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.translateY=value;}
__proto.setScaleX=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.scaleX=value;}
__proto.setScale=function(x,y){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.scaleX=x;this._tf.scaleY=y;}
__proto.setScaleY=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.scaleY=value;}
__proto.setRotate=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.rotate=value;}
__proto.setSkewX=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.skewX=value;}
__proto.setSkewY=function(value){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.skewY=value;}
__proto.destroy=function(){this.scrollRect=null;}
__proto.render=function(sprite,context,x,y){}
__proto.getCSSStyle=function(){return CSSStyle.EMPTY;}
__proto._enableLayout=function(){return false;}
__getset(0,__proto,'scaleX',function(){return this._tf.scaleX;},function(value){this.setScaleX(value);});__getset(0,__proto,'transform',function(){return this.getTransform();},function(value){this.setTransform(value);});__getset(0,__proto,'translateX',function(){return this._tf.translateX;},function(value){this.setTranslateX(value);});__getset(0,__proto,'translateY',function(){return this._tf.translateY;},function(value){this.setTranslateY(value);});__getset(0,__proto,'scaleY',function(){return this._tf.scaleY;},function(value){this.setScaleY(value);});__getset(0,__proto,'block',function(){return(this._type&0x1)!=0;});__getset(0,__proto,'skewY',function(){return this._tf.skewY;},function(value){this.setSkewY(value);});__getset(0,__proto,'rotate',function(){return this._tf.rotate;},function(value){this.setRotate(value);});__getset(0,__proto,'skewX',function(){return this._tf.skewX;},function(value){this.setSkewX(value);});__getset(0,__proto,'paddingLeft',function(){return 0;});__getset(0,__proto,'paddingTop',function(){return 0;});__getset(0,__proto,'absolute',function(){return true;});Style.__init__=function(){Style._TF_EMPTY=new TransformInfo();Style.EMPTY=new Style();}
Style.EMPTY=null;Style._TF_EMPTY=null;return Style;})()
var Font=(function(){function Font(src){this._type=0;this._weight=0;this._decoration=null;this._text=null;this.indent=0;this._color=Color.create(Font.defaultColor);this.family=Font.defaultFamily;this.stroke=Font._STROKE;this.size=Font.defaultSize;src&&src!==Font.EMPTY&&src.copyTo(this);}
__class(Font,'laya.display.css.Font');var __proto=Font.prototype;__proto.set=function(value){this._text=null;var strs=value.split(' ');for(var i=0,n=strs.length;i<n;i++){var str=strs[i];switch(str){case'italic':this.italic=true;continue;case'bold':this.bold=true;continue;}
if(str.indexOf('px')>0){this.size=parseInt(str);this.family=strs[i+1];i++;continue;}}}
__proto.toString=function(){this._text=""
this.italic&&(this._text+="italic ");this.bold&&(this._text+="bold ");return this._text+=this.size+"px "+this.family;}
__proto.copyTo=function(dec){dec._type=this._type;dec._text=this._text;dec._weight=this._weight;dec._color=this._color;dec.family=this.family;dec.stroke=this.stroke!=Font._STROKE?this.stroke.slice():Font._STROKE;dec.indent=this.indent;dec.size=this.size;}
__getset(0,__proto,'password',function(){return(this._type&0x400)!==0;},function(value){value?(this._type|=0x400):(this._type&=~0x400);});__getset(0,__proto,'color',function(){return this._color.strColor;},function(value){this._color=Color.create(value);});__getset(0,__proto,'italic',function(){return(this._type&0x200)!==0;},function(value){value?(this._type|=0x200):(this._type&=~0x200);});__getset(0,__proto,'bold',function(){return(this._type&0x800)!==0;},function(value){value?(this._type|=0x800):(this._type&=~0x800);});__getset(0,__proto,'weight',function(){return""+this._weight;},function(value){var weight=0;switch(value){case'normal':break;case'bold':this.bold=true;weight=700;break;case'bolder':weight=800;break;case'lighter':weight=100;break;default:weight=parseInt(value);}
this._weight=weight;this._text=null;});__getset(0,__proto,'decoration',function(){return this._decoration?this._decoration.value:"none";},function(value){var strs=value.split(' ');this._decoration||(this._decoration={});switch(strs[0]){case'_':this._decoration.type='underline'
break;case'-':this._decoration.type='line-through'
break;case'overline':this._decoration.type='overline'
break;default:this._decoration.type=strs[0];}
strs[1]&&(this._decoration.color=Color.create(strs));this._decoration.value=value;});Font.__init__=function(){Font.EMPTY=new Font(null);}
Font.EMPTY=null;Font.defaultColor="#000000";Font.defaultSize=12;Font.defaultFamily="Arial";Font.defaultFont="12px Arial";Font._STROKE=[0,"#000000"];Font._ITALIC=0x200;Font._PASSWORD=0x400;Font._BOLD=0x800;return Font;})()
var TransformInfo=(function(){function TransformInfo(){this.translateX=0;this.translateY=0;this.scaleX=1;this.scaleY=1;this.rotate=0;this.skewX=0;this.skewY=0;}
__class(TransformInfo,'laya.display.css.TransformInfo');return TransformInfo;})()
var Graphics=(function(){function Graphics(){this._one=null;this._cmds=null;this._render=this._renderEmpty;if(Render.isConchNode){var _this_=this;_this_._nativeObj=new(window)._conchGraphics();_this_.id=_this_._nativeObj.conchID;}}
__class(Graphics,'laya.display.Graphics');var __proto=Graphics.prototype;__proto.destroy=function(){this.clear();if(this._graphicBounds)this._graphicBounds.destroy();this._graphicBounds=null;this._vectorgraphArray=null;this._sp&&(this._sp._renderType=0);this._sp=null;}
__proto.clear=function(recoverCmds){(recoverCmds===void 0)&&(recoverCmds=false);var i=0,len=0;if(recoverCmds){var tCmd=this._one;if(this._cmds){len=this._cmds.length;for(i=0;i<len;i++){tCmd=this._cmds[i];if(tCmd&&(tCmd.callee===Render._context._drawTexture||tCmd.callee===Render._context._drawTextureWithTransform)){tCmd[0]=null;Graphics._cache.push(tCmd);}}
this._cmds.length=0;}else if(tCmd){if(tCmd&&(tCmd.callee===Render._context._drawTexture||tCmd.callee===Render._context._drawTextureWithTransform)){tCmd[0]=null;Graphics._cache.push(tCmd);}}}else{this._cmds=null;}
this._one=null;this._render=this._renderEmpty;this._sp&&(this._sp._renderType&=~0x01&~0x200);this._repaint();if(this._vectorgraphArray){for(i=0,len=this._vectorgraphArray.length;i<len;i++){VectorGraphManager.getInstance().deleteShape(this._vectorgraphArray[i]);}
this._vectorgraphArray.length=0;}}
__proto._clearBoundsCache=function(){if(this._graphicBounds)this._graphicBounds.reset();}
__proto._initGraphicBounds=function(){if(!this._graphicBounds){this._graphicBounds=new GraphicsBounds();this._graphicBounds._graphics=this;}}
__proto._repaint=function(){this._clearBoundsCache();this._sp&&this._sp.repaint();}
__proto._isOnlyOne=function(){return!this._cmds||this._cmds.length===0;}
__proto.getBounds=function(realSize){(realSize===void 0)&&(realSize=false);this._initGraphicBounds();return this._graphicBounds.getBounds(realSize);}
__proto.getBoundPoints=function(realSize){(realSize===void 0)&&(realSize=false);this._initGraphicBounds();return this._graphicBounds.getBoundPoints(realSize);}
__proto._addCmd=function(a){this._cmds=this._cmds||[];a.callee=a.shift();this._cmds.push(a);}
__proto.setFilters=function(fs){this._saveToCmd(Render._context._setFilters,fs);}
__proto.drawTexture=function(tex,x,y,width,height,m,alpha){(x===void 0)&&(x=0);(y===void 0)&&(y=0);(width===void 0)&&(width=0);(height===void 0)&&(height=0);(alpha===void 0)&&(alpha=1);if(!tex||alpha<0.01)return null;if(!width)width=tex.sourceWidth;if(!height)height=tex.sourceHeight;alpha=alpha<0?0:(alpha>1?1:alpha);var offset=(!Render.isWebGL&&(Browser.onFirefox||Browser.onEdge||Browser.onIE||Browser.onSafari))?0.5:0;var wRate=width/tex.sourceWidth;var hRate=height/tex.sourceHeight;width=tex.width*wRate;height=tex.height*hRate;if(tex.loaded&&(width<=0||height<=0))return null;x+=tex.offsetX*wRate;y+=tex.offsetY*hRate;this._sp&&(this._sp._renderType|=0x200);var args;x-=offset;y-=offset;width+=2*offset;height+=2*offset;if(Graphics._cache.length){args=Graphics._cache.pop();args[0]=tex;args[1]=x;args[2]=y;args[3]=width;args[4]=height;args[5]=m;args[6]=alpha;}else{args=[tex,x,y,width,height,m,alpha];}
args.callee=(m||alpha!=1)?Render._context._drawTextureWithTransform:Render._context._drawTexture;if(this._one==null&&!m&&alpha==1){this._one=args;this._render=this._renderOneImg;}else{this._saveToCmd(args.callee,args);}
if(!tex.loaded){tex.once("loaded",this,this._textureLoaded,[tex,args]);}
this._repaint();return args;}
__proto.cleanByTexture=function(tex,x,y,width,height){(width===void 0)&&(width=0);(height===void 0)&&(height=0);if(!tex)return this.clear();if(this._one&&this._render===this._renderOneImg){if(!width)width=tex.sourceWidth;if(!height)height=tex.sourceHeight;var wRate=width/tex.sourceWidth;var hRate=height/tex.sourceHeight;width=tex.width*wRate;height=tex.height*hRate;x+=tex.offsetX*wRate;y+=tex.offsetY*hRate;this._one[0]=tex;this._one[1]=x;this._one[2]=y;this._one[3]=width;this._one[4]=height;}else{this.clear();tex&&this.drawTexture(tex,x,y,width,height);}}
__proto.drawTextures=function(tex,pos){if(!tex)return;this._saveToCmd(Render._context._drawTextures,[tex,pos]);}
__proto.fillTexture=function(tex,x,y,width,height,type,offset){(width===void 0)&&(width=0);(height===void 0)&&(height=0);(type===void 0)&&(type="repeat");if(!tex)return;var args=[tex,x,y,width,height,type,offset||Point.EMPTY,{}];if(!tex.loaded){tex.once("loaded",this,this._textureLoaded,[tex,args]);}
this._saveToCmd(Render._context._fillTexture,args);}
__proto._textureLoaded=function(tex,param){param[3]=param[3]||tex.width;param[4]=param[4]||tex.height;this._repaint();}
__proto.fillCircle=function(x,y,tex,cx,cy,radius,segNum){tex.bitmap.enableMerageInAtlas=false;var verts=new Float32Array((segNum+1)*2);var uvs=new Float32Array((segNum+1)*2);var indices=new Uint16Array(segNum*3);var dang=2*Math.PI/segNum;var cang=0;verts[0]=cx;verts[1]=cy;uvs[0]=cx/tex.width;uvs[1]=cy/tex.height;var idx=2;for(var i=0;i<segNum;i++){var px=radius*Math.cos(cang)+cx;var py=radius*Math.sin(cang)+cy;verts[idx]=px;verts[idx+1]=py;uvs[idx]=px/tex.width;uvs[idx+1]=py/tex.height;cang+=dang;idx+=2;}
idx=0;for(i=0;i<segNum;i++){indices[idx++]=0;indices[idx++]=i+1;indices[idx++]=(i+2>=segNum+1)?1:(i+2);}
this.drawTriangles(tex,x,y,verts,uvs,indices);}
__proto.drawTriangles=function(texture,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode){(alpha===void 0)&&(alpha=1);this._saveToCmd(Render._context.drawTriangles,[texture,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode]);}
__proto._saveToCmd=function(fun,args){this._sp&&(this._sp._renderType|=0x200);if(this._one==null){this._one=args;this._render=this._renderOne;}else{this._sp&&(this._sp._renderType&=~0x01);this._render=this._renderAll;(this._cmds||(this._cmds=[])).length===0&&this._cmds.push(this._one);this._cmds.push(args);}
args.callee=fun;this._repaint();return args;}
__proto.clipRect=function(x,y,width,height){this._saveToCmd(Render._context._clipRect,[x,y,width,height]);}
__proto.fillText=function(text,x,y,font,color,textAlign,underLine){(underLine===void 0)&&(underLine=0);this._saveToCmd(Render._context._fillText,[text,x,y,font||Font.defaultFont,color,textAlign]);}
__proto.fillBorderText=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){this._saveToCmd(Render._context._fillBorderText,[text,x,y,font||Font.defaultFont,fillColor,borderColor,lineWidth,textAlign]);}
__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){this._saveToCmd(Render._context._strokeText,[text,x,y,font||Font.defaultFont,color,lineWidth,textAlign]);}
__proto.alpha=function(value){value=value<0?0:(value>1?1:value);this._saveToCmd(Render._context._alpha,[value]);}
__proto.setAlpha=function(value){value=value<0?0:(value>1?1:value);this._saveToCmd(Render._context._setAlpha,[value]);}
__proto.transform=function(matrix,pivotX,pivotY){(pivotX===void 0)&&(pivotX=0);(pivotY===void 0)&&(pivotY=0);this._saveToCmd(Render._context._transform,[matrix,pivotX,pivotY]);}
__proto.rotate=function(angle,pivotX,pivotY){(pivotX===void 0)&&(pivotX=0);(pivotY===void 0)&&(pivotY=0);this._saveToCmd(Render._context._rotate,[angle,pivotX,pivotY]);}
__proto.scale=function(scaleX,scaleY,pivotX,pivotY){(pivotX===void 0)&&(pivotX=0);(pivotY===void 0)&&(pivotY=0);this._saveToCmd(Render._context._scale,[scaleX,scaleY,pivotX,pivotY]);}
__proto.translate=function(x,y){this._saveToCmd(Render._context._translate,[x,y]);}
__proto.save=function(){this._saveToCmd(Render._context._save,[]);}
__proto.restore=function(){this._saveToCmd(Render._context._restore,[]);}
__proto.replaceText=function(text){this._repaint();var cmds=this._cmds;if(!cmds){if(this._one&&this._isTextCmd(this._one.callee)){if(this._one[0].toUpperCase)this._one[0]=text;else this._one[0].setText(text);return true;}}else{for(var i=cmds.length-1;i>-1;i--){if(this._isTextCmd(cmds[i].callee)){if(cmds[i][0].toUpperCase)cmds[i][0]=text;else cmds[i][0].setText(text);return true;}}}
return false;}
__proto._isTextCmd=function(fun){return fun===Render._context._fillText||fun===Render._context._fillBorderText||fun===Render._context._strokeText;}
__proto.replaceTextColor=function(color){this._repaint();var cmds=this._cmds;if(!cmds){if(this._one&&this._isTextCmd(this._one.callee)){this._one[4]=color;if(!this._one[0].toUpperCase)this._one[0].changed=true;}}else{for(var i=cmds.length-1;i>-1;i--){if(this._isTextCmd(cmds[i].callee)){cmds[i][4]=color;if(!cmds[i][0].toUpperCase)cmds[i][0].changed=true;}}}}
__proto.loadImage=function(url,x,y,width,height,complete){var _$this=this;(x===void 0)&&(x=0);(y===void 0)&&(y=0);(width===void 0)&&(width=0);(height===void 0)&&(height=0);var tex=Loader.getRes(url);if(tex)onloaded(tex);else Laya.loader.load(url,Handler.create(null,onloaded),null,"image");function onloaded(tex){if(tex){_$this.drawTexture(tex,x,y,width,height);if(complete!=null)complete.call(_$this._sp,tex);}}}
__proto._renderEmpty=function(sprite,context,x,y){}
__proto._renderAll=function(sprite,context,x,y){var cmds=this._cmds,cmd;for(var i=0,n=cmds.length;i<n;i++){(cmd=cmds[i]).callee.call(context,x,y,cmd);}}
__proto._renderOne=function(sprite,context,x,y){this._one.callee.call(context,x,y,this._one);}
__proto._renderOneImg=function(sprite,context,x,y){this._one.callee.call(context,x,y,this._one);if(sprite._renderType!==2305){sprite._renderType|=0x01;}}
__proto.drawLine=function(fromX,fromY,toX,toY,lineColor,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var tId=0;if(Render.isWebGL){tId=VectorGraphManager.getInstance().getId();if(this._vectorgraphArray==null)this._vectorgraphArray=[];this._vectorgraphArray.push(tId);};var offset=lineWidth%2===0?0:0.5;var arr=[fromX+offset,fromY+offset,toX+offset,toY+offset,lineColor,lineWidth,tId];this._saveToCmd(Render._context._drawLine,arr);}
__proto.drawLines=function(x,y,points,lineColor,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var tId=0;if(!points||points.length<4)return;if(Render.isWebGL){tId=VectorGraphManager.getInstance().getId();if(this._vectorgraphArray==null)this._vectorgraphArray=[];this._vectorgraphArray.push(tId);};var offset=lineWidth%2===0?0:0.5;var arr=[x+offset,y+offset,points,lineColor,lineWidth,tId];this._saveToCmd(Render._context._drawLines,arr);}
__proto.drawCurves=function(x,y,points,lineColor,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var arr=[x,y,points,lineColor,lineWidth];this._saveToCmd(Render._context._drawCurves,arr);}
__proto.drawRect=function(x,y,width,height,fillColor,lineColor,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var offset=lineColor?lineWidth/2:0;var lineOffset=lineColor?lineWidth:0;var arr=[x+offset,y+offset,width-lineOffset,height-lineOffset,fillColor,lineColor,lineWidth];this._saveToCmd(Render._context._drawRect,arr);}
__proto.drawCircle=function(x,y,radius,fillColor,lineColor,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var offset=lineColor?lineWidth/2:0;var tId=0;if(Render.isWebGL){tId=VectorGraphManager.getInstance().getId();if(this._vectorgraphArray==null)this._vectorgraphArray=[];this._vectorgraphArray.push(tId);};var arr=[x,y,radius-offset,fillColor,lineColor,lineWidth,tId];this._saveToCmd(Render._context._drawCircle,arr);}
__proto.drawPie=function(x,y,radius,startAngle,endAngle,fillColor,lineColor,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var offset=lineColor?lineWidth/2:0;var lineOffset=lineColor?lineWidth:0;var tId=0;if(Render.isWebGL){tId=VectorGraphManager.getInstance().getId();if(this._vectorgraphArray==null)this._vectorgraphArray=[];this._vectorgraphArray.push(tId);};var arr=[x+offset,y+offset,radius-lineOffset,startAngle,endAngle,fillColor,lineColor,lineWidth,tId];arr[3]=Utils.toRadian(startAngle);arr[4]=Utils.toRadian(endAngle);this._saveToCmd(Render._context._drawPie,arr);}
__proto.drawPoly=function(x,y,points,fillColor,lineColor,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var tId=0;var tIsConvexPolygon=false;if(Render.isWebGL){tId=VectorGraphManager.getInstance().getId();if(this._vectorgraphArray==null)this._vectorgraphArray=[];this._vectorgraphArray.push(tId);if(points.length>6){tIsConvexPolygon=false;}else{tIsConvexPolygon=true;}};var offset=lineColor?(lineWidth%2===0?0:0.5):0;var arr=[x+offset,y+offset,points,fillColor,lineColor,lineWidth,tId,tIsConvexPolygon];this._saveToCmd(Render._context._drawPoly,arr);}
__proto.drawPath=function(x,y,paths,brush,pen){var arr=[x,y,paths,brush,pen];this._saveToCmd(Render._context._drawPath,arr);}
__getset(0,__proto,'cmds',function(){return this._cmds;},function(value){this._sp&&(this._sp._renderType|=0x200);this._cmds=value;this._render=this._renderAll;this._repaint();});Graphics.__init__=function(){if(Render.isConchNode){var from=laya.display.Graphics.prototype;var to=Browser.window.ConchGraphics.prototype;var list=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"];for(var i=0,len=list.length;i<=len;i++){var temp=list[i];from[temp]=to[temp];}
from._saveToCmd=null;if(to.drawImageS){from.drawTextures=function(tex,pos){if(!tex)return;if(!(tex.loaded&&tex.bitmap&&tex.source)){return;};var uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;this.drawImageS(tex.bitmap.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,tex.offsetX,tex.offsetY,tex.width,tex.height,pos);}}
from.drawTexture=function(tex,x,y,width,height,m,alpha){(x===void 0)&&(x=0);(y===void 0)&&(y=0);(width===void 0)&&(width=0);(height===void 0)&&(height=0);(alpha===void 0)&&(alpha=1);if(!tex)return;if(!tex.loaded){tex.once("loaded",this,function(){this.drawTexture(tex,x,y,width,height,m);});return;}
if(!(tex.loaded&&tex.bitmap&&tex.source)){return;}
if(!width)width=tex.sourceWidth;if(!height)height=tex.sourceHeight;alpha=alpha<0?0:(alpha>1?1:alpha);width=width-tex.sourceWidth+tex.width;height=height-tex.sourceHeight+tex.height;if(width<=0||height<=0)return;x+=tex.offsetX;y+=tex.offsetY;var uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;this.drawImageM(tex.bitmap.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x,y,width,height,m,alpha);this._repaint();}
from.fillTexture=function(tex,x,y,width,height,type,offset){(width===void 0)&&(width=0);(height===void 0)&&(height=0);(type===void 0)&&(type="repeat");if(!tex)return;if(tex.loaded){var ctxi=Render._context.ctx;var w=tex.bitmap.width,h=tex.bitmap.height,uv=tex.uv;var pat;if(tex.uv!=Texture.DEF_UV){pat=ctxi.createPattern(tex.bitmap.source,type,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h);}else{pat=ctxi.createPattern(tex.bitmap.source,type);};var sX=0,sY=0;if(offset){x+=offset.x%tex.width;y+=offset.y%tex.height;sX-=offset.x%tex.width;sY-=offset.y%tex.height;}
this._fillImage(pat,x,y,sX,sY,width,height);}}}}
Graphics._cache=[];return Graphics;})()
var GraphicsBounds=(function(){function GraphicsBounds(){this._cacheBoundsType=false;}
__class(GraphicsBounds,'laya.display.GraphicsBounds');var __proto=GraphicsBounds.prototype;__proto.destroy=function(){this._graphics=null;this._temp=null;this._rstBoundPoints=null;this._bounds=null;}
__proto.reset=function(){this._temp&&(this._temp.length=0);}
__proto.getBounds=function(realSize){(realSize===void 0)&&(realSize=false);if(!this._bounds||!this._temp||this._temp.length<1||realSize!=this._cacheBoundsType){this._bounds=Rectangle._getWrapRec(this.getBoundPoints(realSize),this._bounds)}
this._cacheBoundsType=realSize;return this._bounds;}
__proto.getBoundPoints=function(realSize){(realSize===void 0)&&(realSize=false);if(!this._temp||this._temp.length<1||realSize!=this._cacheBoundsType)
this._temp=this._getCmdPoints(realSize);this._cacheBoundsType=realSize;return this._rstBoundPoints=Utils.copyArray(this._rstBoundPoints,this._temp);}
__proto._getCmdPoints=function(realSize){(realSize===void 0)&&(realSize=false);var context=Render._context;var cmds=this._graphics.cmds;var rst;rst=this._temp||(this._temp=[]);rst.length=0;if(!cmds&&this._graphics._one!=null){GraphicsBounds._tempCmds.length=0;GraphicsBounds._tempCmds.push(this._graphics._one);cmds=GraphicsBounds._tempCmds;}
if(!cmds)
return rst;var matrixs;matrixs=GraphicsBounds._tempMatrixArrays;matrixs.length=0;var tMatrix=GraphicsBounds._initMatrix;tMatrix.identity();var tempMatrix=GraphicsBounds._tempMatrix;var cmd;var tex;var wRate=NaN;var hRate=NaN;var oWidth=NaN;var oHeight=NaN;var offX=NaN;var offY=NaN;for(var i=0,n=cmds.length;i<n;i++){cmd=cmds[i];if(!cmd.callee)continue;switch(cmd.callee){case context._save:case 7:matrixs.push(tMatrix);tMatrix=tMatrix.clone();break;case context._restore:case 8:tMatrix=matrixs.pop();break;case context._scale:case 5:tempMatrix.identity();tempMatrix.translate(-cmd[2],-cmd[3]);tempMatrix.scale(cmd[0],cmd[1]);tempMatrix.translate(cmd[2],cmd[3]);this._switchMatrix(tMatrix,tempMatrix);break;case context._rotate:case 3:tempMatrix.identity();tempMatrix.translate(-cmd[1],-cmd[2]);tempMatrix.rotate(cmd[0]);tempMatrix.translate(cmd[1],cmd[2]);this._switchMatrix(tMatrix,tempMatrix);break;case context._translate:case 6:tempMatrix.identity();tempMatrix.translate(cmd[0],cmd[1]);this._switchMatrix(tMatrix,tempMatrix);break;case context._transform:case 4:tempMatrix.identity();tempMatrix.translate(-cmd[1],-cmd[2]);tempMatrix.concat(cmd[0]);tempMatrix.translate(cmd[1],cmd[2]);this._switchMatrix(tMatrix,tempMatrix);break;case 16:case 24:GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tMatrix);break;case 17:tMatrix.copyTo(tempMatrix);tempMatrix.concat(cmd[4]);GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tempMatrix);break;case context._drawTexture:tex=cmd[0];if(realSize){if(cmd[3]&&cmd[4]){GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix);}else{tex=cmd[0];GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),tMatrix);}}else{wRate=(cmd[3]||tex.sourceWidth)/tex.width;hRate=(cmd[4]||tex.sourceHeight)/tex.height;oWidth=wRate*tex.sourceWidth;oHeight=hRate*tex.sourceHeight;offX=tex.offsetX>0?tex.offsetX:0;offY=tex.offsetY>0?tex.offsetY:0;offX*=wRate;offY*=hRate;GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1]-offX,cmd[2]-offY,oWidth,oHeight),tMatrix);}
break;case context._fillTexture:if(cmd[3]&&cmd[4]){GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix);}else{tex=cmd[0];GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),tMatrix);}
break;case context._drawTextureWithTransform:;var drawMatrix;if(cmd[5]){tMatrix.copyTo(tempMatrix);tempMatrix.concat(cmd[5]);drawMatrix=tempMatrix;}else{drawMatrix=tMatrix;}
if(realSize){if(cmd[3]&&cmd[4]){GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],cmd[3],cmd[4]),drawMatrix);}else{tex=cmd[0];GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1],cmd[2],tex.width,tex.height),drawMatrix);}}else{tex=cmd[0];wRate=(cmd[3]||tex.sourceWidth)/tex.width;hRate=(cmd[4]||tex.sourceHeight)/tex.height;oWidth=wRate*tex.sourceWidth;oHeight=hRate*tex.sourceHeight;offX=tex.offsetX>0?tex.offsetX:0;offY=tex.offsetY>0?tex.offsetY:0;offX*=wRate;offY*=hRate;GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[1]-offX,cmd[2]-offY,oWidth,oHeight),drawMatrix);}
break;case context._drawRect:case 13:GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0],cmd[1],cmd[2],cmd[3]),tMatrix);break;case context._drawCircle:case context._fillCircle:case 14:GraphicsBounds._addPointArrToRst(rst,Rectangle._getBoundPointS(cmd[0]-cmd[2],cmd[1]-cmd[2],cmd[2]+cmd[2],cmd[2]+cmd[2]),tMatrix);break;case context._drawLine:case 20:GraphicsBounds._tempPoints.length=0;var lineWidth=NaN;lineWidth=cmd[5]*0.5;if(cmd[0]==cmd[2]){GraphicsBounds._tempPoints.push(cmd[0]+lineWidth,cmd[1],cmd[2]+lineWidth,cmd[3],cmd[0]-lineWidth,cmd[1],cmd[2]-lineWidth,cmd[3]);}else if(cmd[1]==cmd[3]){GraphicsBounds._tempPoints.push(cmd[0],cmd[1]+lineWidth,cmd[2],cmd[3]+lineWidth,cmd[0],cmd[1]-lineWidth,cmd[2],cmd[3]-lineWidth);}else{GraphicsBounds._tempPoints.push(cmd[0],cmd[1],cmd[2],cmd[3]);}
GraphicsBounds._addPointArrToRst(rst,GraphicsBounds._tempPoints,tMatrix);break;case context._drawCurves:case 22:GraphicsBounds._addPointArrToRst(rst,Bezier.I.getBezierPoints(cmd[2]),tMatrix,cmd[0],cmd[1]);break;case context._drawPoly:case context._drawLines:case 18:GraphicsBounds._addPointArrToRst(rst,cmd[2],tMatrix,cmd[0],cmd[1]);break;case context._drawPath:case 19:GraphicsBounds._addPointArrToRst(rst,this._getPathPoints(cmd[2]),tMatrix,cmd[0],cmd[1]);break;case context._drawPie:case 15:GraphicsBounds._addPointArrToRst(rst,this._getPiePoints(cmd[0],cmd[1],cmd[2],cmd[3],cmd[4]),tMatrix);break;}}
if(rst.length>200){rst=Utils.copyArray(rst,Rectangle._getWrapRec(rst)._getBoundPoints());}else if(rst.length>8)
rst=GrahamScan.scanPList(rst);return rst;}
__proto._switchMatrix=function(tMatix,tempMatrix){tempMatrix.concat(tMatix);tempMatrix.copyTo(tMatix);}
__proto._getPiePoints=function(x,y,radius,startAngle,endAngle){var rst=GraphicsBounds._tempPoints;GraphicsBounds._tempPoints.length=0;rst.push(x,y);var delta=(endAngle-startAngle)%(2*Math.PI);var segnum=10;var step=delta/segnum;var i=NaN;var angle=startAngle;for(i=0;i<=segnum;i++){rst.push(x+radius*Math.cos(angle),y+radius*Math.sin(angle));angle+=step;}
return rst;}
__proto._getPathPoints=function(paths){var i=0,len=0;var rst=GraphicsBounds._tempPoints;rst.length=0;len=paths.length;var tCMD;for(i=0;i<len;i++){tCMD=paths[i];if(tCMD.length>1){rst.push(tCMD[1],tCMD[2]);if(tCMD.length>3){rst.push(tCMD[3],tCMD[4]);}}}
return rst;}
GraphicsBounds._addPointArrToRst=function(rst,points,matrix,dx,dy){(dx===void 0)&&(dx=0);(dy===void 0)&&(dy=0);var i=0,len=0;len=points.length;for(i=0;i<len;i+=2){GraphicsBounds._addPointToRst(rst,points[i]+dx,points[i+1]+dy,matrix);}}
GraphicsBounds._addPointToRst=function(rst,x,y,matrix){var _tempPoint=Point.TEMP;_tempPoint.setTo(x?x:0,y?y:0);matrix.transformPoint(_tempPoint);rst.push(_tempPoint.x,_tempPoint.y);}
GraphicsBounds._tempPoints=[];GraphicsBounds._tempMatrixArrays=[];GraphicsBounds._tempCmds=[];__static(GraphicsBounds,['_tempMatrix',function(){return this._tempMatrix=new Matrix();},'_initMatrix',function(){return this._initMatrix=new Matrix();}]);return GraphicsBounds;})()
var Event=(function(){function Event(){}
__class(Event,'laya.events.Event');var __proto=Event.prototype;__proto.setTo=function(type,currentTarget,target){this.type=type;this.currentTarget=currentTarget;this.target=target;return this;}
__proto.stopPropagation=function(){this._stoped=true;}
__getset(0,__proto,'stageY',function(){return Laya.stage.mouseY;});__getset(0,__proto,'charCode',function(){return this.nativeEvent.charCode;});__getset(0,__proto,'touches',function(){var arr=this.nativeEvent.touches;if(arr){var stage=Laya.stage;for(var i=0,n=arr.length;i<n;i++){var e=arr[i];var point=Point.TEMP;point.setTo(e.clientX,e.clientY);stage._canvasTransform.invertTransformPoint(point);stage.transform.invertTransformPoint(point);e.stageX=point.x;e.stageY=point.y;}}
return arr;});__getset(0,__proto,'keyLocation',function(){return this.nativeEvent.keyLocation;});__getset(0,__proto,'ctrlKey',function(){return this.nativeEvent.ctrlKey;});__getset(0,__proto,'altKey',function(){return this.nativeEvent.altKey;});__getset(0,__proto,'shiftKey',function(){return this.nativeEvent.shiftKey;});__getset(0,__proto,'stageX',function(){return Laya.stage.mouseX;});Event.EMPTY=new Event();Event.MOUSE_DOWN="mousedown";Event.MOUSE_UP="mouseup";Event.CLICK="click";Event.RIGHT_MOUSE_DOWN="rightmousedown";Event.RIGHT_MOUSE_UP="rightmouseup";Event.RIGHT_CLICK="rightclick";Event.MOUSE_MOVE="mousemove";Event.MOUSE_OVER="mouseover";Event.MOUSE_OUT="mouseout";Event.MOUSE_WHEEL="mousewheel";Event.ROLL_OVER="mouseover";Event.ROLL_OUT="mouseout";Event.DOUBLE_CLICK="doubleclick";Event.CHANGE="change";Event.CHANGED="changed";Event.RESIZE="resize";Event.ADDED="added";Event.REMOVED="removed";Event.DISPLAY="display";Event.UNDISPLAY="undisplay";Event.ERROR="error";Event.COMPLETE="complete";Event.LOADED="loaded";Event.PROGRESS="progress";Event.INPUT="input";Event.RENDER="render";Event.OPEN="open";Event.MESSAGE="message";Event.CLOSE="close";Event.KEY_DOWN="keydown";Event.KEY_PRESS="keypress";Event.KEY_UP="keyup";Event.FRAME="enterframe";Event.DRAG_START="dragstart";Event.DRAG_MOVE="dragmove";Event.DRAG_END="dragend";Event.ENTER="enter";Event.SELECT="select";Event.BLUR="blur";Event.FOCUS="focus";Event.VISIBILITY_CHANGE="visibilitychange";Event.FOCUS_CHANGE="focuschange";Event.PLAYED="played";Event.PAUSED="paused";Event.STOPPED="stopped";Event.START="start";Event.END="end";Event.ENABLE_CHANGED="enablechanged";Event.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged";Event.COMPONENT_ADDED="componentadded";Event.COMPONENT_REMOVED="componentremoved";Event.LAYER_CHANGED="layerchanged";Event.HIERARCHY_LOADED="hierarchyloaded";Event.RECOVERED="recovered";Event.RELEASED="released";Event.LINK="link";Event.LABEL="label";Event.FULL_SCREEN_CHANGE="fullscreenchange";Event.DEVICE_LOST="devicelost";Event.MESH_CHANGED="meshchanged";Event.MATERIAL_CHANGED="materialchanged";Event.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged";Event.ANIMATION_CHANGED="animationchanged";Event.TRIGGER_ENTER="triggerenter";Event.TRIGGER_STAY="triggerstay";Event.TRIGGER_EXIT="triggerexit";Event.TRAIL_FILTER_CHANGE="trailfilterchange";Event.DOMINO_FILTER_CHANGE="dominofilterchange";return Event;})()
var Keyboard=(function(){function Keyboard(){}
__class(Keyboard,'laya.events.Keyboard');Keyboard.NUMBER_0=48;Keyboard.NUMBER_1=49;Keyboard.NUMBER_2=50;Keyboard.NUMBER_3=51;Keyboard.NUMBER_4=52;Keyboard.NUMBER_5=53;Keyboard.NUMBER_6=54;Keyboard.NUMBER_7=55;Keyboard.NUMBER_8=56;Keyboard.NUMBER_9=57;Keyboard.A=65;Keyboard.B=66;Keyboard.C=67;Keyboard.D=68;Keyboard.E=69;Keyboard.F=70;Keyboard.G=71;Keyboard.H=72;Keyboard.I=73;Keyboard.J=74;Keyboard.K=75;Keyboard.L=76;Keyboard.M=77;Keyboard.N=78;Keyboard.O=79;Keyboard.P=80;Keyboard.Q=81;Keyboard.R=82;Keyboard.S=83;Keyboard.T=84;Keyboard.U=85;Keyboard.V=86;Keyboard.W=87;Keyboard.X=88;Keyboard.Y=89;Keyboard.Z=90;Keyboard.F1=112;Keyboard.F2=113;Keyboard.F3=114;Keyboard.F4=115;Keyboard.F5=116;Keyboard.F6=117;Keyboard.F7=118;Keyboard.F8=119;Keyboard.F9=120;Keyboard.F10=121;Keyboard.F11=122;Keyboard.F12=123;Keyboard.F13=124;Keyboard.F14=125;Keyboard.F15=126;Keyboard.NUMPAD=21;Keyboard.NUMPAD_0=96;Keyboard.NUMPAD_1=97;Keyboard.NUMPAD_2=98;Keyboard.NUMPAD_3=99;Keyboard.NUMPAD_4=100;Keyboard.NUMPAD_5=101;Keyboard.NUMPAD_6=102;Keyboard.NUMPAD_7=103;Keyboard.NUMPAD_8=104;Keyboard.NUMPAD_9=105;Keyboard.NUMPAD_ADD=107;Keyboard.NUMPAD_DECIMAL=110;Keyboard.NUMPAD_DIVIDE=111;Keyboard.NUMPAD_ENTER=108;Keyboard.NUMPAD_MULTIPLY=106;Keyboard.NUMPAD_SUBTRACT=109;Keyboard.SEMICOLON=186;Keyboard.EQUAL=187;Keyboard.COMMA=188;Keyboard.MINUS=189;Keyboard.PERIOD=190;Keyboard.SLASH=191;Keyboard.BACKQUOTE=192;Keyboard.LEFTBRACKET=219;Keyboard.BACKSLASH=220;Keyboard.RIGHTBRACKET=221;Keyboard.QUOTE=222;Keyboard.ALTERNATE=18;Keyboard.BACKSPACE=8;Keyboard.CAPS_LOCK=20;Keyboard.COMMAND=15;Keyboard.CONTROL=17;Keyboard.DELETE=46;Keyboard.ENTER=13;Keyboard.ESCAPE=27;Keyboard.PAGE_UP=33;Keyboard.PAGE_DOWN=34;Keyboard.END=35;Keyboard.HOME=36;Keyboard.LEFT=37;Keyboard.UP=38;Keyboard.RIGHT=39;Keyboard.DOWN=40;Keyboard.SHIFT=16;Keyboard.SPACE=32;Keyboard.TAB=9;Keyboard.INSERT=45;return Keyboard;})()
var KeyBoardManager=(function(){function KeyBoardManager(){}
__class(KeyBoardManager,'laya.events.KeyBoardManager');KeyBoardManager.__init__=function(){KeyBoardManager._addEvent("keydown");KeyBoardManager._addEvent("keypress");KeyBoardManager._addEvent("keyup");}
KeyBoardManager._addEvent=function(type){Browser.document.addEventListener(type,function(e){laya.events.KeyBoardManager._dispatch(e,type);},true);}
KeyBoardManager._dispatch=function(e,type){if(!KeyBoardManager.enabled)return;KeyBoardManager._event._stoped=false;KeyBoardManager._event.nativeEvent=e;KeyBoardManager._event.keyCode=e.keyCode||e.which||e.charCode;if(type==="keydown")KeyBoardManager._pressKeys[KeyBoardManager._event.keyCode]=true;else if(type==="keyup")KeyBoardManager._pressKeys[KeyBoardManager._event.keyCode]=null;var target=(Laya.stage.focus&&(Laya.stage.focus.event!=null)&&Laya.stage.focus.displayedInStage)?Laya.stage.focus:Laya.stage;var ct=target;while(ct){ct.event(type,KeyBoardManager._event.setTo(type,ct,target));ct=ct.parent;}}
KeyBoardManager.hasKeyDown=function(key){return KeyBoardManager._pressKeys[key];}
KeyBoardManager._pressKeys={};KeyBoardManager.enabled=true;__static(KeyBoardManager,['_event',function(){return this._event=new Event();}]);return KeyBoardManager;})()
var KeyLocation=(function(){function KeyLocation(){}
__class(KeyLocation,'laya.events.KeyLocation');KeyLocation.STANDARD=0;KeyLocation.LEFT=1;KeyLocation.RIGHT=2;KeyLocation.NUM_PAD=3;return KeyLocation;})()
var MouseManager=(function(){function MouseManager(){this.mouseX=0;this.mouseY=0;this.disableMouseEvent=false;this.mouseDownTime=0;this.mouseMoveAccuracy=2;this._stage=null;this._target=null;this._lastMoveTimer=0;this._isLeftMouse=false;this._eventList=[];this._touchIDs={};this._id=1;this._tTouchID=0;this._event=new Event();this._matrix=new Matrix();this._point=new Point();this._rect=new Rectangle();this._prePoint=new Point();this._curTouchID=NaN;}
__class(MouseManager,'laya.events.MouseManager');var __proto=MouseManager.prototype;__proto.__init__=function(stage,canvas){var _$this=this;this._stage=stage;var _this=this;var list=this._eventList;canvas.oncontextmenu=function(e){if(MouseManager.enabled)return false;}
canvas.addEventListener('mousedown',function(e){if(MouseManager.enabled){if(!Browser.onIE)e.preventDefault();list.push(e);_this.mouseDownTime=Browser.now();}});canvas.addEventListener('mouseup',function(e){if(MouseManager.enabled){e.preventDefault();list.push(e);_this.mouseDownTime=-Browser.now();}},true);canvas.addEventListener('mousemove',function(e){if(MouseManager.enabled){e.preventDefault();var now=Browser.now();if(now-_this._lastMoveTimer<10)return;_this._lastMoveTimer=now;list.push(e);}},true);canvas.addEventListener("mouseout",function(e){if(MouseManager.enabled)list.push(e);})
canvas.addEventListener("mouseover",function(e){if(MouseManager.enabled)list.push(e);})
canvas.addEventListener("touchstart",function(e){if(MouseManager.enabled){list.push(e);if(!MouseManager._isFirstTouch&&!Input.isInputting)e.preventDefault();_this.mouseDownTime=Browser.now();}});canvas.addEventListener("touchend",function(e){if(MouseManager.enabled){if(!MouseManager._isFirstTouch&&!Input.isInputting)e.preventDefault();MouseManager._isFirstTouch=false;list.push(e);_this.mouseDownTime=-Browser.now();}else{_$this._curTouchID=NaN;}},true);canvas.addEventListener("touchmove",function(e){if(MouseManager.enabled){e.preventDefault();list.push(e);}},true);canvas.addEventListener("touchcancel",function(e){if(MouseManager.enabled){e.preventDefault();list.push(e);}else{_$this._curTouchID=NaN;}},true);canvas.addEventListener('mousewheel',function(e){if(MouseManager.enabled)list.push(e);});canvas.addEventListener('DOMMouseScroll',function(e){if(MouseManager.enabled)list.push(e);});}
__proto.initEvent=function(e,nativeEvent){var _this=this;_this._event._stoped=false;_this._event.nativeEvent=nativeEvent||e;_this._target=null;this._point.setTo(e.pageX||e.clientX,e.pageY||e.clientY);this._stage._canvasTransform.invertTransformPoint(this._point);_this.mouseX=this._point.x;_this.mouseY=this._point.y;_this._event.touchId=e.identifier||0;this._tTouchID=_this._event.touchId;var evt;evt=TouchManager.I._event;evt._stoped=false;evt.nativeEvent=_this._event.nativeEvent;evt.touchId=_this._event.touchId;}
__proto.checkMouseWheel=function(e){this._event.delta=e.wheelDelta?e.wheelDelta*0.025:-e.detail;var _lastOvers=TouchManager.I.getLastOvers();for(var i=0,n=_lastOvers.length;i<n;i++){var ele=_lastOvers[i];ele.event("mousewheel",this._event.setTo("mousewheel",ele,this._target));}}
__proto.onMouseMove=function(ele){TouchManager.I.onMouseMove(ele,this._tTouchID);}
__proto.onMouseDown=function(ele){if(Input.isInputting&&Laya.stage.focus&&Laya.stage.focus["focus"]&&!Laya.stage.focus.contains(this._target)){var pre_input=Laya.stage.focus['_tf']||Laya.stage.focus;var new_input=ele['_tf']||ele;if((new_input instanceof laya.display.Input)&&new_input.multiline==pre_input.multiline)
pre_input['_focusOut']();else
pre_input.focus=false;}
TouchManager.I.onMouseDown(ele,this._tTouchID,this._isLeftMouse);}
__proto.onMouseUp=function(ele){TouchManager.I.onMouseUp(ele,this._tTouchID,this._isLeftMouse);}
__proto.check=function(sp,mouseX,mouseY,callBack){this._point.setTo(mouseX,mouseY);sp.fromParentPoint(this._point);mouseX=this._point.x;mouseY=this._point.y;var scrollRect=sp.scrollRect;if(scrollRect){this._rect.setTo(scrollRect.x,scrollRect.y,scrollRect.width,scrollRect.height);if(!this._rect.contains(mouseX,mouseY))return false;}
if(!this.disableMouseEvent){if(sp.hitTestPrior&&!sp.mouseThrough&&!this.hitTest(sp,mouseX,mouseY)){return false;}
for(var i=sp._childs.length-1;i>-1;i--){var child=sp._childs[i];if(!child.destroyed&&child.mouseEnabled&&child.visible){if(this.check(child,mouseX,mouseY,callBack))return true;}}};var isHit=(sp.hitTestPrior&&!sp.mouseThrough&&!this.disableMouseEvent)?true:this.hitTest(sp,mouseX,mouseY);if(isHit){this._target=sp;callBack.call(this,sp);}else if(callBack===this.onMouseUp&&sp===this._stage){this._target=this._stage;callBack.call(this,this._target);}
return isHit;}
__proto.hitTest=function(sp,mouseX,mouseY){var isHit=false;if(sp.scrollRect){mouseX-=sp.scrollRect.x;mouseY-=sp.scrollRect.y;}
if((sp.hitArea instanceof laya.utils.HitArea)){return sp.hitArea.isHit(mouseX,mouseY);}
if(sp.width>0&&sp.height>0||sp.mouseThrough||sp.hitArea){if(!sp.mouseThrough){var hitRect=this._rect;if(sp.hitArea)hitRect=sp.hitArea;else hitRect.setTo(0,0,sp.width,sp.height);isHit=hitRect.contains(mouseX,mouseY);}else{isHit=sp.getGraphicBounds().contains(mouseX,mouseY);}}
return isHit;}
__proto.runEvent=function(){var len=this._eventList.length;if(!len)return;var _this=this;var i=0,j=0,n=0,touch;while(i<len){var evt=this._eventList[i];if(evt.type!=='mousemove')this._prePoint.x=this._prePoint.y=-1000000;switch(evt.type){case'mousedown':this._touchIDs[0]=this._id++;if(!MouseManager._isTouchRespond){_this._isLeftMouse=evt.button===0;_this.initEvent(evt);_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseDown);}else
MouseManager._isTouchRespond=false;break;case'mouseup':_this._isLeftMouse=evt.button===0;_this.initEvent(evt);_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseUp);break;case'mousemove':if((Math.abs(this._prePoint.x-evt.clientX)+Math.abs(this._prePoint.y-evt.clientY))>=this.mouseMoveAccuracy){this._prePoint.x=evt.clientX;this._prePoint.y=evt.clientY;_this.initEvent(evt);_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseMove);}
break;case"touchstart":MouseManager._isTouchRespond=true;_this._isLeftMouse=true;var touches=evt.changedTouches;for(j=0,n=touches.length;j<n;j++){touch=touches[j];if(MouseManager.multiTouchEnabled||isNaN(this._curTouchID)){this._curTouchID=touch.identifier;if(this._id%200===0)this._touchIDs={};this._touchIDs[touch.identifier]=this._id++;_this.initEvent(touch,evt);_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseDown);}}
break;case"touchend":case"touchcancel":MouseManager._isTouchRespond=true;_this._isLeftMouse=true;var touchends=evt.changedTouches;for(j=0,n=touchends.length;j<n;j++){touch=touchends[j];if(MouseManager.multiTouchEnabled||touch.identifier==this._curTouchID){this._curTouchID=NaN;_this.initEvent(touch,evt);var isChecked=false;isChecked=_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseUp);if(!isChecked){_this.onMouseUp(null);}}}
break;case"touchmove":;var touchemoves=evt.changedTouches;for(j=0,n=touchemoves.length;j<n;j++){touch=touchemoves[j];if(MouseManager.multiTouchEnabled||touch.identifier==this._curTouchID){_this.initEvent(touch,evt);_this.check(_this._stage,_this.mouseX,_this.mouseY,_this.onMouseMove);}}
break;case"wheel":case"mousewheel":case"DOMMouseScroll":_this.checkMouseWheel(evt);break;case"mouseout":TouchManager.I.stageMouseOut();break;case"mouseover":_this._stage.event("mouseover",_this._event.setTo("mouseover",_this._stage,_this._stage));break;}
i++;}
this._eventList.length=0;}
MouseManager.enabled=true;MouseManager.multiTouchEnabled=true;MouseManager._isTouchRespond=false;MouseManager._isFirstTouch=true;__static(MouseManager,['instance',function(){return this.instance=new MouseManager();}]);return MouseManager;})()
var TouchManager=(function(){function TouchManager(){this.preOvers=[];this.preDowns=[];this.preRightDowns=[];this.enable=true;this._lastClickTime=0;this._event=new Event();}
__class(TouchManager,'laya.events.TouchManager');var __proto=TouchManager.prototype;__proto._clearTempArrs=function(){TouchManager._oldArr.length=0;TouchManager._newArr.length=0;TouchManager._tEleArr.length=0;}
__proto.getTouchFromArr=function(touchID,arr){var i=0,len=0;len=arr.length;var tTouchO;for(i=0;i<len;i++){tTouchO=arr[i];if(tTouchO.id==touchID){return tTouchO;}}
return null;}
__proto.removeTouchFromArr=function(touchID,arr){var i=0;for(i=arr.length-1;i>=0;i--){if(arr[i].id==touchID){arr.splice(i,1);}}}
__proto.createTouchO=function(ele,touchID){var rst;rst=Pool.getItem("TouchData")||{};rst.id=touchID;rst.tar=ele;return rst;}
__proto.onMouseDown=function(ele,touchID,isLeft){(isLeft===void 0)&&(isLeft=false);if(!this.enable)
return;var preO;var tO;var arrs;preO=this.getTouchFromArr(touchID,this.preOvers);arrs=this.getEles(ele,null,TouchManager._tEleArr);if(!preO){tO=this.createTouchO(ele,touchID);this.preOvers.push(tO);}else{preO.tar=ele;}
if(Browser.onMobile)
this.sendEvents(arrs,"mouseover",touchID);var preDowns;preDowns=isLeft?this.preDowns:this.preRightDowns;preO=this.getTouchFromArr(touchID,preDowns);if(!preO){tO=this.createTouchO(ele,touchID);preDowns.push(tO);}else{preO.tar=ele;}
this.sendEvents(arrs,isLeft?"mousedown":"rightmousedown",touchID);this._clearTempArrs();}
__proto.sendEvents=function(eles,type,touchID){(touchID===void 0)&&(touchID=0);var i=0,len=0;len=eles.length;this._event._stoped=false;var _target;_target=eles[0];var tE;for(i=0;i<len;i++){tE=eles[i];if(tE.destroyed)return;tE.event(type,this._event.setTo(type,tE,_target));if(this._event._stoped)
break;}}
__proto.getEles=function(start,end,rst){if(!rst){rst=[];}else{rst.length=0;}
while(start&&start!=end){rst.push(start);start=start.parent;}
return rst;}
__proto.checkMouseOutAndOverOfMove=function(eleNew,elePre,touchID){(touchID===void 0)&&(touchID=0);if(elePre==eleNew)
return;var tar;var arrs;var i=0,len=0;if(elePre.contains(eleNew)){arrs=this.getEles(eleNew,elePre,TouchManager._tEleArr);this.sendEvents(arrs,"mouseover",touchID);}else if(eleNew.contains(elePre)){arrs=this.getEles(elePre,eleNew,TouchManager._tEleArr);this.sendEvents(arrs,"mouseout",touchID);}else{arrs=TouchManager._tEleArr;arrs.length=0;var oldArr;oldArr=this.getEles(elePre,null,TouchManager._oldArr);var newArr;newArr=this.getEles(eleNew,null,TouchManager._newArr);len=oldArr.length;var tIndex=0;for(i=0;i<len;i++){tar=oldArr[i];tIndex=newArr.indexOf(tar);if(tIndex>=0){newArr.splice(tIndex,newArr.length-tIndex);break;}else{arrs.push(tar);}}
if(arrs.length>0){this.sendEvents(arrs,"mouseout",touchID);}
if(newArr.length>0){this.sendEvents(newArr,"mouseover",touchID);}}}
__proto.onMouseMove=function(ele,touchID){if(!this.enable)
return;var preO;preO=this.getTouchFromArr(touchID,this.preOvers);var arrs;var tO;if(!preO){arrs=this.getEles(ele,null,TouchManager._tEleArr);this.sendEvents(arrs,"mouseover",touchID);this.preOvers.push(this.createTouchO(ele,touchID));}else{this.checkMouseOutAndOverOfMove(ele,preO.tar);preO.tar=ele;arrs=this.getEles(ele,null,TouchManager._tEleArr);}
this.sendEvents(arrs,"mousemove",touchID);this._clearTempArrs();}
__proto.getLastOvers=function(){TouchManager._tEleArr.length=0;if(this.preOvers.length>0&&this.preOvers[0].tar){return this.getEles(this.preOvers[0].tar,null,TouchManager._tEleArr);}
TouchManager._tEleArr.push(Laya.stage);return TouchManager._tEleArr;}
__proto.stageMouseOut=function(){var lastOvers;lastOvers=this.getLastOvers();this.preOvers.length=0;this.sendEvents(lastOvers,"mouseout",0);}
__proto.onMouseUp=function(ele,touchID,isLeft){(isLeft===void 0)&&(isLeft=false);if(!this.enable)
return;var preO;var tO;var arrs;var oldArr;var i=0,len=0;var tar;var sendArr;var onMobile=Browser.onMobile;arrs=this.getEles(ele,null,TouchManager._tEleArr);this.sendEvents(arrs,isLeft?"mouseup":"rightmouseup",touchID);var preDowns;preDowns=isLeft?this.preDowns:this.preRightDowns;preO=this.getTouchFromArr(touchID,preDowns);if(!preO){}else{var isDouble=false;var now=Browser.now();isDouble=now-this._lastClickTime<300;this._lastClickTime=now;if(ele==preO.tar){sendArr=arrs;}else{oldArr=this.getEles(preO.tar,null,TouchManager._oldArr);sendArr=TouchManager._newArr;sendArr.length=0;len=oldArr.length;for(i=0;i<len;i++){tar=oldArr[i];if(arrs.indexOf(tar)>=0){sendArr.push(tar);}}}
if(sendArr.length>0){this.sendEvents(sendArr,isLeft?"click":"rightclick",touchID);}
if(isLeft&&isDouble){this.sendEvents(sendArr,"doubleclick",touchID);}
this.removeTouchFromArr(touchID,preDowns);preO.tar=null;Pool.recover("TouchData",preO);}
preO=this.getTouchFromArr(touchID,this.preOvers);if(!preO){}else{if(onMobile){sendArr=this.getEles(preO.tar,null,sendArr);if(sendArr&&sendArr.length>0){this.sendEvents(sendArr,"mouseout",touchID);}
this.removeTouchFromArr(touchID,this.preOvers);preO.tar=null;Pool.recover("TouchData",preO);}}
this._clearTempArrs();}
TouchManager._oldArr=[];TouchManager._newArr=[];TouchManager._tEleArr=[];__static(TouchManager,['I',function(){return this.I=new TouchManager();}]);return TouchManager;})()
var Filter=(function(){function Filter(){this._action=null;}
__class(Filter,'laya.filters.Filter');var __proto=Filter.prototype;Laya.imps(__proto,{"laya.filters.IFilter":true})
__proto.callNative=function(sp){}
__getset(0,__proto,'type',function(){return-1});__getset(0,__proto,'action',function(){return this._action});Filter.BLUR=0x10;Filter.COLOR=0x20;Filter.GLOW=0x08;Filter._filterStart=null;Filter._filterEnd=null;Filter._EndTarget=null;Filter._recycleScope=null;Filter._filter=null;Filter._useSrc=null;Filter._endSrc=null;Filter._useOut=null;Filter._endOut=null;return Filter;})()
var ColorFilterAction=(function(){function ColorFilterAction(){this.data=null;}
__class(ColorFilterAction,'laya.filters.ColorFilterAction');var __proto=ColorFilterAction.prototype;Laya.imps(__proto,{"laya.filters.IFilterAction":true})
__proto.apply=function(srcCanvas){var ctx=srcCanvas.ctx.ctx;var canvas=srcCanvas.ctx.ctx.canvas;if(canvas.width==0||canvas.height==0)return canvas;var imgdata=ctx.getImageData(0,0,canvas.width,canvas.height);var data=imgdata.data;var nData;for(var i=0,n=data.length;i<n;i+=4){nData=this.getColor(data[i],data[i+1],data[i+2],data[i+3]);if(data[i+3]==0)continue;data[i]=nData[0];data[i+1]=nData[1];data[i+2]=nData[2];data[i+3]=nData[3];}
ctx.putImageData(imgdata,0,0);return srcCanvas;}
__proto.getColor=function(red,green,blue,alpha){var rst=[];if(this.data._mat&&this.data._alpha){var mat=this.data._mat;var tempAlpha=this.data._alpha;rst[0]=mat[0]*red+mat[1]*green+mat[2]*blue+mat[3]*alpha+tempAlpha[0];rst[1]=mat[4]*red+mat[5]*green+mat[6]*blue+mat[7]*alpha+tempAlpha[1];rst[2]=mat[8]*red+mat[9]*green+mat[10]*blue+mat[11]*alpha+tempAlpha[2];rst[3]=mat[12]*red+mat[13]*green+mat[14]*blue+mat[15]*alpha+tempAlpha[3];}
return rst;}
return ColorFilterAction;})()
var Arith=(function(){function Arith(){}
__class(Arith,'laya.maths.Arith');Arith.formatR=function(r){if(r>Math.PI)r-=Math.PI*2;if(r<-Math.PI)r+=Math.PI*2;return r;}
Arith.isPOT=function(w,h){return(w>0&&(w&(w-1))===0&&h>0&&(h&(h-1))===0);}
Arith.setMatToArray=function(mat,array){mat.a,mat.b,0,0,mat.c,mat.d,0,0,0,0,1,0,mat.tx+20,mat.ty+20,0,1
array[0]=mat.a;array[1]=mat.b;array[4]=mat.c;array[5]=mat.d;array[12]=mat.tx;array[13]=mat.ty;}
return Arith;})()
var Bezier=(function(){function Bezier(){this._controlPoints=[new Point(),new Point(),new Point()];this._calFun=this.getPoint2;}
__class(Bezier,'laya.maths.Bezier');var __proto=Bezier.prototype;__proto._switchPoint=function(x,y){var tPoint=this._controlPoints.shift();tPoint.setTo(x,y);this._controlPoints.push(tPoint);}
__proto.getPoint2=function(t,rst){var p1=this._controlPoints[0];var p2=this._controlPoints[1];var p3=this._controlPoints[2];var lineX=Math.pow((1-t),2)*p1.x+2*t*(1-t)*p2.x+Math.pow(t,2)*p3.x;var lineY=Math.pow((1-t),2)*p1.y+2*t*(1-t)*p2.y+Math.pow(t,2)*p3.y;rst.push(lineX,lineY);}
__proto.getPoint3=function(t,rst){var p1=this._controlPoints[0];var p2=this._controlPoints[1];var p3=this._controlPoints[2];var p4=this._controlPoints[3];var lineX=Math.pow((1-t),3)*p1.x+3*p2.x*t*(1-t)*(1-t)+3*p3.x*t*t*(1-t)+p4.x*Math.pow(t,3);var lineY=Math.pow((1-t),3)*p1.y+3*p2.y*t*(1-t)*(1-t)+3*p3.y*t*t*(1-t)+p4.y*Math.pow(t,3);rst.push(lineX,lineY);}
__proto.insertPoints=function(count,rst){var i=NaN;count=count>0?count:5;var dLen=NaN;dLen=1/count;for(i=0;i<=1;i+=dLen){this._calFun(i,rst);}}
__proto.getBezierPoints=function(pList,inSertCount,count){(inSertCount===void 0)&&(inSertCount=5);(count===void 0)&&(count=2);var i=0,len=0;len=pList.length;if(len<(count+1)*2)return[];var rst;rst=[];switch(count){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[];}
while(this._controlPoints.length<=count){this._controlPoints.push(new Point());}
for(i=0;i<count*2;i+=2){this._switchPoint(pList[i],pList[i+1]);}
for(i=count*2;i<len;i+=2){this._switchPoint(pList[i],pList[i+1]);if((i/2)%count==0)
this.insertPoints(inSertCount,rst);}
return rst;}
__static(Bezier,['I',function(){return this.I=new Bezier();}]);return Bezier;})()
var GrahamScan=(function(){function GrahamScan(){}
__class(GrahamScan,'laya.maths.GrahamScan');GrahamScan.multiply=function(p1,p2,p0){return((p1.x-p0.x)*(p2.y-p0.y)-(p2.x-p0.x)*(p1.y-p0.y));}
GrahamScan.dis=function(p1,p2){return(p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y);}
GrahamScan._getPoints=function(count,tempUse,rst){(tempUse===void 0)&&(tempUse=false);if(!GrahamScan._mPointList)GrahamScan._mPointList=[];while(GrahamScan._mPointList.length<count)GrahamScan._mPointList.push(new Point());if(!rst)rst=[];rst.length=0;if(tempUse){GrahamScan.getFrom(rst,GrahamScan._mPointList,count);}else{GrahamScan.getFromR(rst,GrahamScan._mPointList,count);}
return rst;}
GrahamScan.getFrom=function(rst,src,count){var i=0;for(i=0;i<count;i++){rst.push(src[i]);}
return rst;}
GrahamScan.getFromR=function(rst,src,count){var i=0;for(i=0;i<count;i++){rst.push(src.pop());}
return rst;}
GrahamScan.pListToPointList=function(pList,tempUse){(tempUse===void 0)&&(tempUse=false);var i=0,len=pList.length/2,rst=GrahamScan._getPoints(len,tempUse,GrahamScan._tempPointList);for(i=0;i<len;i++){rst[i].setTo(pList[i+i],pList[i+i+1]);}
return rst;}
GrahamScan.pointListToPlist=function(pointList){var i=0,len=pointList.length,rst=GrahamScan._temPList,tPoint;rst.length=0;for(i=0;i<len;i++){tPoint=pointList[i];rst.push(tPoint.x,tPoint.y);}
return rst;}
GrahamScan.scanPList=function(pList){return Utils.copyArray(pList,GrahamScan.pointListToPlist(GrahamScan.scan(GrahamScan.pListToPointList(pList,true))));}
GrahamScan.scan=function(PointSet){var i=0,j=0,k=0,top=2,tmp,n=PointSet.length,ch;var _tmpDic={};var key;ch=GrahamScan._temArr;ch.length=0;n=PointSet.length;for(i=n-1;i>=0;i--){tmp=PointSet[i];key=tmp.x+"_"+tmp.y;if(!_tmpDic.hasOwnProperty(key)){_tmpDic[key]=true;ch.push(tmp);}}
n=ch.length;Utils.copyArray(PointSet,ch);for(i=1;i<n;i++)
if((PointSet[i].y<PointSet[k].y)||((PointSet[i].y==PointSet[k].y)&&(PointSet[i].x<PointSet[k].x)))
k=i;tmp=PointSet[0];PointSet[0]=PointSet[k];PointSet[k]=tmp;for(i=1;i<n-1;i++){k=i;for(j=i+1;j<n;j++)
if((GrahamScan.multiply(PointSet[j],PointSet[k],PointSet[0])>0)||((GrahamScan.multiply(PointSet[j],PointSet[k],PointSet[0])==0)&&(GrahamScan.dis(PointSet[0],PointSet[j])<GrahamScan.dis(PointSet[0],PointSet[k]))))
k=j;tmp=PointSet[i];PointSet[i]=PointSet[k];PointSet[k]=tmp;}
ch=GrahamScan._temArr;ch.length=0;if(PointSet.length<3){return Utils.copyArray(ch,PointSet);}
ch.push(PointSet[0],PointSet[1],PointSet[2]);for(i=3;i<n;i++){while(ch.length>=2&&GrahamScan.multiply(PointSet[i],ch[ch.length-1],ch[ch.length-2])>=0)ch.pop();PointSet[i]&&ch.push(PointSet[i]);}
return ch;}
GrahamScan._mPointList=null;GrahamScan._tempPointList=[];GrahamScan._temPList=[];GrahamScan._temArr=[];return GrahamScan;})()
var MathUtil=(function(){function MathUtil(){}
__class(MathUtil,'laya.maths.MathUtil');MathUtil.subtractVector3=function(l,r,o){o[0]=l[0]-r[0];o[1]=l[1]-r[1];o[2]=l[2]-r[2];}
MathUtil.lerp=function(left,right,amount){return left*(1-amount)+right*amount;}
MathUtil.scaleVector3=function(f,b,e){e[0]=f[0]*b;e[1]=f[1]*b;e[2]=f[2]*b;}
MathUtil.lerpVector3=function(l,r,t,o){var ax=l[0],ay=l[1],az=l[2];o[0]=ax+t*(r[0]-ax);o[1]=ay+t*(r[1]-ay);o[2]=az+t*(r[2]-az);}
MathUtil.lerpVector4=function(l,r,t,o){var ax=l[0],ay=l[1],az=l[2],aw=l[3];o[0]=ax+t*(r[0]-ax);o[1]=ay+t*(r[1]-ay);o[2]=az+t*(r[2]-az);o[3]=aw+t*(r[3]-aw);}
MathUtil.slerpQuaternionArray=function(a,Offset1,b,Offset2,t,out,Offset3){var ax=a[Offset1+0],ay=a[Offset1+1],az=a[Offset1+2],aw=a[Offset1+3],bx=b[Offset2+0],by=b[Offset2+1],bz=b[Offset2+2],bw=b[Offset2+3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0.0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw;}
if((1.0-cosom)>0.000001){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1.0-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom;}else{scale0=1.0-t;scale1=t;}
out[Offset3+0]=scale0*ax+scale1*bx;out[Offset3+1]=scale0*ay+scale1*by;out[Offset3+2]=scale0*az+scale1*bz;out[Offset3+3]=scale0*aw+scale1*bw;return out;}
MathUtil.getRotation=function(x0,y0,x1,y1){return Math.atan2(y1-y0,x1-x0)/Math.PI*180;}
MathUtil.sortBigFirst=function(a,b){if(a==b)
return 0;return b>a?1:-1;}
MathUtil.sortSmallFirst=function(a,b){if(a==b)
return 0;return b>a?-1:1;}
MathUtil.sortNumBigFirst=function(a,b){return parseFloat(b)-parseFloat(a);}
MathUtil.sortNumSmallFirst=function(a,b){return parseFloat(a)-parseFloat(b);}
MathUtil.sortByKey=function(key,bigFirst,forceNum){(bigFirst===void 0)&&(bigFirst=false);(forceNum===void 0)&&(forceNum=true);var _sortFun;if(bigFirst){_sortFun=forceNum?MathUtil.sortNumBigFirst:MathUtil.sortBigFirst;}else{_sortFun=forceNum?MathUtil.sortNumSmallFirst:MathUtil.sortSmallFirst;}
return function(a,b){return _sortFun(a[key],b[key]);}}
return MathUtil;})()
var Matrix=(function(){function Matrix(a,b,c,d,tx,ty){this.inPool=false;this.bTransform=false;(a===void 0)&&(a=1);(b===void 0)&&(b=0);(c===void 0)&&(c=0);(d===void 0)&&(d=1);(tx===void 0)&&(tx=0);(ty===void 0)&&(ty=0);this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;this._checkTransform();}
__class(Matrix,'laya.maths.Matrix');var __proto=Matrix.prototype;__proto.identity=function(){this.a=this.d=1;this.b=this.tx=this.ty=this.c=0;this.bTransform=false;return this;}
__proto._checkTransform=function(){return this.bTransform=(this.a!==1||this.b!==0||this.c!==0||this.d!==1);}
__proto.setTranslate=function(x,y){this.tx=x;this.ty=y;return this;}
__proto.translate=function(x,y){this.tx+=x;this.ty+=y;return this;}
__proto.scale=function(x,y){this.a*=x;this.d*=y;this.c*=x;this.b*=y;this.tx*=x;this.ty*=y;this.bTransform=true;}
__proto.rotate=function(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var a1=this.a;var c1=this.c;var tx1=this.tx;this.a=a1*cos-this.b*sin;this.b=a1*sin+this.b*cos;this.c=c1*cos-this.d*sin;this.d=c1*sin+this.d*cos;this.tx=tx1*cos-this.ty*sin;this.ty=tx1*sin+this.ty*cos;this.bTransform=true;}
__proto.skew=function(x,y){var tanX=Math.tan(x);var tanY=Math.tan(y);var a1=this.a;var b1=this.b;this.a+=tanY*this.c;this.b+=tanY*this.d;this.c+=tanX*a1;this.d+=tanX*b1;return this;}
__proto.invertTransformPoint=function(out){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;var tx1=this.tx;var n=a1*d1-b1*c1;var a2=d1/n;var b2=-b1/n;var c2=-c1/n;var d2=a1/n;var tx2=(c1*this.ty-d1*tx1)/n;var ty2=-(a1*this.ty-b1*tx1)/n;return out.setTo(a2*out.x+c2*out.y+tx2,b2*out.x+d2*out.y+ty2);}
__proto.transformPoint=function(out){return out.setTo(this.a*out.x+this.c*out.y+this.tx,this.b*out.x+this.d*out.y+this.ty);}
__proto.transformPointN=function(out){return out.setTo(this.a*out.x+this.c*out.y,this.b*out.x+this.d*out.y);}
__proto.transformPointArray=function(data,out){var len=data.length;for(var i=0;i<len;i+=2){var x=data[i],y=data[i+1];out[i]=this.a*x+this.c*y+this.tx;out[i+1]=this.b*x+this.d*y+this.ty;}
return out;}
__proto.transformPointArrayScale=function(data,out){var len=data.length;for(var i=0;i<len;i+=2){var x=data[i],y=data[i+1];out[i]=this.a*x+this.c*y;out[i+1]=this.b*x+this.d*y;}
return out;}
__proto.getScaleX=function(){return this.b===0?this.a:Math.sqrt(this.a*this.a+this.b*this.b);}
__proto.getScaleY=function(){return this.c===0?this.d:Math.sqrt(this.c*this.c+this.d*this.d);}
__proto.invert=function(){var a1=this.a;var b1=this.b;var c1=this.c;var d1=this.d;var tx1=this.tx;var n=a1*d1-b1*c1;this.a=d1/n;this.b=-b1/n;this.c=-c1/n;this.d=a1/n;this.tx=(c1*this.ty-d1*tx1)/n;this.ty=-(a1*this.ty-b1*tx1)/n;return this;}
__proto.setTo=function(a,b,c,d,tx,ty){this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty;return this;}
__proto.concat=function(matrix){var a=this.a;var c=this.c;var tx=this.tx;this.a=a*matrix.a+this.b*matrix.c;this.b=a*matrix.b+this.b*matrix.d;this.c=c*matrix.a+this.d*matrix.c;this.d=c*matrix.b+this.d*matrix.d;this.tx=tx*matrix.a+this.ty*matrix.c+matrix.tx;this.ty=tx*matrix.b+this.ty*matrix.d+matrix.ty;return this;}
__proto.scaleEx=function(x,y){var ba=this.a,bb=this.b,bc=this.c,bd=this.d;if(bb!==0||bc!==0){this.a=x*ba;this.b=x*bb;this.c=y*bc;this.d=y*bd;}else{this.a=x*ba;this.b=0*bd;this.c=0*ba;this.d=y*bd;}
this.bTransform=true;}
__proto.rotateEx=function(angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var ba=this.a,bb=this.b,bc=this.c,bd=this.d;if(bb!==0||bc!==0){this.a=cos*ba+sin*bc;this.b=cos*bb+sin*bd;this.c=-sin*ba+cos*bc;this.d=-sin*bb+cos*bd;}else{this.a=cos*ba;this.b=sin*bd;this.c=-sin*ba;this.d=cos*bd;}
this.bTransform=true;}
__proto.clone=function(){var dec=Matrix.create();dec.a=this.a;dec.b=this.b;dec.c=this.c;dec.d=this.d;dec.tx=this.tx;dec.ty=this.ty;dec.bTransform=this.bTransform;return dec;}
__proto.copyTo=function(dec){dec.a=this.a;dec.b=this.b;dec.c=this.c;dec.d=this.d;dec.tx=this.tx;dec.ty=this.ty;dec.bTransform=this.bTransform;return dec;}
__proto.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty;}
__proto.destroy=function(){if(this.inPool)return;var cache=Matrix._cache;this.inPool=true;cache._length||(cache._length=0);cache[cache._length++]=this;this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;this.bTransform=false;}
Matrix.mul=function(m1,m2,out){var aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,aty=m1.ty;var ba=m2.a,bb=m2.b,bc=m2.c,bd=m2.d,btx=m2.tx,bty=m2.ty;if(bb!==0||bc!==0){out.a=aa*ba+ab*bc;out.b=aa*bb+ab*bd;out.c=ac*ba+ad*bc;out.d=ac*bb+ad*bd;out.tx=ba*atx+bc*aty+btx;out.ty=bb*atx+bd*aty+bty;}else{out.a=aa*ba;out.b=ab*bd;out.c=ac*ba;out.d=ad*bd;out.tx=ba*atx+btx;out.ty=bd*aty+bty;}
return out;}
Matrix.mul16=function(m1,m2,out){var aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,aty=m1.ty;var ba=m2.a,bb=m2.b,bc=m2.c,bd=m2.d,btx=m2.tx,bty=m2.ty;if(bb!==0||bc!==0){out[0]=aa*ba+ab*bc;out[1]=aa*bb+ab*bd;out[4]=ac*ba+ad*bc;out[5]=ac*bb+ad*bd;out[12]=ba*atx+bc*aty+btx;out[13]=bb*atx+bd*aty+bty;}else{out[0]=aa*ba;out[1]=ab*bd;out[4]=ac*ba;out[5]=ad*bd;out[12]=ba*atx+btx;out[13]=bd*aty+bty;}
return out;}
Matrix.mulPre=function(m1,ba,bb,bc,bd,btx,bty,out){var aa=m1.a,ab=m1.b,ac=m1.c,ad=m1.d,atx=m1.tx,aty=m1.ty;if(bb!==0||bc!==0){out.a=aa*ba+ab*bc;out.b=aa*bb+ab*bd;out.c=ac*ba+ad*bc;out.d=ac*bb+ad*bd;out.tx=ba*atx+bc*aty+btx;out.ty=bb*atx+bd*aty+bty;}else{out.a=aa*ba;out.b=ab*bd;out.c=ac*ba;out.d=ad*bd;out.tx=ba*atx+btx;out.ty=bd*aty+bty;}
return out;}
Matrix.mulPos=function(m1,aa,ab,ac,ad,atx,aty,out){var ba=m1.a,bb=m1.b,bc=m1.c,bd=m1.d,btx=m1.tx,bty=m1.ty;if(bb!==0||bc!==0){out.a=aa*ba+ab*bc;out.b=aa*bb+ab*bd;out.c=ac*ba+ad*bc;out.d=ac*bb+ad*bd;out.tx=ba*atx+bc*aty+btx;out.ty=bb*atx+bd*aty+bty;}else{out.a=aa*ba;out.b=ab*bd;out.c=ac*ba;out.d=ad*bd;out.tx=ba*atx+btx;out.ty=bd*aty+bty;}
return out;}
Matrix.preMul=function(parent,self,out){var pa=parent.a,pb=parent.b,pc=parent.c,pd=parent.d;var na=self.a,nb=self.b,nc=self.c,nd=self.d,ntx=self.tx,nty=self.ty;out.a=na*pa;out.b=out.c=0;out.d=nd*pd;out.tx=ntx*pa+parent.tx;out.ty=nty*pd+parent.ty;if(nb!==0||nc!==0||pb!==0||pc!==0){out.a+=nb*pc;out.d+=nc*pb;out.b+=na*pb+nb*pd;out.c+=nc*pa+nd*pc;out.tx+=nty*pc;out.ty+=ntx*pb;}
return out;}
Matrix.preMulXY=function(parent,x,y,out){var pa=parent.a,pb=parent.b,pc=parent.c,pd=parent.d;out.a=pa;out.b=pb;out.c=pc;out.d=pd;out.tx=x*pa+parent.tx+y*pc;out.ty=y*pd+parent.ty+x*pb;return out;}
Matrix.create=function(){var cache=Matrix._cache;var mat=!cache._length?(new Matrix()):cache[--cache._length];mat.inPool=false;return mat;}
Matrix.EMPTY=new Matrix();Matrix.TEMP=new Matrix();Matrix._cache=[];return Matrix;})()
var Point=(function(){function Point(x,y){(x===void 0)&&(x=0);(y===void 0)&&(y=0);this.x=x;this.y=y;}
__class(Point,'laya.maths.Point');var __proto=Point.prototype;__proto.setTo=function(x,y){this.x=x;this.y=y;return this;}
__proto.distance=function(x,y){return Math.sqrt((this.x-x)*(this.x-x)+(this.y-y)*(this.y-y));}
__proto.toString=function(){return this.x+","+this.y;}
__proto.normalize=function(){var d=Math.sqrt(this.x*this.x+this.y*this.y);if(d>0){var id=1.0/d;this.x*=id;this.y*=id;}}
Point.TEMP=new Point();Point.EMPTY=new Point();return Point;})()
var Rectangle=(function(){function Rectangle(x,y,width,height){(x===void 0)&&(x=0);(y===void 0)&&(y=0);(width===void 0)&&(width=0);(height===void 0)&&(height=0);this.x=x;this.y=y;this.width=width;this.height=height;}
__class(Rectangle,'laya.maths.Rectangle');var __proto=Rectangle.prototype;__proto.setTo=function(x,y,width,height){this.x=x;this.y=y;this.width=width;this.height=height;return this;}
__proto.copyFrom=function(source){this.x=source.x;this.y=source.y;this.width=source.width;this.height=source.height;return this;}
__proto.contains=function(x,y){if(this.width<=0||this.height<=0)return false;if(x>=this.x&&x<this.right){if(y>=this.y&&y<this.bottom){return true;}}
return false;}
__proto.intersects=function(rect){return!(rect.x>(this.x+this.width)||(rect.x+rect.width)<this.x||rect.y>(this.y+this.height)||(rect.y+rect.height)<this.y);}
__proto.intersection=function(rect,out){if(!this.intersects(rect))return null;out||(out=new Rectangle());out.x=Math.max(this.x,rect.x);out.y=Math.max(this.y,rect.y);out.width=Math.min(this.right,rect.right)-out.x;out.height=Math.min(this.bottom,rect.bottom)-out.y;return out;}
__proto.union=function(source,out){out||(out=new Rectangle());this.clone(out);if(source.width<=0||source.height<=0)return out;out.addPoint(source.x,source.y);out.addPoint(source.right,source.bottom);return this;}
__proto.clone=function(out){out||(out=new Rectangle());out.x=this.x;out.y=this.y;out.width=this.width;out.height=this.height;return out;}
__proto.toString=function(){return this.x+","+this.y+","+this.width+","+this.height;}
__proto.equals=function(rect){if(!rect||rect.x!==this.x||rect.y!==this.y||rect.width!==this.width||rect.height!==this.height)return false;return true;}
__proto.addPoint=function(x,y){this.x>x&&(this.width+=this.x-x,this.x=x);this.y>y&&(this.height+=this.y-y,this.y=y);if(this.width<x-this.x)this.width=x-this.x;if(this.height<y-this.y)this.height=y-this.y;return this;}
__proto._getBoundPoints=function(){var rst=Rectangle._temB;rst.length=0;if(this.width==0||this.height==0)return rst;rst.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height);return rst;}
__proto.isEmpty=function(){if(this.width<=0||this.height<=0)return true;return false;}
__getset(0,__proto,'right',function(){return this.x+this.width;});__getset(0,__proto,'bottom',function(){return this.y+this.height;});Rectangle._getBoundPointS=function(x,y,width,height){var rst=Rectangle._temA;rst.length=0;if(width==0||height==0)return rst;rst.push(x,y,x+width,y,x,y+height,x+width,y+height);return rst;}
Rectangle._getWrapRec=function(pointList,rst){if(!pointList||pointList.length<1)return rst?rst.setTo(0,0,0,0):Rectangle.TEMP.setTo(0,0,0,0);rst=rst?rst:new Rectangle();var i,len=pointList.length,minX,maxX,minY,maxY,tPoint=Point.TEMP;minX=minY=99999;maxX=maxY=-minX;for(i=0;i<len;i+=2){tPoint.x=pointList[i];tPoint.y=pointList[i+1];minX=minX<tPoint.x?minX:tPoint.x;minY=minY<tPoint.y?minY:tPoint.y;maxX=maxX>tPoint.x?maxX:tPoint.x;maxY=maxY>tPoint.y?maxY:tPoint.y;}
return rst.setTo(minX,minY,maxX-minX,maxY-minY);}
Rectangle.EMPTY=new Rectangle();Rectangle.TEMP=new Rectangle();Rectangle._temB=[];Rectangle._temA=[];return Rectangle;})()
var SoundManager=(function(){function SoundManager(){}
__class(SoundManager,'laya.media.SoundManager');__getset(1,SoundManager,'useAudioMusic',function(){return SoundManager._useAudioMusic;},function(value){SoundManager._useAudioMusic=value;if(value){SoundManager._musicClass=AudioSound;}else{SoundManager._musicClass=null;}});__getset(1,SoundManager,'autoStopMusic',function(){return SoundManager._autoStopMusic;},function(v){Laya.stage.off("blur",null,SoundManager._stageOnBlur);Laya.stage.off("focus",null,SoundManager._stageOnFocus);Laya.stage.off("visibilitychange",null,SoundManager._visibilityChange);SoundManager._autoStopMusic=v;if(v){Laya.stage.on("blur",null,SoundManager._stageOnBlur);Laya.stage.on("focus",null,SoundManager._stageOnFocus);Laya.stage.on("visibilitychange",null,SoundManager._visibilityChange);}});__getset(1,SoundManager,'muted',function(){return SoundManager._muted;},function(value){if(value==SoundManager._muted)return;if(value){SoundManager.stopAllSound();}
SoundManager.musicMuted=value;SoundManager._muted=value;});__getset(1,SoundManager,'musicMuted',function(){return SoundManager._musicMuted;},function(value){if(value==SoundManager._musicMuted)return;if(value){if(SoundManager._tMusic){if(SoundManager._musicChannel&&!SoundManager._musicChannel.isStopped){SoundManager._musicChannel.pause();}else{SoundManager._musicChannel=null;}}else{SoundManager._musicChannel=null;}
SoundManager._musicMuted=value;}else{SoundManager._musicMuted=value;if(SoundManager._tMusic){if(SoundManager._musicChannel){SoundManager._musicChannel.resume();}}}});__getset(1,SoundManager,'soundMuted',function(){return SoundManager._soundMuted;},function(value){SoundManager._soundMuted=value;});SoundManager.addChannel=function(channel){if(SoundManager._channels.indexOf(channel)>=0)return;SoundManager._channels.push(channel);}
SoundManager.removeChannel=function(channel){var i=0;for(i=SoundManager._channels.length-1;i>=0;i--){if(SoundManager._channels[i]==channel){SoundManager._channels.splice(i,1);}}}
SoundManager.disposeSoundIfNotUsed=function(url){var i=0;for(i=SoundManager._channels.length-1;i>=0;i--){if(SoundManager._channels[i].url==url){return;}}
SoundManager.destroySound(url);}
SoundManager._visibilityChange=function(){if(Laya.stage.isVisibility){SoundManager._stageOnFocus();}else{SoundManager._stageOnBlur();}}
SoundManager._stageOnBlur=function(){SoundManager._isActive=false;if(SoundManager._musicChannel){if(!SoundManager._musicChannel.isStopped){SoundManager._blurPaused=true;SoundManager._musicChannel.pause();}}
SoundManager.stopAllSound();Laya.stage.once("mousedown",null,SoundManager._stageOnFocus);}
SoundManager._recoverWebAudio=function(){if(WebAudioSound.ctx&&WebAudioSound.ctx.state!="running")
WebAudioSound.ctx.resume();}
SoundManager._stageOnFocus=function(){SoundManager._isActive=true;SoundManager._recoverWebAudio();Laya.stage.off("mousedown",null,SoundManager._stageOnFocus);if(SoundManager._blurPaused){if(SoundManager._musicChannel&&SoundManager._musicChannel.isStopped){SoundManager._blurPaused=false;SoundManager._musicChannel.resume();}}}
SoundManager.playSound=function(url,loops,complete,soundClass,startTime){(loops===void 0)&&(loops=1);(startTime===void 0)&&(startTime=0);if(!SoundManager._isActive||!url)return null;if(SoundManager._muted)return null;SoundManager._recoverWebAudio();url=URL.formatURL(url);if(url==SoundManager._tMusic){if(SoundManager._musicMuted)return null;}else{if(Render.isConchApp){var ext=Utils.getFileExtension(url);if(ext!="wav"&&ext!="ogg"){alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document.");return null;}}
if(SoundManager._soundMuted)return null;};var tSound;if(!Browser.onMiniGame){tSound=Laya.loader.getRes(url);}
if(!soundClass)soundClass=SoundManager._soundClass;if(!tSound){tSound=new soundClass();tSound.load(url);Loader.cacheRes(url,tSound);};var channel;channel=tSound.play(startTime,loops);if(!channel)return null;channel.url=url;channel.volume=(url==SoundManager._tMusic)?SoundManager.musicVolume:SoundManager.soundVolume;channel.completeHandler=complete;return channel;}
SoundManager.destroySound=function(url){var tSound=Laya.loader.getRes(url);if(tSound){Loader.clearRes(url);tSound.dispose();}}
SoundManager.playMusic=function(url,loops,complete,startTime){(loops===void 0)&&(loops=0);(startTime===void 0)&&(startTime=0);url=URL.formatURL(url);SoundManager._tMusic=url;if(SoundManager._musicChannel)SoundManager._musicChannel.stop();return SoundManager._musicChannel=SoundManager.playSound(url,loops,complete,SoundManager._musicClass,startTime);}
SoundManager.stopSound=function(url){url=URL.formatURL(url);var i=0;var channel;for(i=SoundManager._channels.length-1;i>=0;i--){channel=SoundManager._channels[i];if(channel.url==url){channel.stop();}}}
SoundManager.stopAll=function(){SoundManager._tMusic=null;var i=0;var channel;for(i=SoundManager._channels.length-1;i>=0;i--){channel=SoundManager._channels[i];channel.stop();}}
SoundManager.stopAllSound=function(){var i=0;var channel;for(i=SoundManager._channels.length-1;i>=0;i--){channel=SoundManager._channels[i];if(channel.url!=SoundManager._tMusic){channel.stop();}}}
SoundManager.stopMusic=function(){if(SoundManager._musicChannel)SoundManager._musicChannel.stop();SoundManager._tMusic=null;}
SoundManager.setSoundVolume=function(volume,url){if(url){url=URL.formatURL(url);SoundManager._setVolume(url,volume);}else{SoundManager.soundVolume=volume;var i=0;var channel;for(i=SoundManager._channels.length-1;i>=0;i--){channel=SoundManager._channels[i];if(channel.url!=SoundManager._tMusic){channel.volume=volume;}}}}
SoundManager.setMusicVolume=function(volume){SoundManager.musicVolume=volume;SoundManager._setVolume(SoundManager._tMusic,volume);}
SoundManager._setVolume=function(url,volume){url=URL.formatURL(url);var i=0;var channel;for(i=SoundManager._channels.length-1;i>=0;i--){channel=SoundManager._channels[i];if(channel.url==url){channel.volume=volume;}}}
SoundManager.musicVolume=1;SoundManager.soundVolume=1;SoundManager.playbackRate=1;SoundManager._useAudioMusic=true;SoundManager._muted=false;SoundManager._soundMuted=false;SoundManager._musicMuted=false;SoundManager._tMusic=null;SoundManager._musicChannel=null;SoundManager._channels=[];SoundManager._autoStopMusic=false;SoundManager._blurPaused=false;SoundManager._isActive=true;SoundManager._soundClass=null;SoundManager._musicClass=null;SoundManager.autoReleaseSound=true;return SoundManager;})()
var LocalStorage=(function(){var Storage;function LocalStorage(){}
__class(LocalStorage,'laya.net.LocalStorage');LocalStorage.__init__=function(){if(!LocalStorage._baseClass){LocalStorage._baseClass=Storage;Storage.init();}
LocalStorage.items=LocalStorage._baseClass.items;LocalStorage.support=LocalStorage._baseClass.support;}
LocalStorage.setItem=function(key,value){LocalStorage._baseClass.setItem(key,value);}
LocalStorage.getItem=function(key){return LocalStorage._baseClass.getItem(key);}
LocalStorage.setJSON=function(key,value){LocalStorage._baseClass.setJSON(key,value);}
LocalStorage.getJSON=function(key){return LocalStorage._baseClass.getJSON(key);}
LocalStorage.removeItem=function(key){LocalStorage._baseClass.removeItem(key);}
LocalStorage.clear=function(){LocalStorage._baseClass.clear();}
LocalStorage._baseClass=null;LocalStorage.items=null;LocalStorage.support=false;LocalStorage.__init$=function(){Storage=(function(){function Storage(){}
__class(Storage,'');Storage.init=function(){try{Storage.items=window.localStorage;Storage.setItem('laya','1');Storage.removeItem('laya');Storage.support=true;}catch(e){}if(!Storage.support)console.log('LocalStorage is not supprot or browser is private mode.');}
Storage.setItem=function(key,value){try{Storage.support&&Storage.items.setItem(key,value);}catch(e){console.warn("set localStorage failed",e);}}
Storage.getItem=function(key){return Storage.support?Storage.items.getItem(key):null;}
Storage.setJSON=function(key,value){try{Storage.support&&Storage.items.setItem(key,JSON.stringify(value));}catch(e){console.warn("set localStorage failed",e);}}
Storage.getJSON=function(key){return JSON.parse(Storage.support?Storage.items.getItem(key):null);}
Storage.removeItem=function(key){Storage.support&&Storage.items.removeItem(key);}
Storage.clear=function(){Storage.support&&Storage.items.clear();}
Storage.items=null;Storage.support=false;return Storage;})()}
return LocalStorage;})()
var ResourceVersion=(function(){function ResourceVersion(){}
__class(ResourceVersion,'laya.net.ResourceVersion');ResourceVersion.enable=function(manifestFile,callback,type){(type===void 0)&&(type=2);laya.net.ResourceVersion.type=type;Laya.loader.load(manifestFile,Handler.create(null,ResourceVersion.onManifestLoaded,[callback]),null,"json");URL.customFormat=ResourceVersion.addVersionPrefix;}
ResourceVersion.onManifestLoaded=function(callback,data){ResourceVersion.manifest=data;callback.run();if(!data){console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。");}}
ResourceVersion.addVersionPrefix=function(originURL){if(ResourceVersion.manifest&&ResourceVersion.manifest[originURL]){if(ResourceVersion.type==2)return ResourceVersion.manifest[originURL];return ResourceVersion.manifest[originURL]+"/"+originURL;}
return originURL;}
ResourceVersion.FOLDER_VERSION=1;ResourceVersion.FILENAME_VERSION=2;ResourceVersion.manifest=null;ResourceVersion.type=1;return ResourceVersion;})()
var TTFLoader=(function(){function TTFLoader(){this.fontName=null;this.complete=null;this.err=null;this._fontTxt=null;this._url=null;this._div=null;this._txtWidth=NaN;this._http=null;}
__class(TTFLoader,'laya.net.TTFLoader');var __proto=TTFLoader.prototype;__proto.load=function(fontPath){this._url=fontPath;var tArr=fontPath.split(".ttf")[0].split("/");this.fontName=tArr[tArr.length-1];if(Browser.window.conch){this._loadConch();}else
if(Browser.window.FontFace){this._loadWithFontFace()}
else{this._loadWithCSS();}}
__proto._loadConch=function(){this._http=new HttpRequest();this._http.on("error",this,this._onErr);this._http.on("complete",this,this._onHttpLoaded);this._http.send(this._url,null,"get","arraybuffer");}
__proto._onHttpLoaded=function(data){Browser.window.conch.setFontFaceFromBuffer(this.fontName,data);this._clearHttp();this._complete();}
__proto._clearHttp=function(){if(this._http){this._http.off("error",this,this._onErr);this._http.off("complete",this,this._onHttpLoaded);this._http=null;}}
__proto._onErr=function(){this._clearHttp();if(this.err){this.err.runWith("fail:"+this._url);this.err=null;}}
__proto._complete=function(){Laya.timer.clear(this,this._complete);Laya.timer.clear(this,this._checkComplete);if(this._div&&this._div.parentNode){this._div.parentNode.removeChild(this._div);this._div=null;}
if(this.complete){this.complete.runWith(this);this.complete=null;}}
__proto._checkComplete=function(){if(RunDriver.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth){this._complete();}}
__proto._loadWithFontFace=function(){var fontFace=new Browser.window.FontFace(this.fontName,"url('"+this._url+"')");Browser.window.document.fonts.add(fontFace);var self=this;fontFace.loaded.then((function(){self._complete()}));fontFace.load();}
__proto._createDiv=function(){this._div=Browser.createElement("div");this._div.innerHTML="laya";var _style=this._div.style;_style.fontFamily=this.fontName;_style.position="absolute";_style.left="-100px";_style.top="-100px";Browser.document.body.appendChild(this._div);}
__proto._loadWithCSS=function(){var _$this=this;var fontStyle=Browser.createElement("style");fontStyle.type="text/css";Browser.document.body.appendChild(fontStyle);fontStyle.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}";this._fontTxt="40px "+this.fontName;this._txtWidth=RunDriver.measureText("LayaTTFFont",this._fontTxt).width;var self=this;fontStyle.onload=function(){Laya.timer.once(10000,self,_$this._complete);};Laya.timer.loop(20,this,this._checkComplete);this._createDiv();}
TTFLoader._testString="LayaTTFFont";return TTFLoader;})()
var URL=(function(){function URL(url){this._url=null;this._path=null;this._url=URL.formatURL(url);this._path=URL.getPath(url);}
__class(URL,'laya.net.URL');var __proto=URL.prototype;__getset(0,__proto,'path',function(){return this._path;});__getset(0,__proto,'url',function(){return this._url;});URL.formatURL=function(url,base){if(!url)return"null path";if(url.indexOf(":")>0)return url;if(URL.customFormat!=null)url=URL.customFormat(url,base);var char1=url.charAt(0);if(char1==="."){return URL.formatRelativePath((base||URL.basePath)+url);}else if(char1==='~'){return URL.rootPath+url.substring(1);}else if(char1==="d"){if(url.indexOf("data:image")===0)return url;}else if(char1==="/"){return url;}
return(base||URL.basePath)+url;}
URL.formatRelativePath=function(value){var parts=value.split("/");for(var i=0,len=parts.length;i<len;i++){if(parts[i]=='..'){parts.splice(i-1,2);i-=2;}}
return parts.join('/');}
URL.isAbsolute=function(url){return url.indexOf(":")>0||url.charAt(0)=='/';}
URL.getPath=function(url){var ofs=url.lastIndexOf('/');return ofs>0?url.substr(0,ofs+1):"";}
URL.getFileName=function(url){var ofs=url.lastIndexOf('/');return ofs>0?url.substr(ofs+1):url;}
URL.version={};URL.basePath="";URL.rootPath="";URL.customFormat=function(url){var newUrl=URL.version[url];if(!Render.isConchApp&&newUrl)url+="?v="+newUrl;return url;}
return URL;})()
var Render=(function(){function Render(width,height){this._timeId=0;var style=Render._mainCanvas.source.style;style.position='absolute';style.top=style.left="0px";style.background="#000000";Render._mainCanvas.source.id="layaCanvas";var isWebGl=laya.renders.Render.isWebGL;Render._mainCanvas.source.width=width;Render._mainCanvas.source.height=height;isWebGl&&Render.WebGL.init(Render._mainCanvas,width,height);Browser.container.appendChild(Render._mainCanvas.source);Render._context=new RenderContext(width,height,isWebGl?null:Render._mainCanvas);Render._context.ctx.setIsMainContext();Browser.window.requestAnimationFrame(loop);function loop(){Laya.stage._loop();Browser.window.requestAnimationFrame(loop);}
Laya.stage.on("visibilitychange",this,this._onVisibilitychange);}
__class(Render,'laya.renders.Render');var __proto=Render.prototype;__proto._onVisibilitychange=function(){if(!Laya.stage.isVisibility){this._timeId=Browser.window.setInterval(this._enterFrame,1000);}else if(this._timeId!=0){Browser.window.clearInterval(this._timeId);}}
__proto._enterFrame=function(e){Laya.stage._loop();}
__getset(1,Render,'context',function(){return Render._context;});__getset(1,Render,'canvas',function(){return Render._mainCanvas.source;});Render._context=null;Render._mainCanvas=null;Render.WebGL=null;Render.isConchNode=false;Render.isConchApp=false;Render.isConchWebGL=false;Render.isWebGL=false;Render.is3DMode=false;Render.optimizeTextureMemory=function(url,texture){return true;}
Render.__init$=function(){window.ConchRenderType=window.ConchRenderType||1;window.ConchRenderType|=(!window.conch?0:0x04);;{Render.isConchNode=(window.ConchRenderType&5)==5;Render.isConchApp=(window.ConchRenderType&0x04)==0x04;Render.isConchWebGL=window.ConchRenderType==6;};;}
return Render;})()
var RenderContext=(function(){function RenderContext(width,height,canvas){this.x=0;this.y=0;this._drawTexture=function(x,y,args){if(args[0].loaded)this.ctx.drawTexture(args[0],args[1],args[2],args[3],args[4],x,y);}
this._fillTexture=function(x,y,args){if(args[0].loaded)this.ctx.fillTexture(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6],args[7]);}
this._drawTextureWithTransform=function(x,y,args){if(args[0].loaded)this.ctx.drawTextureWithTransform(args[0],args[1],args[2],args[3],args[4],args[5],x,y,args[6]);}
this._fillQuadrangle=function(x,y,args){this.ctx.fillQuadrangle(args[0],args[1],args[2],args[3],args[4]);}
this._drawRect=function(x,y,args){var ctx=this.ctx;if(args[4]!=null){ctx.fillStyle=args[4];ctx.fillRect(x+args[0],y+args[1],args[2],args[3],null);}
if(args[5]!=null){ctx.strokeStyle=args[5];ctx.lineWidth=args[6];ctx.strokeRect(x+args[0],y+args[1],args[2],args[3],args[6]);}}
this._drawPie=function(x,y,args){var ctx=this.ctx;Render.isWebGL&&ctx.setPathId(args[8]);ctx.beginPath();if(Render.isWebGL){ctx.movePath(args[0]+x,args[1]+y);ctx.moveTo(0,0);}else{ctx.moveTo(x+args[0],y+args[1]);}
ctx.arc(x+args[0],y+args[1],args[2],args[3],args[4]);ctx.closePath();this._fillAndStroke(args[5],args[6],args[7],true);}
this._clipRect=function(x,y,args){this.ctx.clipRect(x+args[0],y+args[1],args[2],args[3]);}
this._fillRect=function(x,y,args){this.ctx.fillRect(x+args[0],y+args[1],args[2],args[3],args[4]);}
this._drawCircle=function(x,y,args){var ctx=this.ctx;Render.isWebGL&&ctx.setPathId(args[6]);Stat.drawCall++;ctx.beginPath();Render.isWebGL&&ctx.movePath(args[0]+x,args[1]+y);ctx.arc(args[0]+x,args[1]+y,args[2],0,RenderContext.PI2);ctx.closePath();this._fillAndStroke(args[3],args[4],args[5],true);}
this._fillCircle=function(x,y,args){Stat.drawCall++;var ctx=this.ctx;ctx.beginPath();ctx.fillStyle=args[3];ctx.arc(args[0]+x,args[1]+y,args[2],0,RenderContext.PI2);ctx.fill();}
this._setShader=function(x,y,args){this.ctx.setShader(args[0]);}
this._drawLine=function(x,y,args){var ctx=this.ctx;Render.isWebGL&&ctx.setPathId(args[6]);ctx.beginPath();ctx.strokeStyle=args[4];ctx.lineWidth=args[5];if(Render.isWebGL){ctx.movePath(x,y);ctx.moveTo(args[0],args[1]);ctx.lineTo(args[2],args[3]);}else{ctx.moveTo(x+args[0],y+args[1]);ctx.lineTo(x+args[2],y+args[3]);}
ctx.stroke();}
this._drawLines=function(x,y,args){var ctx=this.ctx;Render.isWebGL&&ctx.setPathId(args[5]);ctx.beginPath();x+=args[0],y+=args[1];Render.isWebGL&&ctx.movePath(x,y);ctx.strokeStyle=args[3];ctx.lineWidth=args[4];var points=args[2];var i=2,n=points.length;if(Render.isWebGL){ctx.moveTo(points[0],points[1]);while(i<n){ctx.lineTo(points[i++],points[i++]);}}else{ctx.moveTo(x+points[0],y+points[1]);while(i<n){ctx.lineTo(x+points[i++],y+points[i++]);}}
ctx.stroke();}
this._drawLinesWebGL=function(x,y,args){this.ctx.drawLines(x+this.x+args[0],y+this.y+args[1],args[2],args[3],args[4]);}
this._drawCurves=function(x,y,args){this.ctx.drawCurves(x,y,args);}
this._draw=function(x,y,args){args[0].call(null,this,x,y);}
this._transformByMatrix=function(x,y,args){this.ctx.transformByMatrix(args[0]);}
this._setTransform=function(x,y,args){this.ctx.setTransform(args[0],args[1],args[2],args[3],args[4],args[5]);}
this._setTransformByMatrix=function(x,y,args){this.ctx.setTransformByMatrix(args[0]);}
this._save=function(x,y,args){this.ctx.save();}
this._restore=function(x,y,args){this.ctx.restore();}
this._translate=function(x,y,args){this.ctx.translate(args[0],args[1]);}
this._transform=function(x,y,args){this.ctx.translate(args[1]+x,args[2]+y);var mat=args[0];this.ctx.transform(mat.a,mat.b,mat.c,mat.d,mat.tx,mat.ty);this.ctx.translate(-x-args[1],-y-args[2]);}
this._rotate=function(x,y,args){this.ctx.translate(args[1]+x,args[2]+y);this.ctx.rotate(args[0]);this.ctx.translate(-x-args[1],-y-args[2]);}
this._scale=function(x,y,args){this.ctx.translate(args[2]+x,args[3]+y);this.ctx.scale(args[0],args[1]);this.ctx.translate(-x-args[2],-y-args[3]);}
this._alpha=function(x,y,args){this.ctx.globalAlpha*=args[0];}
this._setAlpha=function(x,y,args){this.ctx.globalAlpha=args[0];}
this._fillText=function(x,y,args){this.ctx.fillText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5]);}
this._strokeText=function(x,y,args){this.ctx.strokeText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6]);}
this._fillBorderText=function(x,y,args){this.ctx.fillBorderText(args[0],args[1]+x,args[2]+y,args[3],args[4],args[5],args[6],args[7]);}
this._blendMode=function(x,y,args){this.ctx.globalCompositeOperation=args[0];}
this._beginClip=function(x,y,args){this.ctx.beginClip&&this.ctx.beginClip(x+args[0],y+args[1],args[2],args[3]);}
this._setIBVB=function(x,y,args){this.ctx.setIBVB(args[0]+x,args[1]+y,args[2],args[3],args[4],args[5],args[6],args[7]);}
this._fillTrangles=function(x,y,args){this.ctx.fillTrangles(args[0],args[1]+x,args[2]+y,args[3],args[4]);}
this._drawPath=function(x,y,args){var ctx=this.ctx;Render.isWebGL&&ctx.setPathId(-1);ctx.beginPath();x+=args[0],y+=args[1];Render.isWebGL&&ctx.movePath(x,y);var paths=args[2];for(var i=0,n=paths.length;i<n;i++){var path=paths[i];switch(path[0]){case"moveTo":Render.isWebGL?ctx.moveTo(path[1],path[2]):ctx.moveTo(x+path[1],y+path[2]);break;case"lineTo":Render.isWebGL?ctx.lineTo(path[1],path[2]):ctx.lineTo(x+path[1],y+path[2]);break;case"arcTo":Render.isWebGL?ctx.arcTo(path[1],path[2],path[3],path[4],path[5]):ctx.arcTo(x+path[1],y+path[2],x+path[3],y+path[4],path[5]);break;case"closePath":ctx.closePath();break;}};var brush=args[3];if(brush!=null){ctx.fillStyle=brush.fillStyle;ctx.fill();};var pen=args[4];if(pen!=null){ctx.strokeStyle=pen.strokeStyle;ctx.lineWidth=pen.lineWidth||1;ctx.lineJoin=pen.lineJoin;ctx.lineCap=pen.lineCap;ctx.miterLimit=pen.miterLimit;ctx.stroke();}}
this.drawPoly=function(x,y,args){this.ctx.drawPoly(x+this.x+args[0],y+this.y+args[1],args[2],args[3],args[4],args[5],args[6]);}
this._drawPoly=function(x,y,args){var ctx=this.ctx;var points=args[2];var i=2,n=points.length;if(Render.isWebGL){ctx.setPathId(args[6]);ctx.beginPath();x+=args[0],y+=args[1];ctx.movePath(x,y);ctx.moveTo(points[0],points[1]);while(i<n){ctx.lineTo(points[i++],points[i++]);}}else{ctx.beginPath();x+=args[0],y+=args[1];ctx.moveTo(x+points[0],y+points[1]);while(i<n){ctx.lineTo(x+points[i++],y+points[i++]);}}
ctx.closePath();this._fillAndStroke(args[3],args[4],args[5],args[7]);}
this._drawSkin=function(x,y,args){var tSprite=args[0];if(tSprite){var ctx=this.ctx;tSprite.render(ctx,x,y);}}
this._drawParticle=function(x,y,args){this.ctx.drawParticle(x+this.x,y+this.y,args[0]);}
this._setFilters=function(x,y,args){this.ctx.setFilters(args);}
if(canvas){this.ctx=canvas.getContext('2d');}else{canvas=HTMLCanvas.create("3D");this.ctx=RunDriver.createWebGLContext2D(canvas);canvas._setContext(this.ctx);}
canvas.size(width,height);this.canvas=canvas;}
__class(RenderContext,'laya.renders.RenderContext');var __proto=RenderContext.prototype;__proto.destroy=function(){if(this.canvas){this.canvas.destroy();this.canvas=null;this.ctx=null;}
if(this.ctx){this.ctx.destroy();this.ctx=null;}}
__proto.drawTexture=function(tex,x,y,width,height){if(tex.loaded)this.ctx.drawTexture(tex,x,y,width,height,this.x,this.y);}
__proto._drawTextures=function(x,y,args){if(args[0].loaded)this.ctx.drawTextures(args[0],args[1],x+this.x,y+this.y);}
__proto.drawTextureWithTransform=function(tex,x,y,width,height,m,alpha){if(tex.loaded)this.ctx.drawTextureWithTransform(tex,x,y,width,height,m,this.x,this.y,alpha);}
__proto.fillQuadrangle=function(tex,x,y,point4,m){this.ctx.fillQuadrangle(tex,x,y,point4,m);}
__proto.drawCanvas=function(canvas,x,y,width,height){this.ctx.drawCanvas(canvas,x+this.x,y+this.y,width,height);}
__proto.drawRect=function(x,y,width,height,color,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var ctx=this.ctx;ctx.strokeStyle=color;ctx.lineWidth=lineWidth;ctx.strokeRect(x+this.x,y+this.y,width,height,lineWidth);}
__proto._fillAndStroke=function(fillColor,strokeColor,lineWidth,isConvexPolygon){(isConvexPolygon===void 0)&&(isConvexPolygon=false);var ctx=this.ctx;if(fillColor!=null){ctx.fillStyle=fillColor;if(Render.isWebGL){ctx.fill(isConvexPolygon);}else{ctx.fill();}}
if(strokeColor!=null&&lineWidth>0){ctx.strokeStyle=strokeColor;ctx.lineWidth=lineWidth;ctx.stroke();}}
__proto.clipRect=function(x,y,width,height){this.ctx.clipRect(x+this.x,y+this.y,width,height);}
__proto.fillRect=function(x,y,width,height,fillStyle){this.ctx.fillRect(x+this.x,y+this.y,width,height,fillStyle);}
__proto.drawCircle=function(x,y,radius,color,lineWidth){(lineWidth===void 0)&&(lineWidth=1);Stat.drawCall++;var ctx=this.ctx;ctx.beginPath();ctx.strokeStyle=color;ctx.lineWidth=lineWidth;ctx.arc(x+this.x,y+this.y,radius,0,RenderContext.PI2);ctx.stroke();}
__proto.drawTriangles=function(x,y,args){if(Render.isWebGL){this.ctx.drawTriangles(args[0],x+args[1],y+args[2],args[3],args[4],args[5],args[6],args[7],args[8],args[9]);}else{var indices=args[5];var i=0,len=indices.length;var ctx=this.ctx;for(i=0;i<len;i+=3){var index0=indices[i]*2;var index1=indices[i+1]*2;var index2=indices[i+2]*2;ctx.drawTriangle(args[0],args[3],args[4],index0,index1,index2,args[6],true);}}}
__proto.fillCircle=function(x,y,radius,color){Stat.drawCall++;var ctx=this.ctx;ctx.beginPath();ctx.fillStyle=color;ctx.arc(x+this.x,y+this.y,radius,0,RenderContext.PI2);ctx.fill();}
__proto.setShader=function(shader){this.ctx.setShader(shader);}
__proto.drawLine=function(fromX,fromY,toX,toY,color,lineWidth){(lineWidth===void 0)&&(lineWidth=1);var ctx=this.ctx;ctx.beginPath();ctx.strokeStyle=color;ctx.lineWidth=lineWidth;ctx.moveTo(this.x+fromX,this.y+fromY);ctx.lineTo(this.x+toX,this.y+toY);ctx.stroke();}
__proto.clear=function(){this.ctx.clear();}
__proto.transformByMatrix=function(value){this.ctx.transformByMatrix(value);}
__proto.setTransform=function(a,b,c,d,tx,ty){this.ctx.setTransform(a,b,c,d,tx,ty);}
__proto.setTransformByMatrix=function(value){this.ctx.setTransformByMatrix(value);}
__proto.save=function(){this.ctx.save();}
__proto.restore=function(){this.ctx.restore();}
__proto.translate=function(x,y){this.ctx.translate(x,y);}
__proto.transform=function(a,b,c,d,tx,ty){this.ctx.transform(a,b,c,d,tx,ty);}
__proto.rotate=function(angle){this.ctx.rotate(angle);}
__proto.scale=function(scaleX,scaleY){this.ctx.scale(scaleX,scaleY);}
__proto.alpha=function(value){this.ctx.globalAlpha*=value;}
__proto.setAlpha=function(value){this.ctx.globalAlpha=value;}
__proto.fillWords=function(words,x,y,font,color,underLine){(underLine===void 0)&&(underLine=0);this.ctx.fillWords(words,x,y,font,color,underLine);}
__proto.fillBorderWords=function(words,x,y,font,fillColor,borderColor,lineWidth){this.ctx.fillBorderWords(words,x,y,font,fillColor,borderColor,lineWidth);}
__proto.fillText=function(text,x,y,font,color,textAlign){this.ctx.fillText(text,x+this.x,y+this.y,font,color,textAlign);}
__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){this.ctx.strokeText(text,x+this.x,y+this.y,font,color,lineWidth,textAlign);}
__proto.blendMode=function(type){this.ctx.globalCompositeOperation=type;}
__proto.flush=function(){this.ctx.flush&&this.ctx.flush();}
__proto.addRenderObject=function(o){this.ctx.addRenderObject(o);}
__proto.beginClip=function(x,y,w,h){this.ctx.beginClip&&this.ctx.beginClip(x,y,w,h);}
__proto.endClip=function(){this.ctx.endClip&&this.ctx.endClip();}
__proto.fillTrangles=function(x,y,args){this.ctx.fillTrangles(args[0],args[1],args[2],args[3],args.length>4?args[4]:null);}
RenderContext.PI2=2*Math.PI;return RenderContext;})()
var RenderSprite=(function(){function RenderSprite(type,next){this._next=next||RenderSprite.NORENDER;switch(type){case 0:this._fun=this._no;return;case 0x01:this._fun=this._image;return;case 0x02:this._fun=this._alpha;return;case 0x04:this._fun=this._transform;return;case 0x08:this._fun=this._blend;return;case 0x10:this._fun=this._canvas;return;case 0x40:this._fun=this._mask;return;case 0x80:this._fun=this._clip;return;case 0x100:this._fun=this._style;return;case 0x200:this._fun=this._graphics;return;case 0x800:this._fun=this._childs;return;case 0x400:this._fun=this._custom;return;case 0x01|0x200:this._fun=this._image2;return;case 0x01|0x04|0x200:this._fun=this._image2;return;case 0x20:this._fun=Filter._filter;return;case 0x11111:this._fun=RenderSprite._initRenderFun;return;}
this.onCreate(type);}
__class(RenderSprite,'laya.renders.RenderSprite');var __proto=RenderSprite.prototype;__proto.onCreate=function(type){}
__proto._style=function(sprite,context,x,y){sprite._style.render(sprite,context,x,y);var next=this._next;next._fun.call(next,sprite,context,x,y);}
__proto._no=function(sprite,context,x,y){}
__proto._custom=function(sprite,context,x,y){sprite.customRender(context,x,y);var tf=sprite._style._tf;this._next._fun.call(this._next,sprite,context,x-tf.translateX,y-tf.translateY);}
__proto._clip=function(sprite,context,x,y){var next=this._next;if(next==RenderSprite.NORENDER)return;var r=sprite._style.scrollRect;context.ctx.save();context.ctx.clipRect(x,y,r.width,r.height);next._fun.call(next,sprite,context,x-r.x,y-r.y);context.ctx.restore();}
__proto._blend=function(sprite,context,x,y){var style=sprite._style;if(style.blendMode){context.ctx.globalCompositeOperation=style.blendMode;};var next=this._next;next._fun.call(next,sprite,context,x,y);context.ctx.globalCompositeOperation="source-over";}
__proto._mask=function(sprite,context,x,y){var next=this._next;next._fun.call(next,sprite,context,x,y);var mask=sprite.mask;if(mask){context.ctx.globalCompositeOperation="destination-in";if(mask.numChildren>0||!mask.graphics._isOnlyOne()){mask.cacheAsBitmap=true;}
mask.render(context,x-sprite.pivotX,y-sprite.pivotY);}
context.ctx.globalCompositeOperation="source-over";}
__proto._graphics=function(sprite,context,x,y){var tf=sprite._style._tf;sprite._graphics&&sprite._graphics._render(sprite,context,x-tf.translateX,y-tf.translateY);var next=this._next;next._fun.call(next,sprite,context,x,y);}
__proto._image=function(sprite,context,x,y){var style=sprite._style;context.ctx.drawTexture2(x,y,style._tf.translateX,style._tf.translateY,sprite.transform,style.alpha,style.blendMode,sprite._graphics._one);}
__proto._image2=function(sprite,context,x,y){var tf=sprite._style._tf;context.ctx.drawTexture2(x,y,tf.translateX,tf.translateY,sprite.transform,1,null,sprite._graphics._one);}
__proto._alpha=function(sprite,context,x,y){var style=sprite._style;var alpha;if((alpha=style.alpha)>0.01||sprite._needRepaint()){var temp=context.ctx.globalAlpha;context.ctx.globalAlpha*=alpha;var next=this._next;next._fun.call(next,sprite,context,x,y);context.ctx.globalAlpha=temp;}}
__proto._transform=function(sprite,context,x,y){var transform=sprite.transform,_next=this._next;if(transform&&_next!=RenderSprite.NORENDER){context.save();context.transform(transform.a,transform.b,transform.c,transform.d,transform.tx+x,transform.ty+y);_next._fun.call(_next,sprite,context,0,0);context.restore();}else
_next._fun.call(_next,sprite,context,x,y);}
__proto._childs=function(sprite,context,x,y){var style=sprite._style;var tf=style._tf;x=x-tf.translateX+style.paddingLeft;y=y-tf.translateY+style.paddingTop;if(style._calculation){var words=sprite._getWords();if(words){var tStyle=style;if(tStyle){if(tStyle.stroke){context.fillBorderWords(words,x,y,tStyle.font,tStyle.color,tStyle.strokeColor,tStyle.stroke);}else{context.fillWords(words,x,y,tStyle.font,tStyle.color,tStyle.underLine);}}}};var childs=sprite._childs,n=childs.length,ele;if(sprite.viewport||(sprite.optimizeScrollRect&&sprite._style.scrollRect)){var rect=sprite.viewport||sprite._style.scrollRect;var left=rect.x;var top=rect.y;var right=rect.right;var bottom=rect.bottom;var _x=NaN,_y=NaN;for(i=0;i<n;++i){if((ele=childs[i]).visible&&((_x=ele._x)<right&&(_x+ele.width)>left&&(_y=ele._y)<bottom&&(_y+ele.height)>top)){ele.render(context,x,y);}}}else{for(var i=0;i<n;++i)
(ele=(childs[i]))._style.visible&&ele.render(context,x,y);}}
__proto._canvas=function(sprite,context,x,y){var _cacheCanvas=sprite._$P.cacheCanvas;if(!_cacheCanvas){this._next._fun.call(this._next,sprite,context,x,y);return;}
_cacheCanvas.type==='bitmap'?(Stat.canvasBitmap++):(Stat.canvasNormal++);var tx=_cacheCanvas.ctx;if(sprite._needRepaint()||!tx){this._canvas_repaint(sprite,context,x,y);}
else{var tRec=_cacheCanvas._cacheRec;context.drawCanvas(tx.canvas,x+tRec.x,y+tRec.y,tRec.width,tRec.height);}}
__proto._canvas_repaint=function(sprite,context,x,y){var _cacheCanvas=sprite._$P.cacheCanvas;var _next=this._next;if(!_cacheCanvas){_next._fun.call(_next,sprite,tx,x,y);return;};var tx=_cacheCanvas.ctx;var _repaint=sprite._needRepaint()||(!tx);var canvas;var left;var top;var tRec;var tCacheType=_cacheCanvas.type;tCacheType==='bitmap'?(Stat.canvasBitmap++):(Stat.canvasNormal++);if(_repaint){if(!_cacheCanvas._cacheRec)
_cacheCanvas._cacheRec=new Rectangle();var w,h;if(!Render.isWebGL||tCacheType==="bitmap"){tRec=sprite.getSelfBounds();tRec.x=tRec.x-sprite.pivotX;tRec.y=tRec.y-sprite.pivotY;tRec.x=tRec.x-16;tRec.y=tRec.y-16;tRec.width=tRec.width+32;tRec.height=tRec.height+32;tRec.x=Math.floor(tRec.x+x)-x;tRec.y=Math.floor(tRec.y+y)-y;tRec.width=Math.floor(tRec.width);tRec.height=Math.floor(tRec.height);_cacheCanvas._cacheRec.copyFrom(tRec);}else{_cacheCanvas._cacheRec.setTo(-sprite.pivotX,-sprite.pivotY,1,1);}
tRec=_cacheCanvas._cacheRec;var scaleX=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleX;var scaleY=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleY;if(!Render.isWebGL){var chainScaleX=1;var chainScaleY=1;var tar;tar=sprite;while(tar&&tar!=Laya.stage){chainScaleX*=tar.scaleX;chainScaleY*=tar.scaleY;tar=tar.parent;}
if(Render.isWebGL){if(chainScaleX<1)scaleX*=chainScaleX;if(chainScaleY<1)scaleY*=chainScaleY;}else{if(chainScaleX>1)scaleX*=chainScaleX;if(chainScaleY>1)scaleY*=chainScaleY;}}
if(sprite.scrollRect){var scrollRect=sprite.scrollRect;tRec.x-=scrollRect.x;tRec.y-=scrollRect.y;}
w=tRec.width*scaleX;h=tRec.height*scaleY;left=tRec.x;top=tRec.y;if(Render.isWebGL&&tCacheType==='bitmap'&&(w>2048||h>2048)){console.warn("cache bitmap size larger than 2048,cache ignored");if(_cacheCanvas.ctx){Pool.recover("RenderContext",_cacheCanvas.ctx);_cacheCanvas.ctx.canvas.size(0,0);_cacheCanvas.ctx=null;}
_next._fun.call(_next,sprite,context,x,y);return;}
if(!tx){tx=_cacheCanvas.ctx=Pool.getItem("RenderContext")||new RenderContext(w,h,HTMLCanvas.create("AUTO"));}
tx.ctx.sprite=sprite;canvas=tx.canvas;canvas.clear();(canvas.width!=w||canvas.height!=h)&&canvas.size(w,h);if(tCacheType==='bitmap')canvas.context.asBitmap=true;else if(tCacheType==='normal')canvas.context.asBitmap=false;var t;if(scaleX!=1||scaleY!=1){var ctx=(tx).ctx;ctx.save();ctx.scale(scaleX,scaleY);if(!Render.isConchWebGL&&Render.isConchApp){t=sprite._$P.cf;t&&ctx.setFilterMatrix&&ctx.setFilterMatrix(t._mat,t._alpha);}
_next._fun.call(_next,sprite,tx,-left,-top);ctx.restore();if(!Render.isConchApp||Render.isConchWebGL)sprite._applyFilters();}else{ctx=(tx).ctx;if(!Render.isConchWebGL&&Render.isConchApp){t=sprite._$P.cf;t&&ctx.setFilterMatrix&&ctx.setFilterMatrix(t._mat,t._alpha);}
_next._fun.call(_next,sprite,tx,-left,-top);if(!Render.isConchApp||Render.isConchWebGL)sprite._applyFilters();}
if(sprite._$P.staticCache)_cacheCanvas.reCache=false;Stat.canvasReCache++;}else{tRec=_cacheCanvas._cacheRec;left=tRec.x;top=tRec.y;canvas=tx.canvas;}
context.drawCanvas(canvas,x+left,y+top,tRec.width,tRec.height);}
RenderSprite.__init__=function(){var i=0,len=0;var initRender;initRender=RunDriver.createRenderSprite(0x11111,null);len=RenderSprite.renders.length=0x800*2;for(i=0;i<len;i++)
RenderSprite.renders[i]=initRender;RenderSprite.renders[0]=RunDriver.createRenderSprite(0,null);function _initSame(value,o){var n=0;for(var i=0;i<value.length;i++){n|=value[i];RenderSprite.renders[n]=o;}}
_initSame([0x01,0x200,0x04,0x02],new RenderSprite(0x01,null));RenderSprite.renders[0x01|0x200]=RunDriver.createRenderSprite(0x01|0x200,null);RenderSprite.renders[0x01|0x04|0x200]=new RenderSprite(0x01|0x04|0x200,null);}
RenderSprite._initRenderFun=function(sprite,context,x,y){var type=sprite._renderType;var r=RenderSprite.renders[type]=RenderSprite._getTypeRender(type);r._fun(sprite,context,x,y);}
RenderSprite._getTypeRender=function(type){var rst=null;var tType=0x800;while(tType>1){if(tType&type)
rst=RunDriver.createRenderSprite(tType,rst);tType=tType>>1;}
return rst;}
RenderSprite.IMAGE=0x01;RenderSprite.ALPHA=0x02;RenderSprite.TRANSFORM=0x04;RenderSprite.BLEND=0x08;RenderSprite.CANVAS=0x10;RenderSprite.FILTERS=0x20;RenderSprite.MASK=0x40;RenderSprite.CLIP=0x80;RenderSprite.STYLE=0x100;RenderSprite.GRAPHICS=0x200;RenderSprite.CUSTOM=0x400;RenderSprite.CHILDS=0x800;RenderSprite.INIT=0x11111;RenderSprite.renders=[];RenderSprite.NORENDER=new RenderSprite(0,null);return RenderSprite;})()
var Context=(function(){function Context(){this._repaint=false;}
__class(Context,'laya.resource.Context');var __proto=Context.prototype;__proto.replaceReset=function(){var i=0,len=0;len=Context.replaceKeys.length;var key;for(i=0;i<len;i++){key=Context.replaceKeys[i];this[Context.newKeys[i]]=this[key];}}
__proto.replaceResotre=function(){this.__restore();this.__reset();}
__proto.setIsMainContext=function(){}
__proto.drawTextures=function(tex,pos,tx,ty){Stat.drawCall+=pos.length/2;var w=tex.width;var h=tex.height;for(var i=0,sz=pos.length;i<sz;i+=2){this.drawTexture(tex,pos[i],pos[i+1],w,h,tx,ty);}}
__proto.drawCanvas=function(canvas,x,y,width,height){Stat.drawCall++;this.drawImage(canvas.source,x,y,width,height);}
__proto.fillRect=function(x,y,width,height,style){Stat.drawCall++;style&&(this.fillStyle=style);this.__fillRect(x,y,width,height);}
__proto.fillText=function(text,x,y,font,color,textAlign){Stat.drawCall++;if(arguments.length>3&&font!=null){this.font=font;this.fillStyle=color;this.textAlign=textAlign;this.textBaseline="top";}
this.__fillText(text,x,y);}
__proto.fillBorderText=function(text,x,y,font,fillColor,borderColor,lineWidth,textAlign){Stat.drawCall++;this.font=font;this.fillStyle=fillColor;this.textBaseline="top";this.strokeStyle=borderColor;this.lineWidth=lineWidth;this.textAlign=textAlign;this.__strokeText(text,x,y);this.__fillText(text,x,y);}
__proto.strokeText=function(text,x,y,font,color,lineWidth,textAlign){Stat.drawCall++;if(arguments.length>3&&font!=null){this.font=font;this.strokeStyle=color;this.lineWidth=lineWidth;this.textAlign=textAlign;this.textBaseline="top";}
this.__strokeText(text,x,y);}
__proto.transformByMatrix=function(value){this.transform(value.a,value.b,value.c,value.d,value.tx,value.ty);}
__proto.setTransformByMatrix=function(value){this.setTransform(value.a,value.b,value.c,value.d,value.tx,value.ty);}
__proto.clipRect=function(x,y,width,height){Stat.drawCall++;this.beginPath();this.rect(x,y,width,height);this.clip();}
__proto.drawTexture=function(tex,x,y,width,height,tx,ty){Stat.drawCall++;var uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;this.drawImage(tex.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x+tx,y+ty,width,height);}
__proto.drawTextureWithTransform=function(tex,x,y,width,height,m,tx,ty,alpha){Stat.drawCall++;var uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;this.save();alpha!=1&&(this.globalAlpha*=alpha);if(m){this.transform(m.a,m.b,m.c,m.d,m.tx+tx,m.ty+ty);this.drawImage(tex.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x,y,width,height);}else{this.drawImage(tex.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,x+tx,y+ty,width,height);}
this.restore();}
__proto.drawTexture2=function(x,y,pivotX,pivotY,m,alpha,blendMode,args2){'use strict';var tex=args2[0];if(!(tex.loaded&&tex.bitmap&&tex.source)){return;}
Stat.drawCall++;var alphaChanged=alpha!==1;if(alphaChanged){var temp=this.globalAlpha;this.globalAlpha*=alpha;};var uv=tex.uv,w=tex.bitmap.width,h=tex.bitmap.height;if(m){this.save();this.transform(m.a,m.b,m.c,m.d,m.tx+x,m.ty+y);this.drawImage(tex.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,args2[1]-pivotX,args2[2]-pivotY,args2[3],args2[4]);this.restore();}else{this.drawImage(tex.source,uv[0]*w,uv[1]*h,(uv[2]-uv[0])*w,(uv[5]-uv[3])*h,args2[1]-pivotX+x,args2[2]-pivotY+y,args2[3],args2[4]);}
if(alphaChanged)this.globalAlpha=temp;}
__proto.fillTexture=function(texture,x,y,width,height,type,offset,other){if(!other.pat){if(texture.uv!=Texture.DEF_UV){var canvas=new HTMLCanvas("2D");canvas.getContext('2d');canvas.size(texture.width,texture.height);canvas.context.drawTexture(texture,0,0,texture.width,texture.height,0,0);texture=new Texture(canvas);}
other.pat=this.createPattern(texture.bitmap.source,type);};var oX=x,oY=y;var sX=0,sY=0;if(offset){oX+=offset.x%texture.width;oY+=offset.y%texture.height;sX-=offset.x%texture.width;sY-=offset.y%texture.height;}
this.translate(oX,oY);this.fillRect(sX,sY,width,height,other.pat);this.translate(-oX,-oY);}
__proto.drawTriangle=function(texture,vertices,uvs,index0,index1,index2,matrix,canvasPadding){var source=texture.bitmap;var textureSource=source.source;var textureWidth=texture.width;var textureHeight=texture.height;var sourceWidth=source.width;var sourceHeight=source.height;var u0=uvs[index0]*sourceWidth;var u1=uvs[index1]*sourceWidth;var u2=uvs[index2]*sourceWidth;var v0=uvs[index0+1]*sourceHeight;var v1=uvs[index1+1]*sourceHeight;var v2=uvs[index2+1]*sourceHeight;var x0=vertices[index0];var x1=vertices[index1];var x2=vertices[index2];var y0=vertices[index0+1];var y1=vertices[index1+1];var y2=vertices[index2+1];if(canvasPadding){var paddingX=1;var paddingY=1;var centerX=(x0+x1+x2)/3;var centerY=(y0+y1+y2)/3;var normX=x0-centerX;var normY=y0-centerY;var dist=Math.sqrt((normX*normX)+(normY*normY));x0=centerX+((normX/dist)*(dist+paddingX));y0=centerY+((normY/dist)*(dist+paddingY));normX=x1-centerX;normY=y1-centerY;dist=Math.sqrt((normX*normX)+(normY*normY));x1=centerX+((normX/dist)*(dist+paddingX));y1=centerY+((normY/dist)*(dist+paddingY));normX=x2-centerX;normY=y2-centerY;dist=Math.sqrt((normX*normX)+(normY*normY));x2=centerX+((normX/dist)*(dist+paddingX));y2=centerY+((normY/dist)*(dist+paddingY));}
this.save();if(matrix)
this.transform(matrix.a,matrix.b,matrix.c,matrix.d,matrix.tx,matrix.ty);this.beginPath();this.moveTo(x0,y0);this.lineTo(x1,y1);this.lineTo(x2,y2);this.closePath();this.clip();var delta=(u0*v1)+(v0*u2)+(u1*v2)-(v1*u2)-(v0*u1)-(u0*v2);var dDelta=1/delta;var deltaA=(x0*v1)+(v0*x2)+(x1*v2)-(v1*x2)-(v0*x1)-(x0*v2);var deltaB=(u0*x1)+(x0*u2)+(u1*x2)-(x1*u2)-(x0*u1)-(u0*x2);var deltaC=(u0*v1*x2)+(v0*x1*u2)+(x0*u1*v2)-(x0*v1*u2)-(v0*u1*x2)-(u0*x1*v2);var deltaD=(y0*v1)+(v0*y2)+(y1*v2)-(v1*y2)-(v0*y1)-(y0*v2);var deltaE=(u0*y1)+(y0*u2)+(u1*y2)-(y1*u2)-(y0*u1)-(u0*y2);var deltaF=(u0*v1*y2)+(v0*y1*u2)+(y0*u1*v2)-(y0*v1*u2)-(v0*u1*y2)-(u0*y1*v2);this.transform(deltaA*dDelta,deltaD*dDelta,deltaB*dDelta,deltaE*dDelta,deltaC*dDelta,deltaF*dDelta);this.drawImage(textureSource,texture.uv[0]*sourceWidth,texture.uv[1]*sourceHeight,textureWidth,textureHeight,texture.uv[0]*sourceWidth,texture.uv[1]*sourceHeight,textureWidth,textureHeight);this.restore();}
__proto.flush=function(){return 0;}
__proto.fillWords=function(words,x,y,font,color,underLine){font&&(this.font=font);color&&(this.fillStyle=color);var _this=this;this.textBaseline="top";this.textAlign='left';for(var i=0,n=words.length;i<n;i++){var a=words[i];this.__fillText(a.char,a.x+x,a.y+y);if(underLine===1){var tHeight=a.height;var dX=a.style.letterSpacing*0.5;if(!dX)dX=0;this.beginPath();this.strokeStyle=color;this.lineWidth=1;this.moveTo(x+a.x-dX+0.5,y+a.y+tHeight+0.5);this.lineTo(x+a.x+a.width+dX+0.5,y+a.y+tHeight+0.5);this.stroke();}}}
__proto.fillBorderWords=function(words,x,y,font,color,borderColor,lineWidth){font&&(this.font=font);color&&(this.fillStyle=color);this.textBaseline="top";this.lineWidth=lineWidth;this.textAlign='left';this.strokeStyle=borderColor;for(var i=0,n=words.length;i<n;i++){var a=words[i];this.__strokeText(a.char,a.x+x,a.y+y);this.__fillText(a.char,a.x+x,a.y+y);}}
__proto.destroy=function(){this.canvas.width=this.canvas.height=0;}
__proto.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height);this._repaint=false;}
__proto.drawCurves=function(x,y,args){this.beginPath();this.strokeStyle=args[3];this.lineWidth=args[4];var points=args[2];x+=args[0],y+=args[1];this.moveTo(x+points[0],y+points[1]);var i=2,n=points.length;while(i<n){this.quadraticCurveTo(x+points[i++],y+points[i++],x+points[i++],y+points[i++]);}
this.stroke();}
Context.__init__=function(to){var from=laya.resource.Context.prototype;to=to||CanvasRenderingContext2D.prototype;if(to.inited)return;to.inited=true;to.__fillText=to.fillText;to.__fillRect=to.fillRect;to.__strokeText=to.strokeText;var funs=['drawTextures',"drawTriangle",'fillWords','fillBorderWords','setIsMainContext','fillRect','strokeText','fillTexture','fillText','transformByMatrix','setTransformByMatrix','clipRect','drawTexture','drawTexture2','drawTextureWithTransform','flush','clear','destroy','drawCanvas','fillBorderText','drawCurves'];funs.forEach(function(i){to[i]=from[i];});}
Context.replaceCanvasGetSet=function(tar,key){var oldO=Object.getOwnPropertyDescriptor(tar,key);if(!oldO||!oldO.configurable)return false;var newO={};var tkey;for(tkey in oldO){if(tkey!="set"){newO[tkey]=oldO[tkey];}};var preFun=oldO["set"];newO["set"]=function(v){var _self=this;preFun.call(_self,v);var _ct=_self.getContext("2d");if(_ct&&"__reset"in _ct){_ct.__reset();}}
Object.defineProperty(tar,key,newO);return true;}
Context.replaceGetSet=function(tar,key){var oldO=Object.getOwnPropertyDescriptor(tar,key);if(!oldO||!oldO.configurable)return false;var newO={};var tkey;for(tkey in oldO){if(tkey!="set"){newO[tkey]=oldO[tkey];}};var preFun=oldO["set"];var dataKey="___"+key+"__";Context.newKeys.push(dataKey);newO["set"]=function(v){var _self=this;if(v!=_self[dataKey]){_self[dataKey]=v;preFun.call(_self,v);}}
Object.defineProperty(tar,key,newO);return true;}
Context._default=new Context();Context.newKeys=[];__static(Context,['replaceKeys',function(){return this.replaceKeys=["font","fillStyle","textBaseline"];}]);return Context;})()
var ResourceManager=(function(){function ResourceManager(name){this._id=0;this._name=null;this._resources=null;this._memorySize=0;this._garbageCollectionRate=NaN;this._isOverflow=false;this.autoRelease=false;this.autoReleaseMaxSize=0;this._id=++ResourceManager._uniqueIDCounter;this._name=name?name:"Content Manager";ResourceManager._isResourceManagersSorted=false;this._memorySize=0;this._isOverflow=false;this.autoRelease=false;this.autoReleaseMaxSize=1024*1024*512;this._garbageCollectionRate=0.2;ResourceManager._resourceManagers.push(this);this._resources=[];}
__class(ResourceManager,'laya.resource.ResourceManager');var __proto=ResourceManager.prototype;Laya.imps(__proto,{"laya.resource.IDispose":true})
__proto.getResourceByIndex=function(index){return this._resources[index];}
__proto.getResourcesLength=function(){return this._resources.length;}
__proto.addResource=function(resource){if(resource.resourceManager)
resource.resourceManager.removeResource(resource);var index=this._resources.indexOf(resource);if(index===-1){resource._resourceManager=this;this._resources.push(resource);this.addSize(resource.memorySize);return true;}
return false;}
__proto.removeResource=function(resource){var index=this._resources.indexOf(resource);if(index!==-1){this._resources.splice(index,1);resource._resourceManager=null;this._memorySize-=resource.memorySize;return true;}
return false;}
__proto.unload=function(){var tempResources=this._resources.slice(0,this._resources.length);for(var i=0;i<tempResources.length;i++){var resource=tempResources[i];resource.destroy();}
tempResources.length=0;}
__proto.dispose=function(){if(this===ResourceManager._systemResourceManager)
throw new Error("systemResourceManager不能被释放！");ResourceManager._resourceManagers.splice(ResourceManager._resourceManagers.indexOf(this),1);ResourceManager._isResourceManagersSorted=false;var tempResources=this._resources.slice(0,this._resources.length);for(var i=0;i<tempResources.length;i++){var resource=tempResources[i];resource.resourceManager.removeResource(resource);resource.destroy();}
tempResources.length=0;}
__proto.addSize=function(add){if(add){if(this.autoRelease&&add>0)
((this._memorySize+add)>this.autoReleaseMaxSize)&&(this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize));this._memorySize+=add;}}
__proto.garbageCollection=function(reserveSize){var all=this._resources;all=all.slice();all.sort(function(a,b){if(!a||!b)
throw new Error("a或b不能为空！");if(a.released&&b.released)
return 0;else if(a.released)
return 1;else if(b.released)
return-1;return a._lastUseFrameCount-b._lastUseFrameCount;});var currentFrameCount=Stat.loopCount;for(var i=0,n=all.length;i<n;i++){var resou=all[i];if(currentFrameCount-resou._lastUseFrameCount>1){resou.releaseResource();}else{if(this._memorySize>=reserveSize)
this._isOverflow=true;return;}
if(this._memorySize<reserveSize){this._isOverflow=false;return;}}}
__getset(0,__proto,'id',function(){return this._id;});__getset(0,__proto,'name',function(){return this._name;},function(value){if((value||value!=="")&&this._name!==value){this._name=value;ResourceManager._isResourceManagersSorted=false;}});__getset(0,__proto,'memorySize',function(){return this._memorySize;});__getset(1,ResourceManager,'systemResourceManager',function(){return ResourceManager._systemResourceManager;});ResourceManager.__init__=function(){ResourceManager.currentResourceManager=ResourceManager.systemResourceManager;}
ResourceManager.getLoadedResourceManagerByIndex=function(index){return ResourceManager._resourceManagers[index];}
ResourceManager.getLoadedResourceManagersCount=function(){return ResourceManager._resourceManagers.length;}
ResourceManager.recreateContentManagers=function(force){(force===void 0)&&(force=false);var temp=ResourceManager.currentResourceManager;for(var i=0;i<ResourceManager._resourceManagers.length;i++){ResourceManager.currentResourceManager=ResourceManager._resourceManagers[i];for(var j=0;j<ResourceManager.currentResourceManager._resources.length;j++){ResourceManager.currentResourceManager._resources[j].releaseResource(force);ResourceManager.currentResourceManager._resources[j].activeResource(force);}}
ResourceManager.currentResourceManager=temp;}
ResourceManager.releaseContentManagers=function(force){(force===void 0)&&(force=false);var temp=ResourceManager.currentResourceManager;for(var i=0;i<ResourceManager._resourceManagers.length;i++){ResourceManager.currentResourceManager=ResourceManager._resourceManagers[i];for(var j=0;j<ResourceManager.currentResourceManager._resources.length;j++){var resource=ResourceManager.currentResourceManager._resources[j];(!resource.released)&&(resource.releaseResource(force));}}
ResourceManager.currentResourceManager=temp;}
ResourceManager._uniqueIDCounter=0;ResourceManager._isResourceManagersSorted=false;ResourceManager._resourceManagers=[];__static(ResourceManager,['_systemResourceManager',function(){return this._systemResourceManager=new ResourceManager("System Resource Manager");},'currentResourceManager',function(){return this.currentResourceManager=ResourceManager._systemResourceManager;}]);return ResourceManager;})()
var System=(function(){function System(){}
__class(System,'laya.system.System');System.changeDefinition=function(name,classObj){Laya[name]=classObj;var str=name+"=classObj";eval(str);}
System.__init__=function(){if(Render.isConchApp){conch.disableConchResManager();conch.disableConchAutoRestoreLostedDevice();}}
return System;})()
SoundManager;var Browser=(function(){function Browser(){}
__class(Browser,'laya.utils.Browser');__getset(1,Browser,'pixelRatio',function(){Browser.__init__();if(Browser.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1)return 2;return RunDriver.getPixelRatio();});__getset(1,Browser,'height',function(){Browser.__init__();return((Laya.stage&&Laya.stage.canvasRotation)?Browser.clientWidth:Browser.clientHeight)*Browser.pixelRatio;});__getset(1,Browser,'clientWidth',function(){Browser.__init__();return Browser.window.innerWidth||Browser.document.body.clientWidth;});__getset(1,Browser,'window',function(){Browser.__init__();return Browser._window;});__getset(1,Browser,'clientHeight',function(){Browser.__init__();return Browser.window.innerHeight||Browser.document.body.clientHeight||Browser.document.documentElement.clientHeight;});__getset(1,Browser,'width',function(){Browser.__init__();return((Laya.stage&&Laya.stage.canvasRotation)?Browser.clientHeight:Browser.clientWidth)*Browser.pixelRatio;});__getset(1,Browser,'container',function(){Browser.__init__();if(!Browser._container){Browser._container=Browser.createElement("div");Browser._container.id="layaContainer";Browser.document.body.appendChild(Browser._container);}
return Browser._container;},function(value){Browser._container=value;});__getset(1,Browser,'document',function(){Browser.__init__();return Browser._document;});Browser.__init__=function(){SoundManager;if(Browser._window)return;Browser._window=RunDriver.getWindow();Browser._document=Browser.window.document;Browser._window.addEventListener('message',function(e){laya.utils.Browser._onMessage(e);},false);Browser.document.__createElement=Browser.document.createElement;window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){return window.setTimeout(c,1000/60);};;Browser.userAgent=Browser.window.navigator.userAgent;Browser.u=Browser.userAgent;Browser.onIOS=!!Browser.u.match(/\(i[^;]+;(U;)? CPU.+Mac OS X/);Browser.onMobile=Browser.u.indexOf("Mobile")>-1;Browser.onIPhone=Browser.u.indexOf("iPhone")>-1;Browser.onMac=Browser.u.indexOf("Mac OS X")>-1;Browser.onIPad=Browser.u.indexOf("iPad")>-1;Browser.onAndriod=Browser.u.indexOf('Android')>-1||Browser.u.indexOf('Adr')>-1;Browser.onWP=Browser.u.indexOf("Windows Phone")>-1;Browser.onQQBrowser=Browser.u.indexOf("QQBrowser")>-1;Browser.onMQQBrowser=Browser.u.indexOf("MQQBrowser")>-1||(Browser.u.indexOf("Mobile")>-1&&Browser.u.indexOf("QQ")>-1);Browser.onIE=!!Browser.window.ActiveXObject||"ActiveXObject"in Browser.window;Browser.onWeiXin=Browser.u.indexOf('MicroMessenger')>-1;Browser.onPC=!Browser.onMobile;Browser.onSafari=Browser.u.indexOf("Safari")>-1;Browser.onFirefox=Browser.u.indexOf('Firefox')>-1;Browser.onEdge=Browser.u.indexOf('Edge')>-1;Browser.onMiniGame=Browser.u.indexOf('MiniGame')>-1;Browser.onLimixiu=Browser.u.indexOf('limixiu')>-1;Browser.httpProtocol=Browser.window.location.protocol=="http:";if(Browser.onMiniGame&&Browser.window.focus==null){console.error("请先初始化小游戏适配库，详细教程https://ldc.layabox.com/doc/?nav=zh-ts-5-0-0");}
Browser.webAudioEnabled=Browser.window["AudioContext"]||Browser.window["webkitAudioContext"]||Browser.window["mozAudioContext"]?true:false;Browser.soundType=Browser.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND";Sound=Browser.webAudioEnabled?WebAudioSound:AudioSound;;if(Browser.webAudioEnabled)WebAudioSound.initWebAudio();;AudioSound._initMusicAudio();Browser.enableTouch=(('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch);window.focus();SoundManager._soundClass=Sound;;SoundManager._musicClass=AudioSound;Render._mainCanvas=Render._mainCanvas||HTMLCanvas.create('2D');if(Browser.canvas)return;Browser.canvas=HTMLCanvas.create('2D');Browser.context=Browser.canvas.getContext('2d');}
Browser._onMessage=function(e){if(!e.data)return;if(e.data.name=="size"){Browser.window.innerWidth=e.data.width;Browser.window.innerHeight=e.data.height;Browser.window.__innerHeight=e.data.clientHeight;if(!Browser.document.createEvent){console.warn("no document.createEvent");return;};var evt=Browser.document.createEvent("HTMLEvents");evt.initEvent("resize",false,false);Browser.window.dispatchEvent(evt);return;}}
Browser.createElement=function(type){Browser.__init__();return Browser.document.__createElement(type);}
Browser.getElementById=function(type){Browser.__init__();return Browser.document.getElementById(type);}
Browser.removeElement=function(ele){if(ele&&ele.parentNode)ele.parentNode.removeChild(ele);}
Browser.now=function(){return RunDriver.now();}
Browser._window=null;Browser._document=null;Browser._container=null;Browser.userAgent=null;Browser.u=null;Browser.onIOS=false;Browser.onMac=false;Browser.onMobile=false;Browser.onIPhone=false;Browser.onIPad=false;Browser.onAndriod=false;Browser.onAndroid=false;Browser.onWP=false;Browser.onQQBrowser=false;Browser.onMQQBrowser=false;Browser.onSafari=false;Browser.onFirefox=false;Browser.onEdge=false;Browser.onIE=false;Browser.onWeiXin=false;Browser.onMiniGame=false;Browser.onLimixiu=false;Browser.onPC=false;Browser.httpProtocol=false;Browser.webAudioEnabled=false;Browser.soundType=null;Browser.enableTouch=false;Browser.canvas=null;Browser.context=null;Browser.__init$=function(){AudioSound;WebAudioSound;}
return Browser;})()
var Byte=(function(){function Byte(data){this._xd_=true;this._allocated_=8;this._pos_=0;this._length=0;if(data){this._u8d_=new Uint8Array(data);this._d_=new DataView(this._u8d_.buffer);this._length=this._d_.byteLength;}else{this.___resizeBuffer(this._allocated_);}}
__class(Byte,'laya.utils.Byte');var __proto=Byte.prototype;__proto.___resizeBuffer=function(len){try{var newByteView=new Uint8Array(len);if(this._u8d_!=null){if(this._u8d_.length<=len)newByteView.set(this._u8d_);else newByteView.set(this._u8d_.subarray(0,len));}
this._u8d_=newByteView;this._d_=new DataView(newByteView.buffer);}catch(err){throw"___resizeBuffer err:"+len;}}
__proto.getString=function(){return this.rUTF(this.getUint16());}
__proto.getFloat32Array=function(start,len){var end=start+len;end=(end>this._length)?this._length:end;var v=new Float32Array(this._d_.buffer.slice(start,end));this._pos_=end;return v;}
__proto.getUint8Array=function(start,len){var end=start+len;end=(end>this._length)?this._length:end;var v=new Uint8Array(this._d_.buffer.slice(start,end));this._pos_=end;return v;}
__proto.getInt16Array=function(start,len){var end=start+len;end=(end>this._length)?this._length:end;var v=new Int16Array(this._d_.buffer.slice(start,end));this._pos_=end;return v;}
__proto.getFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var v=this._d_.getFloat32(this._pos_,this._xd_);this._pos_+=4;return v;}
__proto.getFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var v=this._d_.getFloat64(this._pos_,this._xd_);this._pos_+=8;return v;}
__proto.writeFloat32=function(value){this.ensureWrite(this._pos_+4);this._d_.setFloat32(this._pos_,value,this._xd_);this._pos_+=4;}
__proto.writeFloat64=function(value){this.ensureWrite(this._pos_+8);this._d_.setFloat64(this._pos_,value,this._xd_);this._pos_+=8;}
__proto.getInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var float=this._d_.getInt32(this._pos_,this._xd_);this._pos_+=4;return float;}
__proto.getUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var v=this._d_.getUint32(this._pos_,this._xd_);this._pos_+=4;return v;}
__proto.writeInt32=function(value){this.ensureWrite(this._pos_+4);this._d_.setInt32(this._pos_,value,this._xd_);this._pos_+=4;}
__proto.writeUint32=function(value){this.ensureWrite(this._pos_+4);this._d_.setUint32(this._pos_,value,this._xd_);this._pos_+=4;}
__proto.getInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var us=this._d_.getInt16(this._pos_,this._xd_);this._pos_+=2;return us;}
__proto.getUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var us=this._d_.getUint16(this._pos_,this._xd_);this._pos_+=2;return us;}
__proto.writeUint16=function(value){this.ensureWrite(this._pos_+2);this._d_.setUint16(this._pos_,value,this._xd_);this._pos_+=2;}
__proto.writeInt16=function(value){this.ensureWrite(this._pos_+2);this._d_.setInt16(this._pos_,value,this._xd_);this._pos_+=2;}
__proto.getUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._d_.getUint8(this._pos_++);}
__proto.writeUint8=function(value){this.ensureWrite(this._pos_+1);this._d_.setUint8(this._pos_,value);this._pos_++;}
__proto._getUInt8=function(pos){return this._d_.getUint8(pos);}
__proto._getUint16=function(pos){return this._d_.getUint16(pos,this._xd_);}
__proto._getMatrix=function(){var rst=new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32());return rst;}
__proto.rUTF=function(len){var v="",max=this._pos_+len,c=0,c2=0,c3=0,f=String.fromCharCode;var u=this._u8d_,i=0;while(this._pos_<max){c=u[this._pos_++];if(c<0x80){if(c!=0){v+=f(c);}}else if(c<0xE0){v+=f(((c&0x3F)<<6)|(u[this._pos_++]&0x7F));}else if(c<0xF0){c2=u[this._pos_++];v+=f(((c&0x1F)<<12)|((c2&0x7F)<<6)|(u[this._pos_++]&0x7F));}else{c2=u[this._pos_++];c3=u[this._pos_++];v+=f(((c&0x0F)<<18)|((c2&0x7F)<<12)|((c3<<6)&0x7F)|(u[this._pos_++]&0x7F));}
i++;}
return v;}
__proto.getCustomString=function(len){var v="",ulen=0,c=0,c2=0,f=String.fromCharCode;var u=this._u8d_,i=0;while(len>0){c=u[this._pos_];if(c<0x80){v+=f(c);this._pos_++;len--;}else{ulen=c-0x80;this._pos_++;len-=ulen;while(ulen>0){c=u[this._pos_++];c2=u[this._pos_++];v+=f((c2<<8)|c);ulen--;}}}
return v;}
__proto.clear=function(){this._pos_=0;this.length=0;}
__proto.__getBuffer=function(){return this._d_.buffer;}
__proto.writeUTFBytes=function(value){value=value+"";for(var i=0,sz=value.length;i<sz;i++){var c=value.charCodeAt(i);if(c<=0x7F){this.writeByte(c);}else if(c<=0x7FF){this.ensureWrite(this._pos_+2);this._u8d_.set([0xC0|(c>>6),0x80|(c&0x3F)],this._pos_);this._pos_+=2;}else if(c<=0xFFFF){this.ensureWrite(this._pos_+3);this._u8d_.set([0xE0|(c>>12),0x80|((c>>6)&0x3F),0x80|(c&0x3F)],this._pos_);this._pos_+=3;}else{this.ensureWrite(this._pos_+4);this._u8d_.set([0xF0|(c>>18),0x80|((c>>12)&0x3F),0x80|((c>>6)&0x3F),0x80|(c&0x3F)],this._pos_);this._pos_+=4;}}}
__proto.writeUTFString=function(value){var tPos=this.pos;this.writeUint16(1);this.writeUTFBytes(value);var dPos=this.pos-tPos-2;if(dPos>=65536){throw"writeUTFString byte len more than 65536";}
this._d_.setUint16(tPos,dPos,this._xd_);}
__proto.readUTFString=function(){return this.readUTFBytes(this.getUint16());}
__proto.getUTFString=function(){return this.readUTFString();}
__proto.readUTFBytes=function(len){(len===void 0)&&(len=-1);if(len==0)return"";var lastBytes=this.bytesAvailable;if(len>lastBytes)throw"readUTFBytes error - Out of bounds";len=len>0?len:lastBytes;return this.rUTF(len);}
__proto.getUTFBytes=function(len){(len===void 0)&&(len=-1);return this.readUTFBytes(len);}
__proto.writeByte=function(value){this.ensureWrite(this._pos_+1);this._d_.setInt8(this._pos_,value);this._pos_+=1;}
__proto.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++);}
__proto.getByte=function(){return this.readByte();}
__proto.ensureWrite=function(lengthToEnsure){if(this._length<lengthToEnsure)this._length=lengthToEnsure;if(this._allocated_<lengthToEnsure)this.length=lengthToEnsure;}
__proto.writeArrayBuffer=function(arraybuffer,offset,length){(offset===void 0)&&(offset=0);(length===void 0)&&(length=0);if(offset<0||length<0)throw"writeArrayBuffer error - Out of bounds";if(length==0)length=arraybuffer.byteLength-offset;this.ensureWrite(this._pos_+length);var uint8array=new Uint8Array(arraybuffer);this._u8d_.set(uint8array.subarray(offset,offset+length),this._pos_);this._pos_+=length;}
__getset(0,__proto,'buffer',function(){var rstBuffer=this._d_.buffer;if(rstBuffer.byteLength==this.length)return rstBuffer;return rstBuffer.slice(0,this.length);});__getset(0,__proto,'endian',function(){return this._xd_?"littleEndian":"bigEndian";},function(endianStr){this._xd_=(endianStr=="littleEndian");});__getset(0,__proto,'length',function(){return this._length;},function(value){if(this._allocated_<value)
this.___resizeBuffer(this._allocated_=Math.floor(Math.max(value,this._allocated_*2)));else if(this._allocated_>value)
this.___resizeBuffer(this._allocated_=value);this._length=value;});__getset(0,__proto,'pos',function(){return this._pos_;},function(value){this._pos_=value;});__getset(0,__proto,'bytesAvailable',function(){return this._length-this._pos_;});Byte.getSystemEndian=function(){if(!Byte._sysEndian){var buffer=new ArrayBuffer(2);new DataView(buffer).setInt16(0,256,true);Byte._sysEndian=(new Int16Array(buffer))[0]===256?"littleEndian":"bigEndian";}
return Byte._sysEndian;}
Byte.BIG_ENDIAN="bigEndian";Byte.LITTLE_ENDIAN="littleEndian";Byte._sysEndian=null;return Byte;})()
var CacheManager=(function(){function CacheManager(){}
__class(CacheManager,'laya.utils.CacheManager');CacheManager.regCacheByFunction=function(disposeFunction,getCacheListFunction){CacheManager.unRegCacheByFunction(disposeFunction,getCacheListFunction);var cache;cache={tryDispose:disposeFunction,getCacheList:getCacheListFunction};CacheManager._cacheList.push(cache);}
CacheManager.unRegCacheByFunction=function(disposeFunction,getCacheListFunction){var i=0,len=0;len=CacheManager._cacheList.length;for(i=0;i<len;i++){if(CacheManager._cacheList[i].tryDispose==disposeFunction&&CacheManager._cacheList[i].getCacheList==getCacheListFunction){CacheManager._cacheList.splice(i,1);return;}}}
CacheManager.forceDispose=function(){var i=0,len=CacheManager._cacheList.length;for(i=0;i<len;i++){CacheManager._cacheList[i].tryDispose(true);}}
CacheManager.beginCheck=function(waitTime){(waitTime===void 0)&&(waitTime=15000);Laya.timer.loop(waitTime,null,CacheManager._checkLoop);}
CacheManager.stopCheck=function(){Laya.timer.clear(null,CacheManager._checkLoop);}
CacheManager._checkLoop=function(){var cacheList=CacheManager._cacheList;if(cacheList.length<1)return;var tTime=Browser.now();var count=0;var len=0;len=count=cacheList.length;while(count>0){CacheManager._index++;CacheManager._index=CacheManager._index%len;cacheList[CacheManager._index].tryDispose(false);if(Browser.now()-tTime>CacheManager.loopTimeLimit)break;count--;}}
CacheManager.loopTimeLimit=2;CacheManager._cacheList=[];CacheManager._index=0;return CacheManager;})()
var ClassUtils=(function(){function ClassUtils(){}
__class(ClassUtils,'laya.utils.ClassUtils');ClassUtils.regClass=function(className,classDef){ClassUtils._classMap[className]=classDef;}
ClassUtils.getRegClass=function(className){return ClassUtils._classMap[className];}
ClassUtils.getInstance=function(className){var compClass=ClassUtils.getClass(className);if(compClass)
return new compClass();else
console.warn("[error] Undefined class:",className);return null;}
ClassUtils.createByJson=function(json,node,root,customHandler,instanceHandler){if((typeof json=='string'))
json=JSON.parse(json);var props=json.props;if(!node){node=instanceHandler?instanceHandler.runWith(json):ClassUtils.getInstance(props.runtime||json.type);if(!node)
return null;};var child=json.child;if(child){for(var i=0,n=child.length;i<n;i++){var data=child[i];if((data.props.name==="render"||data.props.renderType==="render")&&node["_$set_itemRender"])
node.itemRender=data;else{if(data.type=="Graphic"){ClassUtils.addGraphicsToSprite(data,node);}else if(ClassUtils.isDrawType(data.type)){ClassUtils.addGraphicToSprite(data,node,true);}else{var tChild=ClassUtils.createByJson(data,null,root,customHandler,instanceHandler)
if(data.type=="Script"){if(tChild.hasOwnProperty("owner")){tChild["owner"]=node;}else if(tChild.hasOwnProperty("target")){tChild["target"]=node;}}else if(data.props.renderType=="mask"){node.mask=tChild;}else{node.addChild(tChild);}}}}}
if(props){for(var prop in props){var value=props[prop];if(prop==="var"&&root){root[value]=node;}else if((value instanceof Array)&&(typeof(node[prop])=='function')){node[prop].apply(node,value);}else{node[prop]=value;}}}
if(customHandler&&json.customProps){customHandler.runWith([node,json]);}
if(node["created"])
node.created();return node;}
ClassUtils.addGraphicsToSprite=function(graphicO,sprite){var graphics;graphics=graphicO.child;if(!graphics||graphics.length<1)
return;var g;g=ClassUtils._getGraphicsFromSprite(graphicO,sprite);var ox=0;var oy=0;if(graphicO.props){ox=ClassUtils._getObjVar(graphicO.props,"x",0);oy=ClassUtils._getObjVar(graphicO.props,"y",0);}
if(ox!=0&&oy!=0){g.translate(ox,oy);};var i=0,len=0;len=graphics.length;for(i=0;i<len;i++){ClassUtils._addGraphicToGraphics(graphics[i],g);}
if(ox!=0&&oy!=0){g.translate(-ox,-oy);}}
ClassUtils.addGraphicToSprite=function(graphicO,sprite,isChild){(isChild===void 0)&&(isChild=false);var g;g=isChild?ClassUtils._getGraphicsFromSprite(graphicO,sprite):sprite.graphics;ClassUtils._addGraphicToGraphics(graphicO,g);}
ClassUtils._getGraphicsFromSprite=function(dataO,sprite){var g;if(!dataO||!dataO.props)
return sprite.graphics;var propsName;propsName=dataO.props.renderType;switch(propsName){case"hit":case"unHit":;var hitArea;if(!sprite.hitArea){sprite.hitArea=new HitArea();}
hitArea=sprite.hitArea;if(!hitArea[propsName]){hitArea[propsName]=new Graphics();}
g=hitArea[propsName];break;default:}
if(!g)
g=sprite.graphics;return g;}
ClassUtils._getTransformData=function(propsO){var m;if(propsO.hasOwnProperty("pivotX")||propsO.hasOwnProperty("pivotY")){m=m||new Matrix();m.translate(-ClassUtils._getObjVar(propsO,"pivotX",0),-ClassUtils._getObjVar(propsO,"pivotY",0));};var sx=ClassUtils._getObjVar(propsO,"scaleX",1),sy=ClassUtils._getObjVar(propsO,"scaleY",1);var rotate=ClassUtils._getObjVar(propsO,"rotation",0);var skewX=ClassUtils._getObjVar(propsO,"skewX",0);var skewY=ClassUtils._getObjVar(propsO,"skewY",0);if(sx!=1||sy!=1||rotate!=0){m=m||new Matrix();m.scale(sx,sy);m.rotate(rotate*0.0174532922222222);}
return m;}
ClassUtils._addGraphicToGraphics=function(graphicO,graphic){var propsO;propsO=graphicO.props;if(!propsO)
return;var drawConfig;drawConfig=ClassUtils.DrawTypeDic[graphicO.type];if(!drawConfig)
return;var g;g=graphic;var m;var params=ClassUtils._getParams(propsO,drawConfig[1],drawConfig[2],drawConfig[3]);m=ClassUtils._tM;if(m||ClassUtils._alpha!=1){g.save();if(m)
g.transform(m);if(ClassUtils._alpha!=1)
g.alpha(ClassUtils._alpha);}
g[drawConfig[0]].apply(g,params);if(m||ClassUtils._alpha!=1){g.restore();}}
ClassUtils._adptLineData=function(params){params[2]=parseFloat(params[0])+parseFloat(params[2]);params[3]=parseFloat(params[1])+parseFloat(params[3]);return params;}
ClassUtils._adptTextureData=function(params){params[0]=Loader.getRes(params[0]);return params;}
ClassUtils._adptLinesData=function(params){params[2]=ClassUtils._getPointListByStr(params[2]);return params;}
ClassUtils.isDrawType=function(type){if(type=="Image")
return false;return ClassUtils.DrawTypeDic.hasOwnProperty(type);}
ClassUtils._getParams=function(obj,params,xPos,adptFun){(xPos===void 0)&&(xPos=0);var rst;rst=ClassUtils._temParam;rst.length=params.length;var i=0,len=0;len=params.length;for(i=0;i<len;i++){rst[i]=ClassUtils._getObjVar(obj,params[i][0],params[i][1]);}
ClassUtils._alpha=ClassUtils._getObjVar(obj,"alpha",1);var m;m=ClassUtils._getTransformData(obj);if(m){if(!xPos)xPos=0;m.translate(rst[xPos],rst[xPos+1]);rst[xPos]=rst[xPos+1]=0;ClassUtils._tM=m;}else{ClassUtils._tM=null;}
if(adptFun&&ClassUtils[adptFun]){rst=ClassUtils[adptFun](rst);}
return rst;}
ClassUtils._getPointListByStr=function(str){var pointArr;pointArr=str.split(",");var i=0,len=0;len=pointArr.length;for(i=0;i<len;i++){pointArr[i]=parseFloat(pointArr[i]);}
return pointArr;}
ClassUtils._getObjVar=function(obj,key,noValue){if(obj.hasOwnProperty(key)){return obj[key];}
return noValue;}
ClassUtils._temParam=[];ClassUtils._classMap={'Sprite':'laya.display.Sprite','Text':'laya.display.Text','Animation':'laya.display.Animation','Skeleton':'laya.ani.bone.Skeleton','Particle2D':'laya.particle.Particle2D','div':'laya.html.dom.HTMLDivElement','p':'laya.html.dom.HTMLElement','img':'laya.html.dom.HTMLImageElement','span':'laya.html.dom.HTMLElement','br':'laya.html.dom.HTMLBrElement','style':'laya.html.dom.HTMLStyleElement','font':'laya.html.dom.HTMLElement','a':'laya.html.dom.HTMLElement','#text':'laya.html.dom.HTMLElement'};ClassUtils.getClass=function(className){var classObject=ClassUtils._classMap[className]||className;if((typeof classObject=='string'))
return Laya["__classmap"][classObject];return classObject;}
ClassUtils._tM=null;ClassUtils._alpha=NaN;__static(ClassUtils,['DrawTypeDic',function(){return this.DrawTypeDic={"Rect":["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],"Circle":["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],"Pie":["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],"Image":["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],"Texture":["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],"FillTexture":["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],"FillText":["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],"Line":["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],"Lines":["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],"Curves":["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],"Poly":["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]};}]);return ClassUtils;})()
var Color=(function(){function Color(str){this._color=[];if((typeof str=='string')){this.strColor=str;if(str===null)str="#000000";str.charAt(0)=='#'&&(str=str.substr(1));var len=str.length;if(len==3||len==4){var temp="";for(var i=0;i<len;i++){temp+=(str[i]+str[i]);}
str=temp;};var color=this.numColor=parseInt(str,16);var flag=(str.length==8);if(flag){this._color=[parseInt(str.substr(0,2),16)/255,((0x00FF0000&color)>>16)/255,((0x0000FF00&color)>>8)/255,(0x000000FF&color)/255];return;}}else{color=this.numColor=str;this.strColor=Utils.toHexColor(color);}
this._color=[((0xFF0000&color)>>16)/255,((0xFF00&color)>>8)/255,(0xFF&color)/255,1];(this._color).__id=++Color._COLODID;}
__class(Color,'laya.utils.Color');Color._initDefault=function(){Color._DEFAULT={};for(var i in Color._COLOR_MAP)Color._SAVE[i]=Color._DEFAULT[i]=new Color(Color._COLOR_MAP[i]);return Color._DEFAULT;}
Color._initSaveMap=function(){Color._SAVE_SIZE=0;Color._SAVE={};for(var i in Color._DEFAULT)Color._SAVE[i]=Color._DEFAULT[i];}
Color.create=function(str){var color=Color._SAVE[str+""];if(color!=null)return color;(Color._SAVE_SIZE<1000)||Color._initSaveMap();return Color._SAVE[str+""]=new Color(str);}
Color._SAVE={};Color._SAVE_SIZE=0;Color._COLOR_MAP={"white":'#FFFFFF',"red":'#FF0000',"green":'#00FF00',"blue":'#0000FF',"black":'#000000',"yellow":'#FFFF00','gray':'#AAAAAA'};Color._DEFAULT=Color._initDefault();Color._COLODID=1;return Color;})()
var Dictionary=(function(){function Dictionary(){this._values=[];this._keys=[];}
__class(Dictionary,'laya.utils.Dictionary');var __proto=Dictionary.prototype;__proto.set=function(key,value){var index=this.indexOf(key);if(index>=0){this._values[index]=value;return;}
this._keys.push(key);this._values.push(value);}
__proto.indexOf=function(key){var index=this._keys.indexOf(key);if(index>=0)return index;key=((typeof key=='string'))?Number(key):(((typeof key=='number'))?key.toString():key);return this._keys.indexOf(key);}
__proto.get=function(key){var index=this.indexOf(key);return index<0?null:this._values[index];}
__proto.remove=function(key){var index=this.indexOf(key);if(index>=0){this._keys.splice(index,1);this._values.splice(index,1);return true;}
return false;}
__proto.clear=function(){this._values.length=0;this._keys.length=0;}
__getset(0,__proto,'values',function(){return this._values;});__getset(0,__proto,'keys',function(){return this._keys;});return Dictionary;})()
var Dragging=(function(){function Dragging(){this.ratio=0.92;this.maxOffset=60;this._dragging=false;this._clickOnly=true;}
__class(Dragging,'laya.utils.Dragging');var __proto=Dragging.prototype;__proto.start=function(target,area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio){(ratio===void 0)&&(ratio=0.92);this.clearTimer();this.target=target;this.area=area;this.hasInertia=hasInertia;this.elasticDistance=area?elasticDistance:0;this.elasticBackTime=elasticBackTime;this.data=data;this._disableMouseEvent=disableMouseEvent;this.ratio=ratio;if(target.globalScaleX!=1||target.globalScaleY!=1){this._parent=target.parent;}else{this._parent=Laya.stage;}
this._clickOnly=true;this._dragging=true;this._elasticRateX=this._elasticRateY=1;this._lastX=this._parent.mouseX;this._lastY=this._parent.mouseY;Laya.stage.on("mouseup",this,this.onStageMouseUp);Laya.stage.on("mouseout",this,this.onStageMouseUp);Laya.timer.frameLoop(1,this,this.loop);}
__proto.clearTimer=function(){Laya.timer.clear(this,this.loop);Laya.timer.clear(this,this.tweenMove);if(this._tween){this._tween.recover();this._tween=null;}}
__proto.stop=function(){if(this._dragging){MouseManager.instance.disableMouseEvent=false;Laya.stage.off("mouseup",this,this.onStageMouseUp);Laya.stage.off("mouseout",this,this.onStageMouseUp);this._dragging=false;this.target&&this.area&&this.backToArea();this.clear();}}
__proto.loop=function(){var point=this._parent.getMousePoint();var mouseX=point.x;var mouseY=point.y;var offsetX=mouseX-this._lastX;var offsetY=mouseY-this._lastY;if(this._clickOnly){if(Math.abs(offsetX*Laya.stage._canvasTransform.getScaleX())>1||Math.abs(offsetY*Laya.stage._canvasTransform.getScaleY())>1){this._clickOnly=false;this._offsets||(this._offsets=[]);this._offsets.length=0;this.target.event("dragstart",this.data);MouseManager.instance.disableMouseEvent=this._disableMouseEvent;this.target._set$P("$_MOUSEDOWN",false);}else return;}else{this._offsets.push(offsetX,offsetY);}
if(offsetX===0&&offsetY===0)return;this._lastX=mouseX;this._lastY=mouseY;this.target.x+=offsetX*this._elasticRateX;this.target.y+=offsetY*this._elasticRateY;this.area&&this.checkArea();this.target.event("dragmove",this.data);}
__proto.checkArea=function(){if(this.elasticDistance<=0){this.backToArea();}else{if(this.target.x<this.area.x){var offsetX=this.area.x-this.target.x;}else if(this.target.x>this.area.x+this.area.width){offsetX=this.target.x-this.area.x-this.area.width;}else{offsetX=0;}
this._elasticRateX=Math.max(0,1-(offsetX/this.elasticDistance));if(this.target.y<this.area.y){var offsetY=this.area.y-this.target.y;}else if(this.target.y>this.area.y+this.area.height){offsetY=this.target.y-this.area.y-this.area.height;}else{offsetY=0;}
this._elasticRateY=Math.max(0,1-(offsetY/this.elasticDistance));}}
__proto.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width);this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height);}
__proto.onStageMouseUp=function(e){MouseManager.instance.disableMouseEvent=false;Laya.stage.off("mouseup",this,this.onStageMouseUp);Laya.stage.off("mouseout",this,this.onStageMouseUp);Laya.timer.clear(this,this.loop);if(this._clickOnly||!this.target)return;if(this.hasInertia){if(this._offsets.length<1){this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY);}
this._offsetX=this._offsetY=0;var len=this._offsets.length;var n=Math.min(len,6);var m=this._offsets.length-n;for(var i=len-1;i>m;i--){this._offsetY+=this._offsets[i--];this._offsetX+=this._offsets[i];}
this._offsetX=this._offsetX/n*2;this._offsetY=this._offsetY/n*2;if(Math.abs(this._offsetX)>this.maxOffset)this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset;if(Math.abs(this._offsetY)>this.maxOffset)this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset;Laya.timer.frameLoop(1,this,this.tweenMove);}else if(this.elasticDistance>0){this.checkElastic();}else{this.clear();}}
__proto.checkElastic=function(){var tx=NaN;var ty=NaN;if(this.target.x<this.area.x)tx=this.area.x;else if(this.target.x>this.area.x+this.area.width)tx=this.area.x+this.area.width;if(this.target.y<this.area.y)ty=this.area.y;else if(this.target.y>this.area.y+this.area.height)ty=this.area.y+this.area.height;if(!isNaN(tx)||!isNaN(ty)){var obj={};if(!isNaN(tx))obj.x=tx;if(!isNaN(ty))obj.y=ty;this._tween=Tween.to(this.target,obj,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,false,false);}else{this.clear();}}
__proto.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX;this._offsetY*=this.ratio*this._elasticRateY;this.target.x+=this._offsetX;this.target.y+=this._offsetY;this.area&&this.checkArea();this.target.event("dragmove",this.data);if((Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1)||this._elasticRateX<0.5||this._elasticRateY<0.5){Laya.timer.clear(this,this.tweenMove);if(this.elasticDistance>0)this.checkElastic();else this.clear();}}
__proto.clear=function(){if(this.target){this.clearTimer();var sp=this.target;this.target=null;this._parent=null;sp.event("dragend",this.data);}}
return Dragging;})()
var Ease=(function(){function Ease(){}
__class(Ease,'laya.utils.Ease');Ease.linearNone=function(t,b,c,d){return c*t/d+b;}
Ease.linearIn=function(t,b,c,d){return c*t/d+b;}
Ease.linearInOut=function(t,b,c,d){return c*t/d+b;}
Ease.linearOut=function(t,b,c,d){return c*t/d+b;}
Ease.bounceIn=function(t,b,c,d){return c-Ease.bounceOut(d-t,0,c,d)+b;}
Ease.bounceInOut=function(t,b,c,d){if(t<d*0.5)return Ease.bounceIn(t*2,0,c,d)*.5+b;else return Ease.bounceOut(t*2-d,0,c,d)*.5+c*.5+b;}
Ease.bounceOut=function(t,b,c,d){if((t/=d)<(1/2.75))return c*(7.5625*t*t)+b;else if(t<(2/2.75))return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;else if(t<(2.5/2.75))return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;else return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}
Ease.backIn=function(t,b,c,d,s){(s===void 0)&&(s=1.70158);return c*(t/=d)*t*((s+1)*t-s)+b;}
Ease.backInOut=function(t,b,c,d,s){(s===void 0)&&(s=1.70158);if((t/=d*0.5)<1)return c*0.5*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;}
Ease.backOut=function(t,b,c,d,s){(s===void 0)&&(s=1.70158);return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;}
Ease.elasticIn=function(t,b,c,d,a,p){(a===void 0)&&(a=0);(p===void 0)&&(p=0);var s;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(!a||(c>0&&a<c)||(c<0&&a<-c)){a=c;s=p/4;}else s=p/Ease.PI2*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*Ease.PI2/p))+b;}
Ease.elasticInOut=function(t,b,c,d,a,p){(a===void 0)&&(a=0);(p===void 0)&&(p=0);var s;if(t==0)return b;if((t/=d*0.5)==2)return b+c;if(!p)p=d*(.3*1.5);if(!a||(c>0&&a<c)||(c<0&&a<-c)){a=c;s=p/4;}else s=p/Ease.PI2*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*Ease.PI2/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*Ease.PI2/p)*.5+c+b;}
Ease.elasticOut=function(t,b,c,d,a,p){(a===void 0)&&(a=0);(p===void 0)&&(p=0);var s;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(!a||(c>0&&a<c)||(c<0&&a<-c)){a=c;s=p/4;}else s=p/Ease.PI2*Math.asin(c/a);return(a*Math.pow(2,-10*t)*Math.sin((t*d-s)*Ease.PI2/p)+c+b);}
Ease.strongIn=function(t,b,c,d){return c*(t/=d)*t*t*t*t+b;}
Ease.strongInOut=function(t,b,c,d){if((t/=d*0.5)<1)return c*0.5*t*t*t*t*t+b;return c*0.5*((t-=2)*t*t*t*t+2)+b;}
Ease.strongOut=function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;}
Ease.sineInOut=function(t,b,c,d){return-c*0.5*(Math.cos(Math.PI*t/d)-1)+b;}
Ease.sineIn=function(t,b,c,d){return-c*Math.cos(t/d*Ease.HALF_PI)+c+b;}
Ease.sineOut=function(t,b,c,d){return c*Math.sin(t/d*Ease.HALF_PI)+b;}
Ease.quintIn=function(t,b,c,d){return c*(t/=d)*t*t*t*t+b;}
Ease.quintInOut=function(t,b,c,d){if((t/=d*0.5)<1)return c*0.5*t*t*t*t*t+b;return c*0.5*((t-=2)*t*t*t*t+2)+b;}
Ease.quintOut=function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;}
Ease.quartIn=function(t,b,c,d){return c*(t/=d)*t*t*t+b;}
Ease.quartInOut=function(t,b,c,d){if((t/=d*0.5)<1)return c*0.5*t*t*t*t+b;return-c*0.5*((t-=2)*t*t*t-2)+b;}
Ease.quartOut=function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;}
Ease.cubicIn=function(t,b,c,d){return c*(t/=d)*t*t+b;}
Ease.cubicInOut=function(t,b,c,d){if((t/=d*0.5)<1)return c*0.5*t*t*t+b;return c*0.5*((t-=2)*t*t+2)+b;}
Ease.cubicOut=function(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;}
Ease.quadIn=function(t,b,c,d){return c*(t/=d)*t+b;}
Ease.quadInOut=function(t,b,c,d){if((t/=d*0.5)<1)return c*0.5*t*t+b;return-c*0.5*((--t)*(t-2)-1)+b;}
Ease.quadOut=function(t,b,c,d){return-c*(t/=d)*(t-2)+b;}
Ease.expoIn=function(t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b-c*0.001;}
Ease.expoInOut=function(t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d*0.5)<1)return c*0.5*Math.pow(2,10*(t-1))+b;return c*0.5*(-Math.pow(2,-10*--t)+2)+b;}
Ease.expoOut=function(t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;}
Ease.circIn=function(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;}
Ease.circInOut=function(t,b,c,d){if((t/=d*0.5)<1)return-c*0.5*(Math.sqrt(1-t*t)-1)+b;return c*0.5*(Math.sqrt(1-(t-=2)*t)+1)+b;}
Ease.circOut=function(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;}
Ease.HALF_PI=Math.PI*0.5;Ease.PI2=Math.PI*2;return Ease;})()
var HitArea=(function(){function HitArea(){this._hit=null;this._unHit=null;}
__class(HitArea,'laya.utils.HitArea');var __proto=HitArea.prototype;__proto.isHit=function(x,y){if(!HitArea.isHitGraphic(x,y,this.hit))return false;return!HitArea.isHitGraphic(x,y,this.unHit);}
__proto.contains=function(x,y){return this.isHit(x,y);}
__getset(0,__proto,'hit',function(){if(!this._hit)this._hit=new Graphics();return this._hit;},function(value){this._hit=value;});__getset(0,__proto,'unHit',function(){if(!this._unHit)this._unHit=new Graphics();return this._unHit;},function(value){this._unHit=value;});HitArea.isHitGraphic=function(x,y,graphic){if(!graphic)return false;var cmds;cmds=graphic.cmds;if(!cmds&&graphic._one){cmds=HitArea._cmds;cmds.length=1;cmds[0]=graphic._one;}
if(!cmds)return false;var i=0,len=0;len=cmds.length;var cmd;for(i=0;i<len;i++){cmd=cmds[i];if(!cmd)continue;var context=Render._context;switch(cmd.callee){case context._translate:case 6:x-=cmd[0];y-=cmd[1];default:}
if(HitArea.isHitCmd(x,y,cmd))return true;}
return false;}
HitArea.isHitCmd=function(x,y,cmd){if(!cmd)return false;var context=Render._context;var rst=false;switch(cmd["callee"]){case context._drawRect:case 13:HitArea._rec.setTo(cmd[0],cmd[1],cmd[2],cmd[3]);rst=HitArea._rec.contains(x,y);break;case context._drawCircle:case context._fillCircle:case 14:;var d=NaN;x-=cmd[0];y-=cmd[1];d=x*x+y*y;rst=d<cmd[2]*cmd[2];break;case context._drawPoly:case 18:x-=cmd[0];y-=cmd[1];rst=HitArea.ptInPolygon(x,y,cmd[2]);break;default:break;}
return rst;}
HitArea.ptInPolygon=function(x,y,areaPoints){var p;p=HitArea._ptPoint;p.setTo(x,y);var nCross=0;var p1x=NaN,p1y=NaN,p2x=NaN,p2y=NaN;var len=0;len=areaPoints.length;for(var i=0;i<len;i+=2){p1x=areaPoints[i];p1y=areaPoints[i+1];p2x=areaPoints[(i+2)%len];p2y=areaPoints[(i+3)%len];if(p1y==p2y)
continue;if(p.y<Math.min(p1y,p2y))
continue;if(p.y>=Math.max(p1y,p2y))
continue;var tx=(p.y-p1y)*(p2x-p1x)/(p2y-p1y)+p1x;if(tx>p.x){nCross++;}}
return(nCross%2==1);}
HitArea._cmds=[];__static(HitArea,['_rec',function(){return this._rec=new Rectangle();},'_ptPoint',function(){return this._ptPoint=new Point();}]);return HitArea;})()
var HTMLChar=(function(){function HTMLChar(char,w,h,style){this.char=char;this.charNum=char.charCodeAt(0);this._x=this._y=0;this.width=w;this.height=h;this.style=style;this.isWord=!HTMLChar._isWordRegExp.test(char);}
__class(HTMLChar,'laya.utils.HTMLChar');var __proto=HTMLChar.prototype;Laya.imps(__proto,{"laya.display.ILayout":true})
__proto.setSprite=function(sprite){this._sprite=sprite;}
__proto.getSprite=function(){return this._sprite;}
__proto._isChar=function(){return true;}
__proto._getCSSStyle=function(){return this.style;}
__getset(0,__proto,'width',function(){return this._w;},function(value){this._w=value;});__getset(0,__proto,'x',function(){return this._x;},function(value){if(this._sprite){this._sprite.x=value;}
this._x=value;});__getset(0,__proto,'y',function(){return this._y;},function(value){if(this._sprite){this._sprite.y=value;}
this._y=value;});__getset(0,__proto,'height',function(){return this._h;},function(value){this._h=value;});HTMLChar._isWordRegExp=new RegExp("[\\w\.]","");return HTMLChar;})()
var Log=(function(){function Log(){}
__class(Log,'laya.utils.Log');Log.enable=function(){if(!Log._logdiv){Log._logdiv=Browser.window.document.createElement('div');Browser.window.document.body.appendChild(Log._logdiv);Log._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;";}}
Log.toggle=function(){var style=Log._logdiv.style;if(style.width=="1px"){style.width=style.height="50%";}else{style.width=style.height="1px";}}
Log.print=function(value){if(Log._logdiv){if(Log._count>=Log.maxCount)Log.clear();Log._count++;Log._logdiv.innerText+=value+"\n";Log._logdiv.scrollTop=Log._logdiv.scrollHeight;}}
Log.clear=function(){Log._logdiv.innerText="";Log._count=0;}
Log._logdiv=null;Log._count=0;Log.maxCount=20;return Log;})()
var Mouse=(function(){function Mouse(){}
__class(Mouse,'laya.utils.Mouse');__getset(1,Mouse,'cursor',function(){return Mouse._style.cursor;},function(cursorStr){Mouse._style.cursor=cursorStr;});Mouse.hide=function(){if(Mouse.cursor!="none"){Mouse._preCursor=Mouse.cursor;Mouse.cursor="none";}}
Mouse.show=function(){if(Mouse.cursor=="none"){if(Mouse._preCursor){Mouse.cursor=Mouse._preCursor;}else{Mouse.cursor="auto";}}}
Mouse._preCursor=null;__static(Mouse,['_style',function(){return this._style=Browser.document.body.style;}]);return Mouse;})()
var Pool=(function(){function Pool(){}
__class(Pool,'laya.utils.Pool');Pool.getPoolBySign=function(sign){return Pool._poolDic[sign]||(Pool._poolDic[sign]=[]);}
Pool.clearBySign=function(sign){if(Pool._poolDic[sign])Pool._poolDic[sign].length=0;}
Pool.recover=function(sign,item){if(item["__InPool"])return;item["__InPool"]=true;Pool.getPoolBySign(sign).push(item);}
Pool.getItemByClass=function(sign,cls){var pool=Pool.getPoolBySign(sign);var rst=pool.length?pool.pop():new cls();rst["__InPool"]=false;return rst;}
Pool.getItemByCreateFun=function(sign,createFun){var pool=Pool.getPoolBySign(sign);var rst=pool.length?pool.pop():createFun();rst["__InPool"]=false;return rst;}
Pool.getItem=function(sign){var pool=Pool.getPoolBySign(sign);var rst=pool.length?pool.pop():null;if(rst){rst["__InPool"]=false;}
return rst;}
Pool._poolDic={};Pool.InPoolSign="__InPool";return Pool;})()
var PoolCache=(function(){function PoolCache(){this.sign=null;this.maxCount=1000;}
__class(PoolCache,'laya.utils.PoolCache');var __proto=PoolCache.prototype;__proto.getCacheList=function(){return Pool.getPoolBySign(this.sign);}
__proto.tryDispose=function(force){var list;list=Pool.getPoolBySign(this.sign);if(list.length>this.maxCount){list.splice(this.maxCount,list.length-this.maxCount);}}
PoolCache.addPoolCacheManager=function(sign,maxCount){(maxCount===void 0)&&(maxCount=100);var cache;cache=new PoolCache();cache.sign=sign;cache.maxCount=maxCount;CacheManager.regCacheByFunction(Utils.bind(cache.tryDispose,cache),Utils.bind(cache.getCacheList,cache));}
return PoolCache;})()
var Stat=(function(){function Stat(){}
__class(Stat,'laya.utils.Stat');__getset(1,Stat,'onclick',null,function(fn){if(Stat._sp){Stat._sp.on("click",Stat._sp,fn);}
if(Stat._canvas){Stat._canvas.source.onclick=fn;Stat._canvas.source.style.pointerEvents='';}});Stat.show=function(x,y){(x===void 0)&&(x=0);(y===void 0)&&(y=0);if(Render.isConchApp){Browser.window.conch.showFPS&&Browser.window.conch.showFPS(x,y);return;}
if(!Browser.onMiniGame&&!Browser.onLimixiu)Stat._useCanvas=true;Stat._show=true;Stat._fpsData.length=60;Stat._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"};Stat._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"};Stat._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"};Stat._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"};if(Render.isWebGL){Stat._view[4]={title:"Shader",value:"shaderCall",color:"white",units:"int"};if(!Render.is3DMode){Stat._view[0].title="FPS(WebGL)";Stat._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};}else{Stat._view[0].title="FPS(3D)";Stat._view[5]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"};Stat._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"};Stat._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"};}}else{Stat._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"};}
if(Stat._useCanvas){Stat.createUIPre(x,y);}else
Stat.createUI(x,y);Stat.enable();}
Stat.createUIPre=function(x,y){var pixel=Browser.pixelRatio;Stat._width=pixel*130;Stat._vx=pixel*75;Stat._height=pixel*(Stat._view.length*12+3*pixel)+4;Stat._fontSize=12*pixel;for(var i=0;i<Stat._view.length;i++){Stat._view[i].x=4;Stat._view[i].y=i*Stat._fontSize+2*pixel;}
if(!Stat._canvas){Stat._canvas=new HTMLCanvas('2D');Stat._canvas.size(Stat._width,Stat._height);Stat._ctx=Stat._canvas.getContext('2d');Stat._ctx.textBaseline="top";Stat._ctx.font=Stat._fontSize+"px Sans-serif";Stat._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+x+"px;top:"+y+"px;width:"+(Stat._width/pixel)+"px;height:"+(Stat._height/pixel)+"px;";}
Stat._first=true;Stat.loop();Stat._first=false;Browser.container.appendChild(Stat._canvas.source);}
Stat.createUI=function(x,y){var stat=Stat._sp;var pixel=Browser.pixelRatio;if(!stat){stat=new Sprite();Stat._leftText=new Text();Stat._leftText.pos(5,5);Stat._leftText.color="#ffffff";stat.addChild(Stat._leftText);Stat._txt=new Text();Stat._txt.pos(80*pixel,5);Stat._txt.color="#ffffff";stat.addChild(Stat._txt);Stat._sp=stat;}
stat.pos(x,y);var text="";for(var i=0;i<Stat._view.length;i++){var one=Stat._view[i];text+=one.title+"\n";}
Stat._leftText.text=text;var width=pixel*138;var height=pixel*(Stat._view.length*12+3*pixel)+4;Stat._txt.fontSize=Stat._fontSize*pixel;Stat._leftText.fontSize=Stat._fontSize*pixel;stat.size(width,height);stat.graphics.clear();stat.graphics.setAlpha(0.5);stat.graphics.drawRect(0,0,width,height,"#999999");stat.graphics.setAlpha(1);Stat.loop();}
Stat.enable=function(){Laya.timer.frameLoop(1,Stat,Stat.loop);}
Stat.hide=function(){Stat._show=false;Laya.timer.clear(Stat,Stat.loop);if(Stat._canvas){Browser.removeElement(Stat._canvas.source);}}
Stat.clear=function(){Stat.trianglesFaces=Stat.drawCall=Stat.shaderCall=Stat.spriteCount=Stat.spriteRenderUseCacheCount=Stat.treeNodeCollision=Stat.treeSpriteCollision=Stat.canvasNormal=Stat.canvasBitmap=Stat.canvasReCache=0;}
Stat.loop=function(){Stat._count++;var timer=Browser.now();if(timer-Stat._timer<1000)return;var count=Stat._count;Stat.FPS=Math.round((count*1000)/(timer-Stat._timer));if(Stat._show){Stat.trianglesFaces=Math.round(Stat.trianglesFaces/count);if(!Stat._useCanvas){Stat.drawCall=Math.round(Stat.drawCall/count)-2;Stat.shaderCall=Math.round(Stat.shaderCall/count)-4;Stat.spriteCount=Math.round(Stat.spriteCount/count)-4;}else{Stat.drawCall=Math.round(Stat.drawCall/count)-2;Stat.shaderCall=Math.round(Stat.shaderCall/count);Stat.spriteCount=Math.round(Stat.spriteCount/count)-1;}
Stat.spriteRenderUseCacheCount=Math.round(Stat.spriteRenderUseCacheCount/count);Stat.canvasNormal=Math.round(Stat.canvasNormal/count);Stat.canvasBitmap=Math.round(Stat.canvasBitmap/count);Stat.canvasReCache=Math.ceil(Stat.canvasReCache/count);Stat.treeNodeCollision=Math.round(Stat.treeNodeCollision/count);Stat.treeSpriteCollision=Math.round(Stat.treeSpriteCollision/count);var delay=Stat.FPS>0?Math.floor(1000/Stat.FPS).toString():" ";Stat._fpsStr=Stat.FPS+(Stat.renderSlow?" slow":"")+" "+delay;Stat._spriteStr=Stat.spriteCount+(Stat.spriteRenderUseCacheCount?("/"+Stat.spriteRenderUseCacheCount):'');Stat._canvasStr=Stat.canvasReCache+"/"+Stat.canvasNormal+"/"+Stat.canvasBitmap;Stat.currentMemorySize=ResourceManager.systemResourceManager.memorySize;if(Stat._useCanvas){Stat.renderInfoPre();}else
Stat.renderInfo();Stat.clear();}
Stat._count=0;Stat._timer=timer;}
Stat.renderInfoPre=function(){if(Stat._canvas){var ctx=Stat._ctx;ctx.clearRect(Stat._first?0:Stat._vx,0,Stat._width,Stat._height);for(var i=0;i<Stat._view.length;i++){var one=Stat._view[i];if(Stat._first){ctx.fillStyle="white";ctx.fillText(one.title,one.x,one.y,null,null,null);}
ctx.fillStyle=one.color;var value=Stat[one.value];(one.units=="M")&&(value=Math.floor(value/(1024*1024)*100)/100+" M");ctx.fillText(value+"",one.x+Stat._vx,one.y,null,null,null);}}}
Stat.renderInfo=function(){var text="";for(var i=0;i<Stat._view.length;i++){var one=Stat._view[i];var value=Stat[one.value];(one.units=="M")&&(value=Math.floor(value/(1024*1024)*100)/100+" M");(one.units=="K")&&(value=Math.floor(value/(1024)*100)/100+" K");text+=value+"\n";}
Stat._txt.text=text;}
Stat.FPS=0;Stat.loopCount=0;Stat.shaderCall=0;Stat.drawCall=0;Stat.trianglesFaces=0;Stat.spriteCount=0;Stat.spriteRenderUseCacheCount=0;Stat.treeNodeCollision=0;Stat.treeSpriteCollision=0;Stat.canvasNormal=0;Stat.canvasBitmap=0;Stat.canvasReCache=0;Stat.renderSlow=false;Stat.currentMemorySize=0;Stat._fpsStr=null;Stat._canvasStr=null;Stat._spriteStr=null;Stat._fpsData=[];Stat._timer=0;Stat._count=0;Stat._view=[];Stat._fontSize=12;Stat._txt=null;Stat._leftText=null;Stat._sp=null;Stat._show=false;Stat._useCanvas=false;Stat._canvas=null;Stat._ctx=null;Stat._first=false;Stat._vx=NaN;Stat._width=0;Stat._height=100;return Stat;})()
var StringKey=(function(){function StringKey(){this._strsToID={};this._idToStrs=[];this._length=0;}
__class(StringKey,'laya.utils.StringKey');var __proto=StringKey.prototype;__proto.add=function(str){var index=this._strsToID[str];if(index!=null)return index;this._idToStrs[this._length]=str;return this._strsToID[str]=this._length++;}
__proto.getID=function(str){var index=this._strsToID[str];return index==null?-1:index;}
__proto.getName=function(id){var str=this._idToStrs[id];return str==null?undefined:str;}
return StringKey;})()
var Timer=(function(){var TimerHandler;function Timer(){this._delta=0;this.scale=1;this.currFrame=0;this._mid=1;this._map=[];this._laters=[];this._handlers=[];this._temp=[];this._count=0;this.currTimer=this._now();this._lastTimer=this._now();this._init();}
__class(Timer,'laya.utils.Timer');var __proto=Timer.prototype;__proto._init=function(){Laya.timer&&Laya.timer.frameLoop(1,this,this._update);}
__proto._now=function(){return Date.now();}
__proto._update=function(){if(this.scale<=0){this._lastTimer=this._now();return;};var frame=this.currFrame=this.currFrame+this.scale;var now=this._now();this._delta=(now-this._lastTimer)*this.scale;var timer=this.currTimer=this.currTimer+this._delta;this._lastTimer=now;var handlers=this._handlers;this._count=0;for(i=0,n=handlers.length;i<n;i++){handler=handlers[i];if(handler.method!==null){var t=handler.userFrame?frame:timer;if(t>=handler.exeTime){if(handler.repeat){if(!handler.jumpFrame){handler.exeTime+=handler.delay;handler.run(false);if(t>handler.exeTime){handler.exeTime+=Math.ceil((t-handler.exeTime)/handler.delay)*handler.delay;}}else{while(t>=handler.exeTime){handler.exeTime+=handler.delay;handler.run(false);}}}else{handler.run(true);}}}else{this._count++;}}
if(this._count>30||frame%200===0)this._clearHandlers();var laters=this._laters;for(var i=0,n=laters.length-1;i<=n;i++){var handler=laters[i];if(handler.method!==null){this._map[handler.key]=null;handler.run(false);}
this._recoverHandler(handler);i===n&&(n=laters.length-1);}
laters.length=0;}
__proto._clearHandlers=function(){var handlers=this._handlers;for(var i=0,n=handlers.length;i<n;i++){var handler=handlers[i];if(handler.method!==null)this._temp.push(handler);else this._recoverHandler(handler);}
this._handlers=this._temp;this._temp=handlers;this._temp.length=0;}
__proto._recoverHandler=function(handler){if(this._map[handler.key]==handler)this._map[handler.key]=null;handler.clear();Timer._pool.push(handler);}
__proto._create=function(useFrame,repeat,delay,caller,method,args,coverBefore){if(!delay){method.apply(caller,args);return null;}
if(coverBefore){var handler=this._getHandler(caller,method);if(handler){handler.repeat=repeat;handler.userFrame=useFrame;handler.delay=delay;handler.caller=caller;handler.method=method;handler.args=args;handler.exeTime=delay+(useFrame?this.currFrame:this.currTimer+this._now()-this._lastTimer);return handler;}}
handler=Timer._pool.length>0?Timer._pool.pop():new TimerHandler();handler.repeat=repeat;handler.userFrame=useFrame;handler.delay=delay;handler.caller=caller;handler.method=method;handler.args=args;handler.exeTime=delay+(useFrame?this.currFrame:this.currTimer+this._now()-this._lastTimer)+1;this._indexHandler(handler);this._handlers.push(handler);return handler;}
__proto._indexHandler=function(handler){var caller=handler.caller;var method=handler.method;var cid=caller?caller.$_GID||(caller.$_GID=Utils.getGID()):0;var mid=method.$_TID||(method.$_TID=(this._mid++)*100000);handler.key=cid+mid;this._map[handler.key]=handler;}
__proto.once=function(delay,caller,method,args,coverBefore){(coverBefore===void 0)&&(coverBefore=true);this._create(false,false,delay,caller,method,args,coverBefore);}
__proto.loop=function(delay,caller,method,args,coverBefore,jumpFrame){(coverBefore===void 0)&&(coverBefore=true);(jumpFrame===void 0)&&(jumpFrame=false);var handler=this._create(false,true,delay,caller,method,args,coverBefore);if(handler)handler.jumpFrame=jumpFrame;}
__proto.frameOnce=function(delay,caller,method,args,coverBefore){(coverBefore===void 0)&&(coverBefore=true);this._create(true,false,delay,caller,method,args,coverBefore);}
__proto.frameLoop=function(delay,caller,method,args,coverBefore){(coverBefore===void 0)&&(coverBefore=true);this._create(true,true,delay,caller,method,args,coverBefore);}
__proto.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+Timer._pool.length;}
__proto.clear=function(caller,method){var handler=this._getHandler(caller,method);if(handler){this._map[handler.key]=null;handler.key=0;handler.clear();}}
__proto.clearAll=function(caller){if(!caller)return;for(var i=0,n=this._handlers.length;i<n;i++){var handler=this._handlers[i];if(handler.caller===caller){this._map[handler.key]=null;handler.key=0;handler.clear();}}}
__proto._getHandler=function(caller,method){var cid=caller?caller.$_GID||(caller.$_GID=Utils.getGID()):0;var mid=method.$_TID||(method.$_TID=(this._mid++)*100000);return this._map[cid+mid];}
__proto.callLater=function(caller,method,args){if(this._getHandler(caller,method)==null){if(Timer._pool.length)
var handler=Timer._pool.pop();else handler=new TimerHandler();handler.caller=caller;handler.method=method;handler.args=args;this._indexHandler(handler);this._laters.push(handler);}}
__proto.runCallLater=function(caller,method){var handler=this._getHandler(caller,method);if(handler&&handler.method!=null){this._map[handler.key]=null;handler.run(true);}}
__proto.runTimer=function(caller,method){this.runCallLater(caller,method);}
__getset(0,__proto,'delta',function(){return this._delta;});Timer._pool=[];Timer.__init$=function(){TimerHandler=(function(){function TimerHandler(){this.key=0;this.repeat=false;this.delay=0;this.userFrame=false;this.exeTime=0;this.caller=null;this.method=null;this.args=null;this.jumpFrame=false;}
__class(TimerHandler,'');var __proto=TimerHandler.prototype;__proto.clear=function(){this.caller=null;this.method=null;this.args=null;}
__proto.run=function(withClear){var caller=this.caller;if(caller&&caller.destroyed)return this.clear();var method=this.method;var args=this.args;withClear&&this.clear();if(method==null)return;args?method.apply(caller,args):method.call(caller);}
return TimerHandler;})()}
return Timer;})()
var Tween=(function(){function Tween(){this.gid=0;}
__class(Tween,'laya.utils.Tween');var __proto=Tween.prototype;__proto.to=function(target,props,duration,ease,complete,delay,coverBefore){(delay===void 0)&&(delay=0);(coverBefore===void 0)&&(coverBefore=false);return this._create(target,props,duration,ease,complete,delay,coverBefore,true,false,true);}
__proto.from=function(target,props,duration,ease,complete,delay,coverBefore){(delay===void 0)&&(delay=0);(coverBefore===void 0)&&(coverBefore=false);return this._create(target,props,duration,ease,complete,delay,coverBefore,false,false,true);}
__proto._create=function(target,props,duration,ease,complete,delay,coverBefore,isTo,usePool,runNow){if(!target)throw new Error("Tween:target is null");this._target=target;this._duration=duration;this._ease=ease||props.ease||Tween.easeNone;this._complete=complete||props.complete;this._delay=delay;this._props=[];this._usedTimer=0;this._startTimer=Browser.now();this._usedPool=usePool;this._delayParam=null;this.update=props.update;var gid=(target.$_GID||(target.$_GID=Utils.getGID()));if(!Tween.tweenMap[gid]){Tween.tweenMap[gid]=[this];}else{if(coverBefore)Tween.clearTween(target);Tween.tweenMap[gid].push(this);}
if(runNow){if(delay<=0)this.firstStart(target,props,isTo);else{this._delayParam=[target,props,isTo];Laya.scaleTimer.once(delay,this,this.firstStart,this._delayParam);}}else{this._initProps(target,props,isTo);}
return this;}
__proto.firstStart=function(target,props,isTo){this._delayParam=null;if(target.destroyed){this.clear();return;}
this._initProps(target,props,isTo);this._beginLoop();}
__proto._initProps=function(target,props,isTo){for(var p in props){if((typeof(target[p])=='number')){var start=isTo?target[p]:props[p];var end=isTo?props[p]:target[p];this._props.push([p,start,end-start]);if(!isTo)target[p]=start;}}}
__proto._beginLoop=function(){Laya.scaleTimer.frameLoop(1,this,this._doEase);}
__proto._doEase=function(){this._updateEase(Browser.now());}
__proto._updateEase=function(time){var target=this._target;if(!target)return;if(target.destroyed)return Tween.clearTween(target);var usedTimer=this._usedTimer=time-this._startTimer-this._delay;if(usedTimer<0)return;if(usedTimer>=this._duration)return this.complete();var ratio=usedTimer>0?this._ease(usedTimer,0,1,this._duration):0;var props=this._props;for(var i=0,n=props.length;i<n;i++){var prop=props[i];target[prop[0]]=prop[1]+(ratio*prop[2]);}
if(this.update)this.update.run();}
__proto.complete=function(){if(!this._target)return;Laya.scaleTimer.runTimer(this,this.firstStart);var target=this._target;var props=this._props;var handler=this._complete;for(var i=0,n=props.length;i<n;i++){var prop=props[i];target[prop[0]]=prop[1]+prop[2];}
if(this.update)this.update.run();this.clear();handler&&handler.run();}
__proto.pause=function(){Laya.scaleTimer.clear(this,this._beginLoop);Laya.scaleTimer.clear(this,this._doEase);Laya.scaleTimer.clear(this,this.firstStart);var time=Browser.now();var dTime=NaN;dTime=time-this._startTimer-this._delay;if(dTime<0){this._usedTimer=dTime;}}
__proto.setStartTime=function(startTime){this._startTimer=startTime;}
__proto.clear=function(){if(this._target){this._remove();this._clear();}}
__proto._clear=function(){this.pause();Laya.scaleTimer.clear(this,this.firstStart);this._complete=null;this._target=null;this._ease=null;this._props=null;this._delayParam=null;if(this._usedPool){this.update=null;Pool.recover("tween",this);}}
__proto.recover=function(){this._usedPool=true;this._clear();}
__proto._remove=function(){var tweens=Tween.tweenMap[this._target.$_GID];if(tweens){for(var i=0,n=tweens.length;i<n;i++){if(tweens[i]===this){tweens.splice(i,1);break;}}}}
__proto.restart=function(){this.pause();this._usedTimer=0;this._startTimer=Browser.now();if(this._delayParam){Laya.scaleTimer.once(this._delay,this,this.firstStart,this._delayParam);return;};var props=this._props;for(var i=0,n=props.length;i<n;i++){var prop=props[i];this._target[prop[0]]=prop[1];}
Laya.scaleTimer.once(this._delay,this,this._beginLoop);}
__proto.resume=function(){if(this._usedTimer>=this._duration)return;this._startTimer=Browser.now()-this._usedTimer-this._delay;if(this._delayParam){if(this._usedTimer<0){Laya.scaleTimer.once(-this._usedTimer,this,this.firstStart,this._delayParam);}else{this.firstStart.apply(this,this._delayParam);}}else{this._beginLoop();}}
__getset(0,__proto,'progress',null,function(v){var uTime=v*this._duration;this._startTimer=Browser.now()-this._delay-uTime;});Tween.to=function(target,props,duration,ease,complete,delay,coverBefore,autoRecover){(delay===void 0)&&(delay=0);(coverBefore===void 0)&&(coverBefore=false);(autoRecover===void 0)&&(autoRecover=true);return Pool.getItemByClass("tween",Tween)._create(target,props,duration,ease,complete,delay,coverBefore,true,autoRecover,true);}
Tween.from=function(target,props,duration,ease,complete,delay,coverBefore,autoRecover){(delay===void 0)&&(delay=0);(coverBefore===void 0)&&(coverBefore=false);(autoRecover===void 0)&&(autoRecover=true);return Pool.getItemByClass("tween",Tween)._create(target,props,duration,ease,complete,delay,coverBefore,false,autoRecover,true);}
Tween.clearAll=function(target){if(!target||!target.$_GID)return;var tweens=Tween.tweenMap[target.$_GID];if(tweens){for(var i=0,n=tweens.length;i<n;i++){tweens[i]._clear();}
tweens.length=0;}}
Tween.clear=function(tween){tween.clear();}
Tween.clearTween=function(target){Tween.clearAll(target);}
Tween.easeNone=function(t,b,c,d){return c*t/d+b;}
Tween.tweenMap={};return Tween;})()
var Utils=(function(){function Utils(){}
__class(Utils,'laya.utils.Utils');Utils.toRadian=function(angle){return angle*Utils._pi2;}
Utils.toAngle=function(radian){return radian*Utils._pi;}
Utils.toHexColor=function(color){if(color<0||isNaN(color))return null;var str=color.toString(16);while(str.length<6)str="0"+str;return"#"+str;}
Utils.getGID=function(){return Utils._gid++;}
Utils.concatArray=function(source,array){if(!array)return source;if(!source)return array;var i=0,len=array.length;for(i=0;i<len;i++){source.push(array[i]);}
return source;}
Utils.clearArray=function(array){if(!array)return array;array.length=0;return array;}
Utils.copyArray=function(source,array){source||(source=[]);if(!array)return source;source.length=array.length;var i=0,len=array.length;for(i=0;i<len;i++){source[i]=array[i];}
return source;}
Utils.getGlobalRecByPoints=function(sprite,x0,y0,x1,y1){var newLTPoint;newLTPoint=new Point(x0,y0);newLTPoint=sprite.localToGlobal(newLTPoint);var newRBPoint;newRBPoint=new Point(x1,y1);newRBPoint=sprite.localToGlobal(newRBPoint);return Rectangle._getWrapRec([newLTPoint.x,newLTPoint.y,newRBPoint.x,newRBPoint.y]);}
Utils.getGlobalPosAndScale=function(sprite){return Utils.getGlobalRecByPoints(sprite,0,0,1,1);}
Utils.bind=function(fun,scope){var rst=fun;rst=fun.bind(scope);;return rst;}
Utils.measureText=function(txt,font){return RunDriver.measureText(txt,font);}
Utils.updateOrder=function(array){if(!array||array.length<2)return false;var i=1,j=0,len=array.length,key=NaN,c;while(i<len){j=i;c=array[j];key=array[j]._zOrder;while(--j>-1){if(array[j]._zOrder>key)array[j+1]=array[j];else break;}
array[j+1]=c;i++;};var model=c.parent.conchModel;if(model){if(model.updateZOrder!=null){model.updateZOrder();}else{for(i=0;i<len;i++){model.removeChild(array[i].conchModel);}
for(i=0;i<len;i++){model.addChildAt(array[i].conchModel,i);}}}
return true;}
Utils.transPointList=function(points,x,y){var i=0,len=points.length;for(i=0;i<len;i+=2){points[i]+=x;points[i+1]+=y;}}
Utils.parseInt=function(str,radix){(radix===void 0)&&(radix=0);var result=Browser.window.parseInt(str,radix);if(isNaN(result))return 0;return result;}
Utils.getFileExtension=function(path){Utils._extReg.lastIndex=path.lastIndexOf(".");var result=Utils._extReg.exec(path);if(result&&result.length>1){return result[1].toLowerCase();}
return null;}
Utils.getTransformRelativeToWindow=function(coordinateSpace,x,y){var stage=Laya.stage;var globalTransform=laya.utils.Utils.getGlobalPosAndScale(coordinateSpace);var canvasMatrix=stage._canvasTransform.clone();var canvasLeft=canvasMatrix.tx;var canvasTop=canvasMatrix.ty;canvasMatrix.rotate(-Math.PI/180*Laya.stage.canvasDegree);canvasMatrix.scale(Laya.stage.clientScaleX,Laya.stage.clientScaleY);var perpendicular=(Laya.stage.canvasDegree%180!=0);var tx=NaN,ty=NaN;if(perpendicular){tx=y+globalTransform.y;ty=x+globalTransform.x;tx*=canvasMatrix.d;ty*=canvasMatrix.a;if(Laya.stage.canvasDegree==90){tx=canvasLeft-tx;ty+=canvasTop;}
else{tx+=canvasLeft;ty=canvasTop-ty;}}
else{tx=x+globalTransform.x;ty=y+globalTransform.y;tx*=canvasMatrix.a;ty*=canvasMatrix.d;tx+=canvasLeft;ty+=canvasTop;};var domScaleX=NaN,domScaleY=NaN;if(perpendicular){domScaleX=canvasMatrix.d*globalTransform.height;domScaleY=canvasMatrix.a*globalTransform.width;}else{domScaleX=canvasMatrix.a*globalTransform.width;domScaleY=canvasMatrix.d*globalTransform.height;}
return{x:tx,y:ty,scaleX:domScaleX,scaleY:domScaleY};}
Utils.fitDOMElementInArea=function(dom,coordinateSpace,x,y,width,height){if(!dom._fitLayaAirInitialized){dom._fitLayaAirInitialized=true;dom.style.transformOrigin=dom.style.webKittransformOrigin="left top";dom.style.position="absolute"};var transform=Utils.getTransformRelativeToWindow(coordinateSpace,x,y);dom.style.transform=dom.style.webkitTransform="scale("+transform.scaleX+","+transform.scaleY+") rotate("+(Laya.stage.canvasDegree)+"deg)";dom.style.width=width+'px';dom.style.height=height+'px';dom.style.left=transform.x+'px';dom.style.top=transform.y+'px';}
Utils.isOkTextureList=function(textureList){if(!textureList)return false;var i=0,len=textureList.length;var tTexture;for(i=0;i<len;i++){tTexture=textureList[i];if(!tTexture||!tTexture.source)return false;}
return true;}
Utils.isOKCmdList=function(cmds){if(!cmds)return false;var i=0,len=cmds.length;var context=Render._context;var cmd;var tex;for(i=0;i<len;i++){cmd=cmds[i];switch(cmd.callee){case context._drawTexture:case context._fillTexture:case context._drawTextureWithTransform:tex=cmd[0];if(!tex||!tex.source)return false;}}
return true;}
Utils._gid=1;Utils._pi=180/Math.PI;Utils._pi2=Math.PI/180;Utils._extReg=/\.(\w+)\??/g;Utils.parseXMLFromString=function(value){var rst;value=value.replace(/>\s+</g,'><');rst=(new DOMParser()).parseFromString(value,'text/xml');if(rst.firstChild.textContent.indexOf("This page contains the following errors")>-1){throw new Error(rst.firstChild.firstChild.textContent);}
return rst;}
return Utils;})()
var VectorGraphManager=(function(){function VectorGraphManager(){this.useDic={};this.shapeDic={};this.shapeLineDic={};this._id=0;this._checkKey=false;this._freeIdArray=[];if(Render.isWebGL){CacheManager.regCacheByFunction(Utils.bind(this.startDispose,this),Utils.bind(this.getCacheList,this));}}
__class(VectorGraphManager,'laya.utils.VectorGraphManager');var __proto=VectorGraphManager.prototype;__proto.getId=function(){return this._id++;}
__proto.addShape=function(id,shape){this.shapeDic[id]=shape;if(!this.useDic[id]){this.useDic[id]=true;}}
__proto.addLine=function(id,Line){this.shapeLineDic[id]=Line;if(!this.shapeLineDic[id]){this.shapeLineDic[id]=true;}}
__proto.getShape=function(id){if(this._checkKey){if(this.useDic[id]!=null){this.useDic[id]=true;}}}
__proto.deleteShape=function(id){if(this.shapeDic[id]){this.shapeDic[id]=null;delete this.shapeDic[id];}
if(this.shapeLineDic[id]){this.shapeLineDic[id]=null;delete this.shapeLineDic[id];}
if(this.useDic[id]!=null){delete this.useDic[id];}}
__proto.getCacheList=function(){var str;var list=[];for(str in this.shapeDic){list.push(this.shapeDic[str]);}
for(str in this.shapeLineDic){list.push(this.shapeLineDic[str]);}
return list;}
__proto.startDispose=function(key){var str;for(str in this.useDic){this.useDic[str]=false;}
this._checkKey=true;}
__proto.endDispose=function(){if(this._checkKey){var str;for(str in this.useDic){if(!this.useDic[str]){this.deleteShape(str);}}
this._checkKey=false;}}
VectorGraphManager.getInstance=function(){return VectorGraphManager.instance=VectorGraphManager.instance||new VectorGraphManager();}
VectorGraphManager.instance=null;return VectorGraphManager;})()
var WeakObject=(function(){function WeakObject(){this._obj=null;this._obj=WeakObject.supportWeakMap?new Browser.window.WeakMap():{};if(!WeakObject.supportWeakMap)WeakObject._maps.push(this);}
__class(WeakObject,'laya.utils.WeakObject');var __proto=WeakObject.prototype;__proto.set=function(key,value){if(key==null)return;if(WeakObject.supportWeakMap){var objKey=key;if((typeof key=='string')||(typeof key=='number')){objKey=WeakObject._keys[key];if(!objKey)objKey=WeakObject._keys[key]={k:key};}
this._obj.set(objKey,value);}else{if((typeof key=='string')||(typeof key=='number')){this._obj[key]=value;}else{key.$_GID||(key.$_GID=Utils.getGID());this._obj[key.$_GID]=value;}}}
__proto.get=function(key){if(key==null)return null;if(WeakObject.supportWeakMap){var objKey=((typeof key=='string')||(typeof key=='number'))?WeakObject._keys[key]:key;if(!objKey)return null;return this._obj.get(objKey);}else{if((typeof key=='string')||(typeof key=='number'))return this._obj[key];return this._obj[key.$_GID];}}
__proto.del=function(key){if(key==null)return;if(WeakObject.supportWeakMap){var objKey=((typeof key=='string')||(typeof key=='number'))?WeakObject._keys[key]:key;if(!objKey)return;this._obj.delete(objKey);}else{if((typeof key=='string')||(typeof key=='number'))delete this._obj[key];else delete this._obj[this._obj.$_GID];}}
__proto.has=function(key){if(key==null)return false;if(WeakObject.supportWeakMap){var objKey=((typeof key=='string')||(typeof key=='number'))?WeakObject._keys[key]:key;return this._obj.has(objKey);}else{if((typeof key=='string')||(typeof key=='number'))return this._obj[key]!=null;return this._obj[this._obj.$_GID]!=null;}}
WeakObject.__init__=function(){WeakObject.supportWeakMap=Browser.window.WeakMap!=null;if(!WeakObject.supportWeakMap)Laya.timer.loop(WeakObject.delInterval,null,WeakObject.clearCache);}
WeakObject.clearCache=function(){for(var i=0,n=WeakObject._maps.length;i<n;i++){var obj=WeakObject._maps[i];obj._obj={};}}
WeakObject.supportWeakMap=false;WeakObject.delInterval=5*60*1000;WeakObject._keys={};WeakObject._maps=[];__static(WeakObject,['I',function(){return this.I=new WeakObject();}]);return WeakObject;})()
var WordText=(function(){function WordText(){this.id=NaN;this.save=[];this.toUpperCase=null;this.changed=false;this._text=null;}
__class(WordText,'laya.utils.WordText');var __proto=WordText.prototype;__proto.setText=function(txt){this.changed=true;this._text=txt;}
__proto.toString=function(){return this._text;}
__proto.charCodeAt=function(i){return this._text?this._text.charCodeAt(i):NaN;}
__proto.charAt=function(i){return this._text?this._text.charAt(i):null;}
__getset(0,__proto,'length',function(){return this._text?this._text.length:0;});return WordText;})()
var Node=(function(_super){function Node(){this._bits=0;this._displayedInStage=false;this._parent=null;this.conchModel=null;this.name="";this._destroyed=false;Node.__super.call(this);this._childs=Node.ARRAY_EMPTY;this._$P=Node.PROP_EMPTY;this.timer=Laya.scaleTimer;this.conchModel=Render.isConchNode?this.createConchModel():null;}
__class(Node,'laya.display.Node',_super);var __proto=Node.prototype;__proto._setBit=function(type,value){if(type==0x1){var preValue=this._getBit(type);if(preValue!=value){this._updateDisplayedInstage();}}
if(value){this._bits|=type;}else{this._bits&=~type;}}
__proto._getBit=function(type){return(this._bits&type)!=0;}
__proto._setUpNoticeChain=function(){if(this._getBit(0x1)){this._setUpNoticeType(0x1);}}
__proto._setUpNoticeType=function(type){var ele=this;ele._setBit(type,true);ele=ele.parent;while(ele){if(ele._getBit(type))return;ele._setBit(type,true);ele=ele.parent;}}
__proto.on=function(type,caller,listener,args){if(type==="display"||type==="undisplay"){if(!this._getBit(0x1)){this._setUpNoticeType(0x1);}}
return this._createListener(type,caller,listener,args,false);}
__proto.once=function(type,caller,listener,args){if(type==="display"||type==="undisplay"){if(!this._getBit(0x1)){this._setUpNoticeType(0x1);}}
return this._createListener(type,caller,listener,args,true);}
__proto.createConchModel=function(){return null;}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);this._destroyed=true;this._parent&&this._parent.removeChild(this);if(this._childs){if(destroyChild)this.destroyChildren();else this.removeChildren();}
this._childs=null;this._$P=null;this.offAll();this.timer.clearAll(this);}
__proto.destroyChildren=function(){if(this._childs){for(var i=this._childs.length-1;i>-1;i--){this._childs[i].destroy(true);}}}
__proto.addChild=function(node){if(!node||this.destroyed||node===this)return node;if((node).zOrder)this._set$P("hasZorder",true);if(node._parent===this){var index=this.getChildIndex(node);if(index!==this._childs.length-1){this._childs.splice(index,1);this._childs.push(node);if(this.conchModel){this.conchModel.removeChild(node.conchModel);this.conchModel.addChildAt(node.conchModel,this._childs.length-1);}
this._childChanged();}}else{node.parent&&node.parent.removeChild(node);this._childs===Node.ARRAY_EMPTY&&(this._childs=[]);this._childs.push(node);this.conchModel&&this.conchModel.addChildAt(node.conchModel,this._childs.length-1);node.parent=this;this._childChanged();}
return node;}
__proto.addChildren=function(__args){var args=arguments;var i=0,n=args.length;while(i<n){this.addChild(args[i++]);}}
__proto.addChildAt=function(node,index){if(!node||this.destroyed||node===this)return node;if((node).zOrder)this._set$P("hasZorder",true);if(index>=0&&index<=this._childs.length){if(node._parent===this){var oldIndex=this.getChildIndex(node);this._childs.splice(oldIndex,1);this._childs.splice(index,0,node);if(this.conchModel){this.conchModel.removeChild(node.conchModel);this.conchModel.addChildAt(node.conchModel,index);}
this._childChanged();}else{node.parent&&node.parent.removeChild(node);this._childs===Node.ARRAY_EMPTY&&(this._childs=[]);this._childs.splice(index,0,node);this.conchModel&&this.conchModel.addChildAt(node.conchModel,index);node.parent=this;}
return node;}else{throw new Error("appendChildAt:The index is out of bounds");}}
__proto.getChildIndex=function(node){return this._childs.indexOf(node);}
__proto.getChildByName=function(name){var nodes=this._childs;if(nodes){for(var i=0,n=nodes.length;i<n;i++){var node=nodes[i];if(node.name===name)return node;}}
return null;}
__proto._get$P=function(key){return this._$P[key];}
__proto._set$P=function(key,value){if(!this.destroyed){this._$P===Node.PROP_EMPTY&&(this._$P={});this._$P[key]=value;}
return value;}
__proto.getChildAt=function(index){return this._childs[index];}
__proto.setChildIndex=function(node,index){var childs=this._childs;if(index<0||index>=childs.length){throw new Error("setChildIndex:The index is out of bounds.");};var oldIndex=this.getChildIndex(node);if(oldIndex<0)throw new Error("setChildIndex:node is must child of this object.");childs.splice(oldIndex,1);childs.splice(index,0,node);if(this.conchModel){this.conchModel.removeChild(node.conchModel);this.conchModel.addChildAt(node.conchModel,index);}
this._childChanged();return node;}
__proto._childChanged=function(child){}
__proto.removeChild=function(node){if(!this._childs)return node;var index=this._childs.indexOf(node);return this.removeChildAt(index);}
__proto.removeSelf=function(){this._parent&&this._parent.removeChild(this);return this;}
__proto.removeChildByName=function(name){var node=this.getChildByName(name);node&&this.removeChild(node);return node;}
__proto.removeChildAt=function(index){var node=this.getChildAt(index);if(node){this._childs.splice(index,1);this.conchModel&&this.conchModel.removeChild(node.conchModel);node.parent=null;}
return node;}
__proto.removeChildren=function(beginIndex,endIndex){(beginIndex===void 0)&&(beginIndex=0);(endIndex===void 0)&&(endIndex=0x7fffffff);if(this._childs&&this._childs.length>0){var childs=this._childs;if(beginIndex===0&&endIndex>=n){var arr=childs;this._childs=Node.ARRAY_EMPTY;}else{arr=childs.splice(beginIndex,endIndex-beginIndex);}
for(var i=0,n=arr.length;i<n;i++){arr[i].parent=null;this.conchModel&&this.conchModel.removeChild(arr[i].conchModel);}}
return this;}
__proto.replaceChild=function(newNode,oldNode){var index=this._childs.indexOf(oldNode);if(index>-1){this._childs.splice(index,1,newNode);if(this.conchModel){this.conchModel.removeChild(oldNode.conchModel);this.conchModel.addChildAt(newNode.conchModel,index);}
oldNode.parent=null;newNode.parent=this;return newNode;}
return null;}
__proto._updateDisplayedInstage=function(){var ele;ele=this;var stage=Laya.stage;this._displayedInStage=false;while(ele){if(ele._getBit(0x1)){this._displayedInStage=ele._displayedInStage;break;}
if(ele==stage||ele._displayedInStage){this._displayedInStage=true;break;}
ele=ele.parent;}}
__proto._setDisplay=function(value){if(this._displayedInStage!==value){this._displayedInStage=value;if(value)this.event("display");else this.event("undisplay");}}
__proto._displayChild=function(node,display){var childs=node._childs;if(childs){for(var i=0,n=childs.length;i<n;i++){var child=childs[i];if(!child._getBit(0x1))continue;if(child._childs.length>0){this._displayChild(child,display);}else{child._setDisplay(display);}}}
node._setDisplay(display);}
__proto.contains=function(node){if(node===this)return true;while(node){if(node.parent===this)return true;node=node.parent;}
return false;}
__proto.timerLoop=function(delay,caller,method,args,coverBefore,jumpFrame){(coverBefore===void 0)&&(coverBefore=true);(jumpFrame===void 0)&&(jumpFrame=false);this.timer.loop(delay,caller,method,args,coverBefore,jumpFrame);}
__proto.timerOnce=function(delay,caller,method,args,coverBefore){(coverBefore===void 0)&&(coverBefore=true);this.timer._create(false,false,delay,caller,method,args,coverBefore);}
__proto.frameLoop=function(delay,caller,method,args,coverBefore){(coverBefore===void 0)&&(coverBefore=true);this.timer._create(true,true,delay,caller,method,args,coverBefore);}
__proto.frameOnce=function(delay,caller,method,args,coverBefore){(coverBefore===void 0)&&(coverBefore=true);this.timer._create(true,false,delay,caller,method,args,coverBefore);}
__proto.clearTimer=function(caller,method){this.timer.clear(caller,method);}
__getset(0,__proto,'numChildren',function(){return this._childs.length;});__getset(0,__proto,'destroyed',function(){return this._destroyed;});__getset(0,__proto,'parent',function(){return this._parent;},function(value){if(this._parent!==value){if(value){this._parent=value;this.event("added");if(this._getBit(0x1)){this._setUpNoticeChain();value.displayedInStage&&this._displayChild(this,true);}
value._childChanged(this);}else{this.event("removed");this._parent._childChanged();if(this._getBit(0x1))this._displayChild(this,false);this._parent=value;}}});__getset(0,__proto,'displayedInStage',function(){if(this._getBit(0x1))return this._displayedInStage;this._setUpNoticeType(0x1);return this._displayedInStage;});Node.ARRAY_EMPTY=[];Node.PROP_EMPTY={};Node.NOTICE_DISPLAY=0x1;Node.MOUSEENABLE=0x2;return Node;})(EventDispatcher)
var CSSStyle=(function(_super){function CSSStyle(ower){this._bgground=null;this._border=null;this._rect=null;this.underLine=0;this.lineHeight=0;CSSStyle.__super.call(this);this._padding=CSSStyle._PADDING;this._spacing=CSSStyle._SPACING;this._aligns=CSSStyle._ALIGNS;this._font=Font.EMPTY;this._ower=ower;}
__class(CSSStyle,'laya.display.css.CSSStyle',_super);var __proto=CSSStyle.prototype;__proto.destroy=function(){this._ower=null;this._font=null;this._rect=null;}
__proto.inherit=function(src){this._font=src._font;this._spacing=src._spacing===CSSStyle._SPACING?CSSStyle._SPACING:src._spacing.slice();this.lineHeight=src.lineHeight;}
__proto._widthAuto=function(){return(this._type&0x40000)!==0;}
__proto.widthed=function(sprite){return(this._type&0x8)!=0;}
__proto._calculation=function(type,value){if(value.indexOf('%')<0)return false;var ower=this._ower;var parent=ower.parent;var rect=this._rect;function getValue(pw,w,nums){return(pw*nums[0]+w*nums[1]+nums[2]);}
function onParentResize(type){var pw=parent.width,w=ower.width;rect.width&&(ower.width=getValue(pw,w,rect.width));rect.height&&(ower.height=getValue(pw,w,rect.height));rect.left&&(ower.x=getValue(pw,w,rect.left));rect.top&&(ower.y=getValue(pw,w,rect.top));}
if(rect===null){parent._getCSSStyle()._type|=0x80000;parent.on("resize",this,onParentResize);this._rect=rect={input:{}};};var nums=value.split(' ');nums[0]=parseFloat(nums[0])/100;if(nums.length==1)
nums[1]=nums[2]=0;else{nums[1]=parseFloat(nums[1])/100;nums[2]=parseFloat(nums[2]);}
rect[type]=nums;rect.input[type]=value;onParentResize(type);return true;}
__proto.heighted=function(sprite){return(this._type&0x2000)!=0;}
__proto.size=function(w,h){var ower=this._ower;var resize=false;if(w!==-1&&w!=this._ower.width){this._type|=0x8;this._ower.width=w;resize=true;}
if(h!==-1&&h!=this._ower.height){this._type|=0x2000;this._ower.height=h;resize=true;}
if(resize){ower._layoutLater();(this._type&0x80000)&&ower.event("resize",this);}}
__proto._getAlign=function(){return this._aligns[0];}
__proto._getValign=function(){return this._aligns[1];}
__proto._getCssFloat=function(){return(this._type&0x8000)!=0?0x8000:0;}
__proto._createFont=function(){return(this._type&0x1000)?this._font:(this._type|=0x1000,this._font=new Font(this._font));}
__proto.render=function(sprite,context,x,y){var w=sprite.width;var h=sprite.height;x-=sprite.pivotX;y-=sprite.pivotY;this._bgground&&this._bgground.color!=null&&context.ctx.fillRect(x,y,w,h,this._bgground.color);this._border&&this._border.color&&context.drawRect(x,y,w,h,this._border.color.strColor,this._border.size);}
__proto.getCSSStyle=function(){return this;}
__proto.cssText=function(text){this.attrs(CSSStyle.parseOneCSS(text,';'));}
__proto.attrs=function(attrs){if(attrs){for(var i=0,n=attrs.length;i<n;i++){var attr=attrs[i];this[attr[0]]=attr[1];}}}
__proto.setTransform=function(value){(value==='none')?(this._tf=Style._TF_EMPTY):this.attrs(CSSStyle.parseOneCSS(value,','));}
__proto.translate=function(x,y){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.translateX=x;this._tf.translateY=y;}
__proto.scale=function(x,y){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo());this._tf.scaleX=x;this._tf.scaleY=y;}
__proto._enableLayout=function(){return(this._type&0x2)===0&&(this._type&0x4)===0;}
__getset(0,__proto,'block',_super.prototype._$get_block,function(value){value?(this._type|=0x1):(this._type&=(~0x1));});__getset(0,__proto,'valign',function(){return CSSStyle._valigndef[this._aligns[1]];},function(value){this._aligns===CSSStyle._ALIGNS&&(this._aligns=[0,0,0]);this._aligns[1]=CSSStyle._valigndef[value];});__getset(0,__proto,'height',null,function(h){this._type|=0x2000;if((typeof h=='string')){if(this._calculation("height",h))return;h=parseInt(h);}
this.size(-1,h);});__getset(0,__proto,'width',null,function(w){this._type|=0x8;if((typeof w=='string')){var offset=w.indexOf('auto');if(offset>=0){this._type|=0x40000;w=w.substr(0,offset);}
if(this._calculation("width",w))return;w=parseInt(w);}
this.size(w,-1);});__getset(0,__proto,'fontWeight',function(){return this._font.weight;},function(value){this._createFont().weight=value;});__getset(0,__proto,'left',null,function(value){var ower=this._ower;if(((typeof value=='string'))){if(value==="center")
value="50% -50% 0";else if(value==="right")
value="100% -100% 0";if(this._calculation("left",value))return;value=parseInt(value);}
ower.x=value;});__getset(0,__proto,'_translate',null,function(value){this.translate(value[0],value[1]);});__getset(0,__proto,'absolute',function(){return(this._type&0x4)!==0;});__getset(0,__proto,'top',null,function(value){var ower=this._ower;if(((typeof value=='string'))){if(value==="middle")
value="50% -50% 0";else if(value==="bottom")
value="100% -100% 0";if(this._calculation("top",value))return;value=parseInt(value);}
ower.y=value;});__getset(0,__proto,'align',function(){return CSSStyle._aligndef[this._aligns[0]];},function(value){this._aligns===CSSStyle._ALIGNS&&(this._aligns=[0,0,0]);this._aligns[0]=CSSStyle._aligndef[value];});__getset(0,__proto,'bold',function(){return this._font.bold;},function(value){this._createFont().bold=value;});__getset(0,__proto,'padding',function(){return this._padding;},function(value){this._padding=value;});__getset(0,__proto,'leading',function(){return this._spacing[1];},function(d){((typeof d=='string'))&&(d=parseInt(d+""));this._spacing===CSSStyle._SPACING&&(this._spacing=[0,0]);this._spacing[1]=d;});__getset(0,__proto,'lineElement',function(){return(this._type&0x10000)!=0;},function(value){value?(this._type|=0x10000):(this._type&=(~0x10000));});__getset(0,__proto,'cssFloat',function(){return(this._type&0x8000)!=0?"right":"left";},function(value){this.lineElement=false;value==="right"?(this._type|=0x8000):(this._type&=(~0x8000));});__getset(0,__proto,'textDecoration',function(){return this._font.decoration;},function(value){this._createFont().decoration=value;});__getset(0,__proto,'whiteSpace',function(){return(this._type&0x20000)?"nowrap":"";},function(type){type==="nowrap"&&(this._type|=0x20000);type==="none"&&(this._type&=~0x20000);});__getset(0,__proto,'background',null,function(value){if(!value){this._bgground=null;return;}
this._bgground||(this._bgground={});this._bgground.color=value;this._ower.conchModel&&this._ower.conchModel.bgColor(value);this._type|=0x4000;this._ower._renderType|=0x100;});__getset(0,__proto,'wordWrap',function(){return(this._type&0x20000)===0;},function(value){value?(this._type&=~0x20000):(this._type|=0x20000);});__getset(0,__proto,'color',function(){return this._font.color;},function(value){this._createFont().color=value;});__getset(0,__proto,'password',function(){return this._font.password;},function(value){this._createFont().password=value;});__getset(0,__proto,'backgroundColor',function(){return this._bgground?this._bgground.color:null;},function(value){if(value==='none')this._bgground=null;else(this._bgground||(this._bgground={}),this._bgground.color=value);this._ower.conchModel&&this._ower.conchModel.bgColor(value);this._ower._renderType|=0x100;});__getset(0,__proto,'font',function(){return this._font.toString();},function(value){this._createFont().set(value);});__getset(0,__proto,'weight',null,function(value){this._createFont().weight=value;});__getset(0,__proto,'letterSpacing',function(){return this._spacing[0];},function(d){((typeof d=='string'))&&(d=parseInt(d+""));this._spacing===CSSStyle._SPACING&&(this._spacing=[0,0]);this._spacing[0]=d;});__getset(0,__proto,'fontSize',function(){return this._font.size;},function(value){this._createFont().size=value;});__getset(0,__proto,'italic',function(){return this._font.italic;},function(value){this._createFont().italic=value;});__getset(0,__proto,'fontFamily',function(){return this._font.family;},function(value){this._createFont().family=value;});__getset(0,__proto,'stroke',function(){return this._font.stroke[0];},function(value){if(this._createFont().stroke===Font._STROKE)this._font.stroke=[0,"#000000"];this._font.stroke[0]=value;});__getset(0,__proto,'strokeColor',function(){return this._font.stroke[1];},function(value){if(this._createFont().stroke===Font._STROKE)this._font.stroke=[0,"#000000"];this._font.stroke[1]=value;});__getset(0,__proto,'border',function(){return this._border?this._border.value:"";},function(value){if(value=='none'){this._border=null;return;}
this._border||(this._border={});this._border.value=value;var values=value.split(' ');this._border.color=Color.create(values[values.length-1]);if(values.length==1){this._border.size=1;this._border.type='solid';return;};var i=0;if(values[0].indexOf('px')>0){this._border.size=parseInt(values[0]);i++;}else this._border.size=1;this._border.type=values[i];this._ower._renderType|=0x100;});__getset(0,__proto,'borderColor',function(){return(this._border&&this._border.color)?this._border.color.strColor:null;},function(value){if(!value){this._border=null;return;}
this._border||(this._border={size:1,type:'solid'});this._border.color=(value==null)?null:Color.create(value);this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor);this._ower._renderType|=0x100;});__getset(0,__proto,'position',function(){return(this._type&0x4)?"absolute":"";},function(value){value=="absolute"?(this._type|=0x4):(this._type&=~0x4);});__getset(0,__proto,'display',null,function(value){switch(value){case'':this._type&=~0x2;this.visible=true;break;case'none':this._type|=0x2;this.visible=false;this._ower._layoutLater();break;}});__getset(0,__proto,'paddingLeft',function(){return this.padding[3];});__getset(0,__proto,'paddingTop',function(){return this.padding[0];});__getset(0,__proto,'_scale',null,function(value){this._ower.scale(value[0],value[1]);});__getset(0,__proto,'_rotate',null,function(value){this._ower.rotation=value;});CSSStyle.parseOneCSS=function(text,clipWord){var out=[];var attrs=text.split(clipWord);var valueArray;for(var i=0,n=attrs.length;i<n;i++){var attr=attrs[i];var ofs=attr.indexOf(':');var name=attr.substr(0,ofs).replace(/^\s+|\s+$/g,'');if(name.length==0)
continue;var value=attr.substr(ofs+1).replace(/^\s+|\s+$/g,'');var one=[name,value];switch(name){case'italic':case'bold':one[1]=value=="true";break;case'line-height':one[0]='lineHeight';one[1]=parseInt(value);break;case'font-size':one[0]='fontSize';one[1]=parseInt(value);break;case'padding':valueArray=value.split(' ');valueArray.length>1||(valueArray[1]=valueArray[2]=valueArray[3]=valueArray[0]);one[1]=[parseInt(valueArray[0]),parseInt(valueArray[1]),parseInt(valueArray[2]),parseInt(valueArray[3])];break;case'rotate':one[0]="_rotate";one[1]=parseFloat(value);break;case'scale':valueArray=value.split(' ');one[0]="_scale";one[1]=[parseFloat(valueArray[0]),parseFloat(valueArray[1])];break;case'translate':valueArray=value.split(' ');one[0]="_translate";one[1]=[parseInt(valueArray[0]),parseInt(valueArray[1])];break;default:(one[0]=CSSStyle._CSSTOVALUE[name])||(one[0]=name);}
out.push(one);}
return out;}
CSSStyle.parseCSS=function(text,uri){var one;while((one=CSSStyle._parseCSSRegExp.exec(text))!=null){CSSStyle.styleSheets[one[1]]=CSSStyle.parseOneCSS(one[2],';');}}
CSSStyle.EMPTY=new CSSStyle(null);CSSStyle._CSSTOVALUE={'letter-spacing':'letterSpacing','line-spacing':'lineSpacing','white-space':'whiteSpace','line-height':'lineHeight','scale-x':'scaleX','scale-y':'scaleY','translate-x':'translateX','translate-y':'translateY','font-family':'fontFamily','font-weight':'fontWeight','vertical-align':'valign','text-decoration':'textDecoration','background-color':'backgroundColor','border-color':'borderColor','float':'cssFloat'};CSSStyle._parseCSSRegExp=new RegExp("([\.\#]\\w+)\\s*{([\\s\\S]*?)}","g");CSSStyle._aligndef={'left':0,'center':1,'right':2,0:'left',1:'center',2:'right'};CSSStyle._valigndef={'top':0,'middle':1,'bottom':2,0:'top',1:'middle',2:'bottom'};CSSStyle.styleSheets={};CSSStyle.ALIGN_CENTER=1;CSSStyle.ALIGN_RIGHT=2;CSSStyle.VALIGN_MIDDLE=1;CSSStyle.VALIGN_BOTTOM=2;CSSStyle._CSS_BLOCK=0x1;CSSStyle._DISPLAY_NONE=0x2;CSSStyle._ABSOLUTE=0x4;CSSStyle._WIDTH_SET=0x8;CSSStyle._PADDING=[0,0,0,0];CSSStyle._RECT=[-1,-1,-1,-1];CSSStyle._SPACING=[0,0];CSSStyle._ALIGNS=[0,0,0];CSSStyle.ADDLAYOUTED=0x200;CSSStyle._NEWFONT=0x1000;CSSStyle._HEIGHT_SET=0x2000;CSSStyle._BACKGROUND_SET=0x4000;CSSStyle._FLOAT_RIGHT=0x8000;CSSStyle._LINE_ELEMENT=0x10000;CSSStyle._NOWARP=0x20000;CSSStyle._WIDTHAUTO=0x40000;CSSStyle._LISTERRESZIE=0x80000;return CSSStyle;})(Style)
var AudioSound=(function(_super){function AudioSound(){this.url=null;this.audio=null;this.loaded=false;AudioSound.__super.call(this);}
__class(AudioSound,'laya.media.h5audio.AudioSound',_super);var __proto=AudioSound.prototype;__proto.dispose=function(){var ad=AudioSound._audioCache[this.url];if(ad){ad.src="";delete AudioSound._audioCache[this.url];}}
__proto.load=function(url){url=URL.formatURL(url);this.url=url;var ad;if(url==SoundManager._tMusic){AudioSound._initMusicAudio();ad=AudioSound._musicAudio;if(ad.src!=url){AudioSound._audioCache[ad.src]=null;ad=null;}}else{ad=AudioSound._audioCache[url];}
if(ad&&ad.readyState>=2){this.event("complete");return;}
if(!ad){if(url==SoundManager._tMusic){AudioSound._initMusicAudio();ad=AudioSound._musicAudio;}else{ad=Browser.createElement("audio");}
AudioSound._audioCache[url]=ad;ad.src=url;}
ad.addEventListener("canplaythrough",onLoaded);ad.addEventListener("error",onErr);var me=this;function onLoaded(){offs();me.loaded=true;me.event("complete");}
function onErr(){ad.load=null;offs();me.event("error");}
function offs(){ad.removeEventListener("canplaythrough",onLoaded);ad.removeEventListener("error",onErr);}
this.audio=ad;if(ad.load){ad.load();}else{onErr();}}
__proto.play=function(startTime,loops){(startTime===void 0)&&(startTime=0);(loops===void 0)&&(loops=0);if(!this.url)return null;var ad;if(this.url==SoundManager._tMusic){ad=AudioSound._musicAudio;}else{ad=AudioSound._audioCache[this.url];}
if(!ad)return null;var tAd;tAd=Pool.getItem("audio:"+this.url);if(Render.isConchApp){if(!tAd){tAd=Browser.createElement("audio");tAd.src=this.url;}}
else{if(this.url==SoundManager._tMusic){AudioSound._initMusicAudio();tAd=AudioSound._musicAudio;tAd.src=this.url;}else{tAd=tAd?tAd:ad.cloneNode(true);}};var channel=new AudioSoundChannel(tAd);channel.url=this.url;channel.loops=loops;channel.startTime=startTime;channel.play();SoundManager.addChannel(channel);return channel;}
__getset(0,__proto,'duration',function(){var ad;ad=AudioSound._audioCache[this.url];if(!ad)
return 0;return ad.duration;});AudioSound._initMusicAudio=function(){if(AudioSound._musicAudio)return;if(!AudioSound._musicAudio)AudioSound._musicAudio=Browser.createElement("audio");if(!Render.isConchApp){Browser.document.addEventListener("mousedown",AudioSound._makeMusicOK);}}
AudioSound._makeMusicOK=function(){Browser.document.removeEventListener("mousedown",AudioSound._makeMusicOK);if(!AudioSound._musicAudio.src){AudioSound._musicAudio.src="";AudioSound._musicAudio.load();}else{AudioSound._musicAudio.play();}}
AudioSound._audioCache={};AudioSound._musicAudio=null;return AudioSound;})(EventDispatcher)
var SoundChannel=(function(_super){function SoundChannel(){this.url=null;this.loops=0;this.startTime=NaN;this.isStopped=false;this.completeHandler=null;SoundChannel.__super.call(this);}
__class(SoundChannel,'laya.media.SoundChannel',_super);var __proto=SoundChannel.prototype;__proto.play=function(){}
__proto.stop=function(){}
__proto.pause=function(){}
__proto.resume=function(){}
__proto.__runComplete=function(handler){if(handler){handler.run();}}
__getset(0,__proto,'volume',function(){return 1;},function(v){});__getset(0,__proto,'position',function(){return 0;});__getset(0,__proto,'duration',function(){return 0;});return SoundChannel;})(EventDispatcher)
var Sound=(function(_super){function Sound(){Sound.__super.call(this);;}
__class(Sound,'laya.media.Sound',_super);var __proto=Sound.prototype;__proto.load=function(url){}
__proto.play=function(startTime,loops){(startTime===void 0)&&(startTime=0);(loops===void 0)&&(loops=0);return null;}
__proto.dispose=function(){}
__getset(0,__proto,'duration',function(){return 0;});return Sound;})(EventDispatcher)
var WebAudioSound=(function(_super){function WebAudioSound(){this.url=null;this.loaded=false;this.data=null;this.audioBuffer=null;this.__toPlays=null;this._disposed=false;WebAudioSound.__super.call(this);}
__class(WebAudioSound,'laya.media.webaudio.WebAudioSound',_super);var __proto=WebAudioSound.prototype;__proto.load=function(url){var me=this;url=URL.formatURL(url);this.url=url;this.audioBuffer=WebAudioSound._dataCache[url];if(this.audioBuffer){this._loaded(this.audioBuffer);return;}
WebAudioSound.e.on("loaded:"+url,this,this._loaded);WebAudioSound.e.on("err:"+url,this,this._err);if(WebAudioSound.__loadingSound[url]){return;}
WebAudioSound.__loadingSound[url]=true;var request=new Browser.window.XMLHttpRequest();request.open("GET",url,true);request.responseType="arraybuffer";request.onload=function(){if(me._disposed){me._removeLoadEvents();return;}
me.data=request.response;WebAudioSound.buffs.push({"buffer":me.data,"url":me.url});WebAudioSound.decode();};request.onerror=function(e){me._err();}
request.send();}
__proto._err=function(){this._removeLoadEvents();WebAudioSound.__loadingSound[this.url]=false;this.event("error");}
__proto._loaded=function(audioBuffer){this._removeLoadEvents();if(this._disposed){return;}
this.audioBuffer=audioBuffer;WebAudioSound._dataCache[this.url]=this.audioBuffer;this.loaded=true;this.event("complete");}
__proto._removeLoadEvents=function(){WebAudioSound.e.off("loaded:"+this.url,this,this._loaded);WebAudioSound.e.off("err:"+this.url,this,this._err);}
__proto.__playAfterLoaded=function(){if(!this.__toPlays)return;var i=0,len=0;var toPlays;toPlays=this.__toPlays;len=toPlays.length;var tParams;for(i=0;i<len;i++){tParams=toPlays[i];if(tParams[2]&&!(tParams[2]).isStopped){this.play(tParams[0],tParams[1],tParams[2]);}}
this.__toPlays.length=0;}
__proto.play=function(startTime,loops,channel){(startTime===void 0)&&(startTime=0);(loops===void 0)&&(loops=0);channel=channel?channel:new WebAudioSoundChannel();if(!this.audioBuffer){if(this.url){if(!this.__toPlays)this.__toPlays=[];this.__toPlays.push([startTime,loops,channel]);this.once("complete",this,this.__playAfterLoaded);this.load(this.url);}}
channel.url=this.url;channel.loops=loops;channel["audioBuffer"]=this.audioBuffer;channel.startTime=startTime;channel.play();SoundManager.addChannel(channel);return channel;}
__proto.dispose=function(){this._disposed=true;delete WebAudioSound._dataCache[this.url];delete WebAudioSound.__loadingSound[this.url];this.audioBuffer=null;this.data=null;this.__toPlays=[];}
__getset(0,__proto,'duration',function(){if(this.audioBuffer){return this.audioBuffer.duration;}
return 0;});WebAudioSound.decode=function(){if(WebAudioSound.buffs.length<=0||WebAudioSound.isDecoding){return;}
WebAudioSound.isDecoding=true;WebAudioSound.tInfo=WebAudioSound.buffs.shift();WebAudioSound.ctx.decodeAudioData(WebAudioSound.tInfo["buffer"],WebAudioSound._done,WebAudioSound._fail);}
WebAudioSound._done=function(audioBuffer){WebAudioSound.e.event("loaded:"+WebAudioSound.tInfo.url,audioBuffer);WebAudioSound.isDecoding=false;WebAudioSound.decode();}
WebAudioSound._fail=function(){WebAudioSound.e.event("err:"+WebAudioSound.tInfo.url,null);WebAudioSound.isDecoding=false;WebAudioSound.decode();}
WebAudioSound._playEmptySound=function(){if(WebAudioSound.ctx==null){return;};var source=WebAudioSound.ctx.createBufferSource();source.buffer=WebAudioSound._miniBuffer;source.connect(WebAudioSound.ctx.destination);source.start(0,0,0);}
WebAudioSound._unlock=function(){if(WebAudioSound._unlocked){return;}
WebAudioSound._playEmptySound();if(WebAudioSound.ctx.state=="running"){Browser.document.removeEventListener("mousedown",WebAudioSound._unlock,true);Browser.document.removeEventListener("touchend",WebAudioSound._unlock,true);WebAudioSound._unlocked=true;}}
WebAudioSound.initWebAudio=function(){if(WebAudioSound.ctx.state!="running"){WebAudioSound._unlock();Browser.document.addEventListener("mousedown",WebAudioSound._unlock,true);Browser.document.addEventListener("touchend",WebAudioSound._unlock,true);}}
WebAudioSound._dataCache={};WebAudioSound.buffs=[];WebAudioSound.isDecoding=false;WebAudioSound._unlocked=false;WebAudioSound.tInfo=null;WebAudioSound.__loadingSound={};__static(WebAudioSound,['window',function(){return this.window=Browser.window;},'webAudioEnabled',function(){return this.webAudioEnabled=WebAudioSound.window["AudioContext"]||WebAudioSound.window["webkitAudioContext"]||WebAudioSound.window["mozAudioContext"];},'ctx',function(){return this.ctx=WebAudioSound.webAudioEnabled?new(WebAudioSound.window["AudioContext"]||WebAudioSound.window["webkitAudioContext"]||WebAudioSound.window["mozAudioContext"])():undefined;},'_miniBuffer',function(){return this._miniBuffer=WebAudioSound.ctx.createBuffer(1,1,22050);},'e',function(){return this.e=new EventDispatcher();}]);return WebAudioSound;})(EventDispatcher)
var HttpRequest=(function(_super){function HttpRequest(){this._responseType=null;this._data=null;HttpRequest.__super.call(this);this._http=new Browser.window.XMLHttpRequest();}
__class(HttpRequest,'laya.net.HttpRequest',_super);var __proto=HttpRequest.prototype;__proto.send=function(url,data,method,responseType,headers){(method===void 0)&&(method="get");(responseType===void 0)&&(responseType="text");this._responseType=responseType;this._data=null;var _this=this;var http=this._http;http.open(method,url,true);if(headers){for(var i=0;i<headers.length;i++){http.setRequestHeader(headers[i++],headers[i]);}}else if(!Render.isConchApp){if(!data||(typeof data=='string'))http.setRequestHeader("Content-Type","application/x-www-form-urlencoded");else http.setRequestHeader("Content-Type","application/json");}
http.responseType=responseType!=="arraybuffer"?"text":"arraybuffer";http.onerror=function(e){_this._onError(e);}
http.onabort=function(e){_this._onAbort(e);}
http.onprogress=function(e){_this._onProgress(e);}
http.onload=function(e){_this._onLoad(e);}
http.send(data);}
__proto._onProgress=function(e){if(e&&e.lengthComputable)this.event("progress",e.loaded/e.total);}
__proto._onAbort=function(e){this.error("Request was aborted by user");}
__proto._onError=function(e){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText);}
__proto._onLoad=function(e){var http=this._http;var status=http.status!==undefined?http.status:200;if(status===200||status===204||status===0){this.complete();}else{this.error("["+http.status+"]"+http.statusText+":"+http.responseURL);}}
__proto.error=function(message){this.clear();this.event("error",message);}
__proto.complete=function(){this.clear();var flag=true;try{if(this._responseType==="json"){this._data=JSON.parse(this._http.responseText);}else if(this._responseType==="xml"){this._data=Utils.parseXMLFromString(this._http.responseText);}else{this._data=this._http.response||this._http.responseText;}}catch(e){flag=false;this.error(e.message);}
flag&&this.event("complete",(this._data instanceof Array)?[this._data]:this._data);}
__proto.clear=function(){var http=this._http;http.onerror=http.onabort=http.onprogress=http.onload=null;}
__getset(0,__proto,'url',function(){return this._http.responseURL;});__getset(0,__proto,'http',function(){return this._http;});__getset(0,__proto,'data',function(){return this._data;});return HttpRequest;})(EventDispatcher)
var Loader=(function(_super){function Loader(){this._data=null;this._class=null;this._url=null;this._type=null;this._cache=false;this._http=null;this._customParse=false;Loader.__super.call(this);}
__class(Loader,'laya.net.Loader',_super);var __proto=Loader.prototype;__proto.load=function(url,type,cache,group,ignoreCache){(cache===void 0)&&(cache=true);(ignoreCache===void 0)&&(ignoreCache=false);this._url=url;if(url.indexOf("data:image")===0)this._type=type="image";else{this._type=type||(type=this.getTypeFromUrl(url));url=URL.formatURL(url);}
this._cache=cache;this._data=null;if(!ignoreCache&&Loader.loadedMap[url]){this._data=Loader.loadedMap[url];this.event("progress",1);this.event("complete",this._data);return;}
if(group)Loader.setGroup(url,group);if(Loader.parserMap[type]!=null){this._customParse=true;if(((Loader.parserMap[type])instanceof laya.utils.Handler))Loader.parserMap[type].runWith(this);else Loader.parserMap[type].call(null,this);return;}
if(type==="image"||type==="htmlimage"||type==="nativeimage")return this._loadImage(url);if(type==="sound")return this._loadSound(url);if(type==="ttf")return this._loadTTF(url);if(type=="atlas"){if(Loader.preLoadedAtlasConfigMap[url]){this.onLoaded(Loader.preLoadedAtlasConfigMap[url]);delete Loader.preLoadedAtlasConfigMap[url];return;}}
if(!this._http){this._http=new HttpRequest();this._http.on("progress",this,this.onProgress);this._http.on("error",this,this.onError);this._http.on("complete",this,this.onLoaded);};var contentType;switch(type){case"atlas":contentType="json";break;case"font":contentType="xml";break;case"pkm":contentType="arraybuffer";break
default:contentType=type;}
this._http.send(url,null,"get",contentType);}
__proto.getTypeFromUrl=function(url){var type=Utils.getFileExtension(url);if(type)return Loader.typeMap[type];console.warn("Not recognize the resources suffix",url);return"text";}
__proto._loadTTF=function(url){url=URL.formatURL(url);var ttfLoader=new TTFLoader();ttfLoader.complete=Handler.create(this,this.onLoaded);ttfLoader.load(url);}
__proto._loadImage=function(url){url=URL.formatURL(url);var _this=this;var image;function clear(){image.onload=null;image.onerror=null;delete Loader.imgCache[url]};var onload=function(){clear();_this.onLoaded(image);};var onerror=function(){clear();_this.event("error","Load image failed");}
if(this._type==="nativeimage"){image=new Browser.window.Image();image.crossOrigin="";image.onload=onload;image.onerror=onerror;image.src=url;Loader.imgCache[url]=image;}else{new HTMLImage.create(url,{onload:onload,onerror:onerror,onCreate:function(img){image=img;Loader.imgCache[url]=img;}});}}
__proto._loadSound=function(url){var sound=(new SoundManager._soundClass());var _this=this;sound.on("complete",this,soundOnload);sound.on("error",this,soundOnErr);sound.load(url);function soundOnload(){clear();_this.onLoaded(sound);}
function soundOnErr(){clear();sound.dispose();_this.event("error","Load sound failed");}
function clear(){sound.offAll();}}
__proto.onProgress=function(value){if(this._type==="atlas")this.event("progress",value*0.3);else this.event("progress",value);}
__proto.onError=function(message){this.event("error",message);}
__proto.onLoaded=function(data){var type=this._type;if(type==="image"){var tex=new Texture(data);tex.url=this._url;this.complete(tex);}else if(type==="sound"||type==="htmlimage"||type==="nativeimage"){this.complete(data);}else if(type==="atlas"){if(!data.src&&!data._setContext){if(!this._data){this._data=data;if(data.meta&&data.meta.image){var toloadPics=data.meta.image.split(",");var split=this._url.indexOf("/")>=0?"/":"\\";var idx=this._url.lastIndexOf(split);var folderPath=idx>=0?this._url.substr(0,idx+1):"";for(var i=0,len=toloadPics.length;i<len;i++){toloadPics[i]=folderPath+toloadPics[i];}}else{toloadPics=[this._url.replace(".json",".png")];}
toloadPics.reverse();data.toLoads=toloadPics;data.pics=[];}
this.event("progress",0.3+1/toloadPics.length*0.6);return this._loadImage(toloadPics.pop());}else{this._data.pics.push(data);if(this._data.toLoads.length>0){this.event("progress",0.3+1/this._data.toLoads.length*0.6);return this._loadImage(this._data.toLoads.pop());};var frames=this._data.frames;var cleanUrl=this._url.split("?")[0];var directory=(this._data.meta&&this._data.meta.prefix)?this._data.meta.prefix:cleanUrl.substring(0,cleanUrl.lastIndexOf("."))+"/";var pics=this._data.pics;var atlasURL=URL.formatURL(this._url);var map=Loader.atlasMap[atlasURL]||(Loader.atlasMap[atlasURL]=[]);map.dir=directory;var scaleRate=1;if(this._data.meta&&this._data.meta.scale&&this._data.meta.scale!=1){scaleRate=parseFloat(this._data.meta.scale);for(var name in frames){var obj=frames[name];var tPic=pics[obj.frame.idx?obj.frame.idx:0];var url=URL.formatURL(directory+name);tPic.scaleRate=scaleRate;Loader.cacheRes(url,Texture.create(tPic,obj.frame.x,obj.frame.y,obj.frame.w,obj.frame.h,obj.spriteSourceSize.x,obj.spriteSourceSize.y,obj.sourceSize.w,obj.sourceSize.h));Loader.loadedMap[url].url=url;map.push(url);}}else{for(name in frames){obj=frames[name];tPic=pics[obj.frame.idx?obj.frame.idx:0];url=URL.formatURL(directory+name);Loader.cacheRes(url,Texture.create(tPic,obj.frame.x,obj.frame.y,obj.frame.w,obj.frame.h,obj.spriteSourceSize.x,obj.spriteSourceSize.y,obj.sourceSize.w,obj.sourceSize.h));Loader.loadedMap[url].url=url;map.push(url);}}
delete this._data.pics;this.complete(this._data);}}else if(type=="font"){if(!data.src){this._data=data;this.event("progress",0.5);return this._loadImage(this._url.replace(".fnt",".png"));}else{var bFont=new BitmapFont();bFont.parseFont(this._data,data);var tArr=this._url.split(".fnt")[0].split("/");var fontName=tArr[tArr.length-1];Text.registerBitmapFont(fontName,bFont);this._data=bFont;this.complete(this._data);}}else if(type=="pkm"){var image=HTMLImage.create(data,this._url);var tex1=new Texture(image);tex1.url=this._url;this.complete(tex1);}else{this.complete(data);}}
__proto.complete=function(data){this._data=data;if(this._customParse){this.event("loaded",(data instanceof Array)?[data]:data);}else{Loader._loaders.push(this);if(!Loader._isWorking)Loader.checkNext();}}
__proto.endLoad=function(content){content&&(this._data=content);if(this._cache)Loader.cacheRes(this._url,this._data);this._customParse=false;this.event("progress",1);this.event("complete",(this.data instanceof Array)?[this.data]:this.data);}
__getset(0,__proto,'url',function(){return this._url;});__getset(0,__proto,'data',function(){return this._data;});__getset(0,__proto,'cache',function(){return this._cache;});__getset(0,__proto,'type',function(){return this._type;});Loader.checkNext=function(){Loader._isWorking=true;var startTimer=Browser.now();var thisTimer=startTimer;while(Loader._startIndex<Loader._loaders.length){thisTimer=Browser.now();Loader._loaders[Loader._startIndex].endLoad();Loader._startIndex++;if(Browser.now()-startTimer>Loader.maxTimeOut){console.warn("loader callback cost a long time:"+(Browser.now()-startTimer)+" url="+Loader._loaders[Loader._startIndex-1].url);Laya.timer.frameOnce(1,null,Loader.checkNext);return;}}
Loader._loaders.length=0;Loader._startIndex=0;Loader._isWorking=false;}
Loader.clearRes=function(url,forceDispose){(forceDispose===void 0)&&(forceDispose=false);url=URL.formatURL(url);var arr=Loader.getAtlas(url);if(arr){for(var i=0,n=arr.length;i<n;i++){var resUrl=arr[i];var tex=Loader.getRes(resUrl);delete Loader.loadedMap[resUrl];if(tex)tex.destroy(forceDispose);}
arr.length=0;delete Loader.atlasMap[url];delete Loader.loadedMap[url];}else{var res=Loader.loadedMap[url];if(res){delete Loader.loadedMap[url];if((res instanceof laya.resource.Texture)&&res.bitmap)(res).destroy(forceDispose);}}}
Loader.clearTextureRes=function(url){url=URL.formatURL(url);var arr=laya.net.Loader.getAtlas(url);var res=(arr&&arr.length>0)?laya.net.Loader.getRes(arr[0]):laya.net.Loader.getRes(url);if(res&&res.bitmap){if(Render.isConchApp){if(res.bitmap.source.releaseTexture){res.bitmap.source.releaseTexture();}}else if(res.bitmap._atlaser==null){res.bitmap.releaseResource(true);}}}
Loader.setAtlasConfigs=function(url,config){Loader.preLoadedAtlasConfigMap[URL.formatURL(url)]=config;}
Loader.getRes=function(url){return Loader.loadedMap[URL.formatURL(url)];}
Loader.getAtlas=function(url){return Loader.atlasMap[URL.formatURL(url)];}
Loader.cacheRes=function(url,data){url=URL.formatURL(url);if(Loader.loadedMap[url]!=null){console.warn("Resources already exist,is repeated loading:",url);}else{Loader.loadedMap[url]=data;}}
Loader.setGroup=function(url,group){if(!Loader.groupMap[group])Loader.groupMap[group]=[];Loader.groupMap[group].push(url);}
Loader.clearResByGroup=function(group){if(!Loader.groupMap[group])return;var arr=Loader.groupMap[group],i=0,len=arr.length;for(i=0;i<len;i++){Loader.clearRes(arr[i]);}
arr.length=0;}
Loader.TEXT="text";Loader.JSON="json";Loader.XML="xml";Loader.BUFFER="arraybuffer";Loader.IMAGE="image";Loader.SOUND="sound";Loader.ATLAS="atlas";Loader.FONT="font";Loader.TTF="ttf";Loader.PKM="pkm";Loader.typeMap={"png":"image","jpg":"image","jpeg":"image","txt":"text","json":"json","xml":"xml","als":"atlas","atlas":"atlas","mp3":"sound","ogg":"sound","wav":"sound","part":"json","fnt":"font","pkm":"pkm","ttf":"ttf"};Loader.parserMap={};Loader.groupMap={};Loader.maxTimeOut=100;Loader.loadedMap={};Loader.preLoadedAtlasConfigMap={};Loader.atlasMap={};Loader._loaders=[];Loader._isWorking=false;Loader._startIndex=0;Loader.imgCache={};return Loader;})(EventDispatcher)
var LoaderManager=(function(_super){var ResInfo;function LoaderManager(){this.retryNum=1;this.retryDelay=0;this.maxLoader=5;this._loaders=[];this._loaderCount=0;this._resInfos=[];this._infoPool=[];this._maxPriority=5;this._failRes={};LoaderManager.__super.call(this);for(var i=0;i<this._maxPriority;i++)this._resInfos[i]=[];}
__class(LoaderManager,'laya.net.LoaderManager',_super);var __proto=LoaderManager.prototype;__proto.create=function(url,complete,progress,clas,params,priority,cache,group){(priority===void 0)&&(priority=1);(cache===void 0)&&(cache=true);if((url instanceof Array)){var items=url;var itemCount=items.length;var loadedCount=0;if(progress){var progress2=Handler.create(progress.caller,progress.method,progress.args,false);}
for(var i=0;i<itemCount;i++){var item=items[i];if((typeof item=='string'))item=items[i]={url:item};item.progress=0;var progressHandler=progress?Handler.create(null,onProgress,[item],false):null;var completeHandler=(progress||complete)?Handler.create(null,onComplete,[item]):null;this._create(item.url,completeHandler,progressHandler,item.clas||clas,item.params||params,item.priority||priority,cache,item.group||group);}
function onComplete(item,content){loadedCount++;item.progress=1;if(loadedCount===itemCount&&complete){complete.run();}}
function onProgress(item,value){item.progress=value;var num=0;for(var j=0;j<itemCount;j++){var item1=items[j];num+=item1.progress;};var v=num/itemCount;progress2.runWith(v);}
return true;}else return this._create(url,complete,progress,clas,params,priority,cache,group);}
__proto._create=function(url,complete,progress,clas,params,priority,cache,group){(priority===void 0)&&(priority=1);(cache===void 0)&&(cache=true);var formarUrl=URL.formatURL(url);var item=this.getRes(formarUrl);if(!item){var extension=Utils.getFileExtension(url);var creatItem=LoaderManager.createMap[extension];if(!creatItem)
throw new Error("LoaderManager:unknown file("+url+") extension with: "+extension+".");if(!clas)clas=creatItem[0];var type=creatItem[1];if(extension=="atlas"){this.load(url,complete,progress,type,priority,cache);}else{if(clas===Texture)type="htmlimage";item=clas?new clas():null;if(item.hasOwnProperty("_loaded"))
item._loaded=false;item._setUrl(url);(group)&&(item._setGroup(group));this._createLoad(item,url,Handler.create(null,onLoaded),progress,type,priority,false,group,true);function onLoaded(data){(item&&!item.destroyed&&data)&&(item.onAsynLoaded.call(item,url,data,params));if(complete)complete.run();Laya.loader.event(url);}
(cache)&&(this.cacheRes(formarUrl,item));}}else{if(!item.hasOwnProperty("loaded")||item.loaded){progress&&progress.runWith(1);complete&&complete.run();}else if(complete){Laya.loader._createListener(url,complete.caller,complete.method,complete.args,true,false);}}
return item;}
__proto.load=function(url,complete,progress,type,priority,cache,group,ignoreCache){var _$this=this;(priority===void 0)&&(priority=1);(cache===void 0)&&(cache=true);(ignoreCache===void 0)&&(ignoreCache=false);if((url instanceof Array))return this._loadAssets(url,complete,progress,type,priority,cache,group);var content=Loader.getRes(url);if(content!=null){Laya.timer.frameOnce(1,null,function(){progress&&progress.runWith(1);complete&&complete.runWith(content);_$this._loaderCount||_$this.event("complete");});}else{var info=LoaderManager._resMap[url];if(!info){info=this._infoPool.length?this._infoPool.pop():new ResInfo();info.url=url;info.type=type;info.cache=cache;info.group=group;info.ignoreCache=ignoreCache;complete&&info.on("complete",complete.caller,complete.method,complete.args);progress&&info.on("progress",progress.caller,progress.method,progress.args);LoaderManager._resMap[url]=info;priority=priority<this._maxPriority?priority:this._maxPriority-1;this._resInfos[priority].push(info);this._next();}else{complete&&info._createListener("complete",complete.caller,complete.method,complete.args,false,false);progress&&info._createListener("progress",progress.caller,progress.method,progress.args,false,false);}}
return this;}
__proto._createLoad=function(item,url,complete,progress,type,priority,cache,group,ignoreCache){var _$this=this;(priority===void 0)&&(priority=1);(cache===void 0)&&(cache=true);(ignoreCache===void 0)&&(ignoreCache=false);if((url instanceof Array))return this._loadAssets(url,complete,progress,type,priority,cache,group);var content=Loader.getRes(url);if(content!=null){Laya.timer.frameOnce(1,null,function(){progress&&progress.runWith(1);complete&&complete.runWith(content);_$this._loaderCount||_$this.event("complete");});}else{var info=LoaderManager._resMap[url];if(!info){info=this._infoPool.length?this._infoPool.pop():new ResInfo();info.url=url;info.clas=item;info.type=type;info.cache=cache;info.group=group;info.ignoreCache=ignoreCache;complete&&info.on("complete",complete.caller,complete.method,complete.args);progress&&info.on("progress",progress.caller,progress.method,progress.args);LoaderManager._resMap[url]=info;priority=priority<this._maxPriority?priority:this._maxPriority-1;this._resInfos[priority].push(info);this._next();}else{complete&&info._createListener("complete",complete.caller,complete.method,complete.args,false,false);progress&&info._createListener("progress",progress.caller,progress.method,progress.args,false,false);}}
return this;}
__proto._next=function(){if(this._loaderCount>=this.maxLoader)return;for(var i=0;i<this._maxPriority;i++){var infos=this._resInfos[i];while(infos.length>0){var info=infos.shift();if(info)return this._doLoad(info);}}
this._loaderCount||this.event("complete");}
__proto._doLoad=function(resInfo){this._loaderCount++;var loader=this._loaders.length?this._loaders.pop():new Loader();loader.on("complete",null,onLoaded);loader.on("progress",null,function(num){resInfo.event("progress",num);});loader.on("error",null,function(msg){onLoaded(null);});var _this=this;function onLoaded(data){loader.offAll();loader._data=null;_this._loaders.push(loader);_this._endLoad(resInfo,(data instanceof Array)?[data]:data);_this._loaderCount--;_this._next();}
loader._class=resInfo.clas;loader.load(resInfo.url,resInfo.type,resInfo.cache,resInfo.group,resInfo.ignoreCache);}
__proto._endLoad=function(resInfo,content){var url=resInfo.url;if(content==null){var errorCount=this._failRes[url]||0;if(errorCount<this.retryNum){console.warn("[warn]Retry to load:",url);this._failRes[url]=errorCount+1;Laya.timer.once(this.retryDelay,this,this._addReTry,[resInfo],false);return;}else{console.warn("[error]Failed to load:",url);this.event("error",url);}}
if(this._failRes[url])this._failRes[url]=0;delete LoaderManager._resMap[url];resInfo.event("complete",content);resInfo.offAll();this._infoPool.push(resInfo);}
__proto._addReTry=function(resInfo){this._resInfos[this._maxPriority-1].push(resInfo);this._next();}
__proto.clearRes=function(url,forceDispose){(forceDispose===void 0)&&(forceDispose=false);Loader.clearRes(url,forceDispose);}
__proto.getRes=function(url){return Loader.getRes(url);}
__proto.cacheRes=function(url,data){Loader.cacheRes(url,data);}
__proto.clearTextureRes=function(url){Loader.clearTextureRes(url);}
__proto.setGroup=function(url,group){Loader.setGroup(url,group);}
__proto.clearResByGroup=function(group){Loader.clearResByGroup(group);}
__proto.clearUnLoaded=function(){for(var i=0;i<this._maxPriority;i++){var infos=this._resInfos[i];for(var j=infos.length-1;j>-1;j--){var info=infos[j];if(info){info.offAll();this._infoPool.push(info);}}
infos.length=0;}
this._loaderCount=0;LoaderManager._resMap={};}
__proto.cancelLoadByUrls=function(urls){if(!urls)return;for(var i=0,n=urls.length;i<n;i++){this.cancelLoadByUrl(urls[i]);}}
__proto.cancelLoadByUrl=function(url){for(var i=0;i<this._maxPriority;i++){var infos=this._resInfos[i];for(var j=infos.length-1;j>-1;j--){var info=infos[j];if(info&&info.url===url){infos[j]=null;info.offAll();this._infoPool.push(info);}}}
if(LoaderManager._resMap[url])delete LoaderManager._resMap[url];}
__proto._loadAssets=function(arr,complete,progress,type,priority,cache,group){(priority===void 0)&&(priority=1);(cache===void 0)&&(cache=true);var itemCount=arr.length;var loadedCount=0;var totalSize=0;var items=[];var success=true;for(var i=0;i<itemCount;i++){var item=arr[i];if((typeof item=='string'))item={url:item,type:type,size:1,priority:priority};if(!item.size)item.size=1;item.progress=0;totalSize+=item.size;items.push(item);var progressHandler=progress?Handler.create(null,loadProgress,[item],false):null;var completeHandler=(complete||progress)?Handler.create(null,loadComplete,[item]):null;this.load(item.url,completeHandler,progressHandler,item.type,item.priority||1,cache,item.group||group);}
function loadComplete(item,content){loadedCount++;item.progress=1;if(!content)success=false;if(loadedCount===itemCount&&complete){complete.runWith(success);}}
function loadProgress(item,value){if(progress!=null){item.progress=value;var num=0;for(var j=0;j<items.length;j++){var item1=items[j];num+=item1.size*item1.progress;};var v=num/totalSize;progress.runWith(v);}}
return this;}
LoaderManager.cacheRes=function(url,data){Loader.cacheRes(url,data);}
LoaderManager._resMap={};__static(LoaderManager,['createMap',function(){return this.createMap={atlas:[null,"atlas"]};}]);LoaderManager.__init$=function(){ResInfo=(function(_super){function ResInfo(){this.url=null;this.type=null;this.cache=false;this.group=null;this.ignoreCache=false;this.clas=null;ResInfo.__super.call(this);}
__class(ResInfo,'',_super);return ResInfo;})(EventDispatcher)}
return LoaderManager;})(EventDispatcher)
var ColorFilter=(function(_super){function ColorFilter(mat){ColorFilter.__super.call(this);if(!mat){mat=[0.3,0.59,0.11,0,0,0.3,0.59,0.11,0,0,0.3,0.59,0.11,0,0,0,0,0,1,0];}
this._mat=new Float32Array(16);this._alpha=new Float32Array(4);var j=0;var z=0;for(var i=0;i<20;i++){if(i%5!=4){this._mat[j++]=mat[i];}else{this._alpha[z++]=mat[i];}}
this._action=RunDriver.createFilterAction(0x20);this._action.data=this;}
__class(ColorFilter,'laya.filters.ColorFilter',_super);var __proto=ColorFilter.prototype;Laya.imps(__proto,{"laya.filters.IFilter":true})
__proto.callNative=function(sp){var t=sp._$P.cf=this;sp.conchModel&&sp.conchModel.setFilterMatrix&&sp.conchModel.setFilterMatrix(this._mat,this._alpha);}
__getset(0,__proto,'type',function(){return 0x20;});__getset(0,__proto,'action',function(){return this._action;});return ColorFilter;})(Filter)
var Socket=(function(_super){function Socket(host,port,byteClass){this._endian=null;this._stamp=NaN;this._socket=null;this._connected=false;this._addInputPosition=0;this._input=null;this._output=null;this.timeout=0;this.objectEncoding=0;this.disableInput=false;this._byteClass=null;this.protocols=[];(port===void 0)&&(port=0);Socket.__super.call(this);this._byteClass=byteClass?byteClass:Byte;this.endian="bigEndian";this.timeout=20000;this._addInputPosition=0;if(host&&port>0&&port<65535)
this.connect(host,port);}
__class(Socket,'laya.net.Socket',_super);var __proto=Socket.prototype;__proto.connect=function(host,port){var url="ws://"+host+":"+port;if(Browser.window.location.protocol=="https:"){url="wss://"+host+":"+port;}else{url="ws://"+host+":"+port;}
this.connectByUrl(url);}
__proto.connectByUrl=function(url){var _$this=this;if(this._socket!=null)
this.close();this._socket&&this.cleanSocket();if(!this.protocols||this.protocols.length==0){this._socket=new Browser.window.WebSocket(url);}else{this._socket=new Browser.window.WebSocket(url,this.protocols);}
this._socket.binaryType="arraybuffer";this._output=new this._byteClass();this._output.endian=this.endian;this._input=new this._byteClass();this._input.endian=this.endian;this._addInputPosition=0;this._socket.onopen=function(e){_$this._onOpen(e);};this._socket.onmessage=function(msg){_$this._onMessage(msg);};this._socket.onclose=function(e){_$this._onClose(e);};this._socket.onerror=function(e){_$this._onError(e);};}
__proto.cleanSocket=function(){try{this._socket.close();}catch(e){}
this._connected=false;this._socket.onopen=null;this._socket.onmessage=null;this._socket.onclose=null;this._socket.onerror=null;this._socket=null;}
__proto.close=function(){if(this._socket!=null){try{this._socket.close();}catch(e){}}}
__proto._onOpen=function(e){this._connected=true;this.event("open",e);}
__proto._onMessage=function(msg){if(!msg||!msg.data)return;var data=msg.data;if(this.disableInput&&data){this.event("message",data);return;}
if(this._input.length>0&&this._input.bytesAvailable<1){this._input.clear();this._addInputPosition=0;};var pre=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0);this._input.pos=this._addInputPosition;if(data){if((typeof data=='string')){this._input.writeUTFBytes(data);}else{this._input.writeArrayBuffer(data);}
this._addInputPosition=this._input.pos;this._input.pos=pre;}
this.event("message",data);}
__proto._onClose=function(e){this._connected=false;this.event("close",e)}
__proto._onError=function(e){this.event("error",e)}
__proto.send=function(data){this._socket.send(data);}
__proto.flush=function(){if(this._output&&this._output.length>0){var evt;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length));}catch(e){evt=e;}
this._output.endian=this.endian;this._output.clear();if(evt)this.event("error",evt);}}
__getset(0,__proto,'input',function(){return this._input;});__getset(0,__proto,'output',function(){return this._output;});__getset(0,__proto,'connected',function(){return this._connected;});__getset(0,__proto,'endian',function(){return this._endian;},function(value){this._endian=value;if(this._input!=null)this._input.endian=value;if(this._output!=null)this._output.endian=value;});Socket.LITTLE_ENDIAN="littleEndian";Socket.BIG_ENDIAN="bigEndian";return Socket;})(EventDispatcher)
var WorkerLoader=(function(_super){function WorkerLoader(){this.worker=null;WorkerLoader.__super.call(this);var _$this=this;this.worker=new Browser.window.Worker(WorkerLoader.workerPath);this.worker.onmessage=function(evt){_$this.workerMessage(evt.data);}}
__class(WorkerLoader,'laya.net.WorkerLoader',_super);var __proto=WorkerLoader.prototype;__proto.workerMessage=function(data){if(data){switch(data.type){case"Image":this.imageLoaded(data);break;case"Msg":this.event("image_msg",data.msg);break;}}}
__proto.imageLoaded=function(data){if(data&&data.buffer&&data.buffer.length<10){WorkerLoader._enable=false;this._myTrace("buffer lost when postmessage ,disable workerloader");this.event(data.url,null);this.event("image_err",data.url+"\n"+data.msg);return;}
if(!data.dataType){this.event(data.url,null);this.event("image_err",data.url+"\n"+data.msg);return;};var canvas,ctx;var imageData;switch(data.dataType){case"buffer":canvas=new HTMLCanvas("2D");ctx=canvas.source.getContext("2d");imageData=ctx.createImageData(data.width,data.height);imageData.data.set(data.buffer);canvas.size(imageData.width,imageData.height);ctx.putImageData(imageData,0,0);canvas.memorySize=0;break;case"imagedata":canvas=new HTMLCanvas("2D");ctx=canvas.source.getContext("2d");imageData=data.imagedata;canvas.size(imageData.width,imageData.height);ctx.putImageData(imageData,0,0);imageData=data.imagedata;canvas.memorySize=0;break;case"imageBitmap":imageData=data.imageBitmap;if(!Render.isWebGL){canvas=new HTMLCanvas("2D");ctx=canvas.source.getContext("2d");canvas.size(imageData.width,imageData.height);ctx.drawImage(imageData,0,0);canvas.src=data.url;}else
canvas=imageData;break;}
if(Render.isWebGL)
canvas=new laya.webgl.resource.WebGLImage(canvas,data.url);;this.event(data.url,canvas);}
__proto._myTrace=function(__arg){var arg=arguments;var rst=[];var i=0,len=arg.length;for(i=0;i<len;i++){rst.push(arg[i]);}
this.event("image_msg",rst.join(" "));}
__proto.loadImage=function(url){var data;data={};data.type="load";data.url=url;this.worker.postMessage(data);}
__proto._loadImage=function(url){var _this=this;if(!WorkerLoader._enable||url.toLowerCase().indexOf(".png")<0){WorkerLoader._preLoadFun.call(_this,url);return;}
url=URL.formatURL(url);function clear(){laya.net.WorkerLoader.I.off(url,_this,onload);};var onload=function(image){clear();if(image){_this["onLoaded"](image);}else{WorkerLoader._preLoadFun.call(_this,url);}};laya.net.WorkerLoader.I.on(url,_this,onload);laya.net.WorkerLoader.I.loadImage(url);}
__getset(1,WorkerLoader,'enable',function(){return WorkerLoader._enable;},function(v){if(WorkerLoader.disableJSDecode&&(!Browser.window.createImageBitmap))return;WorkerLoader._enable=v;if(WorkerLoader._enable&&WorkerLoader._preLoadFun==null)WorkerLoader._enable=WorkerLoader.__init__();});WorkerLoader.__init__=function(){if(WorkerLoader._preLoadFun!=null)return false;if(!Browser.window.Worker)return false;WorkerLoader._preLoadFun=Loader["prototype"]["_loadImage"];Loader["prototype"]["_loadImage"]=WorkerLoader["prototype"]["_loadImage"];if(!WorkerLoader.I)WorkerLoader.I=new WorkerLoader();return true;}
WorkerLoader.workerSupported=function(){return Browser.window.Worker?true:false;}
WorkerLoader.IMAGE_LOADED="image_loaded";WorkerLoader.IMAGE_ERR="image_err";WorkerLoader.IMAGE_MSG="image_msg";WorkerLoader.I=null;WorkerLoader._preLoadFun=null;WorkerLoader._enable=false;WorkerLoader.workerPath="libs/worker.js";WorkerLoader.disableJSDecode=true;return WorkerLoader;})(EventDispatcher)
var Resource=(function(_super){function Resource(){Resource.__super.call(this);this._$1__id=++Resource._uniqueIDCounter;this.__loaded=true;this._destroyed=false;this._referenceCount=0;Resource._idResourcesMap[this.id]=this;this._released=true;this.lock=false;this._memorySize=0;this._lastUseFrameCount=-1;(ResourceManager.currentResourceManager)&&(ResourceManager.currentResourceManager.addResource(this));}
__class(Resource,'laya.resource.Resource',_super);var __proto=Resource.prototype;Laya.imps(__proto,{"laya.resource.ICreateResource":true,"laya.resource.IDispose":true})
__proto._setUrl=function(url){if(this._url!==url){var resList;if(this._url){resList=Resource._urlResourcesMap[this._url];resList.splice(resList.indexOf(this),1);(resList.length===0)&&(delete Resource._urlResourcesMap[this._url]);}
if(url){resList=Resource._urlResourcesMap[url];(resList)||(Resource._urlResourcesMap[url]=resList=[]);resList.push(this);}
this._url=url;}}
__proto._getGroup=function(){return this._group;}
__proto._setGroup=function(value){if(this._group!==value){var groupList;if(this._group){groupList=Resource._groupResourcesMap[this._group];groupList.splice(groupList.indexOf(this),1);(groupList.length===0)&&(delete Resource._groupResourcesMap[this._group]);}
if(value){groupList=Resource._groupResourcesMap[value];(groupList)||(Resource._groupResourcesMap[value]=groupList=[]);groupList.push(this);}
this._group=value;}}
__proto._addReference=function(){this._referenceCount++;}
__proto._removeReference=function(){this._referenceCount--;}
__proto._clearReference=function(){this._referenceCount=0;}
__proto._endLoaded=function(){this.__loaded=true;this.event("loaded",this);}
__proto.recreateResource=function(){this.completeCreate();}
__proto.disposeResource=function(){}
__proto.activeResource=function(force){(force===void 0)&&(force=false);this._lastUseFrameCount=Stat.loopCount;if(!this._destroyed&&this.__loaded&&(this._released||force))
this.recreateResource();}
__proto.releaseResource=function(force){(force===void 0)&&(force=false);if(!force&&this.lock)
return false;if(!this._released||force){this.disposeResource();this._released=true;this._lastUseFrameCount=-1;this.event("released",this);return true;}else{return false;}}
__proto.onAsynLoaded=function(url,data,params){throw new Error("Resource: must override this function!");}
__proto.destroy=function(){if(this._destroyed)
return;if(this._resourceManager!==null)
this._resourceManager.removeResource(this);this._destroyed=true;this.lock=false;this.releaseResource();delete Resource._idResourcesMap[this.id];var resList;if(this._url){resList=Resource._urlResourcesMap[this._url];if(resList){resList.splice(resList.indexOf(this),1);(resList.length===0)&&(delete Resource._urlResourcesMap[this.url]);}
Loader.clearRes(this._url);(this.__loaded)||(RunDriver.cancelLoadByUrl(this._url));}
if(this._group){resList=Resource._groupResourcesMap[this._group];resList.splice(resList.indexOf(this),1);(resList.length===0)&&(delete Resource._groupResourcesMap[this.url]);}}
__proto.completeCreate=function(){this._released=false;this.event("recovered",this);}
__proto.dispose=function(){this.destroy();}
__getset(0,__proto,'memorySize',function(){return this._memorySize;},function(value){var offsetValue=value-this._memorySize;this._memorySize=value;this.resourceManager&&this.resourceManager.addSize(offsetValue);});__getset(0,__proto,'_loaded',null,function(value){this.__loaded=value;});__getset(0,__proto,'loaded',function(){return this.__loaded;});__getset(0,__proto,'id',function(){return this._$1__id;});__getset(0,__proto,'destroyed',function(){return this._destroyed;});__getset(0,__proto,'group',function(){return this._getGroup();},function(value){this._setGroup(value);});__getset(0,__proto,'resourceManager',function(){return this._resourceManager;});__getset(0,__proto,'url',function(){return this._url;});__getset(0,__proto,'released',function(){return this._released;});__getset(0,__proto,'referenceCount',function(){return this._referenceCount;});Resource.getResourceByID=function(id){return Resource._idResourcesMap[id];}
Resource.getResourceByURL=function(url,index){(index===void 0)&&(index=0);return Resource._urlResourcesMap[url][index];}
Resource.getResourceCountByURL=function(url){return Resource._urlResourcesMap[url].length;}
Resource.destroyUnusedResources=function(group){var res;if(group){var resouList=Resource._groupResourcesMap[group];if(resouList){var tempResouList=resouList.slice();for(var i=0,n=tempResouList.length;i<n;i++){res=tempResouList[i];if(!res.lock&&res._referenceCount===0)
res.destroy();}}}else{for(var k in Resource._idResourcesMap){res=Resource._idResourcesMap[k];if(!res.lock&&res._referenceCount===0)
res.destroy();}}}
Resource._uniqueIDCounter=0;Resource._idResourcesMap={};Resource._urlResourcesMap={};Resource._groupResourcesMap={};return Resource;})(EventDispatcher)
var Texture=(function(_super){function Texture(bitmap,uv){this.offsetX=0;this.offsetY=0;this.sourceWidth=0;this.sourceHeight=0;this._w=0;this._h=0;this._uvID=0;this._atlasID=-1;this.scaleRate=1;Texture.__super.call(this);this.setTo(bitmap,uv);}
__class(Texture,'laya.resource.Texture',_super);var __proto=Texture.prototype;__proto._setUrl=function(url){this.url=url;}
__proto.setTo=function(bitmap,uv){if(bitmap instanceof window.HTMLElement){var canvas=HTMLCanvas.create("2D",bitmap);this.bitmap=canvas;}else{this.bitmap=bitmap;}
this.uv=uv||Texture.DEF_UV;if(bitmap){this._w=bitmap.width;this._h=bitmap.height;this.sourceWidth=this.sourceWidth||this._w;this.sourceHeight=this.sourceHeight||this._h
this._loaded=this._w>0;var _this=this;if(this._loaded){RunDriver.addToAtlas&&RunDriver.addToAtlas(_this);}else{var bm=bitmap;if((bm instanceof laya.resource.HTMLImage)&&bm.image)
bm.image.addEventListener('load',function(e){RunDriver.addToAtlas&&RunDriver.addToAtlas(_this);},false);}}}
__proto.active=function(){if(this.bitmap)this.bitmap.activeResource();}
__proto.destroy=function(forceDispose){(forceDispose===void 0)&&(forceDispose=false);if(this.bitmap&&(this.bitmap).referenceCount>0){var temp=this.bitmap;if(forceDispose){if(Render.isConchApp&&temp.source&&temp.source.conchDestroy){this.bitmap.source.conchDestroy();}
this.bitmap=null;temp.dispose();(temp)._clearReference();}else{(temp)._removeReference();if((temp).referenceCount==0){if(Render.isConchApp&&temp.source&&temp.source.conchDestroy){this.bitmap.source.conchDestroy();}
this.bitmap=null;temp.dispose();}}
if(this.url&&this===Laya.loader.getRes(this.url))Laya.loader.clearRes(this.url,forceDispose);this._loaded=false;}}
__proto.load=function(url){var _$this=this;this._loaded=false;url=URL.customFormat(url);var fileBitmap=(this.bitmap||(this.bitmap=HTMLImage.create(url)));if(fileBitmap)fileBitmap._addReference();var _this=this;fileBitmap.onload=function(){fileBitmap.onload=null;_this._loaded=true;_$this.sourceWidth=_$this._w=fileBitmap.width;_$this.sourceHeight=_$this._h=fileBitmap.height;_this.event("loaded",this);(RunDriver.addToAtlas)&&(RunDriver.addToAtlas(_this));};}
__proto.addTextureToAtlas=function(e){RunDriver.addTextureToAtlas(this);}
__proto.getPixels=function(x,y,width,height){if(Render.isConchApp){var temp=this.bitmap;if(temp.source&&temp.source.getImageData){var arraybuffer=temp.source.getImageData(x,y,width,height);var tUint8Array=new Uint8Array(arraybuffer);return Array.from(tUint8Array);}
return null;}else if(Render.isWebGL){return RunDriver.getTexturePixels(this,x,y,width,height);}else{Browser.canvas.size(width,height);Browser.canvas.clear();Browser.context.drawTexture(this,-x,-y,this.width,this.height,0,0);var info=Browser.context.getImageData(0,0,width,height);}
return info.data;}
__proto.onAsynLoaded=function(url,bitmap){this.setTo(bitmap,this.uv);}
__getset(0,__proto,'source',function(){if(!this.bitmap)return null;this.bitmap.activeResource();return this.bitmap.source;});__getset(0,__proto,'loaded',function(){return this._loaded;});__getset(0,__proto,'released',function(){if(!this.bitmap)return true;return this.bitmap.released;});__getset(0,__proto,'width',function(){if(this._w)return this._w;return(this.uv&&this.uv!==Texture.DEF_UV)?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width;},function(value){this._w=value;this.sourceWidth||(this.sourceWidth=value);});__getset(0,__proto,'repeat',function(){if(Render.isWebGL&&this.bitmap){return this.bitmap.repeat;}
return true;},function(value){if(value){if(Render.isWebGL&&this.bitmap){this.bitmap.repeat=value;if(value){this.bitmap.enableMerageInAtlas=false;}}}});__getset(0,__proto,'height',function(){if(this._h)return this._h;return(this.uv&&this.uv!==Texture.DEF_UV)?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height;},function(value){this._h=value;this.sourceHeight||(this.sourceHeight=value);});__getset(0,__proto,'isLinearSampling',function(){return Render.isWebGL?(this.bitmap.minFifter!=0x2600):true;},function(value){if(!value&&Render.isWebGL){if(!value&&(this.bitmap.minFifter==-1)&&(this.bitmap.magFifter==-1)){this.bitmap.minFifter=0x2600;this.bitmap.magFifter=0x2600;this.bitmap.enableMerageInAtlas=false;}}});Texture.moveUV=function(offsetX,offsetY,uv){for(var i=0;i<8;i+=2){uv[i]+=offsetX;uv[i+1]+=offsetY;}
return uv;}
Texture.create=function(source,x,y,width,height,offsetX,offsetY,sourceWidth,sourceHeight){(offsetX===void 0)&&(offsetX=0);(offsetY===void 0)&&(offsetY=0);(sourceWidth===void 0)&&(sourceWidth=0);(sourceHeight===void 0)&&(sourceHeight=0);var btex=(source instanceof laya.resource.Texture);var uv=btex?source.uv:Texture.DEF_UV;var bitmap=btex?source.bitmap:source;var bIsAtlas=RunDriver.isAtlas(bitmap);if(bIsAtlas){var atlaser=bitmap._atlaser;var nAtlasID=(source)._atlasID;if(nAtlasID==-1){throw new Error("create texture error");}
bitmap=atlaser._inAtlasTextureBitmapValue[nAtlasID];uv=atlaser._inAtlasTextureOriUVValue[nAtlasID];};var tex=new Texture(bitmap,null);if(bitmap.width&&(x+width)>bitmap.width)width=bitmap.width-x;if(bitmap.height&&(y+height)>bitmap.height)height=bitmap.height-y;tex.width=width;tex.height=height;tex.offsetX=offsetX;tex.offsetY=offsetY;tex.sourceWidth=sourceWidth||width;tex.sourceHeight=sourceHeight||height;var dwidth=1/bitmap.width;var dheight=1/bitmap.height;x*=dwidth;y*=dheight;width*=dwidth;height*=dheight;var u1=tex.uv[0],v1=tex.uv[1],u2=tex.uv[4],v2=tex.uv[5];var inAltasUVWidth=(u2-u1),inAltasUVHeight=(v2-v1);var oriUV=Texture.moveUV(uv[0],uv[1],[x,y,x+width,y,x+width,y+height,x,y+height]);tex.uv=[u1+oriUV[0]*inAltasUVWidth,v1+oriUV[1]*inAltasUVHeight,u2-(1-oriUV[2])*inAltasUVWidth,v1+oriUV[3]*inAltasUVHeight,u2-(1-oriUV[4])*inAltasUVWidth,v2-(1-oriUV[5])*inAltasUVHeight,u1+oriUV[6]*inAltasUVWidth,v2-(1-oriUV[7])*inAltasUVHeight];if(bIsAtlas){tex.addTextureToAtlas();};var bitmapScale=bitmap.scaleRate;if(bitmapScale&&bitmapScale!=1){tex.sourceWidth/=bitmapScale;tex.sourceHeight/=bitmapScale;tex.width/=bitmapScale;tex.height/=bitmapScale;tex.scaleRate=bitmapScale;tex.offsetX/=bitmapScale;tex.offsetY/=bitmapScale;}else{tex.scaleRate=1;}
return tex;}
Texture.createFromTexture=function(texture,x,y,width,height){var texScaleRate=texture.scaleRate;if(texScaleRate!=1){x*=texScaleRate;y*=texScaleRate;width*=texScaleRate;height*=texScaleRate;};var rect=Rectangle.TEMP.setTo(x-texture.offsetX,y-texture.offsetY,width,height);var result=rect.intersection(Texture._rect1.setTo(0,0,texture.width,texture.height),Texture._rect2);if(result)
var tex=Texture.create(texture,result.x,result.y,result.width,result.height,result.x-rect.x,result.y-rect.y,width,height);else return null;tex.bitmap._removeReference();return tex;}
Texture.DEF_UV=[0,0,1.0,0,1.0,1.0,0,1.0];Texture.INV_UV=[0,1,1.0,1,1.0,0.0,0,0.0];Texture._rect1=new Rectangle();Texture._rect2=new Rectangle();return Texture;})(EventDispatcher)
var TimeLine=(function(_super){var tweenData;function TimeLine(){this._labelDic=null;this._tweenDic={};this._tweenDataList=[];this._endTweenDataList=null;this._currTime=0;this._lastTime=0;this._startTime=0;this._index=0;this._gidIndex=0;this._firstTweenDic={};this._startTimeSort=false;this._endTimeSort=false;this._loopKey=false;this.scale=1;this._frameRate=60;this._frameIndex=0;this._total=0;TimeLine.__super.call(this);}
__class(TimeLine,'laya.utils.TimeLine',_super);var __proto=TimeLine.prototype;__proto.to=function(target,props,duration,ease,offset){(offset===void 0)&&(offset=0);return this._create(target,props,duration,ease,offset,true);}
__proto.from=function(target,props,duration,ease,offset){(offset===void 0)&&(offset=0);return this._create(target,props,duration,ease,offset,false);}
__proto._create=function(target,props,duration,ease,offset,isTo){var tTweenData=Pool.getItemByClass("tweenData",tweenData);tTweenData.isTo=isTo;tTweenData.type=0;tTweenData.target=target;tTweenData.duration=duration;tTweenData.data=props;tTweenData.startTime=this._startTime+offset;tTweenData.endTime=tTweenData.startTime+tTweenData.duration;tTweenData.ease=ease;this._startTime=Math.max(tTweenData.endTime,this._startTime);this._tweenDataList.push(tTweenData);this._startTimeSort=true;this._endTimeSort=true;return this;}
__proto.addLabel=function(label,offset){var tTweenData=Pool.getItemByClass("tweenData",tweenData);tTweenData.type=1;tTweenData.data=label;tTweenData.endTime=tTweenData.startTime=this._startTime+offset;this._labelDic||(this._labelDic={});this._labelDic[label]=tTweenData;this._tweenDataList.push(tTweenData);return this;}
__proto.removeLabel=function(label){if(this._labelDic&&this._labelDic[label]){var tTweenData=this._labelDic[label];if(tTweenData){var tIndex=this._tweenDataList.indexOf(tTweenData);if(tIndex>-1){this._tweenDataList.splice(tIndex,1);}}
delete this._labelDic[label];}}
__proto.gotoTime=function(time){if(this._tweenDataList==null||this._tweenDataList.length==0)return;var tTween;var tObject;for(var p in this._firstTweenDic){tObject=this._firstTweenDic[p];if(tObject){for(var tDataP in tObject){if(tObject.diyTarget.hasOwnProperty(tDataP)){tObject.diyTarget[tDataP]=tObject[tDataP];}}}}
for(p in this._tweenDic){tTween=this._tweenDic[p];tTween.clear();delete this._tweenDic[p];}
this._index=0;this._gidIndex=0;this._currTime=time;this._lastTime=Browser.now();var tTweenDataCopyList;if(this._endTweenDataList==null||this._endTimeSort){this._endTimeSort=false;this._endTweenDataList=tTweenDataCopyList=this._tweenDataList.concat();function Compare(paraA,paraB){if(paraA.endTime>paraB.endTime){return 1;}else if(paraA.endTime<paraB.endTime){return-1;}else{return 0;}}
tTweenDataCopyList.sort(Compare);}else{tTweenDataCopyList=this._endTweenDataList};var tTweenData;for(var i=0,n=tTweenDataCopyList.length;i<n;i++){tTweenData=tTweenDataCopyList[i];if(tTweenData.type==0){if(time>=tTweenData.endTime){this._index=Math.max(this._index,i+1);var props=tTweenData.data;if(tTweenData.isTo){for(var tP in props){tTweenData.target[tP]=props[tP];}}}else{break;}}}
for(i=0,n=this._tweenDataList.length;i<n;i++){tTweenData=this._tweenDataList[i];if(tTweenData.type==0){if(time>=tTweenData.startTime&&time<tTweenData.endTime){this._index=Math.max(this._index,i+1);this._gidIndex++;tTween=Pool.getItemByClass("tween",Tween);tTween._create(tTweenData.target,tTweenData.data,tTweenData.duration,tTweenData.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,false,tTweenData.isTo,true,false);tTween.setStartTime(this._currTime-(time-tTweenData.startTime));tTween._updateEase(this._currTime);tTween.gid=this._gidIndex;this._tweenDic[this._gidIndex]=tTween;}}}}
__proto.gotoLabel=function(Label){if(this._labelDic==null)return;var tLabelData=this._labelDic[Label];if(tLabelData)this.gotoTime(tLabelData.startTime);}
__proto.pause=function(){Laya.timer.clear(this,this._update);}
__proto.resume=function(){this.play(this._currTime,this._loopKey);}
__proto.play=function(timeOrLabel,loop){(timeOrLabel===void 0)&&(timeOrLabel=0);(loop===void 0)&&(loop=false);if(!this._tweenDataList)return;if(this._startTimeSort){this._startTimeSort=false;function Compare(paraA,paraB){if(paraA.startTime>paraB.startTime){return 1;}else if(paraA.startTime<paraB.startTime){return-1;}else{return 0;}}
this._tweenDataList.sort(Compare);for(var i=0,n=this._tweenDataList.length;i<n;i++){var tTweenData=this._tweenDataList[i];if(tTweenData!=null&&tTweenData.type==0){var tTarget=tTweenData.target;var gid=(tTarget.$_GID||(tTarget.$_GID=Utils.getGID()));var tSrcData=null;if(this._firstTweenDic[gid]==null){tSrcData={};tSrcData.diyTarget=tTarget;this._firstTweenDic[gid]=tSrcData;}else{tSrcData=this._firstTweenDic[gid];}
for(var p in tTweenData.data){if(tSrcData[p]==null){tSrcData[p]=tTarget[p];}}}}}
if((typeof timeOrLabel=='string')){this.gotoLabel(timeOrLabel);}else{this.gotoTime(timeOrLabel);}
this._loopKey=loop;this._lastTime=Browser.now();Laya.timer.frameLoop(1,this,this._update);}
__proto._update=function(){if(this._currTime>=this._startTime){if(this._loopKey){this._complete();if(!this._tweenDataList)return;this.gotoTime(0);}else{for(var p in this._tweenDic){tTween=this._tweenDic[p];tTween.complete();}
this._complete();this.pause();return;}};var tNow=Browser.now();var tFrameTime=tNow-this._lastTime;var tCurrTime=this._currTime+=tFrameTime*this.scale;this._lastTime=tNow;for(p in this._tweenDic){tTween=this._tweenDic[p];tTween._updateEase(tCurrTime);};var tTween;if(this._tweenDataList.length!=0&&this._index<this._tweenDataList.length){var tTweenData=this._tweenDataList[this._index];if(tCurrTime>=tTweenData.startTime){this._index++;if(tTweenData.type==0){this._gidIndex++;tTween=Pool.getItemByClass("tween",Tween);tTween._create(tTweenData.target,tTweenData.data,tTweenData.duration,tTweenData.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,false,tTweenData.isTo,true,false);tTween.setStartTime(tCurrTime);tTween.gid=this._gidIndex;this._tweenDic[this._gidIndex]=tTween;tTween._updateEase(tCurrTime);}else{this.event("label",tTweenData.data);}}}}
__proto._animComplete=function(index){var tTween=this._tweenDic[index];if(tTween)delete this._tweenDic[index];}
__proto._complete=function(){this.event("complete");}
__proto.reset=function(){var p;if(this._labelDic){for(p in this._labelDic){delete this._labelDic[p];}};var tTween;for(p in this._tweenDic){tTween=this._tweenDic[p];tTween.clear();delete this._tweenDic[p];}
for(p in this._firstTweenDic){delete this._firstTweenDic[p];}
this._endTweenDataList=null;if(this._tweenDataList&&this._tweenDataList.length){var i=0,len=0;len=this._tweenDataList.length;for(i=0;i<len;i++){if(this._tweenDataList[i])
this._tweenDataList[i].destroy();}}
this._tweenDataList.length=0;this._currTime=0;this._lastTime=0;this._startTime=0;this._index=0;this._gidIndex=0;this.scale=1;Laya.timer.clear(this,this._update);}
__proto.destroy=function(){this.reset();this._labelDic=null;this._tweenDic=null;this._tweenDataList=null;this._firstTweenDic=null;}
__getset(0,__proto,'index',function(){return this._frameIndex;},function(value){this._frameIndex=value;this.gotoTime(this._frameIndex/this._frameRate*1000);});__getset(0,__proto,'total',function(){this._total=Math.floor(this._startTime/1000*this._frameRate);return this._total;});TimeLine.to=function(target,props,duration,ease,offset){(offset===void 0)&&(offset=0);return(new TimeLine()).to(target,props,duration,ease,offset);}
TimeLine.from=function(target,props,duration,ease,offset){(offset===void 0)&&(offset=0);return(new TimeLine()).from(target,props,duration,ease,offset);}
TimeLine.__init$=function(){tweenData=(function(){function tweenData(){this.type=0;this.isTo=true;this.startTime=NaN;this.endTime=NaN;this.target=null;this.duration=NaN;this.ease=null;this.data=null;}
__class(tweenData,'');var __proto=tweenData.prototype;__proto.destroy=function(){this.target=null;this.ease=null;this.data=null;this.isTo=true;this.type=0;Pool.recover("tweenData",this);}
return tweenData;})()}
return TimeLine;})(EventDispatcher)
var Sprite=(function(_super){function Sprite(){this._transform=null;this._tfChanged=false;this._x=0;this._y=0;this._width=0;this._height=0;this._repaint=1;this._mouseEnableState=0;this._zOrder=0;this._graphics=null;this._renderType=0;this._optimizeScrollRect=false;this._texture=null;this.mouseThrough=false;this.autoSize=false;this.hitTestPrior=false;this.viewport=null;Sprite.__super.call(this);this._style=Style.EMPTY;}
__class(Sprite,'laya.display.Sprite',_super);var __proto=Sprite.prototype;Laya.imps(__proto,{"laya.display.ILayout":true})
__proto.createConchModel=function(){return new ConchNode();}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);this._releaseMem();_super.prototype.destroy.call(this,destroyChild);this._style&&this._style.destroy();this._transform&&this._transform.destroy();this._transform=null;this._style=null;this._graphics=null;}
__proto.updateZOrder=function(){Utils.updateOrder(this._childs)&&this.repaint();}
__proto.reCache=function(){if(this._$P.cacheCanvas)this._$P.cacheCanvas.reCache=true;this._repaint=1;}
__proto.setBounds=function(bound){this._set$P("uBounds",bound);}
__proto.getBounds=function(){if(!this._$P.mBounds)this._set$P("mBounds",new Rectangle());return Rectangle._getWrapRec(this._boundPointsToParent(),this._$P.mBounds);}
__proto.getSelfBounds=function(){if(this._$P.uBounds)return this._$P.uBounds;if(!this._$P.mBounds)this._set$P("mBounds",new Rectangle());return Rectangle._getWrapRec(this._getBoundPointsM(false),this._$P.mBounds);}
__proto._boundPointsToParent=function(ifRotate){(ifRotate===void 0)&&(ifRotate=false);var pX=0,pY=0;if(this._style){pX=this._style._tf.translateX;pY=this._style._tf.translateY;ifRotate=ifRotate||(this._style._tf.rotate!==0);if(this._style.scrollRect){pX+=this._style.scrollRect.x;pY+=this._style.scrollRect.y;}};var pList=this._getBoundPointsM(ifRotate);if(!pList||pList.length<1)return pList;if(pList.length!=8){pList=ifRotate?GrahamScan.scanPList(pList):Rectangle._getWrapRec(pList,Rectangle.TEMP)._getBoundPoints();}
if(!this.transform){Utils.transPointList(pList,this._x-pX,this._y-pY);return pList;};var tPoint=Point.TEMP;var i=0,len=pList.length;for(i=0;i<len;i+=2){tPoint.x=pList[i];tPoint.y=pList[i+1];this.toParentPoint(tPoint);pList[i]=tPoint.x;pList[i+1]=tPoint.y;}
return pList;}
__proto.getGraphicBounds=function(realSize){(realSize===void 0)&&(realSize=false);if(!this._graphics)return Rectangle.TEMP.setTo(0,0,0,0);return this._graphics.getBounds(realSize);}
__proto._getBoundPointsM=function(ifRotate){(ifRotate===void 0)&&(ifRotate=false);if(this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(!this._$P.temBM)this._set$P("temBM",[]);if(this.scrollRect){var rst=Utils.clearArray(this._$P.temBM);var rec=Rectangle.TEMP;rec.copyFrom(this.scrollRect);Utils.concatArray(rst,rec._getBoundPoints());return rst;};var pList=this._graphics?this._graphics.getBoundPoints():Utils.clearArray(this._$P.temBM);var child;var cList;var __childs;__childs=this._childs;for(var i=0,n=__childs.length;i<n;i++){child=__childs[i];if((child instanceof laya.display.Sprite)&&child.visible==true){cList=child._boundPointsToParent(ifRotate);if(cList)
pList=pList?Utils.concatArray(pList,cList):cList;}}
return pList;}
__proto.getStyle=function(){this._style===Style.EMPTY&&(this._style=new Style());return this._style;}
__proto.setStyle=function(value){this._style=value;}
__proto._adjustTransform=function(){'use strict';this._tfChanged=false;var style=this._style;var tf=style._tf;var sx=tf.scaleX,sy=tf.scaleY;var m;if(tf.rotate||sx!==1||sy!==1||tf.skewX||tf.skewY){m=this._transform||(this._transform=Matrix.create());m.bTransform=true;var skx=(tf.rotate-tf.skewX)*0.0174532922222222;var sky=(tf.rotate+tf.skewY)*0.0174532922222222;var cx=Math.cos(sky);var ssx=Math.sin(sky);var cy=Math.sin(skx);var ssy=Math.cos(skx);m.a=sx*cx;m.b=sx*ssx;m.c=-sy*cy;m.d=sy*ssy;m.tx=m.ty=0;return m;}else{this._transform&&this._transform.destroy();this._transform=null;this._renderType&=~0x04;}
return m;}
__proto.pos=function(x,y,speedMode){(speedMode===void 0)&&(speedMode=false);if(this._x!==x||this._y!==y){if(this.destroyed)return this;if(speedMode){this._x=x;this._y=y;this.conchModel&&this.conchModel.pos(this._x,this._y);var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}
if(this._$P.maskParent&&this._$P.maskParent._repaint===0){this._$P.maskParent._repaint=1;this._$P.maskParent.parentRepaint();}}else{this.x=x;this.y=y;}}
return this;}
__proto.pivot=function(x,y){this.pivotX=x;this.pivotY=y;return this;}
__proto.size=function(width,height){this.width=width;this.height=height;return this;}
__proto.scale=function(scaleX,scaleY,speedMode){(speedMode===void 0)&&(speedMode=false);var style=this.getStyle();var _tf=style._tf;if(_tf.scaleX!=scaleX||_tf.scaleY!=scaleY){if(this.destroyed)return this;if(speedMode){style.setScale(scaleX,scaleY);this._tfChanged=true;this.conchModel&&this.conchModel.scale(scaleX,scaleY);this._renderType|=0x04;var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}}else{this.scaleX=scaleX;this.scaleY=scaleY;}}
return this;}
__proto.skew=function(skewX,skewY){this.skewX=skewX;this.skewY=skewY;return this;}
__proto.render=function(context,x,y){Stat.spriteCount++;RenderSprite.renders[this._renderType]._fun(this,context,x+this._x,y+this._y);this._repaint=0;}
__proto.drawToCanvas=function(canvasWidth,canvasHeight,offsetX,offsetY){if(Render.isConchNode){var canvas=HTMLCanvas.create("2D");var context=new RenderContext(canvasWidth,canvasHeight,canvas);context.ctx.setCanvasType(1);this.conchModel.drawToCanvas(canvas.source,offsetX,offsetY);return canvas;}else{return RunDriver.drawToCanvas(this,this._renderType,canvasWidth,canvasHeight,offsetX,offsetY);}}
__proto.customRender=function(context,x,y){this._renderType|=0x400;}
__proto._applyFilters=function(){if(Render.isWebGL)return;var _filters;_filters=this._$P.filters;if(!_filters||_filters.length<1)return;for(var i=0,n=_filters.length;i<n;i++){_filters[i].action.apply(this._$P.cacheCanvas);}}
__proto._isHaveGlowFilter=function(){var i=0,len=0;if(this.filters){for(i=0;i<this.filters.length;i++){if(this.filters[i].type==0x08){return true;}}}
for(i=0,len=this._childs.length;i<len;i++){if(this._childs[i]._isHaveGlowFilter()){return true;}}
return false;}
__proto.localToGlobal=function(point,createNewPoint){(createNewPoint===void 0)&&(createNewPoint=false);if(createNewPoint===true){point=new Point(point.x,point.y);};var ele=this;while(ele){if(ele==Laya.stage)break;point=ele.toParentPoint(point);ele=ele.parent;}
return point;}
__proto.globalToLocal=function(point,createNewPoint){(createNewPoint===void 0)&&(createNewPoint=false);if(createNewPoint){point=new Point(point.x,point.y);};var ele=this;var list=[];while(ele){if(ele==Laya.stage)break;list.push(ele);ele=ele.parent;};var i=list.length-1;while(i>=0){ele=list[i];point=ele.fromParentPoint(point);i--;}
return point;}
__proto.toParentPoint=function(point){if(!point)return point;point.x-=this.pivotX;point.y-=this.pivotY;if(this.transform){this._transform.transformPoint(point);}
point.x+=this._x;point.y+=this._y;var scroll=this._style.scrollRect;if(scroll){point.x-=scroll.x;point.y-=scroll.y;}
return point;}
__proto.fromParentPoint=function(point){if(!point)return point;point.x-=this._x;point.y-=this._y;var scroll=this._style.scrollRect;if(scroll){point.x+=scroll.x;point.y+=scroll.y;}
if(this.transform){this._transform.invertTransformPoint(point);}
point.x+=this.pivotX;point.y+=this.pivotY;return point;}
__proto.on=function(type,caller,listener,args){if(this._mouseEnableState!==1&&this.isMouseEvent(type)){this.mouseEnabled=true;this._setBit(0x2,true);if(this._parent){this._$2__onDisplay();}
return this._createListener(type,caller,listener,args,false);}
return _super.prototype.on.call(this,type,caller,listener,args);}
__proto.once=function(type,caller,listener,args){if(this._mouseEnableState!==1&&this.isMouseEvent(type)){this.mouseEnabled=true;this._setBit(0x2,true);if(this._parent){this._$2__onDisplay();}
return this._createListener(type,caller,listener,args,true);}
return _super.prototype.once.call(this,type,caller,listener,args);}
__proto._$2__onDisplay=function(){if(this._mouseEnableState!==1){var ele=this;ele=ele.parent;while(ele&&ele._mouseEnableState!==1){if(ele._getBit(0x2))break;ele.mouseEnabled=true;ele._setBit(0x2,true);ele=ele.parent;}}}
__proto.loadImage=function(url,x,y,width,height,complete){var _$this=this;(x===void 0)&&(x=0);(y===void 0)&&(y=0);(width===void 0)&&(width=0);(height===void 0)&&(height=0);function loaded(tex){if(!_$this.destroyed){_$this.size(x+(width||tex.width),y+(height||tex.height));_$this.repaint();complete&&complete.runWith(tex);}}
this.graphics.loadImage(url,x,y,width,height,loaded);return this;}
__proto.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint();if(this._repaint===0){this._repaint=1;this.parentRepaint();}
if(this._$P&&this._$P.maskParent){this._$P.maskParent.repaint();}}
__proto._needRepaint=function(){return(this._repaint!==0)&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache;}
__proto._childChanged=function(child){if(this._childs.length)this._renderType|=0x800;else this._renderType&=~0x800;if(child&&this._get$P("hasZorder"))Laya.timer.callLater(this,this.updateZOrder);this.repaint();}
__proto.parentRepaint=function(){var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}}
__proto.startDrag=function(area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio){(hasInertia===void 0)&&(hasInertia=false);(elasticDistance===void 0)&&(elasticDistance=0);(elasticBackTime===void 0)&&(elasticBackTime=300);(disableMouseEvent===void 0)&&(disableMouseEvent=false);(ratio===void 0)&&(ratio=0.92);this._$P.dragging||(this._set$P("dragging",new Dragging()));this._$P.dragging.start(this,area,hasInertia,elasticDistance,elasticBackTime,data,disableMouseEvent,ratio);}
__proto.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop();}
__proto._releaseMem=function(){if(!this._$P)return;var cc=this._$P.cacheCanvas;if(cc&&cc.ctx){Pool.recover("RenderContext",cc.ctx);cc.ctx.canvas.size(0,0);cc.ctx=null;};var fc=this._$P._filterCache;if(fc){fc.destroy();fc.recycle();this._set$P('_filterCache',null);}
this._$P._isHaveGlowFilter&&this._set$P('_isHaveGlowFilter',false);this._$P._isHaveGlowFilter=null;}
__proto._setDisplay=function(value){if(!value)this._releaseMem();_super.prototype._setDisplay.call(this,value);}
__proto.hitTestPoint=function(x,y){var point=this.globalToLocal(Point.TEMP.setTo(x,y));x=point.x;y=point.y;var rect=this._$P.hitArea?this._$P.hitArea:(this._width>0&&this._height>0)?Rectangle.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds();return rect.contains(x,y);}
__proto.getMousePoint=function(){return this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY));}
__proto._getWords=function(){return null;}
__proto._addChildsToLayout=function(out){var words=this._getWords();if(words==null&&this._childs.length==0)return false;if(words){for(var i=0,n=words.length;i<n;i++){out.push(words[i]);}}
this._childs.forEach(function(o,index,array){o._style._enableLayout()&&o._addToLayout(out);});return true;}
__proto._addToLayout=function(out){if(this._style.absolute)return;this._style.block?out.push(this):(this._addChildsToLayout(out)&&(this.x=this.y=0));}
__proto._isChar=function(){return false;}
__proto._getCSSStyle=function(){return this._style.getCSSStyle();}
__proto._setAttributes=function(name,value){switch(name){case'x':this.x=parseFloat(value);break;case'y':this.y=parseFloat(value);break;case'width':this.width=parseFloat(value);break;case'height':this.height=parseFloat(value);break;default:this[name]=value;}}
__proto._layoutLater=function(){this.parent&&(this.parent)._layoutLater();}
__getset(0,__proto,'optimizeScrollRect',function(){return this._optimizeScrollRect;},function(b){if(this._optimizeScrollRect!=b){this._optimizeScrollRect=b;this.conchModel&&this.conchModel.optimizeScrollRect(b);}});__getset(0,__proto,'customRenderEnable',null,function(b){if(b){this._renderType|=0x400;if(Render.isConchNode){Sprite.CustomList.push(this);var canvas=new HTMLCanvas("2d");canvas._setContext(new CanvasRenderingContext2D());this.customContext=new RenderContext(0,0,canvas);canvas.context.setCanvasType&&canvas.context.setCanvasType(2);this.conchModel.custom(canvas.context);}}});__getset(0,__proto,'cacheAsBitmap',function(){return this.cacheAs!=="none";},function(value){this.cacheAs=value?(this._$P["hasFilter"]?"none":"normal"):"none";});__getset(0,__proto,'cacheAs',function(){return this._$P.cacheCanvas==null?"none":this._$P.cacheCanvas.type;},function(value){var cacheCanvas=this._$P.cacheCanvas;if(value===(cacheCanvas?cacheCanvas.type:"none"))return;if(value!=="none"){if(!this._getBit(0x1))this._setUpNoticeType(0x1);cacheCanvas||(cacheCanvas=this._set$P("cacheCanvas",Pool.getItemByClass("cacheCanvas",Object)));cacheCanvas.type=value;cacheCanvas.reCache=true;this._renderType|=0x10;if(value=="bitmap")this.conchModel&&this.conchModel.cacheAs(1);this._set$P("cacheForFilters",false);}else{if(this._$P["hasFilter"]){this._set$P("cacheForFilters",true);}else{if(cacheCanvas){var cc=cacheCanvas;if(cc&&cc.ctx){Pool.recover("RenderContext",cc.ctx);cc.ctx.canvas.size(0,0);cc.ctx=null;}
Pool.recover("cacheCanvas",cacheCanvas);}
this._$P.cacheCanvas=null;this._renderType&=~0x10;this.conchModel&&this.conchModel.cacheAs(0);}}
this.repaint();});__getset(0,__proto,'zOrder',function(){return this._zOrder;},function(value){if(this._zOrder!=value){this._zOrder=value;this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(value);if(this._parent){value&&this._parent._set$P("hasZorder",true);Laya.timer.callLater(this._parent,this.updateZOrder);}}});__getset(0,__proto,'rotation',function(){return this._style._tf.rotate;},function(value){var style=this.getStyle();if(style._tf.rotate!==value){style.setRotate(value);this._tfChanged=true;this.conchModel&&this.conchModel.rotate(value);this._renderType|=0x04;var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}}});__getset(0,__proto,'width',function(){if(!this.autoSize)return this._width;return this.getSelfBounds().width;},function(value){if(this._width!==value){this._width=value;this.conchModel&&this.conchModel.size(value,this._height)
this.repaint();}});__getset(0,__proto,'x',function(){return this._x;},function(value){if(this._x!==value){if(this.destroyed)return;this._x=value;this.conchModel&&this.conchModel.pos(value,this._y);var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}
if(this._$P.maskParent&&this._$P.maskParent._repaint===0){this._$P.maskParent._repaint=1;this._$P.maskParent.parentRepaint();}}});__getset(0,__proto,'globalScaleY',function(){var scale=1;var ele=this;while(ele){if(ele===Laya.stage)break;scale*=ele.scaleY;ele=ele.parent;}
return scale;});__getset(0,__proto,'hitArea',function(){return this._$P.hitArea;},function(value){this._set$P("hitArea",value);});__getset(0,__proto,'staticCache',function(){return this._$P.staticCache;},function(value){this._set$P("staticCache",value);if(!value)this.reCache();});__getset(0,__proto,'texture',function(){return this._texture;},function(value){if(this._texture!=value){this._texture=value;this.graphics.cleanByTexture(value,0,0);}});__getset(0,__proto,'y',function(){return this._y;},function(value){if(this._y!==value){if(this.destroyed)return;this._y=value;this.conchModel&&this.conchModel.pos(this._x,value);var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}
if(this._$P.maskParent&&this._$P.maskParent._repaint===0){this._$P.maskParent._repaint=1;this._$P.maskParent.parentRepaint();}}});__getset(0,__proto,'height',function(){if(!this.autoSize)return this._height;return this.getSelfBounds().height;},function(value){if(this._height!==value){this._height=value;this.conchModel&&this.conchModel.size(this._width,value);this.repaint();}});__getset(0,__proto,'blendMode',function(){return this._style.blendMode;},function(value){this.getStyle().blendMode=value;this.conchModel&&this.conchModel.blendMode(value);if(value&&value!="source-over")this._renderType|=0x08;else this._renderType&=~0x08;this.parentRepaint();});__getset(0,__proto,'scaleX',function(){return this._style._tf.scaleX;},function(value){var style=this.getStyle();if(style._tf.scaleX!==value){style.setScaleX(value);this._tfChanged=true;this.conchModel&&this.conchModel.scale(value,style._tf.scaleY);this._renderType|=0x04;var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}}});__getset(0,__proto,'scaleY',function(){return this._style._tf.scaleY;},function(value){var style=this.getStyle();if(style._tf.scaleY!==value){style.setScaleY(value);this._tfChanged=true;this.conchModel&&this.conchModel.scale(style._tf.scaleX,value);this._renderType|=0x04;var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}}});__getset(0,__proto,'stage',function(){return Laya.stage;});__getset(0,__proto,'skewX',function(){return this._style._tf.skewX;},function(value){var style=this.getStyle();if(style._tf.skewX!==value){style.setSkewX(value);this._tfChanged=true;this.conchModel&&this.conchModel.skew(value,style._tf.skewY);this._renderType|=0x04;var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}}});__getset(0,__proto,'scrollRect',function(){return this._style.scrollRect;},function(value){this.getStyle().scrollRect=value;this.repaint();if(value){this._renderType|=0x80;this.conchModel&&this.conchModel.scrollRect(value.x,value.y,value.width,value.height);}else{this._renderType&=~0x80;if(this.conchModel){if(Sprite.RUNTIMEVERION<"0.9.1")
this.conchModel.removeType(0x40);else
this.conchModel.removeType(0x80);}}});__getset(0,__proto,'skewY',function(){return this._style._tf.skewY;},function(value){var style=this.getStyle();if(style._tf.skewY!==value){style.setSkewY(value);this._tfChanged=true;this.conchModel&&this.conchModel.skew(style._tf.skewX,value);this._renderType|=0x04;var p=this._parent;if(p&&p._repaint===0){p._repaint=1;p.parentRepaint();}}});__getset(0,__proto,'transform',function(){return this._tfChanged?this._adjustTransform():this._transform;},function(value){this._tfChanged=false;this._transform=value;if(value){this._x=value.tx;this._y=value.ty;value.tx=value.ty=0;this.conchModel&&this.conchModel.transform(value.a,value.b,value.c,value.d,this._x,this._y);}
if(value)this._renderType|=0x04;else{this._renderType&=~0x04;this.conchModel&&this.conchModel.removeType(0x04);}
this.parentRepaint();});__getset(0,__proto,'pivotX',function(){return this._style._tf.translateX;},function(value){this.getStyle().setTranslateX(value);this.conchModel&&this.conchModel.pivot(value,this._style._tf.translateY);this.repaint();});__getset(0,__proto,'pivotY',function(){return this._style._tf.translateY;},function(value){this.getStyle().setTranslateY(value);this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,value);this.repaint();});__getset(0,__proto,'alpha',function(){return this._style.alpha;},function(value){if(this._style&&this._style.alpha!==value){value=value<0?0:(value>1?1:value);this.getStyle().alpha=value;this.conchModel&&this.conchModel.alpha(value);if(value!==1)this._renderType|=0x02;else this._renderType&=~0x02;this.parentRepaint();}});__getset(0,__proto,'visible',function(){return this._style.visible;},function(value){if(this._style&&this._style.visible!==value){this.getStyle().visible=value;this.conchModel&&this.conchModel.visible(value);this.parentRepaint();}});__getset(0,__proto,'graphics',function(){return this._graphics||(this.graphics=RunDriver.createGraphics());},function(value){if(this._graphics)this._graphics._sp=null;this._graphics=value;if(value){this._renderType&=~0x01;this._renderType|=0x200;value._sp=this;this.conchModel&&this.conchModel.graphics(this._graphics);}else{this._renderType&=~0x200;this._renderType&=~0x01;if(this.conchModel){if(Sprite.RUNTIMEVERION<"0.9.1")
this.conchModel.removeType(0x100);else
this.conchModel.removeType(0x200);}}
this.repaint();});__getset(0,__proto,'filters',function(){return this._$P.filters;},function(value){value&&value.length===0&&(value=null);if(this._$P.filters==value)return;this._set$P("filters",value?value.slice():null);if(Render.isConchApp){if(this.conchModel){if(Sprite.RUNTIMEVERION<"0.9.1")
this.conchModel.removeType(0x10);else
this.conchModel.removeType(0x20);}
if(this._$P.filters&&this._$P.filters.length==1){this._$P.filters[0].callNative(this);}}
if(Render.isWebGL){if(value&&value.length){this._renderType|=0x20;}else{this._renderType&=~0x20;}}
if(value&&value.length>0){if(!this._getBit(0x1))this._setUpNoticeType(0x1);if(!(Render.isWebGL&&value.length==1&&(((value[0])instanceof laya.filters.ColorFilter)))){if(this.cacheAs!="bitmap"){if(!Render.isConchNode)this.cacheAs="bitmap";this._set$P("cacheForFilters",true);}
this._set$P("hasFilter",true);}}else{this._set$P("hasFilter",false);if(this._$P["cacheForFilters"]&&this.cacheAs=="bitmap"){this.cacheAs="none";}}
this.repaint();});__getset(0,__proto,'parent',_super.prototype._$get_parent,function(value){Laya.superSet(Node,this,'parent',value);if(value&&this._getBit(0x2)){this._$2__onDisplay();}});__getset(0,__proto,'mask',function(){return this._$P._mask;},function(value){if(value&&this.mask&&this.mask._$P.maskParent)return;if(value){this.cacheAs="bitmap";this._set$P("_mask",value);value._set$P("maskParent",this);}else{this.cacheAs="none";this.mask&&this.mask._set$P("maskParent",null);this._set$P("_mask",value);}
this.conchModel&&this.conchModel.mask(value?value.conchModel:null);this._renderType|=0x40;this.parentRepaint();});__getset(0,__proto,'mouseEnabled',function(){return this._mouseEnableState>1;},function(value){this._mouseEnableState=value?2:1;});__getset(0,__proto,'globalScaleX',function(){var scale=1;var ele=this;while(ele){if(ele===Laya.stage)break;scale*=ele.scaleX;ele=ele.parent;}
return scale;});__getset(0,__proto,'mouseX',function(){return this.getMousePoint().x;});__getset(0,__proto,'mouseY',function(){return this.getMousePoint().y;});Sprite.fromImage=function(url){return new Sprite().loadImage(url);}
Sprite.CustomList=[];__static(Sprite,['RUNTIMEVERION',function(){return this.RUNTIMEVERION=window.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf('-')+1):'';}]);return Sprite;})(Node)
var AudioSoundChannel=(function(_super){function AudioSoundChannel(audio){this._audio=null;this._onEnd=null;this._resumePlay=null;AudioSoundChannel.__super.call(this);this._onEnd=Utils.bind(this.__onEnd,this);this._resumePlay=Utils.bind(this.__resumePlay,this);audio.addEventListener("ended",this._onEnd);this._audio=audio;}
__class(AudioSoundChannel,'laya.media.h5audio.AudioSoundChannel',_super);var __proto=AudioSoundChannel.prototype;__proto.__onEnd=function(){if(this.loops==1){if(this.completeHandler){Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],false);this.completeHandler=null;}
this.stop();this.event("complete");return;}
if(this.loops>0){this.loops--;}
this.startTime=0;this.play();}
__proto.__resumePlay=function(){if(this._audio)this._audio.removeEventListener("canplay",this._resumePlay);try{this._audio.currentTime=this.startTime;Browser.container.appendChild(this._audio);this._audio.play();}catch(e){this.event("error");}}
__proto.play=function(){this.isStopped=false;try{this._audio.playbackRate=SoundManager.playbackRate;this._audio.currentTime=this.startTime;}catch(e){this._audio.addEventListener("canplay",this._resumePlay);return;}
SoundManager.addChannel(this);Browser.container.appendChild(this._audio);if("play"in this._audio)
this._audio.play();}
__proto.stop=function(){this.isStopped=true;SoundManager.removeChannel(this);this.completeHandler=null;if(!this._audio)
return;if("pause"in this._audio)
if(Render.isConchApp){this._audio.stop();}
this._audio.pause();this._audio.removeEventListener("ended",this._onEnd);this._audio.removeEventListener("canplay",this._resumePlay);if(!Browser.onIE){if(this._audio!=AudioSound._musicAudio){Pool.recover("audio:"+this.url,this._audio);}}
Browser.removeElement(this._audio);this._audio=null;}
__proto.pause=function(){this.isStopped=true;SoundManager.removeChannel(this);if("pause"in this._audio)
this._audio.pause();}
__proto.resume=function(){if(!this._audio)
return;this.isStopped=false;SoundManager.addChannel(this);if("play"in this._audio)
this._audio.play();}
__getset(0,__proto,'position',function(){if(!this._audio)
return 0;return this._audio.currentTime;});__getset(0,__proto,'duration',function(){if(!this._audio)
return 0;return this._audio.duration;});__getset(0,__proto,'volume',function(){if(!this._audio)return 1;return this._audio.volume;},function(v){if(!this._audio)return;this._audio.volume=v;});return AudioSoundChannel;})(SoundChannel)
var WebAudioSoundChannel=(function(_super){function WebAudioSoundChannel(){this.audioBuffer=null;this.gain=null;this.bufferSource=null;this._currentTime=0;this._volume=1;this._startTime=0;this._pauseTime=0;this._onPlayEnd=null;this.context=WebAudioSound.ctx;WebAudioSoundChannel.__super.call(this);this._onPlayEnd=Utils.bind(this.__onPlayEnd,this);if(this.context["createGain"]){this.gain=this.context["createGain"]();}else{this.gain=this.context["createGainNode"]();}}
__class(WebAudioSoundChannel,'laya.media.webaudio.WebAudioSoundChannel',_super);var __proto=WebAudioSoundChannel.prototype;__proto.play=function(){SoundManager.addChannel(this);this.isStopped=false;this._clearBufferSource();if(!this.audioBuffer)return;var context=this.context;var gain=this.gain;var bufferSource=context.createBufferSource();this.bufferSource=bufferSource;bufferSource.buffer=this.audioBuffer;bufferSource.connect(gain);if(gain)
gain.disconnect();gain.connect(context.destination);bufferSource.onended=this._onPlayEnd;if(this.startTime>=this.duration)this.startTime=0;this._startTime=Browser.now();this.gain.gain.value=this._volume;if(this.loops==0){bufferSource.loop=true;}
bufferSource.playbackRate.value=SoundManager.playbackRate;bufferSource.start(0,this.startTime);this._currentTime=0;}
__proto.__onPlayEnd=function(){if(this.loops==1){if(this.completeHandler){Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],false);this.completeHandler=null;}
this.stop();this.event("complete");return;}
if(this.loops>0){this.loops--;}
this.startTime=0;this.play();}
__proto._clearBufferSource=function(){if(this.bufferSource){var sourceNode=this.bufferSource;if(sourceNode.stop){sourceNode.stop(0);}else{sourceNode.noteOff(0);}
sourceNode.disconnect(0);sourceNode.onended=null;if(!WebAudioSoundChannel._tryCleanFailed)this._tryClearBuffer(sourceNode);this.bufferSource=null;}}
__proto._tryClearBuffer=function(sourceNode){}
__proto.stop=function(){this._clearBufferSource();this.audioBuffer=null;if(this.gain)
this.gain.disconnect();this.isStopped=true;SoundManager.removeChannel(this);this.completeHandler=null;if(SoundManager.autoReleaseSound)
Laya.timer.once(5000,null,SoundManager.disposeSoundIfNotUsed,[this.url],false);}
__proto.pause=function(){if(!this.isStopped){this._pauseTime=this.position;}
this._clearBufferSource();if(this.gain)
this.gain.disconnect();this.isStopped=true;SoundManager.removeChannel(this);if(SoundManager.autoReleaseSound)
Laya.timer.once(5000,null,SoundManager.disposeSoundIfNotUsed,[this.url],false);}
__proto.resume=function(){this.startTime=this._pauseTime;this.play();}
__getset(0,__proto,'position',function(){if(this.bufferSource){return(Browser.now()-this._startTime)/1000+this.startTime;}
return 0;});__getset(0,__proto,'duration',function(){if(this.audioBuffer){return this.audioBuffer.duration;}
return 0;});__getset(0,__proto,'volume',function(){return this._volume;},function(v){if(this.isStopped){return;}
this._volume=v;this.gain.gain.value=v;});WebAudioSoundChannel._tryCleanFailed=false;return WebAudioSoundChannel;})(SoundChannel)
var Bitmap=(function(_super){function Bitmap(){Bitmap.__super.call(this);this._w=0;this._h=0;}
__class(Bitmap,'laya.resource.Bitmap',_super);var __proto=Bitmap.prototype;__getset(0,__proto,'width',function(){return this._w;});__getset(0,__proto,'height',function(){return this._h;});__getset(0,__proto,'source',function(){return this._source;});return Bitmap;})(Resource)
var AnimationPlayerBase=(function(_super){function AnimationPlayerBase(){this.loop=false;this.wrapMode=0;this._index=0;this._count=0;this._isPlaying=false;this._labels=null;this._isReverse=false;this._frameRateChanged=false;this._controlNode=null;this._actionName=null;AnimationPlayerBase.__super.call(this);this._interval=Config.animationInterval;this._setUpNoticeType(0x1);}
__class(AnimationPlayerBase,'laya.display.AnimationPlayerBase',_super);var __proto=AnimationPlayerBase.prototype;__proto.play=function(start,loop,name,showWarn){(start===void 0)&&(start=0);(loop===void 0)&&(loop=true);(name===void 0)&&(name="");(showWarn===void 0)&&(showWarn=true);this._isPlaying=true;this.index=((typeof start=='string'))?this._getFrameByLabel(start):start;this.loop=loop;this._actionName=name;this._isReverse=this.wrapMode==1;if(this.interval>0){this.timerLoop(this.interval,this,this._frameLoop,null,true,true);}}
__proto._getFrameByLabel=function(label){var i=0;for(i=0;i<this._count;i++){if(this._labels[i]&&(this._labels[i]).indexOf(label)>=0)return i;}
return 0;}
__proto._frameLoop=function(){if(this._isReverse){this._index--;if(this._index<0){if(this.loop){if(this.wrapMode==2){this._index=this._count>0?1:0;this._isReverse=false;}else{this._index=this._count-1;}
this.event("complete");}else{this._index=0;this.stop();this.event("complete");return;}}}else{this._index++;if(this._index>=this._count){if(this.loop){if(this.wrapMode==2){this._index=this._count-2>=0?this._count-2:0;this._isReverse=true;}else{this._index=0;}
this.event("complete");}else{this._index--;this.stop();this.event("complete");return;}}}
this.index=this._index;}
__proto._setControlNode=function(node){if(this._controlNode){this._controlNode.off("display",this,this._checkResumePlaying);this._controlNode.off("undisplay",this,this._checkResumePlaying);}
this._controlNode=node;if(node&&node!=this){node.on("display",this,this._checkResumePlaying);node.on("undisplay",this,this._checkResumePlaying);}}
__proto._setDisplay=function(value){_super.prototype._setDisplay.call(this,value);this._checkResumePlaying();}
__proto._checkResumePlaying=function(){if(this._isPlaying){if(this._controlNode.displayedInStage)this.play(this._index,this.loop,this._actionName);else this.clearTimer(this,this._frameLoop);}}
__proto.stop=function(){this._isPlaying=false;this.clearTimer(this,this._frameLoop);}
__proto.addLabel=function(label,index){if(!this._labels)this._labels={};if(!this._labels[index])this._labels[index]=[];this._labels[index].push(label);}
__proto.removeLabel=function(label){if(!label)this._labels=null;else if(this._labels){for(var name in this._labels){this._removeLabelFromLabelList(this._labels[name],label);}}}
__proto._removeLabelFromLabelList=function(list,label){if(!list)return;for(var i=list.length-1;i>=0;i--){if(list[i]==label){list.splice(i,1);}}}
__proto.gotoAndStop=function(position){this.index=((typeof position=='string'))?this._getFrameByLabel(position):position;this.stop();}
__proto._displayToIndex=function(value){}
__proto.clear=function(){this.stop();this._labels=null;}
__getset(0,__proto,'interval',function(){return this._interval;},function(value){if(this._interval!=value){this._frameRateChanged=true;this._interval=value;if(this._isPlaying&&value>0){this.timerLoop(value,this,this._frameLoop,null,true,true);}}});__getset(0,__proto,'isPlaying',function(){return this._isPlaying;});__getset(0,__proto,'index',function(){return this._index;},function(value){this._index=value;this._displayToIndex(value);if(this._labels&&this._labels[value]){var tArr=this._labels[value];for(var i=0,len=tArr.length;i<len;i++){this.event("label",tArr[i]);}}});__getset(0,__proto,'count',function(){return this._count;});AnimationPlayerBase.WRAP_POSITIVE=0;AnimationPlayerBase.WRAP_REVERSE=1;AnimationPlayerBase.WRAP_PINGPONG=2;return AnimationPlayerBase;})(Sprite)
var Text=(function(_super){function Text(){this._clipPoint=null;this._currBitmapFont=null;this._text=null;this._isChanged=false;this._textWidth=0;this._textHeight=0;this._lines=[];this._lineWidths=[];this._startX=NaN;this._startY=NaN;this._lastVisibleLineIndex=-1;this._words=null;this._charSize={};this.underline=false;this._underlineColor=null;Text.__super.call(this);this.overflow=Text.VISIBLE;this._style=new CSSStyle(this);(this._style).wordWrap=false;}
__class(Text,'laya.display.Text',_super);var __proto=Text.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._lines=null;if(this._words){this._words.length=0;this._words=null;}}
__proto._getBoundPointsM=function(ifRotate){(ifRotate===void 0)&&(ifRotate=false);var rec=Rectangle.TEMP;rec.setTo(0,0,this.width,this.height);return rec._getBoundPoints();}
__proto.getGraphicBounds=function(realSize){(realSize===void 0)&&(realSize=false);var rec=Rectangle.TEMP;rec.setTo(0,0,this.width,this.height);return rec;}
__proto._getCSSStyle=function(){return this._style;}
__proto.lang=function(text,arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10){text=Text.langPacks&&Text.langPacks[text]?Text.langPacks[text]:text;if(arguments.length<2){this._text=text;}else{for(var i=0,n=arguments.length;i<n;i++){text=text.replace("{"+i+"}",arguments[i+1]);}
this._text=text;}}
__proto._isPassWordMode=function(){var style=this._style;var password=style.password;if(("prompt"in this)&&this['prompt']==this._text)
password=false;return password;}
__proto._getPassWordTxt=function(txt){var len=txt.length;var word;word="";for(var j=len;j>0;j--){word+="●";}
return word;}
__proto.renderText=function(begin,visibleLineCount){var graphics=this.graphics;graphics.clear(true);var ctxFont=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Browser.onIPhone?(laya.display.Text._fontFamilyMap[this.font]||this.font):this.font);Browser.context.font=ctxFont;var padding=this.padding;var startX=padding[3];var textAlgin="left";var lines=this._lines;var lineHeight=this.leading+this._charSize.height;var tCurrBitmapFont=this._currBitmapFont;if(tCurrBitmapFont){lineHeight=this.leading+tCurrBitmapFont.getMaxHeight();};var startY=padding[0];if((!tCurrBitmapFont)&&this._width>0&&this._textWidth<=this._width){if(this.align=="right"){textAlgin="right";startX=this._width-padding[1];}else if(this.align=="center"){textAlgin="center";startX=this._width*0.5+padding[3]-padding[1];}}
if(this._height>0){var tempVAlign=(this._textHeight>this._height)?"top":this.valign;if(tempVAlign==="middle")
startY=(this._height-visibleLineCount*lineHeight)*0.5+padding[0]-padding[2];else if(tempVAlign==="bottom")
startY=this._height-visibleLineCount*lineHeight-padding[2];};var style=this._style;if(tCurrBitmapFont&&tCurrBitmapFont.autoScaleSize){var bitmapScale=tCurrBitmapFont.fontSize/this.fontSize;}
if(this._clipPoint){graphics.save();if(tCurrBitmapFont&&tCurrBitmapFont.autoScaleSize){var tClipWidth=0;var tClipHeight=0;this._width?tClipWidth=(this._width-padding[3]-padding[1]):tClipWidth=this._textWidth;this._height?tClipHeight=(this._height-padding[0]-padding[2]):tClipHeight=this._textHeight;tClipWidth*=bitmapScale;tClipHeight*=bitmapScale;graphics.clipRect(padding[3],padding[0],tClipWidth,tClipHeight);}else{graphics.clipRect(padding[3],padding[0],this._width?(this._width-padding[3]-padding[1]):this._textWidth,this._height?(this._height-padding[0]-padding[2]):this._textHeight);}};var password=style.password;if(("prompt"in this)&&this['prompt']==this._text)
password=false;var x=0,y=0;var end=Math.min(this._lines.length,visibleLineCount+begin)||1;for(var i=begin;i<end;i++){var word=lines[i];var _word;if(password){var len=word.length;word="";for(var j=len;j>0;j--){word+="●";}}
x=startX-(this._clipPoint?this._clipPoint.x:0);y=startY+lineHeight*i-(this._clipPoint?this._clipPoint.y:0);this.underline&&this.drawUnderline(textAlgin,x,y,i);if(tCurrBitmapFont){var tWidth=this.width;if(tCurrBitmapFont.autoScaleSize){tWidth=this.width*bitmapScale;}
tCurrBitmapFont.drawText(word,this,x,y,this.align,tWidth);}else{if(Render.isWebGL){this._words||(this._words=[]);_word=this._words.length>(i-begin)?this._words[i-begin]:new WordText();_word.setText(word);}else{_word=word;}
style.stroke?graphics.fillBorderText(_word,x,y,ctxFont,this.color,style.strokeColor,style.stroke,textAlgin):graphics.fillText(_word,x,y,ctxFont,this.color,textAlgin);}}
if(tCurrBitmapFont&&tCurrBitmapFont.autoScaleSize){var tScale=1/bitmapScale;this.scale(tScale,tScale);}
if(this._clipPoint)
graphics.restore();this._startX=startX;this._startY=startY;}
__proto.drawUnderline=function(align,x,y,lineIndex){var lineWidth=this._lineWidths[lineIndex];switch(align){case'center':x-=lineWidth/2;break;case'right':x-=lineWidth;break;case'left':default:break;}
y+=this._charSize.height;this._graphics.drawLine(x,y,x+lineWidth,y,this.underlineColor||this.color,1);}
__proto.typeset=function(){this._isChanged=false;if(!this._text){this._clipPoint=null;this._textWidth=this._textHeight=0;this.graphics.clear(true);return;}
Browser.context.font=this._getCSSStyle().font;this._lines.length=0;this._lineWidths.length=0;if(this._isPassWordMode()){this.parseLines(this._getPassWordTxt(this._text));}else
this.parseLines(this._text);this.evalTextSize();if(this.checkEnabledViewportOrNot())
this._clipPoint||(this._clipPoint=new Point(0,0));else
this._clipPoint=null;var lineCount=this._lines.length;if(this.overflow!=Text.VISIBLE){var func=this.overflow==Text.HIDDEN?Math.floor:Math.ceil;lineCount=Math.min(lineCount,func((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)));};var startLine=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(startLine,lineCount);this.repaint();}
__proto.evalTextSize=function(){var nw=NaN,nh=NaN;nw=Math.max.apply(this,this._lineWidths);if(this._currBitmapFont)
nh=this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2];else
nh=this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2];if(nw!=this._textWidth||nh!=this._textHeight){this._textWidth=nw;this._textHeight=nh;if(!this._width||!this._height)
this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight);}}
__proto.checkEnabledViewportOrNot=function(){return this.overflow==Text.SCROLL&&((this._width>0&&this._textWidth>this._width)||(this._height>0&&this._textHeight>this._height));}
__proto.changeText=function(text){if(this._text!==text){this.lang(text+"");if(this._graphics&&this._graphics.replaceText(this._text)){}else{this.typeset();}}}
__proto.parseLines=function(text){var needWordWrapOrTruncate=this.wordWrap||this.overflow==Text.HIDDEN;if(needWordWrapOrTruncate){var wordWrapWidth=this.getWordWrapWidth();}
if(this._currBitmapFont){this._charSize.width=this._currBitmapFont.getMaxWidth();this._charSize.height=this._currBitmapFont.getMaxHeight();}else{var measureResult=Browser.context.measureText(Text._testWord);this._charSize.width=measureResult.width;this._charSize.height=(measureResult.height||this.fontSize);};var lines=text.replace(/\r\n/g,"\n").split("\n");for(var i=0,n=lines.length;i<n;i++){var line=lines[i];if(needWordWrapOrTruncate)
this.parseLine(line,wordWrapWidth);else{this._lineWidths.push(this.getTextWidth(line));this._lines.push(line);}}}
__proto.parseLine=function(line,wordWrapWidth){var ctx=Browser.context;var lines=this._lines;var maybeIndex=0;var execResult;var charsWidth=NaN;var wordWidth=NaN;var startIndex=0;charsWidth=this.getTextWidth(line);if(charsWidth<=wordWrapWidth){lines.push(line);this._lineWidths.push(charsWidth);return;}
charsWidth=this._charSize.width;maybeIndex=Math.floor(wordWrapWidth/charsWidth);(maybeIndex==0)&&(maybeIndex=1);charsWidth=this.getTextWidth(line.substring(0,maybeIndex));wordWidth=charsWidth;for(var j=maybeIndex,m=line.length;j<m;j++){charsWidth=this.getTextWidth(line.charAt(j));wordWidth+=charsWidth;if(wordWidth>wordWrapWidth){if(this.wordWrap){var newLine=line.substring(startIndex,j);if(newLine.charCodeAt(newLine.length-1)<255){execResult=/(?:\w|-)+$/.exec(newLine);if(execResult){j=execResult.index+startIndex;if(execResult.index==0)
j+=newLine.length;else
newLine=line.substring(startIndex,j);}}else
if(Text.RightToLeft){execResult=/([\u0600-\u06FF])+$/.exec(newLine);if(execResult){j=execResult.index+startIndex;if(execResult.index==0)
j+=newLine.length;else
newLine=line.substring(startIndex,j);}}
lines.push(newLine);this._lineWidths.push(wordWidth-charsWidth);startIndex=j;if(j+maybeIndex<m){j+=maybeIndex;charsWidth=this.getTextWidth(line.substring(startIndex,j));wordWidth=charsWidth;j--;}else{lines.push(line.substring(startIndex,m));this._lineWidths.push(this.getTextWidth(lines[lines.length-1]));startIndex=-1;break;}}else if(this.overflow==Text.HIDDEN){lines.push(line.substring(0,j));this._lineWidths.push(this.getTextWidth(lines[lines.length-1]));return;}}}
if(this.wordWrap&&startIndex!=-1){lines.push(line.substring(startIndex,m));this._lineWidths.push(this.getTextWidth(lines[lines.length-1]));}}
__proto.getTextWidth=function(text){if(this._currBitmapFont)
return this._currBitmapFont.getTextWidth(text);else
return Browser.context.measureText(text).width;}
__proto.getWordWrapWidth=function(){var p=this.padding;var w=NaN;if(this._currBitmapFont&&this._currBitmapFont.autoScaleSize)
w=this._width*(this._currBitmapFont.fontSize/this.fontSize);else
w=this._width;if(w<=0){w=this.wordWrap?100:Browser.width;}
w<=0&&(w=100);return w-p[3]-p[1];}
__proto.getCharPoint=function(charIndex,out){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);var len=0,lines=this._lines,startIndex=0;for(var i=0,n=lines.length;i<n;i++){len+=lines[i].length;if(charIndex<len){var line=i;break;}
startIndex=len;};var ctxFont=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.context.font=ctxFont;var width=this.getTextWidth(this._text.substring(startIndex,charIndex));var point=out||new Point();return point.setTo(this._startX+width-(this._clipPoint?this._clipPoint.x:0),this._startY+line*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0));}
__getset(0,__proto,'width',function(){if(this._width)
return this._width;return this.textWidth+this.padding[1]+this.padding[3];},function(value){if(value!=this._width){Laya.superSet(Sprite,this,'width',value);this.isChanged=true;}});__getset(0,__proto,'textWidth',function(){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);return this._textWidth;});__getset(0,__proto,'height',function(){if(this._height)return this._height;return this.textHeight+this.padding[0]+this.padding[2];},function(value){if(value!=this._height){Laya.superSet(Sprite,this,'height',value);this.isChanged=true;}});__getset(0,__proto,'textHeight',function(){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);return this._textHeight;});__getset(0,__proto,'padding',function(){return this._getCSSStyle().padding;},function(value){this._getCSSStyle().padding=value;this.isChanged=true;});__getset(0,__proto,'bold',function(){return this._getCSSStyle().bold;},function(value){this._getCSSStyle().bold=value;this.isChanged=true;});__getset(0,__proto,'text',function(){return this._text||"";},function(value){if(this._text!==value){this.lang(value+"");this.isChanged=true;this.event("change");}});__getset(0,__proto,'color',function(){return this._getCSSStyle().color;},function(value){if(this._getCSSStyle().color!=value){this._getCSSStyle().color=value;if(!this._isChanged&&this._graphics){this._graphics.replaceTextColor(this.color)}else{this.isChanged=true;}}});__getset(0,__proto,'font',function(){return this._getCSSStyle().fontFamily;},function(value){if(this._currBitmapFont){this._currBitmapFont=null;this.scale(1,1);}
if(Text._bitmapFonts&&Text._bitmapFonts[value]){this._currBitmapFont=Text._bitmapFonts[value];}
this._getCSSStyle().fontFamily=value;this.isChanged=true;});__getset(0,__proto,'fontSize',function(){return this._getCSSStyle().fontSize;},function(value){this._getCSSStyle().fontSize=value;this.isChanged=true;});__getset(0,__proto,'italic',function(){return this._getCSSStyle().italic;},function(value){this._getCSSStyle().italic=value;this.isChanged=true;});__getset(0,__proto,'align',function(){return this._getCSSStyle().align;},function(value){this._getCSSStyle().align=value;this.isChanged=true;});__getset(0,__proto,'valign',function(){return this._getCSSStyle().valign;},function(value){this._getCSSStyle().valign=value;this.isChanged=true;});__getset(0,__proto,'wordWrap',function(){return this._getCSSStyle().wordWrap;},function(value){this._getCSSStyle().wordWrap=value;this.isChanged=true;});__getset(0,__proto,'leading',function(){return this._getCSSStyle().leading;},function(value){this._getCSSStyle().leading=value;this.isChanged=true;});__getset(0,__proto,'bgColor',function(){return this._getCSSStyle().backgroundColor;},function(value){this._getCSSStyle().backgroundColor=value;this.isChanged=true;});__getset(0,__proto,'borderColor',function(){return this._getCSSStyle().borderColor;},function(value){this._getCSSStyle().borderColor=value;this.isChanged=true;});__getset(0,__proto,'stroke',function(){return this._getCSSStyle().stroke;},function(value){this._getCSSStyle().stroke=value;this.isChanged=true;});__getset(0,__proto,'strokeColor',function(){return this._getCSSStyle().strokeColor;},function(value){this._getCSSStyle().strokeColor=value;this.isChanged=true;});__getset(0,__proto,'isChanged',null,function(value){if(this._isChanged!==value){this._isChanged=value;value&&Laya.timer.callLater(this,this.typeset);}});__getset(0,__proto,'scrollX',function(){if(!this._clipPoint)
return 0;return this._clipPoint.x;},function(value){if(this.overflow!=Text.SCROLL||(this.textWidth<this._width||!this._clipPoint))
return;value=value<this.padding[3]?this.padding[3]:value;var maxScrollX=this._textWidth-this._width;value=value>maxScrollX?maxScrollX:value;var visibleLineCount=this._height/(this._charSize.height+this.leading)|0+1;this._clipPoint.x=value;this.renderText(this._lastVisibleLineIndex,visibleLineCount);});__getset(0,__proto,'scrollY',function(){if(!this._clipPoint)
return 0;return this._clipPoint.y;},function(value){if(this.overflow!=Text.SCROLL||(this.textHeight<this._height||!this._clipPoint))
return;value=value<this.padding[0]?this.padding[0]:value;var maxScrollY=this._textHeight-this._height;value=value>maxScrollY?maxScrollY:value;var startLine=value/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=startLine;var visibleLineCount=(this._height/(this._charSize.height+this.leading)|0)+1;this._clipPoint.y=value;this.renderText(startLine,visibleLineCount);});__getset(0,__proto,'maxScrollX',function(){return(this.textWidth<this._width)?0:this._textWidth-this._width;});__getset(0,__proto,'maxScrollY',function(){return(this.textHeight<this._height)?0:this._textHeight-this._height;});__getset(0,__proto,'lines',function(){if(this._isChanged)
this.typeset();return this._lines;});__getset(0,__proto,'underlineColor',function(){return this._underlineColor;},function(value){this._underlineColor=value;this._isChanged=true;this.typeset();});Text.registerBitmapFont=function(name,bitmapFont){Text._bitmapFonts||(Text._bitmapFonts={});Text._bitmapFonts[name]=bitmapFont;}
Text.unregisterBitmapFont=function(name,destroy){(destroy===void 0)&&(destroy=true);if(Text._bitmapFonts&&Text._bitmapFonts[name]){var tBitmapFont=Text._bitmapFonts[name];if(destroy){tBitmapFont.destroy();}
delete Text._bitmapFonts[name];}}
Text.setTextRightToLeft=function(){var style;style=Browser.canvas.source.style;style.display="none";style.position="absolute";style.direction="rtl";Render._mainCanvas.source.style.direction="rtl";laya.display.Text.RightToLeft=true;Browser.document.body.appendChild(Browser.canvas.source);}
Text.supportFont=function(font){Browser.context.font="10px sans-serif";var defaultFontWidth=Browser.context.measureText("abcji").width;Browser.context.font="10px "+font;var customFontWidth=Browser.context.measureText("abcji").width;console.log(defaultFontWidth,customFontWidth);if(defaultFontWidth===customFontWidth)return false;else return true;}
Text._testWord="游";Text.langPacks=null;Text.VISIBLE="visible";Text.SCROLL="scroll";Text.HIDDEN="hidden";Text.CharacterCache=true;Text.RightToLeft=false;Text._bitmapFonts=null;__static(Text,['_fontFamilyMap',function(){return this._fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"};}]);return Text;})(Sprite)
var Stage=(function(_super){function Stage(){this.focus=null;this.designWidth=0;this.designHeight=0;this.canvasRotation=false;this.canvasDegree=0;this.renderingEnabled=true;this.screenAdaptationEnabled=true;this._screenMode="none";this._scaleMode="noscale";this._alignV="top";this._alignH="left";this._bgColor="black";this._mouseMoveTime=0;this._renderCount=0;this._frameStartTime=NaN;this._isFocused=false;this._isVisibility=false;this._scenes=null;this._frameRate="fast";Stage.__super.call(this);this.offset=new Point();this._canvasTransform=new Matrix();this._previousOrientation=Browser.window.orientation;var _$this=this;this.transform=Matrix.create();this._scenes=[];this.mouseEnabled=true;this.hitTestPrior=true;this.autoSize=false;this._displayedInStage=true;this._isFocused=true;this._isVisibility=true;var window=Browser.window;var _this=this;window.addEventListener("focus",function(){_$this._isFocused=true;_this.event("focus");_this.event("focuschange");});window.addEventListener("blur",function(){_$this._isFocused=false;_this.event("blur");_this.event("focuschange");if(_this._isInputting())Input["inputElement"].target.focus=false;});var hidden="hidden",state="visibilityState",visibilityChange="visibilitychange";var document=window.document;if(typeof document.hidden!=="undefined"){visibilityChange="visibilitychange";state="visibilityState";}else if(typeof document.mozHidden!=="undefined"){visibilityChange="mozvisibilitychange";state="mozVisibilityState";}else if(typeof document.msHidden!=="undefined"){visibilityChange="msvisibilitychange";state="msVisibilityState";}else if(typeof document.webkitHidden!=="undefined"){visibilityChange="webkitvisibilitychange";state="webkitVisibilityState";}
window.document.addEventListener(visibilityChange,visibleChangeFun);function visibleChangeFun(){if(Browser.document[state]=="hidden"){_this._setStageVisible(false);}else{_this._setStageVisible(true);}}
window.document.addEventListener("qbrowserVisibilityChange",qbroserVisibleChangeFun);function qbroserVisibleChangeFun(e){_this._setStageVisible(!e.hidden);}
window.addEventListener("resize",function(){var orientation=Browser.window.orientation;if(orientation!=null&&orientation!=_$this._previousOrientation&&_this._isInputting()){Input["inputElement"].target.focus=false;}
_$this._previousOrientation=orientation;if(_this._isInputting())return;_this._resetCanvas();});window.addEventListener("orientationchange",function(e){_this._resetCanvas();});this.on("mousemove",this,this._onmouseMove);if(Browser.onMobile)this.on("mousedown",this,this._onmouseMove);}
__class(Stage,'laya.display.Stage',_super);var __proto=Stage.prototype;__proto._setStageVisible=function(value){if(this._isVisibility==value)return;this._isVisibility=value;if(!this._isVisibility)if(this._isInputting())Input["inputElement"].target.focus=false;this.event("visibilitychange");}
__proto._isInputting=function(){return(Browser.onMobile&&Input.isInputting);}
__proto._changeCanvasSize=function(){this.setScreenSize(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio);}
__proto._resetCanvas=function(){if(!this.screenAdaptationEnabled)return;var canvas=Render._mainCanvas;var canvasStyle=canvas.source.style;canvas.size(1,1);Laya.timer.once(100,this,this._changeCanvasSize);}
__proto.setScreenSize=function(screenWidth,screenHeight){var rotation=false;if(this._screenMode!=="none"){var screenType=screenWidth/screenHeight<1?"vertical":"horizontal";rotation=screenType!==this._screenMode;if(rotation){var temp=screenHeight;screenHeight=screenWidth;screenWidth=temp;}}
this.canvasRotation=rotation;var canvas=Render._mainCanvas;var canvasStyle=canvas.source.style;var mat=this._canvasTransform.identity();var scaleMode=this._scaleMode;var scaleX=screenWidth/this.designWidth;var scaleY=screenHeight/this.designHeight;var canvasWidth=this.designWidth;var canvasHeight=this.designHeight;var realWidth=screenWidth;var realHeight=screenHeight;var pixelRatio=Browser.pixelRatio;this._width=this.designWidth;this._height=this.designHeight;switch(scaleMode){case"noscale":scaleX=scaleY=1;realWidth=this.designWidth;realHeight=this.designHeight;break;case"showall":scaleX=scaleY=Math.min(scaleX,scaleY);canvasWidth=realWidth=Math.round(this.designWidth*scaleX);canvasHeight=realHeight=Math.round(this.designHeight*scaleY);break;case"noborder":scaleX=scaleY=Math.max(scaleX,scaleY);realWidth=Math.round(this.designWidth*scaleX);realHeight=Math.round(this.designHeight*scaleY);break;case"full":scaleX=scaleY=1;this._width=canvasWidth=screenWidth;this._height=canvasHeight=screenHeight;break;case"fixedwidth":scaleY=scaleX;this._height=canvasHeight=Math.round(screenHeight/scaleX);break;case"fixedheight":scaleX=scaleY;this._width=canvasWidth=Math.round(screenWidth/scaleY);break;case"fixedauto":if((screenWidth/screenHeight)<(this.designWidth/this.designHeight)){scaleY=scaleX;this._height=canvasHeight=Math.round(screenHeight/scaleX);}else{scaleX=scaleY;this._width=canvasWidth=Math.round(screenWidth/scaleY);}
break;}
if(this.conchModel)this.conchModel.size(this._width,this._height);scaleX*=this.scaleX;scaleY*=this.scaleY;if(scaleX===1&&scaleY===1){this.transform.identity();}else{this.transform.a=this._formatData(scaleX/(realWidth/canvasWidth));this.transform.d=this._formatData(scaleY/(realHeight/canvasHeight));this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d);}
canvas.size(canvasWidth,canvasHeight);RunDriver.changeWebGLSize(canvasWidth,canvasHeight);mat.scale(realWidth/canvasWidth/pixelRatio,realHeight/canvasHeight/pixelRatio);if(this._alignH==="left")this.offset.x=0;else if(this._alignH==="right")this.offset.x=screenWidth-realWidth;else this.offset.x=(screenWidth-realWidth)*0.5/pixelRatio;if(this._alignV==="top")this.offset.y=0;else if(this._alignV==="bottom")this.offset.y=screenHeight-realHeight;else this.offset.y=(screenHeight-realHeight)*0.5/pixelRatio;this.offset.x=Math.round(this.offset.x);this.offset.y=Math.round(this.offset.y);mat.translate(this.offset.x,this.offset.y);this.canvasDegree=0;if(rotation){if(this._screenMode==="horizontal"){mat.rotate(Math.PI/2);mat.translate(screenHeight/pixelRatio,0);this.canvasDegree=90;}else{mat.rotate(-Math.PI/2);mat.translate(0,screenWidth/pixelRatio);this.canvasDegree=-90;}}
mat.a=this._formatData(mat.a);mat.d=this._formatData(mat.d);mat.tx=this._formatData(mat.tx);mat.ty=this._formatData(mat.ty);canvasStyle.transformOrigin=canvasStyle.webkitTransformOrigin=canvasStyle.msTransformOrigin=canvasStyle.mozTransformOrigin=canvasStyle.oTransformOrigin="0px 0px 0px";canvasStyle.transform=canvasStyle.webkitTransform=canvasStyle.msTransform=canvasStyle.mozTransform=canvasStyle.oTransform="matrix("+mat.toString()+")";mat.translate(parseInt(canvasStyle.left)||0,parseInt(canvasStyle.top)||0);this.visible=true;this._repaint=1;this.event("resize");}
__proto._formatData=function(value){if(Math.abs(value)<0.000001)return 0;if(Math.abs(1-value)<0.001)return value>0?1:-1;return value;}
__proto.getMousePoint=function(){return Point.TEMP.setTo(this.mouseX,this.mouseY);}
__proto.repaint=function(){this._repaint=1;}
__proto.parentRepaint=function(){}
__proto._loop=function(){this.render(Render.context,0,0);return true;}
__proto._onmouseMove=function(e){this._mouseMoveTime=Browser.now();}
__proto.getTimeFromFrameStart=function(){return Browser.now()-this._frameStartTime;}
__proto.render=function(context,x,y){if(this._frameRate==="sleep"&&!Render.isConchApp){var now=Browser.now();if(now-this._frameStartTime>=1000)this._frameStartTime=now;else return;}
this._renderCount++;Render.isFlash&&this.repaint();if(!this._style.visible){if(this._renderCount%5===0){Stat.loopCount++;MouseManager.instance.runEvent();Laya.timer._update();}
return;}
this._frameStartTime=Browser.now();var frameMode=this._frameRate==="mouse"?(((this._frameStartTime-this._mouseMoveTime)<2000)?"fast":"slow"):this._frameRate;var isFastMode=(frameMode!=="slow");var isDoubleLoop=(this._renderCount%2===0);Stat.renderSlow=!isFastMode;if(isFastMode||isDoubleLoop||Render.isConchApp){Stat.loopCount++;MouseManager.instance.runEvent();Laya.timer._update();RunDriver.update3DLoop();var scene;var i=0,n=0;if(Render.isConchNode){for(i=0,n=this._scenes.length;i<n;i++){scene=this._scenes[i];(scene)&&(scene._updateSceneConch());}}else{for(i=0,n=this._scenes.length;i<n;i++){scene=this._scenes[i];(scene)&&(scene._updateScene());}}
if(Render.isConchNode){var customList=Sprite["CustomList"];for(i=0,n=customList.length;i<n;i++){var customItem=customList[i];customItem.customRender(customItem.customContext,0,0);}
return;}}
if(Render.isConchNode)return;if(this.renderingEnabled&&(isFastMode||!isDoubleLoop)){if(Render.isWebGL){context.clear();_super.prototype.render.call(this,context,x,y);Stat._show&&Stat._sp&&Stat._sp.render(context,x,y);RunDriver.clear(this._bgColor);RunDriver.beginFlush();context.flush();RunDriver.endFinish();VectorGraphManager.instance&&VectorGraphManager.getInstance().endDispose();}else{RunDriver.clear(this._bgColor);_super.prototype.render.call(this,context,x,y);Stat._show&&Stat._sp&&Stat._sp.render(context,x,y);}}}
__proto._requestFullscreen=function(){var element=Browser.document.documentElement;if(element.requestFullscreen){element.requestFullscreen();}else if(element.mozRequestFullScreen){element.mozRequestFullScreen();}else if(element.webkitRequestFullscreen){element.webkitRequestFullscreen();}else if(element.msRequestFullscreen){element.msRequestFullscreen();}}
__proto._fullScreenChanged=function(){Laya.stage.event("fullscreenchange");}
__proto.exitFullscreen=function(){var document=Browser.document;if(document.exitFullscreen){document.exitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}}
__getset(0,__proto,'clientScaleX',function(){return this._transform?this._transform.getScaleX():1;});__getset(0,__proto,'desginHeight',function(){console.debug("desginHeight已经弃用，请使用designHeight代替");return this.designHeight;});__getset(0,__proto,'frameRate',function(){return this._frameRate;},function(value){this._frameRate=value;if(Render.isConchApp){switch(this._frameRate){case"slow":Browser.window.conch&&Browser.window.conchConfig.setSlowFrame&&Browser.window.conchConfig.setSlowFrame(true);break;case"fast":Browser.window.conch&&Browser.window.conchConfig.setSlowFrame&&Browser.window.conchConfig.setSlowFrame(false);break;case"mouse":Browser.window.conch&&Browser.window.conchConfig.setMouseFrame&&Browser.window.conchConfig.setMouseFrame(2000);break;case"sleep":Browser.window.conch&&Browser.window.conchConfig.setLimitFPS&&Browser.window.conchConfig.setLimitFPS(1);break;default:throw new Error("Stage:frameRate invalid.");break;}}});__getset(0,__proto,'clientScaleY',function(){return this._transform?this._transform.getScaleY():1;});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){this.designWidth=value;Laya.superSet(Sprite,this,'width',value);Laya.timer.callLater(this,this._changeCanvasSize);});__getset(0,__proto,'alignH',function(){return this._alignH;},function(value){this._alignH=value;Laya.timer.callLater(this,this._changeCanvasSize);});__getset(0,__proto,'isFocused',function(){return this._isFocused;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){this.designHeight=value;Laya.superSet(Sprite,this,'height',value);Laya.timer.callLater(this,this._changeCanvasSize);});__getset(0,__proto,'transform',function(){if(this._tfChanged)this._adjustTransform();return this._transform=this._transform||Matrix.create();},_super.prototype._$set_transform);__getset(0,__proto,'isVisibility',function(){return this._isVisibility;});__getset(0,__proto,'desginWidth',function(){console.debug("desginWidth已经弃用，请使用designWidth代替");return this.designWidth;});__getset(0,__proto,'scaleMode',function(){return this._scaleMode;},function(value){this._scaleMode=value;Laya.timer.callLater(this,this._changeCanvasSize);});__getset(0,__proto,'alignV',function(){return this._alignV;},function(value){this._alignV=value;Laya.timer.callLater(this,this._changeCanvasSize);});__getset(0,__proto,'bgColor',function(){return this._bgColor;},function(value){this._bgColor=value;this.conchModel&&this.conchModel.bgColor(value);if(Render.isWebGL){if(value){Stage._wgColor=Color.create(value)._color;}else{if(!Browser.onMiniGame)Stage._wgColor=null;}}
if(Browser.onLimixiu){Stage._wgColor=Color.create(value)._color;}else
if(value){Render.canvas.style.background=value;}else{Render.canvas.style.background="none";}});__getset(0,__proto,'mouseX',function(){return Math.round(MouseManager.instance.mouseX/this.clientScaleX);});__getset(0,__proto,'mouseY',function(){return Math.round(MouseManager.instance.mouseY/this.clientScaleY);});__getset(0,__proto,'screenMode',function(){return this._screenMode;},function(value){this._screenMode=value;});__getset(0,__proto,'visible',_super.prototype._$get_visible,function(value){if(this.visible!==value){Laya.superSet(Sprite,this,'visible',value);var style=Render._mainCanvas.source.style;style.visibility=value?"visible":"hidden";}});__getset(0,__proto,'fullScreenEnabled',null,function(value){var document=Browser.document;var canvas=Render.canvas;if(value){canvas.addEventListener('mousedown',this._requestFullscreen);canvas.addEventListener('touchstart',this._requestFullscreen);document.addEventListener("fullscreenchange",this._fullScreenChanged);document.addEventListener("mozfullscreenchange",this._fullScreenChanged);document.addEventListener("webkitfullscreenchange",this._fullScreenChanged);document.addEventListener("msfullscreenchange",this._fullScreenChanged);}else{canvas.removeEventListener('mousedown',this._requestFullscreen);canvas.removeEventListener('touchstart',this._requestFullscreen);document.removeEventListener("fullscreenchange",this._fullScreenChanged);document.removeEventListener("mozfullscreenchange",this._fullScreenChanged);document.removeEventListener("webkitfullscreenchange",this._fullScreenChanged);document.removeEventListener("msfullscreenchange",this._fullScreenChanged);}});Stage.SCALE_NOSCALE="noscale";Stage.SCALE_EXACTFIT="exactfit";Stage.SCALE_SHOWALL="showall";Stage.SCALE_NOBORDER="noborder";Stage.SCALE_FULL="full";Stage.SCALE_FIXED_WIDTH="fixedwidth";Stage.SCALE_FIXED_HEIGHT="fixedheight";Stage.SCALE_FIXED_AUTO="fixedauto";Stage.ALIGN_LEFT="left";Stage.ALIGN_RIGHT="right";Stage.ALIGN_CENTER="center";Stage.ALIGN_TOP="top";Stage.ALIGN_MIDDLE="middle";Stage.ALIGN_BOTTOM="bottom";Stage.SCREEN_NONE="none";Stage.SCREEN_HORIZONTAL="horizontal";Stage.SCREEN_VERTICAL="vertical";Stage.FRAME_FAST="fast";Stage.FRAME_SLOW="slow";Stage.FRAME_MOUSE="mouse";Stage.FRAME_SLEEP="sleep";Stage.FRAME_MOUSE_THREDHOLD=2000;__static(Stage,['_wgColor',function(){return this._wgColor=[0,0,0,1];}]);return Stage;})(Sprite)
var SoundNode=(function(_super){function SoundNode(){this.url=null;this._channel=null;this._tar=null;this._playEvents=null;this._stopEvents=null;SoundNode.__super.call(this);this.visible=false;this.on("added",this,this._onParentChange);this.on("removed",this,this._onParentChange);}
__class(SoundNode,'laya.media.SoundNode',_super);var __proto=SoundNode.prototype;__proto._onParentChange=function(){this.target=this.parent;}
__proto.play=function(loops,complete){(loops===void 0)&&(loops=1);if(isNaN(loops)){loops=1;}
if(!this.url)return;this.stop();this._channel=SoundManager.playSound(this.url,loops,complete);}
__proto.stop=function(){if(this._channel&&!this._channel.isStopped){this._channel.stop();}
this._channel=null;}
__proto._setPlayAction=function(tar,event,action,add){(add===void 0)&&(add=true);if(!this[action])return;if(!tar)return;if(add){tar.on(event,this,this[action]);}else{tar.off(event,this,this[action]);}}
__proto._setPlayActions=function(tar,events,action,add){(add===void 0)&&(add=true);if(!tar)return;if(!events)return;var eventArr=events.split(",");var i=0,len=0;len=eventArr.length;for(i=0;i<len;i++){this._setPlayAction(tar,eventArr[i],action,add);}}
__getset(0,__proto,'playEvent',null,function(events){this._playEvents=events;if(!events)return;if(this._tar){this._setPlayActions(this._tar,events,"play");}});__getset(0,__proto,'target',null,function(tar){if(this._tar){this._setPlayActions(this._tar,this._playEvents,"play",false);this._setPlayActions(this._tar,this._stopEvents,"stop",false);}
this._tar=tar;if(this._tar){this._setPlayActions(this._tar,this._playEvents,"play",true);this._setPlayActions(this._tar,this._stopEvents,"stop",true);}});__getset(0,__proto,'stopEvent',null,function(events){this._stopEvents=events;if(!events)return;if(this._tar){this._setPlayActions(this._tar,events,"stop");}});return SoundNode;})(Sprite)
var FileBitmap=(function(_super){function FileBitmap(){this._src=null;this._onload=null;this._onerror=null;FileBitmap.__super.call(this);}
__class(FileBitmap,'laya.resource.FileBitmap',_super);var __proto=FileBitmap.prototype;__getset(0,__proto,'src',function(){return this._src;},function(value){this._src=value;});__getset(0,__proto,'onload',null,function(value){});__getset(0,__proto,'onerror',null,function(value){});return FileBitmap;})(Bitmap)
var HTMLCanvas=(function(_super){function HTMLCanvas(type,canvas){this._is2D=false;HTMLCanvas.__super.call(this);var _$this=this;this._source=this;if(type==="2D"||(type==="AUTO"&&!Render.isWebGL)){this._is2D=true;this._source=canvas||Browser.createElement("canvas");this._w=this._source.width;this._h=this._source.height;var o=this;o.getContext=function(contextID,other){if(_$this._ctx)return _$this._ctx;var ctx=_$this._ctx=_$this._source.getContext(contextID,other);if(ctx){ctx._canvas=o;if(!Render.isFlash&&!Browser.onLimixiu)ctx.size=function(w,h){};}
return ctx;}}
this.lock=true;}
__class(HTMLCanvas,'laya.resource.HTMLCanvas',_super);var __proto=HTMLCanvas.prototype;__proto.clear=function(){this._ctx&&this._ctx.clear();}
__proto.destroy=function(){this._ctx&&this._ctx.destroy();this._ctx=null;laya.resource.Resource.prototype.destroy.call(this);}
__proto.release=function(){}
__proto._setContext=function(context){this._ctx=context;}
__proto.getContext=function(contextID,other){return this._ctx?this._ctx:(this._ctx=HTMLCanvas._createContext(this));}
__proto.getMemSize=function(){return 0;}
__proto.size=function(w,h){if(this._w!=w||this._h!=h||(this._source&&(this._source.width!=w||this._source.height!=h))){this._w=w;this._h=h;this.memorySize=this._w*this._h*4;this._ctx&&this._ctx.size(w,h);this._source&&(this._source.height=h,this._source.width=w);}}
__proto.getCanvas=function(){return this._source;}
__proto.toBase64=function(type,encoderOptions,callBack){if(this._source){if(Render.isConchApp&&this._source.toBase64){this._source.toBase64(type,encoderOptions,callBack);}
else{var base64Data=this._source.toDataURL(type,encoderOptions);callBack.call(this,base64Data);}}}
__getset(0,__proto,'context',function(){return this._ctx;});__getset(0,__proto,'asBitmap',null,function(value){});HTMLCanvas.create=function(type,canvas){return new HTMLCanvas(type,canvas);}
HTMLCanvas.TYPE2D="2D";HTMLCanvas.TYPE3D="3D";HTMLCanvas.TYPEAUTO="AUTO";HTMLCanvas._createContext=null;return HTMLCanvas;})(Bitmap)
var HTMLSubImage=(function(_super){function HTMLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src,allowMerageInAtlas){HTMLSubImage.__super.call(this);throw new Error("不允许new！");}
__class(HTMLSubImage,'laya.resource.HTMLSubImage',_super);HTMLSubImage.create=function(canvas,offsetX,offsetY,width,height,atlasImage,src,allowMerageInAtlas){(allowMerageInAtlas===void 0)&&(allowMerageInAtlas=false);return new HTMLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src,allowMerageInAtlas);}
return HTMLSubImage;})(Bitmap)
var Animation=(function(_super){function Animation(){this._frames=null;this._url=null;Animation.__super.call(this);this._setControlNode(this);}
__class(Animation,'laya.display.Animation',_super);var __proto=Animation.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);this.stop();laya.display.Sprite.prototype.destroy.call(this,destroyChild);this._frames=null;this._labels=null;}
__proto.play=function(start,loop,name,showWarn){(start===void 0)&&(start=0);(loop===void 0)&&(loop=true);(name===void 0)&&(name="");(showWarn===void 0)&&(showWarn=true);if(name)this._setFramesFromCache(name,showWarn);this._isPlaying=true;this.index=((typeof start=='string'))?this._getFrameByLabel(start):start;this.loop=loop;this._actionName=name;this._isReverse=this.wrapMode==1;if(this._frames&&this.interval>0){this.timerLoop(this.interval,this,this._frameLoop,null,true,true);}}
__proto._setFramesFromCache=function(name,showWarn){(showWarn===void 0)&&(showWarn=false);if(this._url)name=this._url+"#"+name;if(name&&Animation.framesMap[name]){var tAniO;tAniO=Animation.framesMap[name];if((tAniO instanceof Array)){this._frames=Animation.framesMap[name];this._count=this._frames.length;}else{if(tAniO.nodeRoot){Animation.framesMap[name]=this._parseGraphicAnimationByData(tAniO);tAniO=Animation.framesMap[name];}
this._frames=tAniO.frames;this._count=this._frames.length;if(!this._frameRateChanged)this._interval=tAniO.interval;this._labels=this._copyLabels(tAniO.labels);}
return true;}else{if(showWarn)console.log("ani not found:",name);}
return false;}
__proto._copyLabels=function(labels){if(!labels)return null;var rst;rst={};var key;for(key in labels){rst[key]=Utils.copyArray([],labels[key]);}
return rst;}
__proto._frameLoop=function(){if(this._style.visible&&this._style.alpha>0.01){_super.prototype._frameLoop.call(this);}}
__proto._displayToIndex=function(value){if(this._frames)this.graphics=this._frames[value];}
__proto.clear=function(){this.stop();this.graphics=null;this._frames=null;this._labels=null;}
__proto.loadImages=function(urls,cacheName){(cacheName===void 0)&&(cacheName="");this._url="";if(!this._setFramesFromCache(cacheName)){this.frames=Animation.framesMap[cacheName]?Animation.framesMap[cacheName]:Animation.createFrames(urls,cacheName);}
return this;}
__proto.loadAtlas=function(url,loaded,cacheName){(cacheName===void 0)&&(cacheName="");this._url="";var _this_=this;function onLoaded(loadUrl){if(url===loadUrl){_this_.frames=Animation.framesMap[cacheName]?Animation.framesMap[cacheName]:Animation.createFrames(url,cacheName);if(loaded)loaded.run();}}
if(!_this_._setFramesFromCache(cacheName)){if(Loader.getAtlas(url))onLoaded(url);else Laya.loader.load(url,Handler.create(null,onLoaded,[url]),null,"atlas");}
return this;}
__proto.loadAnimation=function(url,loaded,atlas){this._url=url;var _this_=this;if(!this._actionName)this._actionName="";if(!_this_._setFramesFromCache("")){if(!atlas||Loader.getAtlas(atlas)){this._loadAnimationData(url,loaded,atlas);}else{Laya.loader.load(atlas,Handler.create(this,this._loadAnimationData,[url,loaded,atlas]),null,"atlas")}}else{_this_._setFramesFromCache(this._actionName,true);this.index=0;if(loaded)loaded.run();}
return this;}
__proto._loadAnimationData=function(url,loaded,atlas){var _$this=this;if(atlas&&!Loader.getAtlas(atlas)){console.warn("atlas load fail:"+atlas);return;};var _this_=this;function onLoaded(loadUrl){if(!Loader.getRes(loadUrl))return;if(url===loadUrl){var tAniO;if(!Animation.framesMap[url+"#"]){var aniData=_this_._parseGraphicAnimation(Loader.getRes(url));if(!aniData)return;var aniList=aniData.animationList;var i=0,len=aniList.length;var defaultO;for(i=0;i<len;i++){tAniO=aniList[i];Animation.framesMap[url+"#"+tAniO.name]=tAniO;if(!defaultO)defaultO=tAniO;}
if(defaultO){Animation.framesMap[url+"#"]=defaultO;_this_._setFramesFromCache(_$this._actionName,true);_$this.index=0;}
_$this._checkResumePlaying();}else{_this_._setFramesFromCache(_$this._actionName,true);_$this.index=0;_$this._checkResumePlaying();}
if(loaded)loaded.run();}}
if(Loader.getRes(url))onLoaded(url);else Laya.loader.load(url,Handler.create(null,onLoaded,[url]),null,"json");Loader.clearRes(url);}
__proto._parseGraphicAnimation=function(animationData){return GraphicAnimation.parseAnimationData(animationData);}
__proto._parseGraphicAnimationByData=function(animationObject){return GraphicAnimation.parseAnimationByData(animationObject);}
__getset(0,__proto,'frames',function(){return this._frames;},function(value){this._frames=value;if(value){this._count=value.length;if(this._isPlaying)this.play(this._index,this.loop,this._actionName);else this.index=this._index;}});__getset(0,__proto,'autoPlay',null,function(value){if(value)this.play();else this.stop();});__getset(0,__proto,'source',null,function(value){if(value.indexOf(".ani")>-1)this.loadAnimation(value);else if(value.indexOf(".json")>-1||value.indexOf("als")>-1||value.indexOf("atlas")>-1)this.loadAtlas(value);else this.loadImages(value.split(","));});__getset(0,__proto,'autoAnimation',null,function(value){this.play(0,true,value,false);});Animation.createFrames=function(url,name){var arr,i=0,n=0,g;if((typeof url=='string')){var atlas=Loader.getAtlas(url);if(atlas&&atlas.length){arr=[];for(i=0,n=atlas.length;i<n;i++){g=new RunDriver.createGraphics();g.drawTexture(Loader.getRes(atlas[i]),0,0);arr.push(g);}}}else if((url instanceof Array)){arr=[];for(i=0,n=url.length;i<n;i++){g=new RunDriver.createGraphics();g.loadImage(url[i],0,0);arr.push(g);}}
if(name)Animation.framesMap[name]=arr;return arr;}
Animation.clearCache=function(key){var cache=Animation.framesMap;var val;var key2=key+"#";for(val in cache){if(val===key||val.indexOf(key2)==0){delete Animation.framesMap[val];}}}
Animation.framesMap={};return Animation;})(AnimationPlayerBase)
var FrameAnimation=(function(_super){function FrameAnimation(){this._targetDic=null;this._animationData=null;this._animationNewFrames=null;FrameAnimation.__super.call(this);if(FrameAnimation._sortIndexFun==null){FrameAnimation._sortIndexFun=MathUtil.sortByKey("index",false,true);}}
__class(FrameAnimation,'laya.display.FrameAnimation',_super);var __proto=FrameAnimation.prototype;__proto._setUp=function(targetDic,animationData){this._labels=null;this._animationNewFrames=null;this._targetDic=targetDic;this._animationData=animationData;this.interval=1000/animationData.frameRate;if(animationData.parsed){this._count=animationData.count;this._labels=animationData.labels;this._animationNewFrames=animationData.animationNewFrames;}else{this._animationNewFrames=[];this._calculateDatas();}
animationData.parsed=true;animationData.labels=this._labels;animationData.count=this._count;animationData.animationNewFrames=this._animationNewFrames;}
__proto.clear=function(){_super.prototype.clear.call(this);this._targetDic=null;this._animationData=null;}
__proto._displayToIndex=function(value){if(!this._animationData)return;if(value<0)value=0;if(value>this._count)value=this._count;var nodes=this._animationData.nodes,i=0,len=nodes.length;for(i=0;i<len;i++){this._displayNodeToFrame(nodes[i],value);}}
__proto._displayNodeToFrame=function(node,frame,targetDic){if(!targetDic)targetDic=this._targetDic;var target=targetDic[node.target];if(!target){return;};var frames=node.frames,key,propFrames,value;var keys=node.keys,i=0,len=keys.length;for(i=0;i<len;i++){key=keys[i];propFrames=frames[key];if(propFrames.length>frame){value=propFrames[frame];}else{value=propFrames[propFrames.length-1];}
target[key]=value;}}
__proto._calculateDatas=function(){if(!this._animationData)return;var nodes=this._animationData.nodes,i=0,len=nodes.length,tNode;this._count=0;for(i=0;i<len;i++){tNode=nodes[i];this._calculateNodeKeyFrames(tNode);}
this._count+=1;}
__proto._calculateNodeKeyFrames=function(node){var keyFrames=node.keyframes,key,tKeyFrames,target=node.target;if(!node.frames){node.frames={};}
if(!node.keys){node.keys=[];}else{node.keys.length=0;}
if(!node.initValues){node.initValues={};}
for(key in keyFrames){tKeyFrames=keyFrames[key];if(!node.frames[key]){node.frames[key]=[];}
if(this._targetDic&&this._targetDic[target]){node.initValues[key]=this._targetDic[target][key];}
tKeyFrames.sort(FrameAnimation._sortIndexFun);node.keys.push(key);this._calculateNodePropFrames(tKeyFrames,node.frames[key],key,target);}}
__proto.resetToInitState=function(){if(!this._targetDic)return;if(!this._animationData)return;var nodes=this._animationData.nodes,i=0,len=nodes.length;var tNode;var initValues;for(i=0;i<len;i++){tNode=nodes[i];initValues=tNode.initValues;if(!initValues)continue;var target=this._targetDic[tNode.target];if(!target)continue;var key;for(key in initValues){target[key]=initValues[key];}}}
__proto._calculateNodePropFrames=function(keyframes,frames,key,target){var i=0,len=keyframes.length-1;frames.length=keyframes[len].index+1;for(i=0;i<len;i++){this._dealKeyFrame(keyframes[i]);this._calculateFrameValues(keyframes[i],keyframes[i+1],frames);}
if(len==0){frames[0]=keyframes[0].value;if(this._animationNewFrames)
this._animationNewFrames[keyframes[0].index]=true;}
this._dealKeyFrame(keyframes[i]);}
__proto._dealKeyFrame=function(keyFrame){if(keyFrame.label&&keyFrame.label!="")this.addLabel(keyFrame.label,keyFrame.index);}
__proto._calculateFrameValues=function(startFrame,endFrame,result){var i=0,easeFun;var start=startFrame.index,end=endFrame.index;var startValue=startFrame.value;var dValue=endFrame.value-startFrame.value;var dLen=end-start;if(end>this._count)this._count=end;if(startFrame.tween){easeFun=Ease[startFrame.tweenMethod];if(easeFun==null){easeFun=Ease.linearNone;}
for(i=start;i<end;i++){result[i]=easeFun(i-start,startValue,dValue,dLen);if(this._animationNewFrames){this._animationNewFrames[i]=true;}}}else{for(i=start;i<end;i++){result[i]=startValue;}}
if(this._animationNewFrames){this._animationNewFrames[startFrame.index]=true;this._animationNewFrames[endFrame.index]=true;}
result[endFrame.index]=endFrame.value;}
FrameAnimation._sortIndexFun=null;return FrameAnimation;})(AnimationPlayerBase)
var Input=(function(_super){function Input(){this._focus=false;this._multiline=false;this._editable=true;this._restrictPattern=null;this._type="text";this._prompt='';this._promptColor="#A9A9A9";this._originColor="#000000";this._content='';Input.__super.call(this);this._maxChars=1E5;this._width=100;this._height=20;this.multiline=false;this.overflow=Text.SCROLL;this.on("mousedown",this,this._onMouseDown);this.on("undisplay",this,this._onUnDisplay);}
__class(Input,'laya.display.Input',_super);var __proto=Input.prototype;__proto.setSelection=function(startIndex,endIndex){this.focus=true;laya.display.Input.inputElement.selectionStart=startIndex;laya.display.Input.inputElement.selectionEnd=endIndex;}
__proto._onUnDisplay=function(e){this.focus=false;}
__proto._onMouseDown=function(e){this.focus=true;}
__proto._syncInputTransform=function(){var inputElement=this.nativeInput;var transform=Utils.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]);var inputWid=this._width-this.padding[1]-this.padding[3];var inputHei=this._height-this.padding[0]-this.padding[2];if(Render.isConchApp){inputElement.setScale(transform.scaleX,transform.scaleY);inputElement.setSize(inputWid,inputHei);inputElement.setPos(transform.x,transform.y);}else{Input.inputContainer.style.transform=Input.inputContainer.style.webkitTransform="scale("+transform.scaleX+","+transform.scaleY+") rotate("+(Laya.stage.canvasDegree)+"deg)";inputElement.style.width=inputWid+'px';inputElement.style.height=inputHei+'px';Input.inputContainer.style.left=transform.x+'px';Input.inputContainer.style.top=transform.y+'px';}}
__proto.select=function(){this.nativeInput.select();}
__proto._setInputMethod=function(){Input.input.parentElement&&(Input.inputContainer.removeChild(Input.input));Input.area.parentElement&&(Input.inputContainer.removeChild(Input.area));Input.inputElement=(this._multiline?Input.area:Input.input);Input.inputContainer.appendChild(Input.inputElement);if(Text.RightToLeft){Input.inputElement.style.direction="rtl";}}
__proto._focusIn=function(){laya.display.Input.isInputting=true;var input=this.nativeInput;this._focus=true;var cssStyle=input.style;cssStyle.whiteSpace=(this.wordWrap?"pre-wrap":"nowrap");this._setPromptColor();input.readOnly=!this._editable;if(Render.isConchApp){input.setType(this._type);input.setForbidEdit(!this._editable);}
input.maxLength=this._maxChars;var padding=this.padding;input.type=this._type;input.value=this._content;input.placeholder=this._prompt;Laya.stage.off("keydown",this,this._onKeyDown);Laya.stage.on("keydown",this,this._onKeyDown);Laya.stage.focus=this;this.event("focus");if(Browser.onPC)input.focus();if(!Browser.onMiniGame){var temp=this._text;this._text=null;}
this.typeset();input.setColor(this._originColor);input.setFontSize(this.fontSize);input.setFontFace(Browser.onIPhone?(Text._fontFamilyMap[this.font]||this.font):this.font);if(Render.isConchApp){input.setMultiAble&&input.setMultiAble(this._multiline);}
cssStyle.lineHeight=(this.leading+this.fontSize)+"px";cssStyle.fontStyle=(this.italic?"italic":"normal");cssStyle.fontWeight=(this.bold?"bold":"normal");cssStyle.textAlign=this.align;cssStyle.padding="0 0";this._syncInputTransform();if(!Render.isConchApp&&Browser.onPC)
Laya.timer.frameLoop(1,this,this._syncInputTransform);}
__proto._setPromptColor=function(){Input.promptStyleDOM=Browser.getElementById("promptStyle");if(!Input.promptStyleDOM){Input.promptStyleDOM=Browser.createElement("style");Input.promptStyleDOM.setAttribute("id","promptStyle");Browser.document.head.appendChild(Input.promptStyleDOM);}
Input.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {"+"color:"+this._promptColor+"}"+"input:-moz-placeholder, textarea:-moz-placeholder {"+"color:"+this._promptColor+"}"+"input::-moz-placeholder, textarea::-moz-placeholder {"+"color:"+this._promptColor+"}"+"input:-ms-input-placeholder, textarea:-ms-input-placeholder {"+"color:"+this._promptColor+"}";}
__proto._focusOut=function(){laya.display.Input.isInputting=false;this._focus=false;this._text=null;this._content=this.nativeInput.value;if(!this._content){Laya.superSet(Text,this,'text',this._prompt);Laya.superSet(Text,this,'color',this._promptColor);}else{Laya.superSet(Text,this,'text',this._content);Laya.superSet(Text,this,'color',this._originColor);}
Laya.stage.off("keydown",this,this._onKeyDown);Laya.stage.focus=null;this.event("blur");if(Render.isConchApp)this.nativeInput.blur();Browser.onPC&&Laya.timer.clear(this,this._syncInputTransform);}
__proto._onKeyDown=function(e){if(e.keyCode===13){if(Browser.onMobile&&!this._multiline)
this.focus=false;this.event("enter");}}
__proto.changeText=function(text){this._content=text;if(this._focus){this.nativeInput.value=text||'';this.event("change");}else
_super.prototype.changeText.call(this,text);}
__getset(0,__proto,'color',_super.prototype._$get_color,function(value){if(this._focus)
this.nativeInput.setColor(value);Laya.superSet(Text,this,'color',this._content?value:this._promptColor);this._originColor=value;});__getset(0,__proto,'inputElementYAdjuster',function(){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。");return 0;},function(value){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。");});__getset(0,__proto,'multiline',function(){return this._multiline;},function(value){this._multiline=value;this.valign=value?"top":"middle";});__getset(0,__proto,'maxChars',function(){return this._maxChars;},function(value){if(value<=0)
value=1E5;this._maxChars=value;});__getset(0,__proto,'text',function(){if(this._focus)
return this.nativeInput.value;else
return this._content||"";},function(value){Laya.superSet(Text,this,'color',this._originColor);value+='';if(this._focus){this.nativeInput.value=value||'';this.event("change");}else{if(!this._multiline)
value=value.replace(/\r?\n/g,'');this._content=value;if(value)
Laya.superSet(Text,this,'text',value);else{Laya.superSet(Text,this,'text',this._prompt);Laya.superSet(Text,this,'color',this.promptColor);}}});__getset(0,__proto,'nativeInput',function(){return this._multiline?Input.area:Input.input;});__getset(0,__proto,'prompt',function(){return this._prompt;},function(value){if(!this._text&&value)
Laya.superSet(Text,this,'color',this._promptColor);this.promptColor=this._promptColor;if(this._text)
Laya.superSet(Text,this,'text',(this._text==this._prompt)?value:this._text);else
Laya.superSet(Text,this,'text',value);this._prompt=Text.langPacks&&Text.langPacks[value]?Text.langPacks[value]:value;});__getset(0,__proto,'focus',function(){return this._focus;},function(value){var input=this.nativeInput;if(this._focus!==value){if(value){if(input.target){input.target._focusOut();}else{this._setInputMethod();}
input.target=this;this._focusIn();}else{input.target=null;this._focusOut();Browser.document.body.scrollTop=0;input.blur();if(Render.isConchApp){input.setPos(-10000,-10000);}else if(Input.inputContainer.contains(input))
Input.inputContainer.removeChild(input);}}});__getset(0,__proto,'restrict',function(){if(this._restrictPattern){return this._restrictPattern.source;}
return"";},function(pattern){if(pattern){pattern="[^"+pattern+"]";if(pattern.indexOf("^^")>-1)
pattern=pattern.replace("^^","");this._restrictPattern=new RegExp(pattern,"g");}else
this._restrictPattern=null;});__getset(0,__proto,'editable',function(){return this._editable;},function(value){this._editable=value;if(Render.isConchApp){Input.input.setForbidEdit(!value);}});__getset(0,__proto,'promptColor',function(){return this._promptColor;},function(value){this._promptColor=value;if(!this._content)Laya.superSet(Text,this,'color',value);});__getset(0,__proto,'type',function(){return this._type;},function(value){if(value=="password")
this._getCSSStyle().password=true;else
this._getCSSStyle().password=false;this._type=value;if(Render.isConchApp){this.nativeInput.setType(value);}});__getset(0,__proto,'inputElementXAdjuster',function(){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。");return 0;},function(value){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。");});__getset(0,__proto,'asPassword',function(){return this._getCSSStyle().password;},function(value){this._getCSSStyle().password=value;this._type="password";console.warn("deprecated: 使用type=\"password\"替代设置asPassword, asPassword将在下次重大更新时删去");this.isChanged=true;});Input.__init__=function(){Input._createInputElement();if(Browser.onMobile)
Render.canvas.addEventListener(Input.IOS_IFRAME?(Browser.onMiniGame?"touchend":"click"):"touchend",Input._popupInputMethod);}
Input._popupInputMethod=function(e){if(!laya.display.Input.isInputting)return;var input=laya.display.Input.inputElement;input.focus();}
Input._createInputElement=function(){Input._initInput(Input.area=Browser.createElement("textarea"));Input._initInput(Input.input=Browser.createElement("input"));Input.inputContainer=Browser.createElement("div");Input.inputContainer.style.position="absolute";Input.inputContainer.style.zIndex=1E5;Browser.container.appendChild(Input.inputContainer);Input.inputContainer.setPos=function(x,y){Input.inputContainer.style.left=x+'px';Input.inputContainer.style.top=y+'px';};}
Input._initInput=function(input){var style=input.style;style.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;";style.resize='none';style.backgroundColor='transparent';style.border='none';style.outline='none';style.zIndex=1;input.addEventListener('input',Input._processInputting);input.addEventListener('mousemove',Input._stopEvent);input.addEventListener('mousedown',Input._stopEvent);input.addEventListener('touchmove',Input._stopEvent);input.setFontFace=function(fontFace){input.style.fontFamily=fontFace;};if(!Render.isConchApp){input.setColor=function(color){input.style.color=color;};input.setFontSize=function(fontSize){input.style.fontSize=fontSize+'px';};}}
Input._processInputting=function(e){var input=laya.display.Input.inputElement.target;if(!input)return;var value=laya.display.Input.inputElement.value;if(input._restrictPattern){value=value.replace(/\u2006|\x27/g,"");if(input._restrictPattern.test(value)){value=value.replace(input._restrictPattern,"");laya.display.Input.inputElement.value=value;}}
input._text=value;input.event("input");}
Input._stopEvent=function(e){if(e.type=='touchmove')
e.preventDefault();e.stopPropagation&&e.stopPropagation();}
Input.TYPE_TEXT="text";Input.TYPE_PASSWORD="password";Input.TYPE_EMAIL="email";Input.TYPE_URL="url";Input.TYPE_NUMBER="number";Input.TYPE_RANGE="range";Input.TYPE_DATE="date";Input.TYPE_MONTH="month";Input.TYPE_WEEK="week";Input.TYPE_TIME="time";Input.TYPE_DATE_TIME="datetime";Input.TYPE_DATE_TIME_LOCAL="datetime-local";Input.TYPE_SEARCH="search";Input.input=null;Input.area=null;Input.inputElement=null;Input.inputContainer=null;Input.confirmButton=null;Input.promptStyleDOM=null;Input.inputHeight=45;Input.isInputting=false;Input.stageMatrix=null;__static(Input,['IOS_IFRAME',function(){return this.IOS_IFRAME=(Browser.onIOS&&Browser.window.top!=Browser.window.self);}]);return Input;})(Text)
var HTMLImage=(function(_super){function HTMLImage(src,def){this._recreateLock=false;this._needReleaseAgain=false;this._enableMerageInAtlas=true;HTMLImage.__super.call(this);this._init_(src,def);}
__class(HTMLImage,'laya.resource.HTMLImage',_super);var __proto=HTMLImage.prototype;__proto._init_=function(src,def){this._src=src;this._source=new Browser.window.Image();if(def){def.onload&&(this.onload=def.onload);def.onerror&&(this.onerror=def.onerror);def.onCreate&&def.onCreate(this);}
if(src.indexOf("data:image")!=0)this._source.crossOrigin="";(src)&&(this._source.src=src);}
__proto.recreateResource=function(){var _$this=this;if(this._src==="")
throw new Error("src no null！");this._needReleaseAgain=false;if(!this._source){this._recreateLock=true;var _this=this;this._source=new Browser.window.Image();this._source.crossOrigin="";this._source.onload=function(){if(_this._needReleaseAgain){_this._needReleaseAgain=false;_this._source.onload=null;_this._source=null;return;}
_this._source.onload=null;_this.memorySize=_$this._w*_$this._h*4;_this._recreateLock=false;_this.completeCreate();};this._source.src=this._src;}else{if(this._recreateLock)
return;this.memorySize=this._w*this._h*4;this._recreateLock=false;this.completeCreate();}}
__proto.disposeResource=function(){if(this._recreateLock)
this._needReleaseAgain=true;(this._source)&&(this._source=null,this.memorySize=0);}
__proto.onresize=function(){this._w=this._source.width;this._h=this._source.height;}
__getset(0,__proto,'onload',null,function(value){var _$this=this;this._onload=value;this._source&&(this._source.onload=this._onload!=null?(function(){_$this.onresize();_$this._onload();}):null);});__getset(0,__proto,'onerror',null,function(value){var _$this=this;this._onerror=value;this._source&&(this._source.onerror=this._onerror!=null?(function(){_$this._onerror()}):null);});__getset(0,__proto,'enableMerageInAtlas',function(){return this._enableMerageInAtlas;},function(value){this._enableMerageInAtlas=value;if(Render.isConchApp){if(this._source)this._source.enableMerageInAtlas=value;}});HTMLImage.create=function(src,def){return new HTMLImage(src,def);}
return HTMLImage;})(FileBitmap)
var EffectAnimation=(function(_super){function EffectAnimation(){this._target=null;this._playEvents=null;this._initData={};this._aniKeys=null;this._effectClass=null;EffectAnimation.__super.call(this);}
__class(EffectAnimation,'laya.display.EffectAnimation',_super);var __proto=EffectAnimation.prototype;__proto._onOtherBegin=function(effect){if(effect==this)
return;this.stop();}
__proto.addEvent=function(){if(!this._target||!this._playEvents)
return;this._setControlNode(this._target);this._target.on(this._playEvents,this,this._onPlayAction);}
__proto._onPlayAction=function(){this.play(0,false);}
__proto.play=function(start,loop,name,showWarn){(start===void 0)&&(start=0);(loop===void 0)&&(loop=true);(name===void 0)&&(name="");(showWarn===void 0)&&(showWarn=true);if(!this._target)
return;this._target.event("effectanimationbegin",[this]);this._recordInitData();laya.display.AnimationPlayerBase.prototype.play.call(this,start,loop,name,showWarn);}
__proto._recordInitData=function(){if(!this._aniKeys)
return;var i=0,len=0;len=this._aniKeys.length;var key;for(i=0;i<len;i++){key=this._aniKeys[i];this._initData[key]=this._target[key];}}
__proto._displayToIndex=function(value){if(!this._animationData)
return;if(value<0)
value=0;if(value>this._count)
value=this._count;var nodes=this._animationData.nodes,i=0,len=nodes.length;len=len>1?1:len;for(i=0;i<len;i++){this._displayNodeToFrame(nodes[i],value);}}
__proto._displayNodeToFrame=function(node,frame,targetDic){if(!this._target)
return;var target;target=this._target;var frames=node.frames,key,propFrames,value;var keys=node.keys,i=0,len=keys.length;var secondFrames;secondFrames=node.secondFrames;var tSecondFrame=0;var easeFun;var tKeyFrames;var startFrame;var endFrame;for(i=0;i<len;i++){key=keys[i];propFrames=frames[key];tSecondFrame=secondFrames[key];if(tSecondFrame==-1){value=this._initData[key];}else{if(frame<tSecondFrame){tKeyFrames=node.keyframes[key];startFrame=tKeyFrames[0];if(startFrame.tween){easeFun=Ease[startFrame.tweenMethod];if(easeFun==null){easeFun=Ease.linearNone;}
endFrame=tKeyFrames[1];value=easeFun(frame,this._initData[key],endFrame.value-this._initData[key],endFrame.index);}else{value=this._initData[key];}}else{if(propFrames.length>frame){value=propFrames[frame];}else{value=propFrames[propFrames.length-1];}}}
target[key]=value;}}
__proto._calculateNodeKeyFrames=function(node){_super.prototype._calculateNodeKeyFrames.call(this,node);var keyFrames=node.keyframes,key,tKeyFrames,target=node.target;var secondFrames;secondFrames={};node.secondFrames=secondFrames;for(key in keyFrames){tKeyFrames=keyFrames[key];if(tKeyFrames.length<=1){secondFrames[key]=-1;}else{secondFrames[key]=tKeyFrames[1].index;}}}
__getset(0,__proto,'target',function(){return this._target;},function(v){if(this._target){this._target.off("effectanimationbegin",this,this._onOtherBegin);}
this._target=v;if(this._target){this._target.on("effectanimationbegin",this,this._onOtherBegin);}
this.addEvent();});__getset(0,__proto,'playEvent',null,function(event){this._playEvents=event;if(!event)
return;this.addEvent();});__getset(0,__proto,'effectData',null,function(uiData){if(uiData){var aniData;aniData=uiData["animations"];if(aniData&&aniData[0]){this._setUp({},aniData[0]);if(aniData[0].nodes&&aniData[0].nodes[0]){this._aniKeys=aniData[0].nodes[0].keys;}}}});__getset(0,__proto,'effectClass',null,function(classStr){this._effectClass=ClassUtils.getClass(classStr);if(this._effectClass){var uiData;uiData=this._effectClass["uiView"];if(uiData){var aniData;aniData=uiData["animations"];if(aniData&&aniData[0]){this._setUp({},aniData[0]);if(aniData[0].nodes&&aniData[0].nodes[0]){this._aniKeys=aniData[0].nodes[0].keys;}}}}});EffectAnimation.EffectAnimationBegin="effectanimationbegin";return EffectAnimation;})(FrameAnimation)
var GraphicAnimation=(function(_super){var GraphicNode;function GraphicAnimation(){this.animationList=null;this.animationDic=null;this._nodeList=null;this._nodeDefaultProps=null;this._gList=null;this._nodeIDAniDic={};this._rootNode=null;this._nodeGDic=null;GraphicAnimation.__super.call(this);}
__class(GraphicAnimation,'laya.utils.GraphicAnimation',_super);var __proto=GraphicAnimation.prototype;__proto._parseNodeList=function(uiView){if(!this._nodeList){this._nodeList=[];}
this._nodeDefaultProps[uiView.compId]=uiView.props;if(uiView.compId)
this._nodeList.push(uiView.compId);var childs=uiView.child;if(childs){var i=0,len=childs.length;for(i=0;i<len;i++){this._parseNodeList(childs[i]);}}}
__proto._calGraphicData=function(aniData){this._setUp(null,aniData);this._createGraphicData();if(this._nodeIDAniDic){var key;for(key in this._nodeIDAniDic){this._nodeIDAniDic[key]=null;}}}
__proto._createGraphicData=function(){var gList=[];var i=0,len=this.count;var animationDataNew=this._animationNewFrames;if(!animationDataNew)animationDataNew=[];var preGraphic;for(i=0;i<len;i++){if(animationDataNew[i]||!preGraphic){preGraphic=this._createFrameGraphic(i);}
gList.push(preGraphic);}
this._gList=gList;}
__proto._createFrameGraphic=function(frame){var g=RunDriver.createGraphics();if(!GraphicAnimation._rootMatrix)
GraphicAnimation._rootMatrix=new Matrix();this._updateNodeGraphic(this._rootNode,frame,GraphicAnimation._rootMatrix,g);return g;}
__proto._updateNodeGraphic=function(node,frame,parentTransfrom,g,alpha){(alpha===void 0)&&(alpha=1);var tNodeG;tNodeG=this._nodeGDic[node.compId]=this._getNodeGraphicData(node.compId,frame,this._nodeGDic[node.compId]);var tGraphicAlpha=tNodeG.alpha*alpha;if(tGraphicAlpha<0.01)return;if(!tNodeG.resultTransform){tNodeG.resultTransform=Matrix.create();};var tResultTransform;tResultTransform=tNodeG.resultTransform;Matrix.mul(tNodeG.transform,parentTransfrom,tResultTransform);var tTex;if(tNodeG.skin){tTex=this._getTextureByUrl(tNodeG.skin);if(tTex){if(tResultTransform._checkTransform()){g.drawTexture(tTex,0,0,tNodeG.width,tNodeG.height,tResultTransform,tGraphicAlpha);tNodeG.resultTransform=null;}else{g.drawTexture(tTex,tResultTransform.tx,tResultTransform.ty,tNodeG.width,tNodeG.height,null,tGraphicAlpha);}}};var childs;childs=node.child;if(!childs)
return;var i=0,len=0;len=childs.length;for(i=0;i<len;i++){this._updateNodeGraphic(childs[i],frame,tResultTransform,g,tGraphicAlpha);}}
__proto._updateNoChilds=function(tNodeG,g){if(!tNodeG.skin)
return;var tTex=this._getTextureByUrl(tNodeG.skin);if(!tTex)
return;var tTransform=tNodeG.transform;tTransform._checkTransform();var onlyTranslate=false;onlyTranslate=!tTransform.bTransform;if(!onlyTranslate){g.drawTexture(tTex,0,0,tNodeG.width,tNodeG.height,tTransform.clone(),tNodeG.alpha);}else{g.drawTexture(tTex,tTransform.tx,tTransform.ty,tNodeG.width,tNodeG.height,null,tNodeG.alpha);}}
__proto._updateNodeGraphic2=function(node,frame,g){var tNodeG;tNodeG=this._nodeGDic[node.compId]=this._getNodeGraphicData(node.compId,frame,this._nodeGDic[node.compId]);if(!node.child){this._updateNoChilds(tNodeG,g);return;};var tTransform=tNodeG.transform;tTransform._checkTransform();var onlyTranslate=false;onlyTranslate=!tTransform.bTransform;var hasTrans=false;hasTrans=onlyTranslate&&(tTransform.tx!=0||tTransform.ty!=0);var ifSave=false;ifSave=(tTransform.bTransform)||tNodeG.alpha!=1;if(ifSave){g.save();}
if(tNodeG.alpha!=1){g.alpha(tNodeG.alpha);}
if(!onlyTranslate){g.transform(tTransform.clone());}else if(hasTrans){g.translate(tTransform.tx,tTransform.ty);};var childs;childs=node.child;var tTex;if(tNodeG.skin){tTex=this._getTextureByUrl(tNodeG.skin);if(tTex){g.drawTexture(tTex,0,0,tNodeG.width,tNodeG.height);}}
if(childs){var i=0,len=0;len=childs.length;for(i=0;i<len;i++){this._updateNodeGraphic2(childs[i],frame,g);}}
if(ifSave){g.restore();}else{if(!onlyTranslate){g.transform(tTransform.clone().invert());}else if(hasTrans){g.translate(-tTransform.tx,-tTransform.ty);}}}
__proto._calculateNodeKeyFrames=function(node){_super.prototype._calculateNodeKeyFrames.call(this,node);this._nodeIDAniDic[node.target]=node;}
__proto.getNodeDataByID=function(nodeID){return this._nodeIDAniDic[nodeID];}
__proto._getParams=function(obj,params,frame,obj2){var rst=GraphicAnimation._temParam;rst.length=params.length;var i=0,len=params.length;for(i=0;i<len;i++){rst[i]=this._getObjVar(obj,params[i][0],frame,params[i][1],obj2);}
return rst;}
__proto._getObjVar=function(obj,key,frame,noValue,obj2){if(obj.hasOwnProperty(key)){var vArr=obj[key];if(frame>=vArr.length)
frame=vArr.length-1;return obj[key][frame];}
if(obj2.hasOwnProperty(key)){return obj2[key];}
return noValue;}
__proto._getNodeGraphicData=function(nodeID,frame,rst){if(!rst)
rst=GraphicNode.create();if(!rst.transform){rst.transform=Matrix.create();}else{rst.transform.identity();};var node=this.getNodeDataByID(nodeID);if(!node)
return rst;var frameData=node.frames;var params=this._getParams(frameData,GraphicAnimation._drawTextureCmd,frame,this._nodeDefaultProps[nodeID]);var url=params[0];var width=NaN,height=NaN;var px=params[5],py=params[6];var aX=params[13],aY=params[14];var sx=params[7],sy=params[8];var rotate=params[9];var skewX=params[11],skewY=params[12]
width=params[3];height=params[4];if(width==0||height==0)url=null;if(width==-1)width=0;if(height==-1)height=0;var tex;rst.skin=url;rst.width=width;rst.height=height;if(url){tex=this._getTextureByUrl(url);if(tex){if(!width)
width=tex.sourceWidth;if(!height)
height=tex.sourceHeight;}else{console.warn("lost skin:",url,",you may load pics first");}}
rst.alpha=params[10];var m;m=rst.transform;if(aX!=0){px=aX*width;}
if(aY!=0){py=aY*height;}
if(px!=0||py!=0){m.translate(-px,-py);};var tm=null;if(rotate||sx!==1||sy!==1||skewX||skewY){tm=GraphicAnimation._tempMt;tm.identity();tm.bTransform=true;var skx=(rotate-skewX)*0.0174532922222222;var sky=(rotate+skewY)*0.0174532922222222;var cx=Math.cos(sky);var ssx=Math.sin(sky);var cy=Math.sin(skx);var ssy=Math.cos(skx);tm.a=sx*cx;tm.b=sx*ssx;tm.c=-sy*cy;tm.d=sy*ssy;tm.tx=tm.ty=0;}
if(tm){m=Matrix.mul(m,tm,m);}
m.translate(params[1],params[2]);return rst;}
__proto._getTextureByUrl=function(url){return Loader.getRes(url);}
__proto.setAniData=function(uiView,aniName){if(uiView.animations){this._nodeDefaultProps={};this._nodeGDic={};if(this._nodeList)
this._nodeList.length=0;this._rootNode=uiView;this._parseNodeList(uiView);var aniDic={};var anilist=[];var animations=uiView.animations;var i=0,len=animations.length;var tAniO;for(i=0;i<len;i++){tAniO=animations[i];this._labels=null;if(aniName&&aniName!=tAniO.name){continue;}
if(!tAniO)
continue;try{this._calGraphicData(tAniO);}catch(e){console.warn("parse animation fail:"+tAniO.name+",empty animation created");this._gList=[];};var frameO={};frameO.interval=1000/tAniO["frameRate"];frameO.frames=this._gList;frameO.labels=this._labels;frameO.name=tAniO.name;anilist.push(frameO);aniDic[tAniO.name]=frameO;}
this.animationList=anilist;this.animationDic=aniDic;}
GraphicAnimation._temParam.length=0;}
__proto.parseByData=function(aniData){var rootNode,aniO;rootNode=aniData.nodeRoot;aniO=aniData.aniO;delete aniData.nodeRoot;delete aniData.aniO;this._nodeDefaultProps={};this._nodeGDic={};if(this._nodeList)
this._nodeList.length=0;this._rootNode=rootNode;this._parseNodeList(rootNode);this._labels=null;try{this._calGraphicData(aniO);}catch(e){console.warn("parse animation fail:"+aniO.name+",empty animation created");this._gList=[];};var frameO=aniData;frameO.interval=1000/aniO["frameRate"];frameO.frames=this._gList;frameO.labels=this._labels;frameO.name=aniO.name;return frameO;}
__proto.setUpAniData=function(uiView){if(uiView.animations){var aniDic={};var anilist=[];var animations=uiView.animations;var i=0,len=animations.length;var tAniO;for(i=0;i<len;i++){tAniO=animations[i];if(!tAniO)
continue;var frameO={};frameO.name=tAniO.name;frameO.aniO=tAniO;frameO.nodeRoot=uiView;anilist.push(frameO);aniDic[tAniO.name]=frameO;}
this.animationList=anilist;this.animationDic=aniDic;}}
__proto._clear=function(){this.animationList=null;this.animationDic=null;this._gList=null;if(this._nodeGDic){var key;var tGNode;for(key in this._nodeGDic){tGNode=this._nodeGDic[key];if(tGNode)tGNode.recover();}}
this._nodeGDic=null;}
GraphicAnimation.parseAnimationByData=function(animationObject){if(!GraphicAnimation._I)
GraphicAnimation._I=new GraphicAnimation();var rst;rst=GraphicAnimation._I.parseByData(animationObject);GraphicAnimation._I._clear();return rst;}
GraphicAnimation.parseAnimationData=function(aniData){if(!GraphicAnimation._I)
GraphicAnimation._I=new GraphicAnimation();GraphicAnimation._I.setUpAniData(aniData);var rst;rst={};rst.animationList=GraphicAnimation._I.animationList;rst.animationDic=GraphicAnimation._I.animationDic;GraphicAnimation._I._clear();return rst;}
GraphicAnimation._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]];GraphicAnimation._temParam=[];GraphicAnimation._I=null;GraphicAnimation._rootMatrix=null;__static(GraphicAnimation,['_tempMt',function(){return this._tempMt=new Matrix();}]);GraphicAnimation.__init$=function(){GraphicNode=(function(){function GraphicNode(){this.skin=null;this.transform=null;this.resultTransform=null;this.width=NaN;this.height=NaN;this.alpha=1;}
__class(GraphicNode,'');var __proto=GraphicNode.prototype;__proto.recover=function(){this.skin=null;this.width=0;this.height=0;this.alpha=1;if(this.transform){this.transform.destroy();this.transform=null;}
if(this.resultTransform){this.resultTransform.destroy();this.resultTransform=null;}
Pool.recover("GraphicNode",this);}
GraphicNode.create=function(){return Pool.getItemByClass("GraphicNode",GraphicNode);}
return GraphicNode;})()}
return GraphicAnimation;})(FrameAnimation)
Laya.__init([EventDispatcher,LoaderManager,Render,Browser,Timer,LocalStorage,TimeLine,GraphicAnimation]);})(window,document,Laya);(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var LayaMain=(function(){function LayaMain(){}
__class(LayaMain,'LayaMain');return LayaMain;})()
new LayaMain();})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var Browser=laya.utils.Browser,Event=laya.events.Event,EventDispatcher=laya.events.EventDispatcher;var HTMLImage=laya.resource.HTMLImage,Handler=laya.utils.Handler,Input=laya.display.Input,Loader=laya.net.Loader;var LocalStorage=laya.net.LocalStorage,Matrix=laya.maths.Matrix,Render=laya.renders.Render,RunDriver=laya.utils.RunDriver;var SoundChannel=laya.media.SoundChannel,SoundManager=laya.media.SoundManager,URL=laya.net.URL,Utils=laya.utils.Utils;var MiniAdpter=(function(){function MiniAdpter(){}
__class(MiniAdpter,'laya.wx.mini.MiniAdpter');MiniAdpter.getJson=function(data){return JSON.parse(data);}
MiniAdpter.init=function(isPosMsg,isSon){(isPosMsg===void 0)&&(isPosMsg=false);(isSon===void 0)&&(isSon=false);if(MiniAdpter._inited)return;MiniAdpter._inited=true;MiniAdpter.window=window;if(MiniAdpter.window.navigator.userAgent.indexOf('MiniGame')<0)return;MiniAdpter.isZiYu=isSon;MiniAdpter.isPosMsgYu=isPosMsg;MiniAdpter.EnvConfig={};if(!MiniAdpter.isZiYu){MiniFileMgr.setNativeFileDir("/layaairGame");MiniFileMgr.existDir(MiniFileMgr.fileNativeDir,Handler.create(MiniAdpter,MiniAdpter.onMkdirCallBack));}
MiniAdpter.systemInfo=wx.getSystemInfoSync();MiniAdpter.window.focus=function(){};Laya['getUrlPath']=function(){};MiniAdpter.window.logtime=function(str){};MiniAdpter.window.alertTimeLog=function(str){};MiniAdpter.window.resetShareInfo=function(){};MiniAdpter.window.CanvasRenderingContext2D=function(){};MiniAdpter.window.CanvasRenderingContext2D.prototype=MiniAdpter.window.wx.createCanvas().getContext('2d').__proto__;MiniAdpter.window.document.body.appendChild=function(){};MiniAdpter.EnvConfig.pixelRatioInt=0;RunDriver.getPixelRatio=MiniAdpter.pixelRatio;MiniAdpter._preCreateElement=Browser.createElement;Browser["createElement"]=MiniAdpter.createElement;RunDriver.createShaderCondition=MiniAdpter.createShaderCondition;Utils['parseXMLFromString']=MiniAdpter.parseXMLFromString;Input['_createInputElement']=MiniInput['_createInputElement'];MiniAdpter.EnvConfig.load=Loader.prototype.load;Loader.prototype.load=MiniLoader.prototype.load;Loader.prototype._loadImage=MiniImage.prototype._loadImage;MiniLocalStorage.__init__();LocalStorage._baseClass=MiniLocalStorage;}
MiniAdpter.getUrlEncode=function(url,type){if(url.indexOf(".fnt")!=-1)
return"utf8";else if(type=="arraybuffer")
return"";return"ascii";}
MiniAdpter.downLoadFile=function(fileUrl,fileType,callBack,encoding){(fileType===void 0)&&(fileType="");(encoding===void 0)&&(encoding="ascii");var fileObj=MiniFileMgr.getFileInfo(fileUrl);if(!fileObj)
MiniFileMgr.downLoadFile(fileUrl,fileType,callBack,encoding);else{callBack!=null&&callBack.runWith([0]);}}
MiniAdpter.remove=function(fileUrl,callBack){MiniFileMgr.deleteFile("",fileUrl,callBack,"",0);}
MiniAdpter.removeAll=function(){MiniFileMgr.deleteAll();}
MiniAdpter.hasNativeFile=function(fileUrl){return MiniFileMgr.isLocalNativeFile(fileUrl);}
MiniAdpter.getFileInfo=function(fileUrl){return MiniFileMgr.getFileInfo(fileUrl);}
MiniAdpter.getFileList=function(){return MiniFileMgr.filesListObj;}
MiniAdpter.exitMiniProgram=function(){MiniAdpter.window["wx"].exitMiniProgram();}
MiniAdpter.onMkdirCallBack=function(errorCode,data){if(!errorCode)
MiniFileMgr.filesListObj=JSON.parse(data.data);}
MiniAdpter.pixelRatio=function(){if(!MiniAdpter.EnvConfig.pixelRatioInt){try{MiniAdpter.EnvConfig.pixelRatioInt=MiniAdpter.systemInfo.pixelRatio;return MiniAdpter.systemInfo.pixelRatio;}catch(error){}}
return MiniAdpter.EnvConfig.pixelRatioInt;}
MiniAdpter.createElement=function(type){if(type=="canvas"){var _source;if(MiniAdpter.idx==1){if(MiniAdpter.isZiYu){_source=sharedCanvas;_source.style={};}else{_source=window.canvas;}}else{_source=window.wx.createCanvas();}
MiniAdpter.idx++;return _source;}else if(type=="textarea"||type=="input"){return MiniAdpter.onCreateInput(type);}else if(type=="div"){var node=MiniAdpter._preCreateElement(type);node.contains=function(value){return null};node.removeChild=function(value){};return node;}else{return MiniAdpter._preCreateElement(type);}}
MiniAdpter.onCreateInput=function(type){var node=MiniAdpter._preCreateElement(type);node.focus=MiniInput.wxinputFocus;node.blur=MiniInput.wxinputblur;node.style={};node.value=0;node.parentElement={};node.placeholder={};node.type={};node.setColor=function(value){};node.setType=function(value){};node.setFontFace=function(value){};node.addEventListener=function(value){};node.contains=function(value){return null};node.removeChild=function(value){};return node;}
MiniAdpter.createShaderCondition=function(conditionScript){var _$this=this;var func=function(){var abc=conditionScript;return _$this[conditionScript.replace("this.","")];}
return func;}
MiniAdpter.EnvConfig=null;MiniAdpter.window=null;MiniAdpter._preCreateElement=null;MiniAdpter._inited=false;MiniAdpter.systemInfo=null;MiniAdpter.isZiYu=false;MiniAdpter.isPosMsgYu=false;MiniAdpter.autoCacheFile=true;MiniAdpter.minClearSize=(5*1024*1024);MiniAdpter.parseXMLFromString=function(value){var rst;var Parser;value=value.replace(/>\s+</g,'><');try{rst=(new window.Parser.DOMParser()).parseFromString(value,'text/xml');}catch(error){throw"需要引入xml解析库文件";}
return rst;}
MiniAdpter.idx=1;__static(MiniAdpter,['nativefiles',function(){return this.nativefiles=["layaNativeDir","wxlocal"];}]);return MiniAdpter;})()
var MiniFileMgr=(function(){function MiniFileMgr(){}
__class(MiniFileMgr,'laya.wx.mini.MiniFileMgr');MiniFileMgr.isLocalNativeFile=function(url){for(var i=0,sz=MiniAdpter.nativefiles.length;i<sz;i++){if(url.indexOf(MiniAdpter.nativefiles[i])!=-1)
return true;}
return false;}
MiniFileMgr.getFileInfo=function(fileUrl){var fileNativePath=fileUrl.split("?")[0];var fileObj=MiniFileMgr.filesListObj[fileNativePath];if(fileObj==null)
return null;else
return fileObj;return null;}
MiniFileMgr.read=function(filePath,encoding,callBack,readyUrl,isSaveFile,fileType){(encoding===void 0)&&(encoding="ascill");(readyUrl===void 0)&&(readyUrl="");(isSaveFile===void 0)&&(isSaveFile=false);(fileType===void 0)&&(fileType="");var fileUrl;if(readyUrl!=""&&(readyUrl.indexOf("http://")!=-1||readyUrl.indexOf("https://")!=-1)){fileUrl=MiniFileMgr.getFileNativePath(filePath)}else{fileUrl=filePath;}
MiniFileMgr.fs.readFile({filePath:fileUrl,encoding:encoding,success:function(data){callBack!=null&&callBack.runWith([0,data]);},fail:function(data){if(data&&readyUrl!="")
MiniFileMgr.downFiles(readyUrl,encoding,callBack,readyUrl,isSaveFile,fileType);else
callBack!=null&&callBack.runWith([1]);}});}
MiniFileMgr.downFiles=function(fileUrl,encoding,callBack,readyUrl,isSaveFile,fileType){(encoding===void 0)&&(encoding="ascii");(readyUrl===void 0)&&(readyUrl="");(isSaveFile===void 0)&&(isSaveFile=false);(fileType===void 0)&&(fileType="");var downloadTask=MiniFileMgr.wxdown({url:fileUrl,success:function(data){if(data.statusCode===200)
MiniFileMgr.readFile(data.tempFilePath,encoding,callBack,readyUrl,isSaveFile,fileType);},fail:function(data){callBack!=null&&callBack.runWith([1,data]);}});downloadTask.onProgressUpdate(function(data){callBack!=null&&callBack.runWith([2,data.progress]);});}
MiniFileMgr.readFile=function(filePath,encoding,callBack,readyUrl,isSaveFile,fileType){(encoding===void 0)&&(encoding="ascill");(readyUrl===void 0)&&(readyUrl="");(isSaveFile===void 0)&&(isSaveFile=false);(fileType===void 0)&&(fileType="");MiniFileMgr.fs.readFile({filePath:filePath,encoding:encoding,success:function(data){if(filePath.indexOf("http://")!=-1||filePath.indexOf("https://")!=-1){if(MiniAdpter.autoCacheFile||isSaveFile){MiniFileMgr.copyFile(filePath,readyUrl,callBack,encoding);}}
else
callBack!=null&&callBack.runWith([0,data]);},fail:function(data){if(data)
callBack!=null&&callBack.runWith([1,data]);}});}
MiniFileMgr.downOtherFiles=function(fileUrl,callBack,readyUrl,isSaveFile){(readyUrl===void 0)&&(readyUrl="");(isSaveFile===void 0)&&(isSaveFile=false);MiniFileMgr.wxdown({url:fileUrl,success:function(data){if(data.statusCode===200){if((MiniAdpter.autoCacheFile||isSaveFile)&&readyUrl.indexOf("wx.qlogo.cn")==-1)
MiniFileMgr.copyFile(data.tempFilePath,readyUrl,callBack);else
callBack!=null&&callBack.runWith([0,data.tempFilePath]);}},fail:function(data){callBack!=null&&callBack.runWith([1,data]);}});}
MiniFileMgr.downLoadFile=function(fileUrl,fileType,callBack,encoding){(fileType===void 0)&&(fileType="");(encoding===void 0)&&(encoding="ascii");if(fileType=="image"||fileType=="sound")
MiniFileMgr.downOtherFiles(fileUrl,callBack,fileUrl,true);else
MiniFileMgr.downFiles(fileUrl,encoding,callBack,fileUrl,true,fileType);}
MiniFileMgr.copyFile=function(tempFilePath,readyUrl,callBack,encoding){(encoding===void 0)&&(encoding="");var temp=tempFilePath.split("/");var tempFileName=temp[temp.length-1];var fileurlkey=readyUrl.split("?")[0];var fileObj=MiniFileMgr.getFileInfo(readyUrl);var saveFilePath=MiniFileMgr.getFileNativePath(tempFileName);var totalSize=50*1024*1024;var chaSize=4*1024*1024;var fileUseSize=MiniFileMgr.getCacheUseSize();if(fileObj){if(fileObj.readyUrl!=readyUrl){MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function(data){if((fileUseSize+chaSize+data.size)>=totalSize){if(data.size>MiniAdpter.minClearSize)
MiniAdpter.minClearSize=data.size;MiniFileMgr.onClearCacheRes();}
MiniFileMgr.deleteFile(tempFileName,readyUrl,callBack,encoding,data.size);},fail:function(data){callBack!=null&&callBack.runWith([1,data]);}});}
else
callBack!=null&&callBack.runWith([0]);}else{MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function(data){if((fileUseSize+chaSize+data.size)>=totalSize){if(data.size>MiniAdpter.minClearSize)
MiniAdpter.minClearSize=data.size;MiniFileMgr.onClearCacheRes();}
MiniFileMgr.fs.copyFile({srcPath:tempFilePath,destPath:saveFilePath,success:function(data2){MiniFileMgr.onSaveFile(readyUrl,tempFileName,true,encoding,callBack,data.size);},fail:function(data){callBack!=null&&callBack.runWith([1,data]);}});},fail:function(data){callBack!=null&&callBack.runWith([1,data]);}});}}
MiniFileMgr.onClearCacheRes=function(){var memSize=MiniAdpter.minClearSize;var tempFileListArr=[];for(var key in MiniFileMgr.filesListObj){tempFileListArr.push(MiniFileMgr.filesListObj[key]);}
MiniFileMgr.sortOn(tempFileListArr,"time",16);var clearSize=0;for(var i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];if(clearSize>=memSize)
break;clearSize+=fileObj.size;MiniFileMgr.deleteFile("",fileObj.readyUrl);}}
MiniFileMgr.sortOn=function(array,name,options){(options===void 0)&&(options=0);if(options==16)return array.sort(function(a,b){return a[name]-b[name];});if(options==(16|2))return array.sort(function(a,b){return b[name]-a[name];});return array.sort(function(a,b){return a[name]-b[name]});}
MiniFileMgr.getFileNativePath=function(fileName){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+fileName;}
MiniFileMgr.deleteFile=function(tempFileName,readyUrl,callBack,encoding,fileSize){(readyUrl===void 0)&&(readyUrl="");(encoding===void 0)&&(encoding="");(fileSize===void 0)&&(fileSize=0);var fileObj=MiniFileMgr.getFileInfo(readyUrl);var deleteFileUrl=MiniFileMgr.getFileNativePath(fileObj.md5);MiniFileMgr.fs.unlink({filePath:deleteFileUrl,success:function(data){var isAdd=tempFileName!=""?true:false;if(tempFileName!=""){var saveFilePath=MiniFileMgr.getFileNativePath(tempFileName);MiniFileMgr.fs.copyFile({srcPath:tempFileName,destPath:saveFilePath,success:function(data){MiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd,encoding,callBack,data.size);},fail:function(data){callBack!=null&&callBack.runWith([1,data]);}});}else{MiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd,encoding,callBack,fileSize);}},fail:function(data){}});}
MiniFileMgr.deleteAll=function(){var tempFileListArr=[];for(var key in MiniFileMgr.filesListObj){tempFileListArr.push(MiniFileMgr.filesListObj[key]);}
for(var i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];MiniFileMgr.deleteFile("",fileObj.readyUrl);}}
MiniFileMgr.onSaveFile=function(readyUrl,md5Name,isAdd,encoding,callBack,fileSize){(isAdd===void 0)&&(isAdd=true);(encoding===void 0)&&(encoding="");(fileSize===void 0)&&(fileSize=0);var fileurlkey=readyUrl.split("?")[0];if(MiniFileMgr.filesListObj['fileUsedSize']==null)
MiniFileMgr.filesListObj['fileUsedSize']=0;if(isAdd){var fileNativeName=MiniFileMgr.getFileNativePath(md5Name);MiniFileMgr.filesListObj[fileurlkey]={md5:md5Name,readyUrl:readyUrl,size:fileSize,times:Browser.now(),encoding:encoding};MiniFileMgr.filesListObj['fileUsedSize']=parseInt(MiniFileMgr.filesListObj['fileUsedSize'])+fileSize;MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),true);callBack!=null&&callBack.runWith([0]);}else{if(MiniFileMgr.filesListObj[fileurlkey]){var deletefileSize=parseInt(MiniFileMgr.filesListObj[fileurlkey].size);MiniFileMgr.filesListObj['fileUsedSize']=parseInt(MiniFileMgr.filesListObj['fileUsedSize'])-deletefileSize;delete MiniFileMgr.filesListObj[fileurlkey];MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),false);callBack!=null&&callBack.runWith([0]);}}}
MiniFileMgr.writeFilesList=function(fileurlkey,filesListStr,isAdd){var listFilesPath=MiniFileMgr.fileNativeDir+"/"+MiniFileMgr.fileListName;MiniFileMgr.fs.writeFile({filePath:listFilesPath,encoding:'utf8',data:filesListStr,success:function(data){},fail:function(data){}});if(!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu){wx.postMessage({url:fileurlkey,data:MiniFileMgr.filesListObj[fileurlkey],isLoad:"filenative",isAdd:isAdd});}}
MiniFileMgr.getCacheUseSize=function(){if(MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj['fileUsedSize'])
return MiniFileMgr.filesListObj['fileUsedSize'];return 0;}
MiniFileMgr.existDir=function(dirPath,callBack){MiniFileMgr.fs.mkdir({dirPath:dirPath,success:function(data){callBack!=null&&callBack.runWith([0,{data:JSON.stringify({})}]);},fail:function(data){if(data.errMsg.indexOf("file already exists")!=-1)
MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",callBack);else
callBack!=null&&callBack.runWith([1,data]);}});}
MiniFileMgr.readSync=function(filePath,encoding,callBack,readyUrl){(encoding===void 0)&&(encoding="ascill");(readyUrl===void 0)&&(readyUrl="");var fileUrl=MiniFileMgr.getFileNativePath(filePath);var filesListStr
try{filesListStr=MiniFileMgr.fs.readFileSync(fileUrl,encoding);callBack!=null&&callBack.runWith([0,{data:filesListStr}]);}
catch(error){callBack!=null&&callBack.runWith([1]);}}
MiniFileMgr.setNativeFileDir=function(value){MiniFileMgr.fileNativeDir=wx.env.USER_DATA_PATH+value;}
MiniFileMgr.filesListObj={};MiniFileMgr.fileNativeDir=null;MiniFileMgr.fileListName="layaairfiles.txt";MiniFileMgr.ziyuFileData={};MiniFileMgr.loadPath="";MiniFileMgr.DESCENDING=2;MiniFileMgr.NUMERIC=16;__static(MiniFileMgr,['fs',function(){return this.fs=wx.getFileSystemManager();},'wxdown',function(){return this.wxdown=wx.downloadFile;}]);return MiniFileMgr;})()
var MiniImage=(function(){function MiniImage(){}
__class(MiniImage,'laya.wx.mini.MiniImage');var __proto=MiniImage.prototype;__proto._loadImage=function(url){var thisLoader=this;if(MiniAdpter.isZiYu){MiniImage.onCreateImage(url,thisLoader,true);return;};var isTransformUrl=false;if(!MiniFileMgr.isLocalNativeFile(url)){isTransformUrl=true;url=URL.formatURL(url);}else{if(url.indexOf("http://")!=-1||url.indexOf("https://")!=-1){if(MiniFileMgr.loadPath!=""){url=url.split(MiniFileMgr.loadPath)[1];}else{var tempStr=URL.rootPath!=""?URL.rootPath:URL.basePath;if(tempStr!="")
url=url.split(tempStr)[1];}}}
if(!MiniFileMgr.getFileInfo(url)){if(url.indexOf("http://")!=-1||url.indexOf("https://")!=-1){if(MiniAdpter.isZiYu){MiniImage.onCreateImage(url,thisLoader,true);}else{MiniFileMgr.downOtherFiles(url,new Handler(MiniImage,MiniImage.onDownImgCallBack,[url,thisLoader]),url);}}
else
MiniImage.onCreateImage(url,thisLoader,true);}else{MiniImage.onCreateImage(url,thisLoader,!isTransformUrl);}}
MiniImage.onDownImgCallBack=function(sourceUrl,thisLoader,errorCode,tempFilePath){(tempFilePath===void 0)&&(tempFilePath="");if(!errorCode)
MiniImage.onCreateImage(sourceUrl,thisLoader,false,tempFilePath);else{thisLoader.onError(null);}}
MiniImage.onCreateImage=function(sourceUrl,thisLoader,isLocal,tempFilePath){(isLocal===void 0)&&(isLocal=false);(tempFilePath===void 0)&&(tempFilePath="");var fileNativeUrl;if(MiniAdpter.autoCacheFile){if(!isLocal){if(tempFilePath!=""){fileNativeUrl=tempFilePath;}else{var fileObj=MiniFileMgr.getFileInfo(sourceUrl);var fileMd5Name=fileObj.md5;fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);}}else
fileNativeUrl=sourceUrl;}else{if(!isLocal)
fileNativeUrl=tempFilePath;else
fileNativeUrl=sourceUrl;}
if(thisLoader.imgCache==null)
thisLoader.imgCache={};var image;function clear(){image.onload=null;image.onerror=null;delete thisLoader.imgCache[sourceUrl]};var onload=function(){clear();thisLoader._url=URL.formatURL(thisLoader._url);thisLoader.onLoaded(image);};var onerror=function(){clear();thisLoader.event("error","Load image failed");}
if(thisLoader._type=="nativeimage"){image=new Browser.window.Image();image.crossOrigin="";image.onload=onload;image.onerror=onerror;image.src=fileNativeUrl;thisLoader.imgCache[sourceUrl]=image;}else{new HTMLImage.create(fileNativeUrl,{onload:onload,onerror:onerror,onCreate:function(img){image=img;thisLoader.imgCache[sourceUrl]=img;}});}}
return MiniImage;})()
var MiniInput=(function(){function MiniInput(){}
__class(MiniInput,'laya.wx.mini.MiniInput');MiniInput._createInputElement=function(){Input['_initInput'](Input['area']=Browser.createElement("textarea"));Input['_initInput'](Input['input']=Browser.createElement("input"));Input['inputContainer']=Browser.createElement("div");Input['inputContainer'].style.position="absolute";Input['inputContainer'].style.zIndex=1E5;Browser.container.appendChild(Input['inputContainer']);Input['inputContainer'].setPos=function(x,y){Input['inputContainer'].style.left=x+'px';Input['inputContainer'].style.top=y+'px';};Laya.stage.on("resize",null,MiniInput._onStageResize);wx.onWindowResize&&wx.onWindowResize(function(res){window.dispatchEvent&&window.dispatchEvent("resize");});SoundManager._soundClass=MiniSound;SoundManager._musicClass=MiniSound;var model=MiniAdpter.systemInfo.model;var system=MiniAdpter.systemInfo.system;if(model.indexOf("iPhone")!=-1){Browser.onIPhone=true;Browser.onIOS=true;Browser.onIPad=true;Browser.onAndriod=false;}
if(system.indexOf("Android")!=-1||system.indexOf("Adr")!=-1){Browser.onAndriod=true;Browser.onIPhone=false;Browser.onIOS=false;Browser.onIPad=false;}}
MiniInput._onStageResize=function(){var ts=Laya.stage._canvasTransform.identity();ts.scale((Browser.width/Render.canvas.width/RunDriver.getPixelRatio()),Browser.height/Render.canvas.height/RunDriver.getPixelRatio());}
MiniInput.wxinputFocus=function(e){var _inputTarget=Input['inputElement'].target;if(_inputTarget&&!_inputTarget.editable){return;}
MiniAdpter.window.wx.offKeyboardConfirm();MiniAdpter.window.wx.offKeyboardInput();MiniAdpter.window.wx.showKeyboard({defaultValue:_inputTarget.text,maxLength:_inputTarget.maxChars,multiple:_inputTarget.multiline,confirmHold:true,confirmType:'done',success:function(res){},fail:function(res){}});MiniAdpter.window.wx.onKeyboardConfirm(function(res){var str=res?res.value:"";_inputTarget.text=str;_inputTarget.event("input");laya.wx.mini.MiniInput.inputEnter();})
MiniAdpter.window.wx.onKeyboardInput(function(res){var str=res?res.value:"";if(!_inputTarget.multiline){if(str.indexOf("\n")!=-1){laya.wx.mini.MiniInput.inputEnter();return;}}
_inputTarget.text=str;_inputTarget.event("input");});}
MiniInput.inputEnter=function(){Input['inputElement'].target.focus=false;}
MiniInput.wxinputblur=function(){MiniInput.hideKeyboard();}
MiniInput.hideKeyboard=function(){MiniAdpter.window.wx.offKeyboardConfirm();MiniAdpter.window.wx.offKeyboardInput();MiniAdpter.window.wx.hideKeyboard({success:function(res){console.log('隐藏键盘')},fail:function(res){console.log("隐藏键盘出错:"+(res?res.errMsg:""));}});}
return MiniInput;})()
var MiniLocalStorage=(function(){function MiniLocalStorage(){}
__class(MiniLocalStorage,'laya.wx.mini.MiniLocalStorage');MiniLocalStorage.__init__=function(){MiniLocalStorage.items=MiniLocalStorage;}
MiniLocalStorage.setItem=function(key,value){wx.setStorageSync(key,value);}
MiniLocalStorage.getItem=function(key){return wx.getStorageSync(key);}
MiniLocalStorage.setJSON=function(key,value){MiniLocalStorage.setItem(key,value);}
MiniLocalStorage.getJSON=function(key){return MiniLocalStorage.getItem(key);}
MiniLocalStorage.removeItem=function(key){wx.removeStorageSync(key);}
MiniLocalStorage.clear=function(){wx.clearStorageSync();}
MiniLocalStorage.getStorageInfoSync=function(){try{var res=wx.getStorageInfoSync()
console.log(res.keys)
console.log(res.currentSize)
console.log(res.limitSize)
return res;}catch(e){}
return null;}
MiniLocalStorage.support=true;MiniLocalStorage.items=null;return MiniLocalStorage;})()
var MiniLocation=(function(){function MiniLocation(){}
__class(MiniLocation,'laya.wx.mini.MiniLocation');MiniLocation.__init__=function(){MiniAdpter.window.navigator.geolocation.getCurrentPosition=MiniLocation.getCurrentPosition;MiniAdpter.window.navigator.geolocation.watchPosition=MiniLocation.watchPosition;MiniAdpter.window.navigator.geolocation.clearWatch=MiniLocation.clearWatch;}
MiniLocation.getCurrentPosition=function(success,error,options){var paramO;paramO={};paramO.success=getSuccess;paramO.fail=error;MiniAdpter.window.wx.getLocation(paramO);function getSuccess(res){if(success!=null){success(res);}}}
MiniLocation.watchPosition=function(success,error,options){MiniLocation._curID++;var curWatchO;curWatchO={};curWatchO.success=success;curWatchO.error=error;MiniLocation._watchDic[MiniLocation._curID]=curWatchO;Laya.timer.loop(1000,null,MiniLocation._myLoop);return MiniLocation._curID;}
MiniLocation.clearWatch=function(id){delete MiniLocation._watchDic[id];if(!MiniLocation._hasWatch()){Laya.timer.clear(null,MiniLocation._myLoop);}}
MiniLocation._hasWatch=function(){var key;for(key in MiniLocation._watchDic){if(MiniLocation._watchDic[key])return true;}
return false;}
MiniLocation._myLoop=function(){MiniLocation.getCurrentPosition(MiniLocation._mySuccess,MiniLocation._myError);}
MiniLocation._mySuccess=function(res){var rst={};rst.coords=res;rst.timestamp=Browser.now();var key;for(key in MiniLocation._watchDic){if(MiniLocation._watchDic[key].success){MiniLocation._watchDic[key].success(rst);}}}
MiniLocation._myError=function(res){var key;for(key in MiniLocation._watchDic){if(MiniLocation._watchDic[key].error){MiniLocation._watchDic[key].error(res);}}}
MiniLocation._watchDic={};MiniLocation._curID=0;return MiniLocation;})()
var MiniAccelerator=(function(_super){function MiniAccelerator(){MiniAccelerator.__super.call(this);}
__class(MiniAccelerator,'laya.wx.mini.MiniAccelerator',_super);var __proto=MiniAccelerator.prototype;__proto.on=function(type,caller,listener,args){_super.prototype.on.call(this,type,caller,listener,args);MiniAccelerator.startListen(this["onDeviceOrientationChange"]);return this;}
__proto.off=function(type,caller,listener,onceOnly){(onceOnly===void 0)&&(onceOnly=false);if(!this.hasListener(type))
MiniAccelerator.stopListen();return _super.prototype.off.call(this,type,caller,listener,onceOnly);}
MiniAccelerator.__init__=function(){try{var Acc;Acc=laya.device.motion.Accelerator;if(!Acc)return;Acc["prototype"]["on"]=MiniAccelerator["prototype"]["on"];Acc["prototype"]["off"]=MiniAccelerator["prototype"]["off"];}catch(e){}}
MiniAccelerator.startListen=function(callBack){MiniAccelerator._callBack=callBack;if(MiniAccelerator._isListening)return;MiniAccelerator._isListening=true;try{wx.onAccelerometerChange(MiniAccelerator.onAccelerometerChange);}catch(e){}}
MiniAccelerator.stopListen=function(){MiniAccelerator._isListening=false;try{wx.stopAccelerometer({});}catch(e){}}
MiniAccelerator.onAccelerometerChange=function(res){var e;e={};e.acceleration=res;e.accelerationIncludingGravity=res;e.rotationRate={};if(MiniAccelerator._callBack!=null){MiniAccelerator._callBack(e);}}
MiniAccelerator._isListening=false;MiniAccelerator._callBack=null;return MiniAccelerator;})(EventDispatcher)
var MiniLoader=(function(_super){function MiniLoader(){MiniLoader.__super.call(this);}
__class(MiniLoader,'laya.wx.mini.MiniLoader',_super);var __proto=MiniLoader.prototype;__proto.load=function(url,type,cache,group,ignoreCache){(cache===void 0)&&(cache=true);(ignoreCache===void 0)&&(ignoreCache=false);var thisLoader=this;thisLoader._url=url;if(url.indexOf("data:image")===0)thisLoader._type=type="image";else{thisLoader._type=type||(type=thisLoader.getTypeFromUrl(url));}
thisLoader._cache=cache;thisLoader._data=null;if(!ignoreCache&&Loader.loadedMap[URL.formatURL(url)]){thisLoader._data=Loader.loadedMap[URL.formatURL(url)];this.event("progress",1);this.event("complete",thisLoader._data);return;}
if(Loader.parserMap[type]!=null){thisLoader._customParse=true;if(((Loader.parserMap[type])instanceof laya.utils.Handler))Loader.parserMap[type].runWith(this);else Loader.parserMap[type].call(null,this);return;};var encoding=MiniAdpter.getUrlEncode(url,type);var urlType=Utils.getFileExtension(url);if((MiniLoader._fileTypeArr.indexOf(urlType)!=-1)){MiniAdpter.EnvConfig.load.call(this,url,type,cache,group,ignoreCache);}else{if(MiniAdpter.isZiYu&&MiniFileMgr.ziyuFileData[url]){var tempData=MiniFileMgr.ziyuFileData[url];thisLoader.onLoaded(tempData);return;}
if(!MiniFileMgr.getFileInfo(url)){if(MiniFileMgr.isLocalNativeFile(url)){MiniFileMgr.read(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,thisLoader]));return;}
url=URL.formatURL(url);if(url.indexOf("http://")!=-1||url.indexOf("https://")!=-1){MiniAdpter.EnvConfig.load.call(thisLoader,url,type,cache,group,ignoreCache);}else{MiniFileMgr.readFile(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,thisLoader]),url);}}else{var fileObj=MiniFileMgr.getFileInfo(url);fileObj.encoding=fileObj.encoding==null?"ascii":fileObj.encoding;MiniFileMgr.readFile(url,fileObj.encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,thisLoader]),url);}}}
MiniLoader.onReadNativeCallBack=function(encoding,url,type,cache,group,ignoreCache,thisLoader,errorCode,data){(cache===void 0)&&(cache=true);(ignoreCache===void 0)&&(ignoreCache=false);(errorCode===void 0)&&(errorCode=0);if(!errorCode){var tempData;if(type=="json"||type=="atlas"){tempData=MiniAdpter.getJson(data.data);}else if(type=="xml"){tempData=Utils.parseXMLFromString(data.data);}else{tempData=data.data;}
if(!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu&&type!="arraybuffer"){wx.postMessage({url:url,data:tempData,isLoad:"filedata"});}
thisLoader.onLoaded(tempData);}else if(errorCode==1){MiniAdpter.EnvConfig.load.call(thisLoader,url,type,cache,group,ignoreCache);}}
__static(MiniLoader,['_fileTypeArr',function(){return this._fileTypeArr=['png','jpg','bmp','jpeg','gif'];}]);return MiniLoader;})(EventDispatcher)
var MiniSound=(function(_super){function MiniSound(){this._sound=null;this.url=null;this.loaded=false;this.readyUrl=null;MiniSound.__super.call(this);}
__class(MiniSound,'laya.wx.mini.MiniSound',_super);var __proto=MiniSound.prototype;__proto.load=function(url){url=URL.formatURL(url);this.url=url;this.readyUrl=url;if(MiniSound._audioCache[this.readyUrl]){this.event("complete");return;}
if(MiniAdpter.autoCacheFile&&MiniFileMgr.getFileInfo(url)){this.onDownLoadCallBack(url,0);}else{if(!MiniAdpter.autoCacheFile){this.onDownLoadCallBack(url,0);}else{MiniFileMgr.downOtherFiles(url,Handler.create(this,this.onDownLoadCallBack,[url]),url);}}}
__proto.onDownLoadCallBack=function(sourceUrl,errorCode){if(!errorCode){var fileNativeUrl;if(MiniAdpter.autoCacheFile){var fileObj=MiniFileMgr.getFileInfo(sourceUrl);var fileMd5Name=fileObj.md5;fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);this._sound=MiniSound._createSound();this._sound.src=this.url=fileNativeUrl;}else{this._sound=MiniSound._createSound();this._sound.src=sourceUrl;}
this._sound.onCanplay(MiniSound.bindToThis(this.onCanPlay,this));this._sound.onError(MiniSound.bindToThis(this.onError,this));}else{this.event("error");}}
__proto.onError=function(error){try{console.log("-----1---------------minisound-----id:"+MiniSound._id);console.log(error);}
catch(error){console.log("-----2---------------minisound-----id:"+MiniSound._id);console.log(error);}
this.event("error");this._sound.offError(null);}
__proto.onCanPlay=function(){this.loaded=true;this.event("complete");MiniSound._audioCache[this.readyUrl]=this;this._sound.offCanplay(null);}
__proto.play=function(startTime,loops){(startTime===void 0)&&(startTime=0);(loops===void 0)&&(loops=0);var tSound;if(this.url==SoundManager._tMusic){if(!MiniSound._musicAudio)MiniSound._musicAudio=MiniSound._createSound();tSound=MiniSound._musicAudio;}else{if(MiniSound._audioCache[this.readyUrl]){tSound=MiniSound._audioCache[this.readyUrl]._sound;}else{tSound=MiniSound._createSound();}}
if(MiniAdpter.autoCacheFile&&MiniFileMgr.getFileInfo(this.url)){var fileNativeUrl;var fileObj=MiniFileMgr.getFileInfo(this.url);var fileMd5Name=fileObj.md5;tSound.src=this.url=MiniFileMgr.getFileNativePath(fileMd5Name);}else{tSound.src=this.url;};var channel=new MiniSoundChannel(tSound,this);channel.url=this.url;channel.loops=loops;channel.loop=(loops===0?true:false);channel.startTime=startTime;channel.play();SoundManager.addChannel(channel);return channel;}
__proto.dispose=function(){var ad=MiniSound._audioCache[this.readyUrl];if(ad){ad.src="";if(ad._sound){ad._sound.destroy();ad._sound=null;ad=null;}
delete MiniSound._audioCache[this.readyUrl];}}
__getset(0,__proto,'duration',function(){return this._sound.duration;});MiniSound._createSound=function(){MiniSound._id++;return MiniAdpter.window.wx.createInnerAudioContext();}
MiniSound.bindToThis=function(fun,scope){var rst=fun;rst=fun.bind(scope);;return rst;}
MiniSound._musicAudio=null;MiniSound._id=0;MiniSound._audioCache={};return MiniSound;})(EventDispatcher)
var MiniSoundChannel=(function(_super){function MiniSoundChannel(audio,miniSound){this._audio=null;this._onEnd=null;this._miniSound=null;MiniSoundChannel.__super.call(this);this._audio=audio;this._miniSound=miniSound;this._onEnd=MiniSoundChannel.bindToThis(this.__onEnd,this);audio.onEnded(this._onEnd);}
__class(MiniSoundChannel,'laya.wx.mini.MiniSoundChannel',_super);var __proto=MiniSoundChannel.prototype;__proto.__onEnd=function(){if(this.loops==1){if(this.completeHandler){Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],false);this.completeHandler=null;}
this.stop();this.event("complete");return;}
if(this.loops>0){this.loops--;}
this.startTime=0;this.play();}
__proto.play=function(){this.isStopped=false;SoundManager.addChannel(this);this._audio.play();}
__proto.stop=function(){this.isStopped=true;SoundManager.removeChannel(this);this.completeHandler=null;if(!this._audio)
return;this._audio.pause();this._audio.offEnded(null);this._audio=null;this._miniSound=null;this._onEnd=null;}
__proto.pause=function(){this.isStopped=true;this._audio.pause();}
__proto.resume=function(){if(!this._audio)
return;this.isStopped=false;SoundManager.addChannel(this);this._audio.play();}
__getset(0,__proto,'autoplay',function(){return this._audio.autoplay;},function(value){this._audio.autoplay=value;});__getset(0,__proto,'position',function(){if(!this._audio)
return 0;return this._audio.currentTime;});__getset(0,__proto,'duration',function(){if(!this._audio)
return 0;return this._audio.duration;});__getset(0,__proto,'loop',function(){return this._audio.loop;},function(value){this._audio.loop=value;});__getset(0,__proto,'volume',function(){if(!this._audio)return 1;return this._audio.volume;},function(v){if(!this._audio)return;this._audio.volume=v;});MiniSoundChannel.bindToThis=function(fun,scope){var rst=fun;rst=fun.bind(scope);;return rst;}
return MiniSoundChannel;})(SoundChannel)})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var Arith=laya.maths.Arith,Bezier=laya.maths.Bezier,Bitmap=laya.resource.Bitmap,Browser=laya.utils.Browser;var Byte=laya.utils.Byte,Color=laya.utils.Color,ColorFilter=laya.filters.ColorFilter,Config=Laya.Config,Context=laya.resource.Context;var Event=laya.events.Event,Filter=laya.filters.Filter,Graphics=laya.display.Graphics,HTMLCanvas=laya.resource.HTMLCanvas;var HTMLChar=laya.utils.HTMLChar,HTMLImage=laya.resource.HTMLImage,HTMLSubImage=laya.resource.HTMLSubImage;var Handler=laya.utils.Handler,Loader=laya.net.Loader,Matrix=laya.maths.Matrix,Point=laya.maths.Point,Rectangle=laya.maths.Rectangle;var Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite;var Resource=laya.resource.Resource,ResourceManager=laya.resource.ResourceManager,RunDriver=laya.utils.RunDriver;var Sprite=laya.display.Sprite,Stage=laya.display.Stage,Stat=laya.utils.Stat,StringKey=laya.utils.StringKey;var Style=laya.display.css.Style,System=laya.system.System,Text=laya.display.Text,Texture=laya.resource.Texture;var TransformInfo=laya.display.css.TransformInfo,URL=laya.net.URL,Utils=laya.utils.Utils,VectorGraphManager=laya.utils.VectorGraphManager;var WordText=laya.utils.WordText;Laya.interface('laya.webgl.shapes.IShape');Laya.interface('laya.webgl.submit.ISubmit');Laya.interface('laya.webgl.text.ICharSegment');Laya.interface('laya.webgl.canvas.save.ISaveData');Laya.interface('laya.webgl.resource.IMergeAtlasBitmap');Laya.interface('laya.filters.IFilterActionGL','laya.filters.IFilterAction');var FilterActionGL=(function(){function FilterActionGL(){}
__class(FilterActionGL,'laya.filters.webgl.FilterActionGL');var __proto=FilterActionGL.prototype;Laya.imps(__proto,{"laya.filters.IFilterActionGL":true})
__proto.setValue=function(shader){}
__proto.setValueMix=function(shader){}
__proto.apply3d=function(scope,sprite,context,x,y){return null;}
__proto.apply=function(srcCanvas){return null;}
__getset(0,__proto,'typeMix',function(){return 0;});return FilterActionGL;})()
var ShaderValue=(function(){function ShaderValue(){}
__class(ShaderValue,'laya.webgl.shader.ShaderValue');return ShaderValue;})()
var AtlasGrid=(function(){var TexRowInfo,TexMergeTexSize;function AtlasGrid(width,height,atlasID){this._atlasID=0;this._width=0;this._height=0;this._texCount=0;this._rowInfo=null;this._cells=null;this._failSize=new TexMergeTexSize();(width===void 0)&&(width=0);(height===void 0)&&(height=0);(atlasID===void 0)&&(atlasID=0);this._cells=null;this._rowInfo=null;this._init(width,height);this._atlasID=atlasID;}
__class(AtlasGrid,'laya.webgl.atlas.AtlasGrid');var __proto=AtlasGrid.prototype;__proto.getAltasID=function(){return this._atlasID;}
__proto.setAltasID=function(atlasID){if(atlasID>=0){this._atlasID=atlasID;}}
__proto.addTex=function(type,width,height){var result=this._get(width,height);if(result.ret==false){return result;}
this._fill(result.x,result.y,width,height,type);this._texCount++;return result;}
__proto._release=function(){if(this._cells!=null){this._cells.length=0;this._cells=null;}
if(this._rowInfo){this._rowInfo.length=0;this._rowInfo=null;}}
__proto._init=function(width,height){this._width=width;this._height=height;this._release();if(this._width==0)return false;this._cells=new Uint8Array(this._width*this._height*3);this._rowInfo=__newvec(this._height);for(var i=0;i<this._height;i++){this._rowInfo[i]=new TexRowInfo();}
this._clear();return true;}
__proto._get=function(width,height){var pFillInfo=new MergeFillInfo();if(width>=this._failSize.width&&height>=this._failSize.height){return pFillInfo;};var rx=-1;var ry=-1;var nWidth=this._width;var nHeight=this._height;var pCellBox=this._cells;for(var y=0;y<nHeight;y++){if(this._rowInfo[y].spaceCount<width)continue;for(var x=0;x<nWidth;){var tm=(y*nWidth+x)*3;if(pCellBox[tm]!=0||pCellBox[tm+1]<width||pCellBox[tm+2]<height){x+=pCellBox[tm+1];continue;}
rx=x;ry=y;for(var xx=0;xx<width;xx++){if(pCellBox[3*xx+tm+2]<height){rx=-1;break;}}
if(rx<0){x+=pCellBox[tm+1];continue;}
pFillInfo.ret=true;pFillInfo.x=rx;pFillInfo.y=ry;return pFillInfo;}}
return pFillInfo;}
__proto._fill=function(x,y,w,h,type){var nWidth=this._width;var nHeghit=this._height;this._check((x+w)<=nWidth&&(y+h)<=nHeghit);for(var yy=y;yy<(h+y);++yy){this._check(this._rowInfo[yy].spaceCount>=w);this._rowInfo[yy].spaceCount-=w;for(var xx=0;xx<w;xx++){var tm=(x+yy*nWidth+xx)*3;this._check(this._cells[tm]==0);this._cells[tm]=type;this._cells[tm+1]=w;this._cells[tm+2]=h;}}
if(x>0){for(yy=0;yy<h;++yy){var s=0;for(xx=x-1;xx>=0;--xx,++s){if(this._cells[((y+yy)*nWidth+xx)*3]!=0)break;}
for(xx=s;xx>0;--xx){this._cells[((y+yy)*nWidth+x-xx)*3+1]=xx;this._check(xx>0);}}}
if(y>0){for(xx=x;xx<(x+w);++xx){s=0;for(yy=y-1;yy>=0;--yy,s++){if(this._cells[(xx+yy*nWidth)*3]!=0)break;}
for(yy=s;yy>0;--yy){this._cells[(xx+(y-yy)*nWidth)*3+2]=yy;this._check(yy>0);}}}}
__proto._check=function(ret){if(ret==false){console.log("xtexMerger 错误啦");}}
__proto._clear=function(){this._texCount=0;for(var y=0;y<this._height;y++){this._rowInfo[y].spaceCount=this._width;}
for(var i=0;i<this._height;i++){for(var j=0;j<this._width;j++){var tm=(i*this._width+j)*3;this._cells[tm]=0;this._cells[tm+1]=this._width-j;this._cells[tm+2]=this._width-i;}}
this._failSize.width=this._width+1;this._failSize.height=this._height+1;}
AtlasGrid.__init$=function(){TexRowInfo=(function(){function TexRowInfo(){this.spaceCount=0;}
__class(TexRowInfo,'');return TexRowInfo;})()
TexMergeTexSize=(function(){function TexMergeTexSize(){this.width=0;this.height=0;}
__class(TexMergeTexSize,'');return TexMergeTexSize;})()}
return AtlasGrid;})()
var AtlasResourceManager=(function(){function AtlasResourceManager(width,height,gridSize,maxTexNum){this._currentAtlasCount=0;this._maxAtlaserCount=0;this._width=0;this._height=0;this._gridSize=0;this._gridNumX=0;this._gridNumY=0;this._init=false;this._curAtlasIndex=0;this._setAtlasParam=false;this._atlaserArray=null;this._needGC=false;this._setAtlasParam=true;this._width=width;this._height=height;this._gridSize=gridSize;this._maxAtlaserCount=maxTexNum;this._gridNumX=width/gridSize;this._gridNumY=height/gridSize;this._curAtlasIndex=0;this._atlaserArray=[];}
__class(AtlasResourceManager,'laya.webgl.atlas.AtlasResourceManager');var __proto=AtlasResourceManager.prototype;__proto.setAtlasParam=function(width,height,gridSize,maxTexNum){if(this._setAtlasParam==true){AtlasResourceManager._sid_=0;this._width=width;this._height=height;this._gridSize=gridSize;this._maxAtlaserCount=maxTexNum;this._gridNumX=width/gridSize;this._gridNumY=height/gridSize;this._curAtlasIndex=0;this.freeAll();return true;}else{console.log("设置大图合集参数错误，只能在开始页面设置各种参数");throw-1;return false;}
return false;}
__proto.pushData=function(texture){var bitmap=texture.bitmap;var nWebGLImageIndex=-1;var curAtlas=null;var i=0,n=0,altasIndex=0;for(i=0,n=this._atlaserArray.length;i<n;i++){altasIndex=(this._curAtlasIndex+i)%n;curAtlas=this._atlaserArray[altasIndex];nWebGLImageIndex=curAtlas.findBitmapIsExist(bitmap);if(nWebGLImageIndex!=-1){break;}}
if(nWebGLImageIndex!=-1){var offset=curAtlas.InAtlasWebGLImagesOffsetValue[nWebGLImageIndex];offsetX=offset[0];offsetY=offset[1];curAtlas.addToAtlas(texture,offsetX,offsetY);return true;}else{var tex=texture;this._setAtlasParam=false;var bFound=false;var nImageGridX=(Math.ceil((texture.bitmap.width+2)/this._gridSize));var nImageGridY=(Math.ceil((texture.bitmap.height+2)/this._gridSize));var bSuccess=false;for(var k=0;k<2;k++){var maxAtlaserCount=this._maxAtlaserCount;for(i=0;i<maxAtlaserCount;i++){altasIndex=(this._curAtlasIndex+i)%maxAtlaserCount;(this._atlaserArray.length-1>=altasIndex)||(this._atlaserArray.push(new Atlaser(this._gridNumX,this._gridNumY,this._width,this._height,AtlasResourceManager._sid_++)));var atlas=this._atlaserArray[altasIndex];var offsetX=0,offsetY=0;var fillInfo=atlas.addTex(1,nImageGridX,nImageGridY);if(fillInfo.ret){offsetX=fillInfo.x*this._gridSize+1;offsetY=fillInfo.y*this._gridSize+1;bitmap.lock=true;atlas.addToAtlasTexture((bitmap),offsetX,offsetY);atlas.addToAtlas(texture,offsetX,offsetY);bSuccess=true;this._curAtlasIndex=altasIndex;break;}}
if(bSuccess)
break;this._atlaserArray.push(new Atlaser(this._gridNumX,this._gridNumY,this._width,this._height,AtlasResourceManager._sid_++));this._needGC=true;this.garbageCollection();this._curAtlasIndex=this._atlaserArray.length-1;}
if(!bSuccess){console.log(">>>AtlasManager pushData error");}
return bSuccess;}}
__proto.addToAtlas=function(tex){laya.webgl.atlas.AtlasResourceManager.instance.pushData(tex);}
__proto.garbageCollection=function(){if(this._needGC===true){var n=this._atlaserArray.length-this._maxAtlaserCount;for(var i=0;i<n;i++){this._atlaserArray[i].dispose();console.log("AtlasResourceManager:Dispose the inner Atlas。");}
console.log(">>>>altas garbageCollection ="+n);this._atlaserArray.splice(0,n);this._needGC=false;}
return true;}
__proto.freeAll=function(){for(var i=0,n=this._atlaserArray.length;i<n;i++){this._atlaserArray[i].dispose();}
this._atlaserArray.length=0;this._curAtlasIndex=0;}
__proto.getAtlaserCount=function(){return this._atlaserArray.length;}
__proto.getAtlaserByIndex=function(index){return this._atlaserArray[index];}
__getset(1,AtlasResourceManager,'instance',function(){if(!AtlasResourceManager._Instance){AtlasResourceManager._Instance=new AtlasResourceManager(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount);}
return AtlasResourceManager._Instance;});__getset(1,AtlasResourceManager,'enabled',function(){return Config.atlasEnable;});__getset(1,AtlasResourceManager,'atlasLimitWidth',function(){return AtlasResourceManager._atlasLimitWidth;},function(value){AtlasResourceManager._atlasLimitWidth=value;});__getset(1,AtlasResourceManager,'atlasLimitHeight',function(){return AtlasResourceManager._atlasLimitHeight;},function(value){AtlasResourceManager._atlasLimitHeight=value;});AtlasResourceManager._enable=function(){Config.atlasEnable=true;}
AtlasResourceManager._disable=function(){Config.atlasEnable=false;}
AtlasResourceManager.__init__=function(){AtlasResourceManager.atlasTextureWidth=2048;AtlasResourceManager.atlasTextureHeight=2048;AtlasResourceManager.maxTextureCount=6;AtlasResourceManager.atlasLimitWidth=512;AtlasResourceManager.atlasLimitHeight=512;}
AtlasResourceManager._atlasLimitWidth=0;AtlasResourceManager._atlasLimitHeight=0;AtlasResourceManager.gridSize=16;AtlasResourceManager.atlasTextureWidth=0;AtlasResourceManager.atlasTextureHeight=0;AtlasResourceManager.maxTextureCount=0;AtlasResourceManager._atlasRestore=0;AtlasResourceManager.BOARDER_TYPE_NO=0;AtlasResourceManager.BOARDER_TYPE_RIGHT=1;AtlasResourceManager.BOARDER_TYPE_LEFT=2;AtlasResourceManager.BOARDER_TYPE_BOTTOM=4;AtlasResourceManager.BOARDER_TYPE_TOP=8;AtlasResourceManager.BOARDER_TYPE_ALL=15;AtlasResourceManager._sid_=0;AtlasResourceManager._Instance=null;return AtlasResourceManager;})()
var MergeFillInfo=(function(){function MergeFillInfo(){this.x=0;this.y=0;this.ret=false;this.ret=false;this.x=0;this.y=0;}
__class(MergeFillInfo,'laya.webgl.atlas.MergeFillInfo');return MergeFillInfo;})();var BlendMode=(function(){function BlendMode(){}
__class(BlendMode,'laya.webgl.canvas.BlendMode');BlendMode._init_=function(gl){BlendMode.fns=[BlendMode.BlendNormal,BlendMode.BlendAdd,BlendMode.BlendMultiply,BlendMode.BlendScreen,BlendMode.BlendOverlay,BlendMode.BlendLight,BlendMode.BlendMask,BlendMode.BlendDestinationOut];BlendMode.targetFns=[BlendMode.BlendNormalTarget,BlendMode.BlendAddTarget,BlendMode.BlendMultiplyTarget,BlendMode.BlendScreenTarget,BlendMode.BlendOverlayTarget,BlendMode.BlendLightTarget,BlendMode.BlendMask,BlendMode.BlendDestinationOut];}
BlendMode.BlendNormal=function(gl){gl.blendFunc(1,0x0303);}
BlendMode.BlendAdd=function(gl){gl.blendFunc(1,0x0304);}
BlendMode.BlendMultiply=function(gl){gl.blendFunc(0x0306,0x0303);}
BlendMode.BlendScreen=function(gl){gl.blendFunc(1,1);}
BlendMode.BlendOverlay=function(gl){gl.blendFunc(1,0x0301);}
BlendMode.BlendLight=function(gl){gl.blendFunc(1,1);}
BlendMode.BlendNormalTarget=function(gl){gl.blendFunc(1,0x0303);}
BlendMode.BlendAddTarget=function(gl){gl.blendFunc(1,0x0304);}
BlendMode.BlendMultiplyTarget=function(gl){gl.blendFunc(0x0306,0x0303);}
BlendMode.BlendScreenTarget=function(gl){gl.blendFunc(1,1);}
BlendMode.BlendOverlayTarget=function(gl){gl.blendFunc(1,0x0301);}
BlendMode.BlendLightTarget=function(gl){gl.blendFunc(1,1);}
BlendMode.BlendMask=function(gl){gl.blendFunc(0,0x0302);}
BlendMode.BlendDestinationOut=function(gl){gl.blendFunc(0,0);}
BlendMode.activeBlendFunction=null;BlendMode.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"];BlendMode.TOINT={"normal":0,"add":1,"multiply":2,"screen":3,"lighter":1,"overlay":4,"light":5,"mask":6,"destination-out":7};BlendMode.NORMAL="normal";BlendMode.ADD="add";BlendMode.MULTIPLY="multiply";BlendMode.SCREEN="screen";BlendMode.LIGHT="light";BlendMode.OVERLAY="overlay";BlendMode.DESTINATIONOUT="destination-out";BlendMode.fns=[];BlendMode.targetFns=[];return BlendMode;})()
var DrawStyle=(function(){function DrawStyle(value){this._color=Color.create("black");this.setValue(value);}
__class(DrawStyle,'laya.webgl.canvas.DrawStyle');var __proto=DrawStyle.prototype;__proto.setValue=function(value){if(value){if((typeof value=='string')){this._color=Color.create(value);return;}
if((value instanceof laya.utils.Color)){this._color=value;return;}}}
__proto.reset=function(){this._color=Color.create("black");}
__proto.equal=function(value){if((typeof value=='string'))return this._color.strColor===value;if((value instanceof laya.utils.Color))return this._color.numColor===(value).numColor;return false;}
__proto.toColorStr=function(){return this._color.strColor;}
DrawStyle.create=function(value){if(value){var color;if((typeof value=='string'))color=Color.create(value);else if((value instanceof laya.utils.Color))color=value;if(color){return color._drawStyle||(color._drawStyle=new DrawStyle(value));}}
return laya.webgl.canvas.DrawStyle.DEFAULT;}
__static(DrawStyle,['DEFAULT',function(){return this.DEFAULT=new DrawStyle("#000000");}]);return DrawStyle;})()
var Path=(function(){function Path(){this._x=0;this._y=0;this.dirty=false;this.offset=0;this.count=0;this.geoStart=0;this.tempArray=[];this.closePath=false;this.geomatrys=[];var gl=WebGL.mainContext;this.ib=IndexBuffer2D.create(0x88E8);this.vb=VertexBuffer2D.create(5);}
__class(Path,'laya.webgl.canvas.Path');var __proto=Path.prototype;__proto.addPoint=function(pointX,pointY){this.tempArray.push(pointX,pointY);}
__proto.getEndPointX=function(){return this.tempArray[this.tempArray.length-2];}
__proto.getEndPointY=function(){return this.tempArray[this.tempArray.length-1];}
__proto.polygon=function(x,y,points,color,borderWidth,borderColor){var geo;this.geomatrys.push(this._curGeomatry=geo=new Polygon(x,y,points,color,borderWidth,borderColor));if(!color)geo.fill=false;if(borderColor==undefined)geo.borderWidth=0;return geo;}
__proto.setGeomtry=function(shape){this.geomatrys.push(this._curGeomatry=shape);}
__proto.drawLine=function(x,y,points,width,color){var geo;if(this.closePath){this.geomatrys.push(this._curGeomatry=geo=new LoopLine(x,y,points,width,color));}else{this.geomatrys.push(this._curGeomatry=geo=new Line(x,y,points,width,color));}
geo.fill=false;return geo;}
__proto.update=function(){var si=this.ib._byteLength;var len=this.geomatrys.length;this.offset=si;for(var i=this.geoStart;i<len;i++){this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);}
this.geoStart=len;this.count=(this.ib._byteLength-si)/CONST3D2D.BYTES_PIDX;}
__proto.reset=function(){this.vb.clear();this.ib.clear();this.offset=this.count=this.geoStart=0;this.geomatrys.length=0;}
__proto.recover=function(){this._curGeomatry=null;this.vb.destory();this.vb=null;this.ib.destory();this.ib=null;}
return Path;})()
var SaveBase=(function(){function SaveBase(){}
__class(SaveBase,'laya.webgl.canvas.save.SaveBase');var __proto=SaveBase.prototype;Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":true})
__proto.isSaveMark=function(){return false;}
__proto.restore=function(context){this._dataObj[this._valueName]=this._value;SaveBase._cache[SaveBase._cache._length++]=this;this._newSubmit&&(context._curSubmit=Submit.RENDERBASE,context._renderKey=0);}
SaveBase._createArray=function(){var value=[];value._length=0;return value;}
SaveBase._init=function(){var namemap=SaveBase._namemap={};namemap[0x1]="ALPHA";namemap[0x2]="fillStyle";namemap[0x8]="font";namemap[0x100]="lineWidth";namemap[0x200]="strokeStyle";namemap[0x2000]="_mergeID";namemap[0x400]=namemap[0x800]=namemap[0x1000]=[];namemap[0x4000]="textBaseline";namemap[0x8000]="textAlign";namemap[0x10000]="_nBlendType";namemap[0x100000]="shader";namemap[0x200000]="filters";return namemap;}
SaveBase.save=function(context,type,dataObj,newSubmit){if((context._saveMark._saveuse&type)!==type){context._saveMark._saveuse|=type;var cache=SaveBase._cache;var o=cache._length>0?cache[--cache._length]:(new SaveBase());o._value=dataObj[o._valueName=SaveBase._namemap[type]];o._dataObj=dataObj;o._newSubmit=newSubmit;var _save=context._save;_save[_save._length++]=o;}}
SaveBase._cache=laya.webgl.canvas.save.SaveBase._createArray();SaveBase._namemap=SaveBase._init();return SaveBase;})()
var SaveClipRect=(function(){function SaveClipRect(){this._clipRect=new Rectangle();}
__class(SaveClipRect,'laya.webgl.canvas.save.SaveClipRect');var __proto=SaveClipRect.prototype;Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":true})
__proto.isSaveMark=function(){return false;}
__proto.restore=function(context){context._clipRect=this._clipSaveRect;SaveClipRect._cache[SaveClipRect._cache._length++]=this;this._submitScissor.submitLength=context._submits._length-this._submitScissor.submitIndex;context._curSubmit=Submit.RENDERBASE;context._renderKey=0;}
SaveClipRect.save=function(context,submitScissor){if((context._saveMark._saveuse&0x20000)==0x20000)return;context._saveMark._saveuse|=0x20000;var cache=SaveClipRect._cache;var o=cache._length>0?cache[--cache._length]:(new SaveClipRect());o._clipSaveRect=context._clipRect;context._clipRect=o._clipRect.copyFrom(context._clipRect);o._submitScissor=submitScissor;var _save=context._save;_save[_save._length++]=o;}
__static(SaveClipRect,['_cache',function(){return this._cache=SaveBase._createArray();}]);return SaveClipRect;})()
var SaveClipRectStencil=(function(){function SaveClipRectStencil(){this._contextX=0;this._contextY=0;this._clipRect=new Rectangle();this._rect=new Rectangle();this._matrix=new Matrix();}
__class(SaveClipRectStencil,'laya.webgl.canvas.save.SaveClipRectStencil');var __proto=SaveClipRectStencil.prototype;Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":true})
__proto.isSaveMark=function(){return false;}
__proto.restore=function(context){SubmitStencil.restore(context,this._rect,this._saveMatrix,this._contextX,this._contextY);context._clipRect=this._clipSaveRect;context._curMat=this._saveMatrix;context._x=this._contextX;context._y=this._contextY;SaveClipRectStencil._cache[SaveClipRectStencil._cache._length++]=this;context._curSubmit=Submit.RENDERBASE;}
SaveClipRectStencil.save=function(context,submitStencil,x,y,width,height,clipX,clipY,clipWidth,clipHeight){if((context._saveMark._saveuse&0x40000)==0x40000)return;context._saveMark._saveuse|=0x40000;var cache=SaveClipRectStencil._cache;var o=cache._length>0?cache[--cache._length]:(new SaveClipRectStencil());o._clipSaveRect=context._clipRect;o._clipRect.setTo(clipX,clipY,clipWidth,clipHeight);context._clipRect=o._clipRect;o._rect.x=x;o._rect.y=y;o._rect.width=width;o._rect.height=height;o._contextX=context._x;o._contextY=context._y;o._saveMatrix=context._curMat;context._curMat.copyTo(o._matrix);context._curMat=o._matrix;o._submitStencil=submitStencil;var _save=context._save;_save[_save._length++]=o;}
__static(SaveClipRectStencil,['_cache',function(){return this._cache=SaveBase._createArray();}]);return SaveClipRectStencil;})()
var SaveMark=(function(){function SaveMark(){this._saveuse=0;;}
__class(SaveMark,'laya.webgl.canvas.save.SaveMark');var __proto=SaveMark.prototype;Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":true})
__proto.isSaveMark=function(){return true;}
__proto.restore=function(context){context._saveMark=this._preSaveMark;SaveMark._no[SaveMark._no._length++]=this;}
SaveMark.Create=function(context){var no=SaveMark._no;var o=no._length>0?no[--no._length]:(new SaveMark());o._saveuse=0;o._preSaveMark=context._saveMark;context._saveMark=o;return o;}
__static(SaveMark,['_no',function(){return this._no=SaveBase._createArray();}]);return SaveMark;})()
var SaveTransform=(function(){function SaveTransform(){this._matrix=new Matrix();}
__class(SaveTransform,'laya.webgl.canvas.save.SaveTransform');var __proto=SaveTransform.prototype;Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":true})
__proto.isSaveMark=function(){return false;}
__proto.restore=function(context){context._curMat=this._savematrix;SaveTransform._no[SaveTransform._no._length++]=this;}
SaveTransform.save=function(context){var _saveMark=context._saveMark;if((_saveMark._saveuse&0x800)===0x800)return;_saveMark._saveuse|=0x800;var no=SaveTransform._no;var o=no._length>0?no[--no._length]:(new SaveTransform());o._savematrix=context._curMat;context._curMat=context._curMat.copyTo(o._matrix);var _save=context._save;_save[_save._length++]=o;}
__static(SaveTransform,['_no',function(){return this._no=SaveBase._createArray();}]);return SaveTransform;})()
var SaveTranslate=(function(){function SaveTranslate(){}
__class(SaveTranslate,'laya.webgl.canvas.save.SaveTranslate');var __proto=SaveTranslate.prototype;Laya.imps(__proto,{"laya.webgl.canvas.save.ISaveData":true})
__proto.isSaveMark=function(){return false;}
__proto.restore=function(context){var mat=context._curMat;context._x=this._x;context._y=this._y;SaveTranslate._no[SaveTranslate._no._length++]=this;}
SaveTranslate.save=function(context){var no=SaveTranslate._no;var o=no._length>0?no[--no._length]:(new SaveTranslate());o._x=context._x;o._y=context._y;var _save=context._save;_save[_save._length++]=o;}
__static(SaveTranslate,['_no',function(){return this._no=SaveBase._createArray();}]);return SaveTranslate;})()
var RenderTargetMAX=(function(){function RenderTargetMAX(){this.target=null;this.repaint=false;this._width=NaN;this._height=NaN;this._sp=null;this._clipRect=new Rectangle();}
__class(RenderTargetMAX,'laya.webgl.resource.RenderTargetMAX');var __proto=RenderTargetMAX.prototype;__proto.setSP=function(sp){this._sp=sp;}
__proto.size=function(w,h){var _$this=this;if(this._width===w&&this._height===h){this.target.size(w,h);return;}
this.repaint=true;this._width=w;this._height=h;if(!this.target)
this.target=RenderTarget2D.create(w,h);else
this.target.size(w,h);if(!this.target.hasListener("recovered")){this.target.on("recovered",this,function(e){Laya.timer.callLater(_$this._sp,_$this._sp.repaint);});}}
__proto._flushToTarget=function(context,target){if(target._destroy)return;var worldScissorTest=RenderState2D.worldScissorTest;var preworldClipRect=RenderState2D.worldClipRect;RenderState2D.worldClipRect=this._clipRect;this._clipRect.x=this._clipRect.y=0;this._clipRect.width=this._width;this._clipRect.height=this._height;RenderState2D.worldScissorTest=false;WebGL.mainContext.disable(0x0C11);var preAlpha=RenderState2D.worldAlpha;var preMatrix4=RenderState2D.worldMatrix4;var preMatrix=RenderState2D.worldMatrix;var preFilters=RenderState2D.worldFilters;var preShaderDefines=RenderState2D.worldShaderDefines;RenderState2D.worldMatrix=Matrix.EMPTY;RenderState2D.restoreTempArray();RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY;RenderState2D.worldAlpha=1;RenderState2D.worldFilters=null;RenderState2D.worldShaderDefines=null;BaseShader.activeShader=null;target.start();Config.showCanvasMark?target.clear(0,1,0,0.3):target.clear(0,0,0,0);context.flush();target.end();BaseShader.activeShader=null;RenderState2D.worldAlpha=preAlpha;RenderState2D.worldMatrix4=preMatrix4;RenderState2D.worldMatrix=preMatrix;RenderState2D.worldFilters=preFilters;RenderState2D.worldShaderDefines=preShaderDefines;RenderState2D.worldScissorTest=worldScissorTest
if(worldScissorTest){var y=RenderState2D.height-preworldClipRect.y-preworldClipRect.height;WebGL.mainContext.scissor(preworldClipRect.x,y,preworldClipRect.width,preworldClipRect.height);WebGL.mainContext.enable(0x0C11);}
RenderState2D.worldClipRect=preworldClipRect;}
__proto.flush=function(context){if(this.repaint){this._flushToTarget(context,this.target);this.repaint=false;}}
__proto.drawTo=function(context,x,y,width,height){context.drawTexture(this.target.getTexture(),x,y,width,height,0,0);}
__proto.destroy=function(){if(this.target){this.target.destroy();this.target=null;this._sp=null;}}
return RenderTargetMAX;})()
var Shader2D=(function(){function Shader2D(){this.ALPHA=1;this.shaderType=0;this.defines=new ShaderDefines2D();}
__class(Shader2D,'laya.webgl.shader.d2.Shader2D');var __proto=Shader2D.prototype;__proto.destroy=function(){this.defines=null;this.filters=null;this.glTexture=null;this.strokeStyle=null;this.fillStyle=null;}
Shader2D.__init__=function(){Shader.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;");Shader.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n");Shader.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;");Shader.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n for(float j = 0.0;j<=c_IterationTime; ++j){\n  vec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n  vec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n }\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;");Shader.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;");Shader.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}");Shader.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n");Shader.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;");var vs,ps;vs="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}";ps="precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  \"parts/BlurFilter_ps_uniform.glsl\";\n#include?COLOR_FILTER \"parts/ColorFilter_ps_uniform.glsl\";\n#include?GLOW_FILTER \"parts/GlowFilter_ps_uniform.glsl\";\n#include?COLOR_ADD \"parts/ColorAdd_ps_uniform.glsl\";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD \"parts/ColorAdd_ps_logic.glsl\";   \n   #include?BLUR_FILTER  \"parts/BlurFilter_ps_logic.glsl\";\n   #include?COLOR_FILTER \"parts/ColorFilter_ps_logic.glsl\";\n   #include?GLOW_FILTER \"parts/GlowFilter_ps_logic.glsl\";\n}";Shader.preCompile2D(0,0x01,vs,ps,null);vs="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}";ps="precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER \"parts/ColorFilter_ps_uniform.glsl\";\nvoid main() {\n vec4 a = vec4(color.r, color.g, color.b, color.a);\n a.w = alpha;\n a.xyz *= alpha;\n gl_FragColor = a;\n #include?COLOR_FILTER \"parts/ColorFilter_ps_logic.glsl\";\n}";Shader.preCompile2D(0,0x02,vs,ps,null);vs="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}";ps="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n //vec4 a=vec4(color.r, color.g, color.b, 1);\n //a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n gl_FragColor.rgb*=alpha;\n}";Shader.preCompile2D(0,0x04,vs,ps,null);vs="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}";ps="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  \"parts/BlurFilter_ps_uniform.glsl\";\n#include?COLOR_FILTER \"parts/ColorFilter_ps_uniform.glsl\";\n#include?GLOW_FILTER \"parts/GlowFilter_ps_uniform.glsl\";\n#include?COLOR_ADD \"parts/ColorAdd_ps_uniform.glsl\";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD \"parts/ColorAdd_ps_logic.glsl\";   \n   #include?BLUR_FILTER  \"parts/BlurFilter_ps_logic.glsl\";\n   #include?COLOR_FILTER \"parts/ColorFilter_ps_logic.glsl\";\n   #include?GLOW_FILTER \"parts/GlowFilter_ps_logic.glsl\";\n}";Shader.preCompile2D(0,0x100,vs,ps,null);vs="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}";ps="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n vec4 t_color = texture2D(texture, v_texcoord);\n gl_FragColor = t_color.rgba * v_color;\n gl_FragColor *= alpha;\n}";Shader.preCompile2D(0,0x200,vs,ps,null);}
return Shader2D;})()
var ShaderDefines=(function(){function ShaderDefines(name2int,int2name,int2nameMap){this._value=0;this._name2int=name2int;this._int2name=int2name;this._int2nameMap=int2nameMap;}
__class(ShaderDefines,'laya.webgl.shader.ShaderDefines');var __proto=ShaderDefines.prototype;__proto.add=function(value){if((typeof value=='string'))value=this._name2int[value];this._value|=value;return this._value;}
__proto.addInt=function(value){this._value|=value;return this._value;}
__proto.remove=function(value){if((typeof value=='string'))value=this._name2int[value];this._value&=(~value);return this._value;}
__proto.isDefine=function(def){return(this._value&def)===def;}
__proto.getValue=function(){return this._value;}
__proto.setValue=function(value){this._value=value;}
__proto.toNameDic=function(){var r=this._int2nameMap[this._value];return r?r:ShaderDefines._toText(this._value,this._int2name,this._int2nameMap);}
ShaderDefines._reg=function(name,value,_name2int,_int2name){_name2int[name]=value;_int2name[value]=name;}
ShaderDefines._toText=function(value,_int2name,_int2nameMap){var r=_int2nameMap[value];if(r)return r;var o={};var d=1;for(var i=0;i<32;i++){d=1<<i;if(d>value)break;if(value&d){var name=_int2name[d];name&&(o[name]="");}}
_int2nameMap[value]=o;return o;}
ShaderDefines._toInt=function(names,_name2int){var words=names.split('.');var num=0;for(var i=0,n=words.length;i<n;i++){var value=_name2int[words[i]];if(!value)throw new Error("Defines to int err:"+names+"/"+words[i]);num|=value;}
return num;}
return ShaderDefines;})()
var SkinMesh=(function(){function SkinMesh(){this.mVBBuffer=null;this.mIBBuffer=null;this.mVBData=null;this.mIBData=null;this.mEleNum=0;this.mTexture=null;this.transform=null;this._vs=null;this._ps=null;this._indexStart=-1;this._verticles=null;this._uvs=null;this._tempMatrix=new Matrix();}
__class(SkinMesh,'laya.webgl.shader.d2.skinAnishader.SkinMesh');var __proto=SkinMesh.prototype;__proto.init=function(texture,vs,ps){if(vs){this._vs=vs;}else{this._vs=[];var tWidth=texture.width;var tHeight=texture.height;var tRed=1;var tGreed=1;var tBlue=1;var tAlpha=1;this._vs.push(0,0,0,0,tRed,tGreed,tBlue,tAlpha);this._vs.push(tWidth,0,1,0,tRed,tGreed,tBlue,tAlpha);this._vs.push(tWidth,tHeight,1,1,tRed,tGreed,tBlue,tAlpha);this._vs.push(0,tHeight,0,1,tRed,tGreed,tBlue,tAlpha);}
if(ps){this._ps=ps;}else{if(!SkinMesh._defaultPS){SkinMesh._defaultPS=[];SkinMesh._defaultPS.push(0,1,3,3,1,2);}
this._ps=SkinMesh._defaultPS;}
this.mVBData=new Float32Array(this._vs);this.mIBData=new Uint16Array(this._ps.length);this.mIBData["start"]=-1;this.mEleNum=this._ps.length;this.mTexture=texture;}
__proto.init2=function(texture,vs,ps,verticles,uvs){if(this.transform)this.transform=null;if(ps){this._ps=ps;}else{this._ps=[];this._ps.push(0,1,3,3,1,2);}
this._verticles=verticles;this._uvs=uvs;this.mEleNum=this._ps.length;this.mTexture=texture;if(Render.isConchNode||Render.isConchApp){this._initMyData();this.mVBData=new Float32Array(this._vs);}}
__proto._initMyData=function(){var vsI=0;var vI=0;var vLen=this._verticles.length;var tempVLen=vLen*4;this._vs=SkinMesh._tempVS;var insertNew=false;if(Render.isConchNode||Render.isConchApp){this._vs.length=tempVLen;insertNew=true;}else{if(this._vs.length<tempVLen){this._vs.length=tempVLen;insertNew=true;}}
SkinMesh._tVSLen=tempVLen;if(insertNew){while(vsI<tempVLen){this._vs[vsI]=this._verticles[vI];this._vs[vsI+1]=this._verticles[vI+1];this._vs[vsI+2]=this._uvs[vI];this._vs[vsI+3]=this._uvs[vI+1];this._vs[vsI+4]=1;this._vs[vsI+5]=1;this._vs[vsI+6]=1;this._vs[vsI+7]=1;vsI+=8;vI+=2;}}else{while(vsI<tempVLen){this._vs[vsI]=this._verticles[vI];this._vs[vsI+1]=this._verticles[vI+1];this._vs[vsI+2]=this._uvs[vI];this._vs[vsI+3]=this._uvs[vI+1];vsI+=8;vI+=2;}}}
__proto.getData2=function(vb,ib,start){this.mVBBuffer=vb;this.mIBBuffer=ib;this._initMyData();vb.appendEx2(this._vs,Float32Array,SkinMesh._tVSLen,4);this._indexStart=ib._byteLength;var tIB;tIB=SkinMesh._tempIB;if(tIB.length<this._ps.length){tIB.length=this._ps.length;}
for(var i=0,n=this._ps.length;i<n;i++){tIB[i]=this._ps[i]+start;}
ib.appendEx2(tIB,Uint16Array,this._ps.length,2);}
__proto.getData=function(vb,ib,start){this.mVBBuffer=vb;this.mIBBuffer=ib;vb.append(this.mVBData);this._indexStart=ib._byteLength;if(this.mIBData["start"]!=start){for(var i=0,n=this._ps.length;i<n;i++){this.mIBData[i]=this._ps[i]+start;}
this.mIBData["start"]=start;}
ib.append(this.mIBData);}
__proto.render=function(context,x,y){if(Render.isWebGL&&this.mTexture){context._renderKey=0;context._shader2D.glTexture=null;SkinMeshBuffer.getInstance().addSkinMesh(this);var tempSubmit=Submit.createShape(context,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Value2D.create(0x200,0));this.transform||(this.transform=Matrix.EMPTY);this.transform.translate(x,y);Matrix.mul(this.transform,context._curMat,this._tempMatrix);this.transform.translate(-x,-y);var tShaderValue=tempSubmit.shaderValue;var tArray=tShaderValue.u_mmat2||RenderState2D.getMatrArray();RenderState2D.mat2MatArray(this._tempMatrix,tArray);tShaderValue.textureHost=this.mTexture;tShaderValue.offsetX=0;tShaderValue.offsetY=0;tShaderValue.u_mmat2=tArray;tShaderValue.ALPHA=context._shader2D.ALPHA;context._submits[context._submits._length++]=tempSubmit;}
else if(Render.isConchApp&&this.mTexture){this.transform||(this.transform=Matrix.EMPTY);context.setSkinMesh&&context.setSkinMesh(x,y,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform);}}
SkinMesh._tempVS=[];SkinMesh._tempIB=[];SkinMesh._defaultPS=null;SkinMesh._tVSLen=0;return SkinMesh;})()
var SkinMeshBuffer=(function(){function SkinMeshBuffer(){this.ib=null;this.vb=null;var gl=WebGL.mainContext;this.ib=IndexBuffer2D.create(0x88E8);this.vb=VertexBuffer2D.create(8);}
__class(SkinMeshBuffer,'laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer');var __proto=SkinMeshBuffer.prototype;__proto.addSkinMesh=function(skinMesh){skinMesh.getData2(this.vb,this.ib,this.vb._byteLength/32);}
__proto.reset=function(){this.vb.clear();this.ib.clear();}
SkinMeshBuffer.getInstance=function(){return SkinMeshBuffer.instance=SkinMeshBuffer.instance||new SkinMeshBuffer();}
SkinMeshBuffer.instance=null;return SkinMeshBuffer;})()
var BasePoly=(function(){function BasePoly(x,y,width,height,edges,color,borderWidth,borderColor,round){this.r0=0
this.fill=true;this.r1=Math.PI/2;(round===void 0)&&(round=0);this.x=x;this.y=y;this.width=width;this.height=height;this.edges=edges;this.color=color;this.borderWidth=borderWidth;this.borderColor=borderColor;}
__class(BasePoly,'laya.webgl.shapes.BasePoly');var __proto=BasePoly.prototype;Laya.imps(__proto,{"laya.webgl.shapes.IShape":true})
__proto.getData=function(ib,vb,start){}
__proto.rebuild=function(points){}
__proto.setMatrix=function(mat){}
__proto.needUpdate=function(mat){return true;}
__proto.sector=function(outVert,outIndex,start){var x=this.x,y=this.y,edges=this.edges,seg=(this.r1-this.r0)/edges;var w=this.width,h=this.height,color=this.color;var r=((color>>16)&0x0000ff)/255,g=((color>>8)&0xff)/255,b=(color&0x0000ff)/255;outVert.push(x,y,r,g,b);for(var i=0;i<edges+1;i++){outVert.push(x+Math.sin(seg*i+this.r0)*w,y+Math.cos(seg*i+this.r0)*h);outVert.push(r,g,b);}
for(i=0;i<edges;i++){outIndex.push(start,start+i+1,start+i+2);}}
__proto.createLine2=function(p,indices,lineWidth,len,outVertex,indexCount){var points=p.concat();var result=outVertex;var color=this.borderColor;var r=((color>>16)&0x0000ff)/255,g=((color>>8)&0xff)/255,b=(color&0x0000ff)/255;var length=points.length/2;var iStart=len,w=lineWidth/2;var px,py,p1x,p1y,p2x,p2y,p3x,p3y;var perpx,perpy,perp2x,perp2y,perp3x,perp3y;var a1,b1,c1,a2,b2,c2;var denom,pdist,dist;p1x=points[0];p1y=points[1];p2x=points[2];p2y=points[3];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;result.push(p1x-perpx+this.x,p1y-perpy+this.y,r,g,b,p1x+perpx+this.x,p1y+perpy+this.y,r,g,b);for(var i=1;i<length-1;i++){p1x=points[(i-1)*2];p1y=points[(i-1)*2+1];p2x=points[(i)*2];p2y=points[(i)*2+1];p3x=points[(i+1)*2];p3y=points[(i+1)*2+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x=perp2x/dist*w;perp2y=perp2y/dist*w;a1=(-perpy+p1y)-(-perpy+p2y);b1=(-perpx+p2x)-(-perpx+p1x);c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);a2=(-perp2y+p3y)-(-perp2y+p2y);b2=(-perp2x+p2x)-(-perp2x+p3x);c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);denom=a1*b2-a2*b1;if(Math.abs(denom)<0.1){denom+=10.1;result.push(p2x-perpx+this.x,p2y-perpy+this.y,r,g,b,p2x+perpx+this.x,p2y+perpy+this.y,r,g,b);continue;}
px=(b1*c2-b2*c1)/denom;py=(a2*c1-a1*c2)/denom;pdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);result.push(px+this.x,py+this.y,r,g,b,p2x-(px-p2x)+this.x,p2y-(py-p2y)+this.y,r,g,b);}
p1x=points[points.length-4];p1y=points[points.length-3];p2x=points[points.length-2];p2y=points[points.length-1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;result.push(p2x-perpx+this.x,p2y-perpy+this.y,r,g,b,p2x+perpx+this.x,p2y+perpy+this.y,r,g,b);var groupLen=indexCount;for(i=1;i<groupLen;i++){indices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+i*2+1,iStart+i*2+1,iStart+i*2,iStart+(i-1)*2);}
return result;}
__proto.createLine=function(p,indices,lineWidth,len){var points=p.concat();var result=p;var color=this.borderColor;var r=((color>>16)&0x0000ff)/255,g=((color>>8)&0xff)/255,b=(color&0x0000ff)/255;points.splice(0,5);var length=points.length/5;var iStart=len,w=lineWidth/2;var px,py,p1x,p1y,p2x,p2y,p3x,p3y;var perpx,perpy,perp2x,perp2y,perp3x,perp3y;var a1,b1,c1,a2,b2,c2;var denom,pdist,dist;p1x=points[0];p1y=points[1];p2x=points[5];p2y=points[6];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;result.push(p1x-perpx,p1y-perpy,r,g,b,p1x+perpx,p1y+perpy,r,g,b);for(var i=1;i<length-1;i++){p1x=points[(i-1)*5];p1y=points[(i-1)*5+1];p2x=points[(i)*5];p2y=points[(i)*5+1];p3x=points[(i+1)*5];p3y=points[(i+1)*5+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x=perp2x/dist*w;perp2y=perp2y/dist*w;a1=(-perpy+p1y)-(-perpy+p2y);b1=(-perpx+p2x)-(-perpx+p1x);c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);a2=(-perp2y+p3y)-(-perp2y+p2y);b2=(-perp2x+p2x)-(-perp2x+p3x);c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);denom=a1*b2-a2*b1;if(Math.abs(denom)<0.1){denom+=10.1;result.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b);continue;}
px=(b1*c2-b2*c1)/denom;py=(a2*c1-a1*c2)/denom;pdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);result.push(px,py,r,g,b,p2x-(px-p2x),p2y-(py-p2y),r,g,b);}
p1x=points[points.length-10];p1y=points[points.length-9];p2x=points[points.length-5];p2y=points[points.length-4];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;result.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b);var groupLen=this.edges+1;for(i=1;i<groupLen;i++){indices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+i*2+1,iStart+i*2+1,iStart+i*2,iStart+(i-1)*2);}
return result;}
__proto.createLoopLine=function(p,indices,lineWidth,len,outVertex,outIndex){var points=p.concat();var result=outVertex?outVertex:p;var color=this.borderColor;var r=((color>>16)&0x0000ff)/255,g=((color>>8)&0xff)/255,b=(color&0x0000ff)/255;points.splice(0,5);var firstPoint=[points[0],points[1]];var lastPoint=[points[points.length-5],points[points.length-4]];var midPointX=lastPoint[0]+(firstPoint[0]-lastPoint[0])*0.5;var midPointY=lastPoint[1]+(firstPoint[1]-lastPoint[1])*0.5;points.unshift(midPointX,midPointY,0,0,0);points.push(midPointX,midPointY,0,0,0);var length=points.length/5;var iStart=len,w=lineWidth/2;var px,py,p1x,p1y,p2x,p2y,p3x,p3y;var perpx,perpy,perp2x,perp2y,perp3x,perp3y;var a1,b1,c1,a2,b2,c2;var denom,pdist,dist;p1x=points[0];p1y=points[1];p2x=points[5];p2y=points[6];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;result.push(p1x-perpx,p1y-perpy,r,g,b,p1x+perpx,p1y+perpy,r,g,b);for(var i=1;i<length-1;i++){p1x=points[(i-1)*5];p1y=points[(i-1)*5+1];p2x=points[(i)*5];p2y=points[(i)*5+1];p3x=points[(i+1)*5];p3y=points[(i+1)*5+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x=perp2x/dist*w;perp2y=perp2y/dist*w;a1=(-perpy+p1y)-(-perpy+p2y);b1=(-perpx+p2x)-(-perpx+p1x);c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);a2=(-perp2y+p3y)-(-perp2y+p2y);b2=(-perp2x+p2x)-(-perp2x+p3x);c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);denom=a1*b2-a2*b1;if(Math.abs(denom)<0.1){denom+=10.1;result.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b);continue;}
px=(b1*c2-b2*c1)/denom;py=(a2*c1-a1*c2)/denom;pdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);result.push(px,py,r,g,b,p2x-(px-p2x),p2y-(py-p2y),r,g,b);}
if(outIndex){indices=outIndex;};var groupLen=this.edges+1;for(i=1;i<groupLen;i++){indices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+i*2+1,iStart+i*2+1,iStart+i*2,iStart+(i-1)*2);}
indices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+1,iStart+1,iStart,iStart+(i-1)*2);return result;}
return BasePoly;})()
var Earcut=(function(){function Earcut(){}
__class(Earcut,'laya.webgl.shapes.Earcut');Earcut.earcut=function(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=Earcut.linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles)outerNode=Earcut.eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y;}
invSize=Math.max(maxX-minX,maxY-minY);invSize=invSize!==0?1/invSize:0;}
Earcut.earcutLinked(outerNode,triangles,dim,minX,minY,invSize);return triangles;}
Earcut.linkedList=function(data,start,end,dim,clockwise){var i,last;if(clockwise===(Earcut.signedArea(data,start,end,dim)>0)){for(i=start;i<end;i+=dim)last=Earcut.insertNode(i,data[i],data[i+1],last);}else{for(i=end-dim;i>=start;i-=dim)last=Earcut.insertNode(i,data[i],data[i+1],last);}
if(last&&Earcut.equals(last,last.next)){Earcut.removeNode(last);last=last.next;}
return last;}
Earcut.filterPoints=function(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(Earcut.equals(p,p.next)||Earcut.area(p.prev,p,p.next)===0)){Earcut.removeNode(p);p=end=p.prev;if(p===p.next)break;again=true;}else{p=p.next;}}while(again||p!==end);return end;}
Earcut.earcutLinked=function(ear,triangles,dim,minX,minY,invSize,pass){if(!ear)return;if(!pass&&invSize)Earcut.indexCurve(ear,minX,minY,invSize);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(invSize?Earcut.isEarHashed(ear,minX,minY,invSize):Earcut.isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);Earcut.removeNode(ear);ear=next.next;stop=next.next;continue;}
ear=next;if(ear===stop){if(!pass){Earcut.earcutLinked(Earcut.filterPoints(ear,null),triangles,dim,minX,minY,invSize,1);}else if(pass===1){ear=Earcut.cureLocalIntersections(ear,triangles,dim);Earcut.earcutLinked(ear,triangles,dim,minX,minY,invSize,2);}else if(pass===2){Earcut.splitEarcut(ear,triangles,dim,minX,minY,invSize);}
break;}}}
Earcut.isEar=function(ear){var a=ear.prev,b=ear,c=ear.next;if(Earcut.area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(Earcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&Earcut.area(p.prev,p,p.next)>=0)return false;p=p.next;}
return true;}
Earcut.isEarHashed=function(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(Earcut.area(a,b,c)>=0)return false;var minTX=a.x<b.x?(a.x<c.x?a.x:c.x):(b.x<c.x?b.x:c.x),minTY=a.y<b.y?(a.y<c.y?a.y:c.y):(b.y<c.y?b.y:c.y),maxTX=a.x>b.x?(a.x>c.x?a.x:c.x):(b.x>c.x?b.x:c.x),maxTY=a.y>b.y?(a.y>c.y?a.y:c.y):(b.y>c.y?b.y:c.y);var minZ=Earcut.zOrder(minTX,minTY,minX,minY,invSize),maxZ=Earcut.zOrder(maxTX,maxTY,minX,minY,invSize);var p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&Earcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&Earcut.area(p.prev,p,p.next)>=0)return false;p=p.nextZ;}
p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&Earcut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&Earcut.area(p.prev,p,p.next)>=0)return false;p=p.prevZ;}
return true;}
Earcut.cureLocalIntersections=function(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!Earcut.equals(a,b)&&Earcut.intersects(a,p,p.next,b)&&Earcut.locallyInside(a,b)&&Earcut.locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);Earcut.removeNode(p);Earcut.removeNode(p.next);p=start=b;}
p=p.next;}while(p!==start);return p;}
Earcut.splitEarcut=function(start,triangles,dim,minX,minY,invSize){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&Earcut.isValidDiagonal(a,b)){var c=Earcut.splitPolygon(a,b);a=Earcut.filterPoints(a,a.next);c=Earcut.filterPoints(c,c.next);Earcut.earcutLinked(a,triangles,dim,minX,minY,invSize);Earcut.earcutLinked(c,triangles,dim,minX,minY,invSize);return;}
b=b.next;}
a=a.next;}while(a!==start);}
Earcut.eliminateHoles=function(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=Earcut.linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(Earcut.getLeftmost(list));}
queue.sort(Earcut.compareX);for(i=0;i<queue.length;i++){Earcut.eliminateHole(queue[i],outerNode);outerNode=Earcut.filterPoints(outerNode,outerNode.next);}
return outerNode;}
Earcut.compareX=function(a,b){return a.x-b.x;}
Earcut.eliminateHole=function(hole,outerNode){outerNode=Earcut.findHoleBridge(hole,outerNode);if(outerNode){var b=Earcut.splitPolygon(outerNode,hole);Earcut.filterPoints(b,b.next);}}
Earcut.findHoleBridge=function(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next;}
m=p.x<p.next.x?p:p.next;}}
p=p.next;}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&hx!==p.x&&Earcut.pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||(tan===tanMin&&p.x>m.x))&&Earcut.locallyInside(p,hole)){m=p;tanMin=tan;}}
p=p.next;}
return m;}
Earcut.indexCurve=function(start,minX,minY,invSize){var p=start;do{if(p.z===null)p.z=Earcut.zOrder(p.x,p.y,minX,minY,invSize);p.prevZ=p.prev;p.nextZ=p.next;p=p.next;}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;Earcut.sortLinked(p);}
Earcut.sortLinked=function(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break;}
qSize=inSize;while(pSize>0||(qSize>0&&q)){if(pSize!==0&&(qSize===0||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--;}else{e=q;q=q.nextZ;qSize--;}
if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e;}
p=q;}
tail.nextZ=null;inSize*=2;}while(numMerges>1);return list;}
Earcut.zOrder=function(x,y,minX,minY,invSize){x=32767*(x-minX)*invSize;y=32767*(y-minY)*invSize;x=(x|(x<<8))&0x00FF00FF;x=(x|(x<<4))&0x0F0F0F0F;x=(x|(x<<2))&0x33333333;x=(x|(x<<1))&0x55555555;y=(y|(y<<8))&0x00FF00FF;y=(y|(y<<4))&0x0F0F0F0F;y=(y|(y<<2))&0x33333333;y=(y|(y<<1))&0x55555555;return x|(y<<1);}
Earcut.getLeftmost=function(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next;}while(p!==start);return leftmost;}
Earcut.pointInTriangle=function(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0;}
Earcut.isValidDiagonal=function(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!Earcut.intersectsPolygon(a,b)&&Earcut.locallyInside(a,b)&&Earcut.locallyInside(b,a)&&Earcut.middleInside(a,b);}
Earcut.area=function(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y);}
Earcut.equals=function(p1,p2){return p1.x===p2.x&&p1.y===p2.y;}
Earcut.intersects=function(p1,q1,p2,q2){if((Earcut.equals(p1,q1)&&Earcut.equals(p2,q2))||(Earcut.equals(p1,q2)&&Earcut.equals(p2,q1)))return true;return Earcut.area(p1,q1,p2)>0!==Earcut.area(p1,q1,q2)>0&&Earcut.area(p2,q2,p1)>0!==Earcut.area(p2,q2,q1)>0;}
Earcut.intersectsPolygon=function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&Earcut.intersects(p,p.next,a,b))return true;p=p.next;}while(p!==a);return false;}
Earcut.locallyInside=function(a,b){return Earcut.area(a.prev,a,a.next)<0?Earcut.area(a,b,a.next)>=0&&Earcut.area(a,a.prev,b)>=0:Earcut.area(a,b,a.prev)<0||Earcut.area(a,a.next,b)<0;}
Earcut.middleInside=function(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(((p.y>py)!==(p.next.y>py))&&p.next.y!==p.y&&(px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x))
inside=!inside;p=p.next;}while(p!==a);return inside;}
Earcut.splitPolygon=function(a,b){var a2=new EarcutNode(a.i,a.x,a.y),b2=new EarcutNode(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2;}
Earcut.insertNode=function(i,x,y,last){var p=new EarcutNode(i,x,y);if(!last){p.prev=p;p.next=p;}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p;}
return p;}
Earcut.removeNode=function(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ;}
Earcut.signedArea=function(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i;}
return sum;}
return Earcut;})()
var EarcutNode=(function(){function EarcutNode(i,x,y){this.i=null;this.x=null;this.y=null;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=null;this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false;}
__class(EarcutNode,'laya.webgl.shapes.EarcutNode');return EarcutNode;})()
var GeometryData=(function(){function GeometryData(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,shape){this.lineWidth=lineWidth;this.lineColor=lineColor;this.lineAlpha=lineAlpha;this.fillColor=fillColor;this.fillAlpha=fillAlpha;this.shape=shape;this.fill=fill;}
__class(GeometryData,'laya.webgl.shapes.GeometryData');var __proto=GeometryData.prototype;__proto.clone=function(){return new GeometryData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape);}
__proto.getIndexData=function(){return null;}
__proto.getVertexData=function(){return null;}
__proto.destroy=function(){this.shape=null;}
return GeometryData;})()
var Vertex=(function(){function Vertex(p){if((p instanceof Float32Array))
this.points=p;else if((p instanceof Array)){var len=p.length;this.points=new Float32Array(p);}}
__class(Vertex,'laya.webgl.shapes.Vertex');var __proto=Vertex.prototype;Laya.imps(__proto,{"laya.webgl.shapes.IShape":true})
__proto.getData=function(ib,vb,start){}
__proto.needUpdate=function(mat){return false;}
__proto.rebuild=function(points){}
__proto.setMatrix=function(mat){}
return Vertex;})()
var Submit=(function(){function Submit(renderType){(renderType===void 0)&&(renderType=10000);this._renderType=renderType;}
__class(Submit,'laya.webgl.submit.Submit');var __proto=Submit.prototype;Laya.imps(__proto,{"laya.webgl.submit.ISubmit":true})
__proto.releaseRender=function(){var cache=Submit._cache;cache[cache._length++]=this;this.shaderValue.release();this._vb=null;}
__proto.getRenderType=function(){return this._renderType;}
__proto.renderSubmit=function(){if(this._numEle===0)return 1;var _tex=this.shaderValue.textureHost;if(_tex){var source=_tex.source;if(!_tex.bitmap||!source)
return 1;this.shaderValue.texture=source;}
this._vb.bind_upload(this._ib);var gl=WebGL.mainContext;this.shaderValue.upload();if(BlendMode.activeBlendFunction!==this._blendFn){gl.enable(0x0BE2);this._blendFn(gl);BlendMode.activeBlendFunction=this._blendFn;}
Stat.drawCall++;Stat.trianglesFaces+=this._numEle/3;gl.drawElements(0x0004,this._numEle,0x1403,this._startIdx);return 1;}
Submit.__init__=function(){var s=Submit.RENDERBASE=new Submit(-1);s.shaderValue=new Value2D(0,0);s.shaderValue.ALPHA=-1234;}
Submit.createSubmit=function(context,ib,vb,pos,sv){var o=Submit._cache._length?Submit._cache[--Submit._cache._length]:new Submit();if(vb==null){vb=o._selfVb||(o._selfVb=VertexBuffer2D.create(-1));vb.clear();pos=0;}
o._ib=ib;o._vb=vb;o._startIdx=pos*CONST3D2D.BYTES_PIDX;o._numEle=0;var blendType=context._nBlendType;o._blendFn=context._targets?BlendMode.targetFns[blendType]:BlendMode.fns[blendType];o.shaderValue=sv;o.shaderValue.setValue(context._shader2D);var filters=context._shader2D.filters;filters&&o.shaderValue.setFilters(filters);return o;}
Submit.createShape=function(ctx,ib,vb,numEle,offset,sv){var o=(!Submit._cache._length)?(new Submit()):Submit._cache[--Submit._cache._length];o._ib=ib;o._vb=vb;o._numEle=numEle;o._startIdx=offset;o.shaderValue=sv;o.shaderValue.setValue(ctx._shader2D);var blendType=ctx._nBlendType;o._blendFn=ctx._targets?BlendMode.targetFns[blendType]:BlendMode.fns[blendType];return o;}
Submit.TYPE_2D=10000;Submit.TYPE_CANVAS=10003;Submit.TYPE_CMDSETRT=10004;Submit.TYPE_CUSTOM=10005;Submit.TYPE_BLURRT=10006;Submit.TYPE_CMDDESTORYPRERT=10007;Submit.TYPE_DISABLESTENCIL=10008;Submit.TYPE_OTHERIBVB=10009;Submit.TYPE_PRIMITIVE=10010;Submit.TYPE_RT=10011;Submit.TYPE_BLUR_RT=10012;Submit.TYPE_TARGET=10013;Submit.TYPE_CHANGE_VALUE=10014;Submit.TYPE_SHAPE=10015;Submit.TYPE_TEXTURE=10016;Submit.TYPE_FILLTEXTURE=10017;Submit.RENDERBASE=null;Submit._cache=(Submit._cache=[],Submit._cache._length=0,Submit._cache);return Submit;})()
var SubmitCMD=(function(){function SubmitCMD(){this.fun=null;this.args=null;}
__class(SubmitCMD,'laya.webgl.submit.SubmitCMD');var __proto=SubmitCMD.prototype;Laya.imps(__proto,{"laya.webgl.submit.ISubmit":true})
__proto.renderSubmit=function(){this.fun.apply(null,this.args);return 1;}
__proto.getRenderType=function(){return 0;}
__proto.releaseRender=function(){var cache=SubmitCMD._cache;cache[cache._length++]=this;}
SubmitCMD.create=function(args,fun){var o=SubmitCMD._cache._length?SubmitCMD._cache[--SubmitCMD._cache._length]:new SubmitCMD();o.fun=fun;o.args=args;return o;}
SubmitCMD._cache=(SubmitCMD._cache=[],SubmitCMD._cache._length=0,SubmitCMD._cache);return SubmitCMD;})()
var SubmitCMDScope=(function(){function SubmitCMDScope(){this.variables={};}
__class(SubmitCMDScope,'laya.webgl.submit.SubmitCMDScope');var __proto=SubmitCMDScope.prototype;__proto.getValue=function(name){return this.variables[name];}
__proto.addValue=function(name,value){return this.variables[name]=value;}
__proto.setValue=function(name,value){if(this.variables.hasOwnProperty(name)){return this.variables[name]=value;}
return null;}
__proto.clear=function(){for(var key in this.variables){delete this.variables[key];}}
__proto.recycle=function(){this.clear();SubmitCMDScope.POOL.push(this);}
SubmitCMDScope.create=function(){var scope=SubmitCMDScope.POOL.pop();scope||(scope=new SubmitCMDScope());return scope;}
SubmitCMDScope.POOL=[];return SubmitCMDScope;})()
var SubmitOtherIBVB=(function(){function SubmitOtherIBVB(){this.offset=0;this.startIndex=0;;this._mat=Matrix.create();}
__class(SubmitOtherIBVB,'laya.webgl.submit.SubmitOtherIBVB');var __proto=SubmitOtherIBVB.prototype;Laya.imps(__proto,{"laya.webgl.submit.ISubmit":true})
__proto.releaseRender=function(){var cache=SubmitOtherIBVB._cache;cache[cache._length++]=this;}
__proto.getRenderType=function(){return 10009;}
__proto.renderSubmit=function(){var _tex=this._shaderValue.textureHost;if(_tex){var source=_tex.source;if(!_tex.bitmap||!source)
return 1;this._shaderValue.texture=source;}
this._vb.bind_upload(this._ib);var w=RenderState2D.worldMatrix4;var wmat=Matrix.TEMP;Matrix.mulPre(this._mat,w[0],w[1],w[4],w[5],w[12],w[13],wmat);var tmp=RenderState2D.worldMatrix4=SubmitOtherIBVB.tempMatrix4;tmp[0]=wmat.a;tmp[1]=wmat.b;tmp[4]=wmat.c;tmp[5]=wmat.d;tmp[12]=wmat.tx;tmp[13]=wmat.ty;this._shader._offset=this.offset;this._shaderValue.refresh();this._shader.upload(this._shaderValue);this._shader._offset=0;var gl=WebGL.mainContext;if(BlendMode.activeBlendFunction!==this._blendFn){gl.enable(0x0BE2);this._blendFn(gl);BlendMode.activeBlendFunction=this._blendFn;}
Stat.drawCall++;Stat.trianglesFaces+=this._numEle/3;gl.drawElements(0x0004,this._numEle,0x1403,this.startIndex);RenderState2D.worldMatrix4=w;BaseShader.activeShader=null;return 1;}
SubmitOtherIBVB.create=function(context,vb,ib,numElement,shader,shaderValue,startIndex,offset,type){(type===void 0)&&(type=0);var o=(!SubmitOtherIBVB._cache._length)?(new SubmitOtherIBVB()):SubmitOtherIBVB._cache[--SubmitOtherIBVB._cache._length];o._ib=ib;o._vb=vb;o._numEle=numElement;o._shader=shader;o._shaderValue=shaderValue;var blendType=context._nBlendType;o._blendFn=context._targets?BlendMode.targetFns[blendType]:BlendMode.fns[blendType];switch(type){case 0:o.offset=0;o.startIndex=offset/(CONST3D2D.BYTES_PE*vb.vertexStride)*1.5;o.startIndex*=CONST3D2D.BYTES_PIDX;break;case 1:o.startIndex=startIndex;o.offset=offset;break;}
return o;}
SubmitOtherIBVB._cache=(SubmitOtherIBVB._cache=[],SubmitOtherIBVB._cache._length=0,SubmitOtherIBVB._cache);SubmitOtherIBVB.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,];return SubmitOtherIBVB;})()
var SubmitScissor=(function(){function SubmitScissor(){this.submitIndex=0;this.submitLength=0;this.context=null;this.clipRect=new Rectangle();this.screenRect=new Rectangle();}
__class(SubmitScissor,'laya.webgl.submit.SubmitScissor');var __proto=SubmitScissor.prototype;Laya.imps(__proto,{"laya.webgl.submit.ISubmit":true})
__proto._scissor=function(x,y,w,h){var m=RenderState2D.worldMatrix4;var a=m[0],d=m[5],tx=m[12],ty=m[13];x=x*a+tx;y=y*d+ty;w*=a;h*=d;if(w<1||h<1){return false;};var r=x+w;var b=y+h;x<0&&(x=0,w=r-x);y<0&&(y=0,h=b-y);var screen=RenderState2D.worldClipRect;x=Math.max(x,screen.x);y=Math.max(y,screen.y);w=Math.min(r,screen.right)-x;h=Math.min(b,screen.bottom)-y;if(w<1||h<1){return false;};var worldScissorTest=RenderState2D.worldScissorTest;this.screenRect.copyFrom(screen);screen.x=x;screen.y=y;screen.width=w;screen.height=h;RenderState2D.worldScissorTest=true;y=RenderState2D.height-y-h;WebGL.mainContext.scissor(x,y,w,h);WebGL.mainContext.enable(0x0C11);this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength);if(worldScissorTest){y=RenderState2D.height-this.screenRect.y-this.screenRect.height;WebGL.mainContext.scissor(this.screenRect.x,y,this.screenRect.width,this.screenRect.height);WebGL.mainContext.enable(0x0C11);}
else{WebGL.mainContext.disable(0x0C11);RenderState2D.worldScissorTest=false;}
screen.copyFrom(this.screenRect);return true;}
__proto._scissorWithTagart=function(x,y,w,h){if(w<1||h<1){return false;};var r=x+w;var b=y+h;x<0&&(x=0,w=r-x);y<0&&(y=0,h=b-y);var screen=RenderState2D.worldClipRect;x=Math.max(x,screen.x);y=Math.max(y,screen.y);w=Math.min(r,screen.right)-x;h=Math.min(b,screen.bottom)-y;if(w<1||h<1){return false;};var worldScissorTest=RenderState2D.worldScissorTest;this.screenRect.copyFrom(screen);RenderState2D.worldScissorTest=true;screen.x=x;screen.y=y;screen.width=w;screen.height=h;y=RenderState2D.height-y-h;WebGL.mainContext.scissor(x,y,w,h);WebGL.mainContext.enable(0x0C11);this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength);if(worldScissorTest){y=RenderState2D.height-this.screenRect.y-this.screenRect.height;WebGL.mainContext.scissor(this.screenRect.x,y,this.screenRect.width,this.screenRect.height);WebGL.mainContext.enable(0x0C11);}
else{WebGL.mainContext.disable(0x0C11);RenderState2D.worldScissorTest=false;}
screen.copyFrom(this.screenRect);return true;}
__proto.renderSubmit=function(){this.submitLength=Math.min(this.context._submits._length-1,this.submitLength);if(this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1)
return this.submitLength+1;if(this.context._targets)
this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height);else this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height);return this.submitLength+1;}
__proto.getRenderType=function(){return 0;}
__proto.releaseRender=function(){var cache=SubmitScissor._cache;cache[cache._length++]=this;this.context=null;}
SubmitScissor.create=function(context){var o=SubmitScissor._cache._length?SubmitScissor._cache[--SubmitScissor._cache._length]:new SubmitScissor();o.context=context;return o;}
SubmitScissor._cache=(SubmitScissor._cache=[],SubmitScissor._cache._length=0,SubmitScissor._cache);return SubmitScissor;})()
var SubmitStencil=(function(){function SubmitStencil(){this.step=0;this.blendMode=null;this.level=0;}
__class(SubmitStencil,'laya.webgl.submit.SubmitStencil');var __proto=SubmitStencil.prototype;Laya.imps(__proto,{"laya.webgl.submit.ISubmit":true})
__proto.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8();break;}
return 1;}
__proto.getRenderType=function(){return 0;}
__proto.releaseRender=function(){var cache=SubmitStencil._cache;cache[cache._length++]=this;}
__proto.do1=function(){var gl=WebGL.mainContext;gl.enable(0x0B90);gl.clear(0x00000400);gl.colorMask(false,false,false,false);gl.stencilFunc(0x0202,this.level,0xFF);gl.stencilOp(0x1E00,0x1E00,0x1E02);}
__proto.do2=function(){var gl=WebGL.mainContext;gl.stencilFunc(0x0202,this.level+1,0xFF);gl.colorMask(true,true,true,true);gl.stencilOp(0x1E00,0x1E00,0x1E00);}
__proto.do3=function(){var gl=WebGL.mainContext;gl.colorMask(true,true,true,true);gl.stencilOp(0x1E00,0x1E00,0x1E00);gl.clear(0x00000400);gl.disable(0x0B90);}
__proto.do4=function(){var gl=WebGL.mainContext;if(this.level==0){gl.enable(0x0B90);gl.clear(0x00000400);}
gl.colorMask(false,false,false,false);gl.stencilFunc(0x0207,0,0xFF);gl.stencilOp(0x1E00,0x1E00,0x1E02);}
__proto.do5=function(){var gl=WebGL.mainContext;gl.stencilFunc(0x0202,this.level,0xFF);gl.colorMask(true,true,true,true);gl.stencilOp(0x1E00,0x1E00,0x1E00);}
__proto.do6=function(){var gl=WebGL.mainContext;BlendMode.targetFns[BlendMode.TOINT[this.blendMode]](gl);}
__proto.do7=function(){var gl=WebGL.mainContext;gl.colorMask(false,false,false,false);gl.stencilOp(0x1E00,0x1E00,0x1E03);}
__proto.do8=function(){var gl=WebGL.mainContext;gl.colorMask(true,true,true,true);gl.stencilFunc(0x0202,this.level,0xFF);gl.stencilOp(0x1E00,0x1E00,0x1E00);}
SubmitStencil.restore=function(context,clip,m,_x,_y){var submitStencil;context._renderKey=0;if(SubmitStencil._mask>0){SubmitStencil._mask--;}
if(SubmitStencil._mask==0){submitStencil=laya.webgl.submit.SubmitStencil.create(3);context.addRenderObject(submitStencil);context._curSubmit=Submit.RENDERBASE;}
else{submitStencil=laya.webgl.submit.SubmitStencil.create(7);context.addRenderObject(submitStencil);var vb=context._vb;var nPos=(vb._byteLength>>2);if(GlUtils.fillRectImgVb(vb,null,clip.x,clip.y,clip.width,clip.height,Texture.DEF_UV,m,_x,_y,0,0)){var shader=context._shader2D;shader.glTexture=null;var submit=context._curSubmit=Submit.createSubmit(context,context._ib,vb,((vb._byteLength-16*4)/32)*3,Value2D.create(0x02,0));submit.shaderValue.ALPHA=1.0;context._submits[context._submits._length++]=submit;context._curSubmit._numEle+=6;context._curSubmit=Submit.RENDERBASE;}else{alert("clipRect calc stencil rect error");}
submitStencil=laya.webgl.submit.SubmitStencil.create(8);context.addRenderObject(submitStencil);}}
SubmitStencil.restore2=function(context,submit){var submitStencil;context._renderKey=0;if(SubmitStencil._mask>0){SubmitStencil._mask--;}
if(SubmitStencil._mask==0){submitStencil=laya.webgl.submit.SubmitStencil.create(3);context.addRenderObject(submitStencil);context._curSubmit=Submit.RENDERBASE;}
else{submitStencil=laya.webgl.submit.SubmitStencil.create(7);context.addRenderObject(submitStencil);context._submits[context._submits._length++]=submit;submitStencil=laya.webgl.submit.SubmitStencil.create(8);context.addRenderObject(submitStencil);}}
SubmitStencil.create=function(step){var o=SubmitStencil._cache._length?SubmitStencil._cache[--SubmitStencil._cache._length]:new SubmitStencil();o.step=step;if(step==5)
++SubmitStencil._mask;o.level=SubmitStencil._mask;return o;}
SubmitStencil._cache=(SubmitStencil._cache=[],SubmitStencil._cache._length=0,SubmitStencil._cache);SubmitStencil._mask=0;return SubmitStencil;})()
var SubmitTarget=(function(){function SubmitTarget(){this._renderType=0;this._vb=null;this._ib=null;this._startIdx=0;this._numEle=0;this.shaderValue=null;this.blendType=0;this.proName=null;this.scope=null;}
__class(SubmitTarget,'laya.webgl.submit.SubmitTarget');var __proto=SubmitTarget.prototype;Laya.imps(__proto,{"laya.webgl.submit.ISubmit":true})
__proto.renderSubmit=function(){this._vb.bind_upload(this._ib);var target=this.scope.getValue(this.proName);if(target){this.shaderValue.texture=target.source;if(this.shaderValue["strength"]&&!this.shaderValue["blurInfo"]){this.shaderValue["blurInfo"]=[target.width,target.height];}
this.shaderValue.upload();this.blend();Stat.drawCall++;Stat.trianglesFaces+=this._numEle/3;WebGL.mainContext.drawElements(0x0004,this._numEle,0x1403,this._startIdx);}
return 1;}
__proto.blend=function(){if(BlendMode.activeBlendFunction!==BlendMode.fns[this.blendType]){var gl=WebGL.mainContext;gl.enable(0x0BE2);BlendMode.fns[this.blendType](gl);BlendMode.activeBlendFunction=BlendMode.fns[this.blendType];}}
__proto.getRenderType=function(){return 0;}
__proto.releaseRender=function(){var cache=SubmitTarget._cache;cache[cache._length++]=this;}
SubmitTarget.create=function(context,ib,vb,pos,sv,proName){var o=SubmitTarget._cache._length?SubmitTarget._cache[--SubmitTarget._cache._length]:new SubmitTarget();o._ib=ib;o._vb=vb;o.proName=proName;o._startIdx=pos*CONST3D2D.BYTES_PIDX;o._numEle=0;o.blendType=context._nBlendType;o.shaderValue=sv;o.shaderValue.setValue(context._shader2D);return o;}
SubmitTarget._cache=(SubmitTarget._cache=[],SubmitTarget._cache._length=0,SubmitTarget._cache);return SubmitTarget;})()
var CharSegment=(function(){function CharSegment(){this._sourceStr=null;}
__class(CharSegment,'laya.webgl.text.CharSegment');var __proto=CharSegment.prototype;Laya.imps(__proto,{"laya.webgl.text.ICharSegment":true})
__proto.textToSpit=function(str){this._sourceStr=str;}
__proto.getChar=function(i){return this._sourceStr.charAt(i);}
__proto.getCharCode=function(i){return this._sourceStr.charCodeAt(i);}
__proto.length=function(){return this._sourceStr.length;}
return CharSegment;})()
var DrawText=(function(){var CharValue;function DrawText(){}
__class(DrawText,'laya.webgl.text.DrawText');DrawText.__init__=function(){DrawText._charsTemp=new Array;DrawText._drawValue=new CharValue();DrawText._charSeg=new CharSegment();}
DrawText.customCharSeg=function(charseg){DrawText._charSeg=charseg;}
DrawText.getChar=function(char,id,drawValue){var result=WebGLCharImage.createOneChar(char,drawValue);if(id!=-1)
DrawText._charsCache[id]=result;return result;}
DrawText._drawSlow=function(save,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine){var drawValue=DrawText._drawValue.value(font,fillColor,borderColor,lineWidth,sx,sy,underLine);var i=0,n=0;var chars=DrawText._charsTemp;var width=0,oneChar,htmlWord,id=NaN;if(words){chars.length=words.length;for(i=0,n=words.length;i<n;i++){htmlWord=words[i];id=htmlWord.charNum+drawValue.txtID;chars[i]=oneChar=DrawText._charsCache[id]||DrawText.getChar(htmlWord.char,id,drawValue);oneChar.active();}}else{var text=((txt instanceof laya.utils.WordText))?txt.toString():txt;if(Text.CharacterCache){DrawText._charSeg.textToSpit(text);var len=DrawText._charSeg.length();chars.length=len;for(i=0,n=len;i<n;i++){id=DrawText._charSeg.getCharCode(i)+drawValue.txtID;chars[i]=oneChar=DrawText._charsCache[id]||DrawText.getChar(DrawText._charSeg.getChar(i),id,drawValue);oneChar.active();width+=oneChar.cw;}}
else{chars.length=0;oneChar=DrawText.getChar(text,-1,drawValue);oneChar.active();width+=oneChar.cw;chars[0]=oneChar;}};var dx=0;if(textAlign!==null&&textAlign!=="left")
dx=-(textAlign=="center"?(width/2):width);var uv,bdSz=NaN,texture,value,saveLength=0;if(words){for(i=0,n=chars.length;i<n;i++){oneChar=chars[i];if(!oneChar.isSpace){htmlWord=words[i];bdSz=oneChar.borderSize;texture=oneChar.texture;ctx._drawText(texture,x+dx+htmlWord.x*sx-bdSz,y+htmlWord.y*sy-bdSz,texture.width,texture.height,curMat,0,0,0,0);}}}else{for(i=0,n=chars.length;i<n;i++){oneChar=chars[i];if(!oneChar.isSpace){bdSz=oneChar.borderSize;texture=oneChar.texture;ctx._drawText(texture,x+dx-bdSz,y-bdSz,texture.width,texture.height,curMat,0,0,0,0);save&&(value=save[saveLength++],value||(value=save[saveLength-1]=[]),value[0]=texture,value[1]=dx-bdSz,value[2]=-bdSz);}
dx+=oneChar.cw;}
save&&(save.length=saveLength);}}
DrawText._drawFast=function(save,ctx,curMat,x,y){var texture,value;for(var i=0,n=save.length;i<n;i++){value=save[i];texture=value[0];texture.active();ctx._drawText(texture,x+value[1],y+value[2],texture.width,texture.height,curMat,0,0,0,0);}}
DrawText.drawText=function(ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,underLine){(underLine===void 0)&&(underLine=0);if((txt&&txt.length===0)||(words&&words.length===0))
return;var sx=curMat.a,sy=curMat.d;(curMat.b!==0||curMat.c!==0)&&(sx=sy=1);var scale=sx!==1||sy!==1;if(scale&&Laya.stage.transform){var t=Laya.stage.transform;scale=t.a===sx&&t.d===sy;}else scale=false;if(scale){curMat=curMat.copyTo(WebGLContext2D._tmpMatrix);var tempTx=curMat.tx;var tempTy=curMat.ty;curMat.scale(1/sx,1/sy);curMat._checkTransform();x*=sx;y*=sy;x+=tempTx-curMat.tx;y+=tempTy-curMat.ty;}else sx=sy=1;if(words){DrawText._drawSlow(null,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine);}else{if(txt.toUpperCase===null){var idNum=sx+sy*100000;var myCache=txt;if(!myCache.changed&&myCache.id===idNum){DrawText._drawFast(myCache.save,ctx,curMat,x,y);}else{myCache.id=idNum;myCache.changed=false;DrawText._drawSlow(myCache.save,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine);}
return;};var id=txt+font.toString()+fillColor+borderColor+lineWidth+sx+sy+textAlign;var cache=DrawText._textsCache[id];if(Text.CharacterCache){if(cache){DrawText._drawFast(cache,ctx,curMat,x,y);}else{DrawText._textsCache.__length||(DrawText._textsCache.__length=0);if(DrawText._textsCache.__length>Config.WebGLTextCacheCount){DrawText._textsCache={};DrawText._textsCache.__length=0;DrawText._curPoolIndex=0;}
DrawText._textCachesPool[DrawText._curPoolIndex]?(cache=DrawText._textsCache[id]=DrawText._textCachesPool[DrawText._curPoolIndex],cache.length=0):(DrawText._textCachesPool[DrawText._curPoolIndex]=cache=DrawText._textsCache[id]=[]);DrawText._textsCache.__length++
DrawText._curPoolIndex++;DrawText._drawSlow(cache,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine);}}
else{DrawText._drawSlow(cache,ctx,txt,words,curMat,font,textAlign,fillColor,borderColor,lineWidth,x,y,sx,sy,underLine);}}}
DrawText._charsTemp=null;DrawText._textCachesPool=[];DrawText._curPoolIndex=0;DrawText._charsCache={};DrawText._textsCache={};DrawText._drawValue=null;DrawText.d=[];DrawText._charSeg=null;DrawText.__init$=function(){CharValue=(function(){function CharValue(){}
__class(CharValue,'');var __proto=CharValue.prototype;__proto.value=function(font,fillColor,borderColor,lineWidth,scaleX,scaleY,underLine){this.font=font;this.fillColor=fillColor;this.borderColor=borderColor;this.lineWidth=lineWidth;this.scaleX=scaleX;this.scaleY=scaleY;this.underLine=underLine;var key=font.toString()+scaleX+scaleY+lineWidth+fillColor+borderColor+underLine;this.txtID=CharValue._keymap[key];if(!this.txtID){this.txtID=(++CharValue._keymapCount)*0.0000001;CharValue._keymap[key]=this.txtID;}
return this;}
CharValue.clear=function(){CharValue._keymap={};CharValue._keymapCount=1;}
CharValue._keymap={};CharValue._keymapCount=1;return CharValue;})()}
return DrawText;})()
var FontInContext=(function(){function FontInContext(font){this._index=0;this._size=14;this._italic=-2;FontInContext._cache2=FontInContext._cache2||[];this.setFont(font||"14px Arial");}
__class(FontInContext,'laya.webgl.text.FontInContext');var __proto=FontInContext.prototype;__proto.setFont=function(value){var arr=FontInContext._cache2[value];if(!arr){this._words=value.split(' ');for(var i=0,n=this._words.length;i<n;i++){if(this._words[i].indexOf('px')>0){this._index=i;break;}}
this._size=parseInt(this._words[this._index]);FontInContext._cache2[value]=[this._words,this._size];}else{this._words=arr[0];this._size=arr[1];}
this._text=null;this._italic=-2;}
__proto.getItalic=function(){this._italic===-2&&(this._italic=this.hasType("italic"));return this._italic;}
__proto.hasType=function(name){for(var i=0,n=this._words.length;i<n;i++)
if(this._words[i]===name)return i;return-1;}
__proto.removeType=function(name){for(var i=0,n=this._words.length;i<n;i++)
if(this._words[i]===name){this._words.splice(i,1);if(this._index>i)this._index--;break;}
this._text=null;this._italic=-2;}
__proto.copyTo=function(dec){dec._text=this._text;dec._size=this._size;dec._index=this._index;dec._words=this._words.slice();dec._italic=-2;return dec;}
__proto.toString=function(){return this._text?this._text:(this._text=this._words.join(' '));}
__getset(0,__proto,'size',function(){return this._size;},function(value){this._size=value;this._words[this._index]=value+"px";this._text=null;});FontInContext.create=function(font){var r=FontInContext._cache[font];if(r)return r;r=FontInContext._cache[font]=new FontInContext(font);return r;}
FontInContext.EMPTY=new FontInContext();FontInContext._cache={};FontInContext._cache2=null;return FontInContext;})()
var CONST3D2D=(function(){function CONST3D2D(){}
__class(CONST3D2D,'laya.webgl.utils.CONST3D2D');CONST3D2D.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];CONST3D2D.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1];CONST3D2D.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0];CONST3D2D._TMPARRAY=[];CONST3D2D._OFFSETX=0;CONST3D2D._OFFSETY=0;__static(CONST3D2D,['BYTES_PE',function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT;},'BYTES_PIDX',function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT;}]);return CONST3D2D;})()
var GlUtils=(function(){function GlUtils(){}
__class(GlUtils,'laya.webgl.utils.GlUtils');GlUtils.make2DProjection=function(width,height,depth){return[2.0/width,0,0,0,0,-2.0/height,0,0,0,0,2.0/depth,0,-1,1,0,1,];}
GlUtils.fillIBQuadrangle=function(buffer,count){if(count>65535/4){throw Error("IBQuadrangle count:"+count+" must<:"+Math.floor(65535/4));return false;}
count=Math.floor(count);buffer._resizeBuffer((count+1)*6*2,false);buffer.byteLength=buffer.bufferLength;var bufferData=buffer.getUint16Array();var idx=0;for(var i=0;i<count;i++){bufferData[idx++]=i*4;bufferData[idx++]=i*4+2;bufferData[idx++]=i*4+1;bufferData[idx++]=i*4;bufferData[idx++]=i*4+3;bufferData[idx++]=i*4+2;}
buffer.setNeedUpload();return true;}
GlUtils.expandIBQuadrangle=function(buffer,count){buffer.bufferLength>=(count*6*2)||GlUtils.fillIBQuadrangle(buffer,count);}
GlUtils.mathCeilPowerOfTwo=function(value){value--;value|=value>>1;value|=value>>2;value|=value>>4;value|=value>>8;value|=value>>16;value++;return value;}
GlUtils.fillQuadrangleImgVb=function(vb,x,y,point4,uv,m,_x,_y){'use strict';var vpos=(vb._byteLength>>2)+16;vb.byteLength=(vpos<<2);var vbdata=vb.getFloat32Array();vpos-=16;vbdata[vpos+2]=uv[0];vbdata[vpos+3]=uv[1];vbdata[vpos+6]=uv[2];vbdata[vpos+7]=uv[3];vbdata[vpos+10]=uv[4];vbdata[vpos+11]=uv[5];vbdata[vpos+14]=uv[6];vbdata[vpos+15]=uv[7];var a=m.a,b=m.b,c=m.c,d=m.d;if(a!==1||b!==0||c!==0||d!==1){m.bTransform=true;var tx=m.tx+_x,ty=m.ty+_y;vbdata[vpos]=(point4[0]+x)*a+(point4[1]+y)*c+tx;vbdata[vpos+1]=(point4[0]+x)*b+(point4[1]+y)*d+ty;vbdata[vpos+4]=(point4[2]+x)*a+(point4[3]+y)*c+tx;vbdata[vpos+5]=(point4[2]+x)*b+(point4[3]+y)*d+ty;vbdata[vpos+8]=(point4[4]+x)*a+(point4[5]+y)*c+tx;vbdata[vpos+9]=(point4[4]+x)*b+(point4[5]+y)*d+ty;vbdata[vpos+12]=(point4[6]+x)*a+(point4[7]+y)*c+tx;vbdata[vpos+13]=(point4[6]+x)*b+(point4[7]+y)*d+ty;}else{m.bTransform=false;x+=m.tx+_x;y+=m.ty+_y;vbdata[vpos]=x+point4[0];vbdata[vpos+1]=y+point4[1];vbdata[vpos+4]=x+point4[2];vbdata[vpos+5]=y+point4[3];vbdata[vpos+8]=x+point4[4];vbdata[vpos+9]=y+point4[5];vbdata[vpos+12]=x+point4[6];vbdata[vpos+13]=y+point4[7];}
vb._upload=true;return true;}
GlUtils.fillTranglesVB=function(vb,x,y,points,m,_x,_y){var vpos=(vb._byteLength>>2)+points.length;vb.byteLength=(vpos<<2);var vbdata=vb.getFloat32Array();vpos-=points.length;var len=points.length;var a=m.a,b=m.b,c=m.c,d=m.d;for(var i=0;i<len;i+=4){vbdata[vpos+i+2]=points[i+2];vbdata[vpos+i+3]=points[i+3];if(a!==1||b!==0||c!==0||d!==1){m.bTransform=true;var tx=m.tx+_x,ty=m.ty+_y;vbdata[vpos+i]=(points[i]+x)*a+(points[i+1]+y)*c+tx;vbdata[vpos+i+1]=(points[i]+x)*b+(points[i+1]+y)*d+ty;}else{m.bTransform=false;x+=m.tx+_x;y+=m.ty+_y;vbdata[vpos+i]=x+points[i];vbdata[vpos+i+1]=y+points[i+1];}}
vb._upload=true;return true;}
GlUtils.copyPreImgVb=function(vb,dx,dy){var vpos=(vb._byteLength>>2);vb.byteLength=((vpos+16)<<2);var vbdata=vb.getFloat32Array();for(var i=0,ci=vpos-16;i<4;i++){vbdata[vpos]=vbdata[ci]+dx;++vpos;++ci;vbdata[vpos]=vbdata[ci]+dy;++vpos;++ci;vbdata[vpos]=vbdata[ci];++vpos;++ci;vbdata[vpos]=vbdata[ci];++vpos;++ci;}
vb._upload=true;}
GlUtils.fillRectImgVb=function(vb,clip,x,y,width,height,uv,m,_x,_y,dx,dy,round){(round===void 0)&&(round=false);var mType=1;var toBx,toBy,toEx,toEy;var cBx,cBy,cEx,cEy;var w0,h0,tx,ty;var finalX,finalY,offsetX,offsetY;var a=m.a,b=m.b,c=m.c,d=m.d;var useClip=clip&&clip.width<99999999;if(a!==1||b!==0||c!==0||d!==1){m.bTransform=true;if(b===0&&c===0){mType=23;w0=width+x,h0=height+y;tx=m.tx+_x,ty=m.ty+_y;toBx=a*x+tx;toEx=a*w0+tx;toBy=d*y+ty;toEy=d*h0+ty;}}else{mType=23;m.bTransform=false;toBx=x+m.tx+_x;toEx=toBx+width;toBy=y+m.ty+_y;toEy=toBy+height;}
if(useClip){cBx=clip.x,cBy=clip.y,cEx=clip.width+cBx,cEy=clip.height+cBy;}
if(mType!==1){if(Math.min(toBx,toEx)>=cEx)return false;if(Math.min(toBy,toEy)>=cEy)return false;if(Math.max(toEx,toBx)<=cBx)return false;if(Math.max(toEy,toBy)<=cBy)return false;};var vpos=(vb._byteLength>>2);vb.byteLength=((vpos+16)<<2);var vbdata=vb.getFloat32Array();vbdata[vpos+2]=uv[0];vbdata[vpos+3]=uv[1];vbdata[vpos+6]=uv[2];vbdata[vpos+7]=uv[3];vbdata[vpos+10]=uv[4];vbdata[vpos+11]=uv[5];vbdata[vpos+14]=uv[6];vbdata[vpos+15]=uv[7];switch(mType){case 1:tx=m.tx+_x,ty=m.ty+_y;w0=width+x,h0=height+y;var w1=x,h1=y;var aw1=a*w1,ch1=c*h1,dh1=d*h1,bw1=b*w1;var aw0=a*w0,ch0=c*h0,dh0=d*h0,bw0=b*w0;if(round){finalX=aw1+ch1+tx;offsetX=Math.round(finalX)-finalX;finalY=dh1+bw1+ty;offsetY=Math.round(finalY)-finalY;vbdata[vpos]=finalX+offsetX;vbdata[vpos+1]=finalY+offsetY;vbdata[vpos+4]=aw0+ch1+tx+offsetX;vbdata[vpos+5]=dh1+bw0+ty+offsetY;vbdata[vpos+8]=aw0+ch0+tx+offsetX;vbdata[vpos+9]=dh0+bw0+ty+offsetY;vbdata[vpos+12]=aw1+ch0+tx+offsetX;vbdata[vpos+13]=dh0+bw1+ty+offsetY;}else{vbdata[vpos]=aw1+ch1+tx;vbdata[vpos+1]=dh1+bw1+ty;vbdata[vpos+4]=aw0+ch1+tx;vbdata[vpos+5]=dh1+bw0+ty;vbdata[vpos+8]=aw0+ch0+tx;vbdata[vpos+9]=dh0+bw0+ty;vbdata[vpos+12]=aw1+ch0+tx;vbdata[vpos+13]=dh0+bw1+ty;}
break;case 23:if(round){finalX=toBx+dx;offsetX=Math.round(finalX)-finalX;finalY=toBy;offsetY=Math.round(finalY)-finalY;vbdata[vpos]=finalX+offsetX;vbdata[vpos+1]=finalY+offsetY;vbdata[vpos+4]=toEx+dx+offsetX;vbdata[vpos+5]=toBy+offsetY;vbdata[vpos+8]=toEx+offsetX;vbdata[vpos+9]=toEy+offsetY;vbdata[vpos+12]=toBx+offsetX;vbdata[vpos+13]=toEy+offsetY;}else{vbdata[vpos]=toBx+dx;vbdata[vpos+1]=toBy;vbdata[vpos+4]=toEx+dx;vbdata[vpos+5]=toBy;vbdata[vpos+8]=toEx;vbdata[vpos+9]=toEy;vbdata[vpos+12]=toBx;vbdata[vpos+13]=toEy;}
break;}
vb._upload=true;return true;}
GlUtils.fillLineVb=function(vb,clip,fx,fy,tx,ty,width,mat){'use strict';var linew=width*.5;var data=GlUtils._fillLineArray;var perpx=-(fy-ty),perpy=fx-tx;var dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx/=dist,perpy/=dist,perpx*=linew,perpy*=linew;data[0]=fx-perpx,data[1]=fy-perpy,data[4]=fx+perpx,data[5]=fy+perpy,data[8]=tx+perpx,data[9]=ty+perpy,data[12]=tx-perpx,data[13]=ty-perpy;mat&&mat.transformPointArray(data,data);var vpos=(vb._byteLength>>2)+16;vb.byteLength=(vpos<<2);vb.insertData(data,vpos-16);return true;}
GlUtils._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return GlUtils;})()
var MatirxArray=(function(){function MatirxArray(){}
__class(MatirxArray,'laya.webgl.utils.MatirxArray');MatirxArray.ArrayMul=function(a,b,o){if(!a){MatirxArray.copyArray(b,o);return;}
if(!b){MatirxArray.copyArray(a,o);return;};var ai0=NaN,ai1=NaN,ai2=NaN,ai3=NaN;for(var i=0;i<4;i++){ai0=a[i];ai1=a[i+4];ai2=a[i+8];ai3=a[i+12];o[i]=ai0*b[0]+ai1*b[1]+ai2*b[2]+ai3*b[3];o[i+4]=ai0*b[4]+ai1*b[5]+ai2*b[6]+ai3*b[7];o[i+8]=ai0*b[8]+ai1*b[9]+ai2*b[10]+ai3*b[11];o[i+12]=ai0*b[12]+ai1*b[13]+ai2*b[14]+ai3*b[15];}}
MatirxArray.copyArray=function(f,t){if(!f)return;if(!t)return;for(var i=0;i<f.length;i++){t[i]=f[i];}}
return MatirxArray;})()
var Mesh2D=(function(){function Mesh2D(stride,vballoc,iballoc){this._stride=0;this.vertNum=0;this.indexNum=0;this._applied=false;this._vb=null;this._ib=null;this._vao=null;this._attribInfo=null;this._quadNum=0;this.canReuse=false;this._stride=stride;this._vb=new VertexBuffer2D(stride,0x88E8);if(vballoc){this._vb._resizeBuffer(vballoc,false);}else{}
this._ib=new IndexBuffer2D();if(iballoc){this._ib._resizeBuffer(iballoc,false);}}
__class(Mesh2D,'laya.webgl.utils.Mesh2D');var __proto=Mesh2D.prototype;__proto.cloneWithNewVB=function(){var mesh=new Mesh2D(this._stride,0,0);mesh._ib=this._ib;mesh._quadNum=this._quadNum;mesh._attribInfo=this._attribInfo;return mesh;}
__proto.cloneWithNewVBIB=function(){var mesh=new Mesh2D(this._stride,0,0);mesh._attribInfo=this._attribInfo;return mesh;}
__proto.getVBW=function(){this._vb.setNeedUpload();return this._vb;}
__proto.getVBR=function(){return this._vb;}
__proto.getIBR=function(){return this._ib;}
__proto.getIBW=function(){this._ib.setNeedUpload();return this._ib;}
__proto.createQuadIB=function(QuadNum){this._quadNum=QuadNum;this._ib._resizeBuffer(QuadNum*6*2,false);this._ib.byteLength=this._ib.bufferLength;var bd=this._ib.getUint16Array();var idx=0;var curvert=0;for(var i=0;i<QuadNum;i++){bd[idx++]=curvert;bd[idx++]=curvert+2;bd[idx++]=curvert+1;bd[idx++]=curvert;bd[idx++]=curvert+3;bd[idx++]=curvert+2;curvert+=4;}
this._ib.setNeedUpload();}
__proto.setAttributes=function(attribs){this._attribInfo=attribs;if(this._attribInfo.length%3!=0){throw'Mesh2D setAttributes error!';}}
__proto.getEleNum=function(){return this._ib.getBuffer().byteLength/2;}
__proto.releaseMesh=function(){}
__proto.destroy=function(){}
__proto.clearVB=function(){this._vb.clear();}
Mesh2D._gvaoid=0;return Mesh2D;})()
var RenderState2D=(function(){function RenderState2D(){}
__class(RenderState2D,'laya.webgl.utils.RenderState2D');RenderState2D.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];}
RenderState2D.mat2MatArray=function(mat,matArray){var m=mat;var m4=matArray;m4[0]=m.a;m4[1]=m.b;m4[2]=RenderState2D.EMPTYMAT4_ARRAY[2];m4[3]=RenderState2D.EMPTYMAT4_ARRAY[3];m4[4]=m.c;m4[5]=m.d;m4[6]=RenderState2D.EMPTYMAT4_ARRAY[6];m4[7]=RenderState2D.EMPTYMAT4_ARRAY[7];m4[8]=RenderState2D.EMPTYMAT4_ARRAY[8];m4[9]=RenderState2D.EMPTYMAT4_ARRAY[9];m4[10]=RenderState2D.EMPTYMAT4_ARRAY[10];m4[11]=RenderState2D.EMPTYMAT4_ARRAY[11];m4[12]=m.tx;m4[13]=m.ty;m4[14]=RenderState2D.EMPTYMAT4_ARRAY[14];m4[15]=RenderState2D.EMPTYMAT4_ARRAY[15];return matArray;}
RenderState2D.restoreTempArray=function(){RenderState2D.TEMPMAT4_ARRAY[0]=1;RenderState2D.TEMPMAT4_ARRAY[1]=0;RenderState2D.TEMPMAT4_ARRAY[4]=0;RenderState2D.TEMPMAT4_ARRAY[5]=1;RenderState2D.TEMPMAT4_ARRAY[12]=0;RenderState2D.TEMPMAT4_ARRAY[13]=0;}
RenderState2D.clear=function(){RenderState2D.worldScissorTest=false;RenderState2D.worldShaderDefines=null;RenderState2D.worldFilters=null;RenderState2D.worldAlpha=1;RenderState2D.worldClipRect.x=RenderState2D.worldClipRect.y=0;RenderState2D.worldClipRect.width=RenderState2D.width;RenderState2D.worldClipRect.height=RenderState2D.height;RenderState2D.curRenderTarget=null;}
RenderState2D._MAXSIZE=99999999;RenderState2D.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];RenderState2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY;RenderState2D.worldAlpha=1.0;RenderState2D.worldScissorTest=false;RenderState2D.worldFilters=null;RenderState2D.worldShaderDefines=null;RenderState2D.curRenderTarget=null;RenderState2D.width=0;RenderState2D.height=0;__static(RenderState2D,['worldMatrix',function(){return this.worldMatrix=new Matrix();},'worldClipRect',function(){return this.worldClipRect=new Rectangle(0,0,99999999,99999999);}]);return RenderState2D;})()
var ShaderCompile=(function(){var ShaderNode,InlcudeFile;function ShaderCompile(name,vs,ps,nameMap,defs){var _$this=this;function _compile(script){var includefiles=[];var top=new ShaderNode(includefiles);_$this._compileToTree(top,script.split('\n'),0,includefiles,defs);return top;};var startTime=Browser.now();this._VS=_compile(vs);this._PS=_compile(ps);this._nameMap=nameMap;if((Browser.now()-startTime)>2)
console.log("ShaderCompile use time:"+(Browser.now()-startTime)+"  size:"+vs.length+"/"+ps.length);}
__class(ShaderCompile,'laya.webgl.utils.ShaderCompile');var __proto=ShaderCompile.prototype;__proto._compileToTree=function(parent,lines,start,includefiles,defs){var node,preNode;var text,name,fname;var ofs=0,words,noUseNode;var i=0,n=0,j=0;for(i=start;i<lines.length;i++){text=lines[i];if(text.length<1)continue;ofs=text.indexOf("//");if(ofs===0)continue;if(ofs>=0)text=text.substr(0,ofs);node=noUseNode||new ShaderNode(includefiles);noUseNode=null;node.text=text;node.noCompile=true;if((ofs=text.indexOf("#"))>=0){name="#";for(j=ofs+1,n=text.length;j<n;j++){var c=text.charAt(j);if(c===' '||c==='\t'||c==='?')break;name+=c;}
node.name=name;switch(name){case"#ifdef":case"#ifndef":node.src=text;node.noCompile=text.match(/[!&|()=<>]/)!=null;if(!node.noCompile){words=text.replace(/^\s*/,'').split(/\s+/);node.setCondition(words[1],name==="#ifdef"?1:2);node.text="//"+node.text;}else{console.log("function():Boolean{return "+text.substr(ofs+node.name.length)+"}");}
node.setParent(parent);parent=node;if(defs){words=text.substr(j).split(ShaderCompile._splitToWordExps3);for(j=0;j<words.length;j++){text=words[j];text.length&&(defs[text]=true);}}
continue;case"#if":node.src=text;node.noCompile=true;node.setParent(parent);parent=node;if(defs){words=text.substr(j).split(ShaderCompile._splitToWordExps3);for(j=0;j<words.length;j++){text=words[j];text.length&&text!="defined"&&(defs[text]=true);}}
continue;case"#else":node.src=text;parent=parent.parent;preNode=parent.childs[parent.childs.length-1];node.noCompile=preNode.noCompile
if(!(node.noCompile)){node.condition=preNode.condition;node.conditionType=preNode.conditionType==1?2:1;node.text="//"+node.text+" "+preNode.text+" "+node.conditionType;}
node.setParent(parent);parent=node;continue;case"#endif":parent=parent.parent;preNode=parent.childs[parent.childs.length-1];node.noCompile=preNode.noCompile;if(!(node.noCompile)){node.text="//"+node.text;}
node.setParent(parent);continue;case"#include":words=ShaderCompile.splitToWords(text,null);var inlcudeFile=ShaderCompile.includes[words[1]];if(!inlcudeFile){throw"ShaderCompile error no this include file:"+words[1];return;}
if((ofs=words[0].indexOf("?"))<0){node.setParent(parent);text=inlcudeFile.getWith(words[2]=='with'?words[3]:null);this._compileToTree(node,text.split('\n'),0,includefiles,defs);node.text="";continue;}
node.setCondition(words[0].substr(ofs+1),1);node.text=inlcudeFile.getWith(words[2]=='with'?words[3]:null);break;case"#import":words=ShaderCompile.splitToWords(text,null);fname=words[1];includefiles.push({node:node,file:ShaderCompile.includes[fname],ofs:node.text.length});continue;}}else{preNode=parent.childs[parent.childs.length-1];if(preNode&&!preNode.name){includefiles.length>0&&ShaderCompile.splitToWords(text,preNode);noUseNode=node;preNode.text+="\n"+text;continue;}
includefiles.length>0&&ShaderCompile.splitToWords(text,node);}
node.setParent(parent);}}
__proto.createShader=function(define,shaderName,createShader){var defMap={};var defineStr="";if(define){for(var i in define){defineStr+="#define "+i+"\n";defMap[i]=true;}};var vs=this._VS.toscript(defMap,[]);var ps=this._PS.toscript(defMap,[]);return(createShader||Shader.create)(defineStr+vs.join('\n'),defineStr+ps.join('\n'),shaderName,this._nameMap);}
ShaderCompile._parseOne=function(attributes,uniforms,words,i,word,b){var one={type:ShaderCompile.shaderParamsMap[words[i+1]],name:words[i+2],size:isNaN(parseInt(words[i+3]))?1:parseInt(words[i+3])};if(b){if(word=="attribute"){attributes.push(one);}else{uniforms.push(one);}}
if(words[i+3]==':'){one.type=words[i+4];i+=2;}
i+=2;return i;}
ShaderCompile.addInclude=function(fileName,txt){if(!txt||txt.length===0)
throw new Error("add shader include file err:"+fileName);if(ShaderCompile.includes[fileName])
throw new Error("add shader include file err, has add:"+fileName);ShaderCompile.includes[fileName]=new InlcudeFile(txt);}
ShaderCompile.preGetParams=function(vs,ps){var text=[vs,ps];var result={};var attributes=[];var uniforms=[];var definesInfo={};var definesName=[];result.attributes=attributes;result.uniforms=uniforms;result.defines=definesInfo;var i=0,n=0,one;for(var s=0;s<2;s++){text[s]=text[s].replace(ShaderCompile._removeAnnotation,"");var words=text[s].match(ShaderCompile._reg);var tempelse;for(i=0,n=words.length;i<n;i++){var word=words[i];if(word!="attribute"&&word!="uniform"){if(word=="#define"){word=words[++i];definesName[word]=1;continue;}else if(word=="#ifdef"){tempelse=words[++i];var def=definesInfo[tempelse]=definesInfo[tempelse]||[];for(i++;i<n;i++){word=words[i];if(word!="attribute"&&word!="uniform"){if(word=="#else"){for(i++;i<n;i++){word=words[i];if(word!="attribute"&&word!="uniform"){if(word=="#endif"){break;}
continue;}
i=ShaderCompile._parseOne(attributes,uniforms,words,i,word,!definesName[tempelse]);}}
continue;}
i=ShaderCompile._parseOne(attributes,uniforms,words,i,word,definesName[tempelse]);}}
continue;}
i=ShaderCompile._parseOne(attributes,uniforms,words,i,word,true);}}
return result;}
ShaderCompile.splitToWords=function(str,block){var out=[];var c;var ofs=-1;var word;for(var i=0,n=str.length;i<n;i++){c=str.charAt(i);if(" \t=+-*/&%!<>()'\",;".indexOf(c)>=0){if(ofs>=0&&(i-ofs)>1){word=str.substr(ofs,i-ofs);out.push(word);}
if(c=='"'||c=="'"){var ofs2=str.indexOf(c,i+1);if(ofs2<0){throw"Sharder err:"+str;}
out.push(str.substr(i+1,ofs2-i-1));i=ofs2;ofs=-1;continue;}
if(c=='('&&block&&out.length>0){word=out[out.length-1]+";";if("vec4;main;".indexOf(word)<0)
block.useFuns+=word;}
ofs=-1;continue;}
if(ofs<0)ofs=i;}
if(ofs<n&&(n-ofs)>1){word=str.substr(ofs,n-ofs);out.push(word);}
return out;}
ShaderCompile.IFDEF_NO=0;ShaderCompile.IFDEF_YES=1;ShaderCompile.IFDEF_ELSE=2;ShaderCompile.IFDEF_PARENT=3;ShaderCompile._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g");ShaderCompile._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g");ShaderCompile._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%\(\),;])","g");ShaderCompile.includes={};__static(ShaderCompile,['shaderParamsMap',function(){return this.shaderParamsMap={"float":0x1406,"int":0x1404,"bool":0x8B56,"vec2":0x8B50,"vec3":0x8B51,"vec4":0x8B52,"ivec2":0x8B53,"ivec3":0x8B54,"ivec4":0x8B55,"bvec2":0x8B57,"bvec3":0x8B58,"bvec4":0x8B59,"mat2":0x8B5A,"mat3":0x8B5B,"mat4":0x8B5C,"sampler2D":0x8B5E,"samplerCube":0x8B60};},'_splitToWordExps3',function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%\(\),;\\|]","g");}]);ShaderCompile.__init$=function(){ShaderNode=(function(){function ShaderNode(includefiles){this.childs=[];this.text="";this.parent=null;this.name=null;this.noCompile=false;this.includefiles=null;this.condition=null;this.conditionType=0;this.useFuns="";this.z=0;this.src=null;this.includefiles=includefiles;}
__class(ShaderNode,'');var __proto=ShaderNode.prototype;__proto.setParent=function(parent){parent.childs.push(this);this.z=parent.z+1;this.parent=parent;}
__proto.setCondition=function(condition,type){if(condition){this.conditionType=type;condition=condition.replace(/(\s*$)/g,"");this.condition=function(){return this[condition];}
this.condition.__condition=condition;}}
__proto.toscript=function(def,out){return this._toscript(def,out,++ShaderNode.__id);}
__proto._toscript=function(def,out,id){if(this.childs.length<1&&!this.text)return out;var outIndex=out.length;if(this.condition){var ifdef=!!this.condition.call(def);this.conditionType===2&&(ifdef=!ifdef);if(!ifdef)return out;}
this.text&&out.push(this.text);this.childs.length>0&&this.childs.forEach(function(o,index,arr){o._toscript(def,out,id);});if(this.includefiles.length>0&&this.useFuns.length>0){var funsCode;for(var i=0,n=this.includefiles.length;i<n;i++){if(this.includefiles[i].curUseID==id){continue;}
funsCode=this.includefiles[i].file.getFunsScript(this.useFuns);if(funsCode.length>0){this.includefiles[i].curUseID=id;out[0]=funsCode+out[0];}}}
return out;}
ShaderNode.__id=1;return ShaderNode;})()
InlcudeFile=(function(){function InlcudeFile(txt){this.script=null;this.codes={};this.funs={};this.curUseID=-1;this.funnames="";this.script=txt;var begin=0,ofs=0,end=0;while(true){begin=txt.indexOf("#begin",begin);if(begin<0)break;end=begin+5;while(true){end=txt.indexOf("#end",end);if(end<0)break;if(txt.charAt(end+4)==='i')
end+=5;else break;}
if(end<0){throw"add include err,no #end:"+txt;return;}
ofs=txt.indexOf('\n',begin);var words=ShaderCompile.splitToWords(txt.substr(begin,ofs-begin),null);if(words[1]=='code'){this.codes[words[2]]=txt.substr(ofs+1,end-ofs-1);}else if(words[1]=='function'){ofs=txt.indexOf("function",begin);ofs+="function".length;this.funs[words[3]]=txt.substr(ofs+1,end-ofs-1);this.funnames+=words[3]+";";}
begin=end+1;}}
__class(InlcudeFile,'');var __proto=InlcudeFile.prototype;__proto.getWith=function(name){var r=name?this.codes[name]:this.script;if(!r){throw"get with error:"+name;}
return r;}
__proto.getFunsScript=function(funsdef){var r="";for(var i in this.funs){if(funsdef.indexOf(i+";")>=0){r+=this.funs[i];}}
return r;}
return InlcudeFile;})()}
return ShaderCompile;})()
var WebGL=(function(){function WebGL(){}
__class(WebGL,'laya.webgl.WebGL');WebGL._uint8ArraySlice=function(){var _this=this;var sz=_this.length;var dec=new Uint8Array(_this.length);for(var i=0;i<sz;i++)dec[i]=_this[i];return dec;}
WebGL._float32ArraySlice=function(){var _this=this;var sz=_this.length;var dec=new Float32Array(_this.length);for(var i=0;i<sz;i++)dec[i]=_this[i];return dec;}
WebGL._uint16ArraySlice=function(__arg){var arg=arguments;var _this=this;var sz=0;var dec;var i=0;if(arg.length===0){sz=_this.length;dec=new Uint16Array(sz);for(i=0;i<sz;i++)
dec[i]=_this[i];}else if(arg.length===2){var start=arg[0];var end=arg[1];if(end>start){sz=end-start;dec=new Uint16Array(sz);for(i=start;i<end;i++)
dec[i-start]=_this[i];}else{dec=new Uint16Array(0);}}
return dec;}
WebGL.expandContext=function(){var from=Context.prototype;var to=CanvasRenderingContext2D.prototype;to.fillTrangles=from.fillTrangles;Buffer2D.__int__(null);to.setIBVB=function(x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset){(startIndex===void 0)&&(startIndex=0);(offset===void 0)&&(offset=0);if(ib===null){this._ib=this._ib||IndexBuffer2D.QuadrangleIB;ib=this._ib;GlUtils.expandIBQuadrangle(ib,(vb._byteLength/(4*16)+8));}
this._setIBVB(x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset);};to.fillTrangles=function(tex,x,y,points,m){this._curMat=this._curMat||Matrix.create();this._vb=this._vb||VertexBuffer2D.create();if(!this._ib){this._ib=IndexBuffer2D.create();GlUtils.fillIBQuadrangle(this._ib,length/4);};var vb=this._vb;var length=points.length>>4;GlUtils.fillTranglesVB(vb,x,y,points,m||this._curMat,0,0);GlUtils.expandIBQuadrangle(this._ib,(vb._byteLength/(4*16)+8));var shaderValues=new Value2D(0x01,0);shaderValues.textureHost=tex;var sd=new Shader2X("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");vb._vertType=3;this._setIBVB(x,y,this._ib,vb,length*6,m,sd,shaderValues,0,0);}}
WebGL.enable=function(){Browser.__init__();if(Render.isConchApp){if(!Render.isConchWebGL){RunDriver.skinAniSprite=function(){var tSkinSprite=new SkinMesh()
return tSkinSprite;}
WebGL.expandContext();return false;}}
RunDriver.getWebGLContext=function getWebGLContext(canvas){var gl;var names=["webgl","experimental-webgl","webkit-3d","moz-webgl"];for(var i=0;i<names.length;i++){try{gl=canvas.getContext(names[i],{stencil:Config.isStencil,alpha:Config.isAlpha,antialias:Config.isAntialias,premultipliedAlpha:Config.premultipliedAlpha,preserveDrawingBuffer:Config.preserveDrawingBuffer});}catch(e){}
if(gl)
return gl;}
return null;}
WebGL.mainContext=RunDriver.getWebGLContext(Render._mainCanvas);if(WebGL.mainContext==null)
return false;if(Render.isWebGL)return true;HTMLImage.create=function(src,def){return new WebGLImage(src,def);}
HTMLSubImage.create=function(canvas,offsetX,offsetY,width,height,atlasImage,src){return new WebGLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src);}
Render.WebGL=WebGL;Render.isWebGL=true;DrawText.__init__();RunDriver.createRenderSprite=function(type,next){return new RenderSprite3D(type,next);}
RunDriver.createWebGLContext2D=function(c){return new WebGLContext2D(c);}
RunDriver.changeWebGLSize=function(width,height){laya.webgl.WebGL.onStageResize(width,height);}
RunDriver.createGraphics=function(){return new GraphicsGL();};var action=RunDriver.createFilterAction;RunDriver.createFilterAction=action?action:function(type){return new ColorFilterActionGL()}
RunDriver.clear=function(color){RenderState2D.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(0x0C11);var ctx=Render.context.ctx;var c=(ctx._submits._length==0||Config.preserveDrawingBuffer)?Color.create(color)._color:Stage._wgColor;if(c)ctx.clearBG(c[0],c[1],c[2],c[3]);RenderState2D.clear();}
RunDriver.addToAtlas=function(texture,force){(force===void 0)&&(force=false);var bitmap=texture.bitmap;if(!Render.optimizeTextureMemory(texture.url,texture)){(bitmap).enableMerageInAtlas=false;return;}
if((Laya.__typeof(bitmap,'laya.webgl.resource.IMergeAtlasBitmap'))&&((bitmap).allowMerageInAtlas)){bitmap.on("recovered",texture,texture.addTextureToAtlas);}}
RunDriver.isAtlas=function(bitmap){return(bitmap instanceof laya.webgl.atlas.AtlasWebGLCanvas);}
AtlasResourceManager._enable();RunDriver.beginFlush=function(){var atlasResourceManager=AtlasResourceManager.instance;var count=atlasResourceManager.getAtlaserCount();for(var i=0;i<count;i++){var atlerCanvas=atlasResourceManager.getAtlaserByIndex(i).texture;(atlerCanvas._flashCacheImageNeedFlush)&&(RunDriver.flashFlushImage(atlerCanvas));}}
RunDriver.drawToCanvas=function(sprite,_renderType,canvasWidth,canvasHeight,offsetX,offsetY){if(canvasWidth<=0||canvasHeight<=0){console.log("[error] canvasWidth and canvasHeight should greater than zero");}
offsetX-=sprite.x;offsetY-=sprite.y;var renderTarget=RenderTarget2D.create(canvasWidth,canvasHeight,0x1908,0x1401,0,false);renderTarget.start();renderTarget.clear(0,0,0,0);Render.context.clear();RenderSprite.renders[_renderType]._fun(sprite,Render.context,offsetX,RenderState2D.height-canvasHeight+offsetY);Render.context.flush();renderTarget.end();var pixels=renderTarget.getData(0,0,renderTarget.width,renderTarget.height);renderTarget.recycle();var htmlCanvas=new WebGLCanvas();htmlCanvas._canvas=Browser.createElement("canvas");htmlCanvas.size(canvasWidth,canvasHeight);var context=htmlCanvas._canvas.getContext('2d');Browser.canvas.size(canvasWidth,canvasHeight);var tempContext=Browser.context;var imgData=tempContext.createImageData(canvasWidth,canvasHeight);imgData.data.set(new Uint8ClampedArray(pixels.buffer));htmlCanvas._imgData=imgData;tempContext.putImageData(imgData,0,0);context.save();context.translate(0,canvasHeight);context.scale(1,-1);context.drawImage(Browser.canvas.source,0,0);context.restore();return htmlCanvas;}
RunDriver.createFilterAction=function(type){var action;switch(type){case 0x20:action=new ColorFilterActionGL();break;}
return action;}
RunDriver.addTextureToAtlas=function(texture){texture._uvID++;AtlasResourceManager._atlasRestore++;((texture.bitmap).enableMerageInAtlas)&&(AtlasResourceManager.instance.addToAtlas(texture));}
RunDriver.getTexturePixels=function(value,x,y,width,height){(Render.context.ctx).clear();var tSprite=new Sprite();tSprite.graphics.drawTexture(value,-x,-y);var tRenderTarget=RenderTarget2D.create(width,height);tRenderTarget.start();tRenderTarget.clear(0,0,0,0);tSprite.render(Render.context,0,0);(Render.context.ctx).flush();tRenderTarget.end();var tUint8Array=tRenderTarget.getData(0,0,width,height);var tArray=[];var tIndex=0;for(var i=height-1;i>=0;i--){for(var j=0;j<width;j++){tIndex=(i*width+j)*4;tArray.push(tUint8Array[tIndex]);tArray.push(tUint8Array[tIndex+1]);tArray.push(tUint8Array[tIndex+2]);tArray.push(tUint8Array[tIndex+3]);}}
return tArray;}
RunDriver.skinAniSprite=function(){var tSkinSprite=new SkinMesh()
return tSkinSprite;}
HTMLCanvas.create=function(type,canvas){var ret=new WebGLCanvas();ret._imgData=canvas;ret.flipY=false;return ret;}
Filter._filterStart=function(scope,sprite,context,x,y){var b=scope.getValue("bounds");var source=RenderTarget2D.create(b.width,b.height);source.start();source.clear(0,0,0,0);scope.addValue("src",source);scope.addValue("ScissorTest",RenderState2D.worldScissorTest);if(RenderState2D.worldScissorTest){var tClilpRect=new Rectangle();tClilpRect.copyFrom((context.ctx)._clipRect)
scope.addValue("clipRect",tClilpRect);RenderState2D.worldScissorTest=false;laya.webgl.WebGL.mainContext.disable(0x0C11);}}
Filter._filterEnd=function(scope,sprite,context,x,y){var b=scope.getValue("bounds");var source=scope.getValue("src");source.end();var out=RenderTarget2D.create(b.width,b.height);out.start();out.clear(0,0,0,0);scope.addValue("out",out);sprite._set$P('_filterCache',out);sprite._set$P('_isHaveGlowFilter',scope.getValue("_isHaveGlowFilter"));}
Filter._EndTarget=function(scope,context){var source=scope.getValue("src");source.recycle();var out=scope.getValue("out");out.end();var b=scope.getValue("ScissorTest");if(b){RenderState2D.worldScissorTest=true;laya.webgl.WebGL.mainContext.enable(0x0C11);context.ctx.save();var tClipRect=scope.getValue("clipRect");(context.ctx).clipRect(tClipRect.x,tClipRect.y,tClipRect.width,tClipRect.height);}}
Filter._useSrc=function(scope){var source=scope.getValue("out");source.end();source=scope.getValue("src");source.start();source.clear(0,0,0,0);}
Filter._endSrc=function(scope){var source=scope.getValue("src");source.end();}
Filter._useOut=function(scope){var source=scope.getValue("src");source.end();source=scope.getValue("out");source.start();source.clear(0,0,0,0);}
Filter._endOut=function(scope){var source=scope.getValue("out");source.end();}
Filter._recycleScope=function(scope){scope.recycle();}
Filter._filter=function(sprite,context,x,y){var next=this._next;if(next){var filters=sprite.filters,len=filters.length;if(len==1&&(filters[0].type==0x20)){context.ctx.save();context.ctx.setFilters([filters[0]]);next._fun.call(next,sprite,context,x,y);context.ctx.restore();return;};var shaderValue;var b;var scope=SubmitCMDScope.create();var p=Point.TEMP;var tMatrix=context.ctx._getTransformMatrix();var mat=Matrix.create();tMatrix.copyTo(mat);var tPadding=0;var tHalfPadding=0;var tIsHaveGlowFilter=false;var out=sprite._$P._filterCache?sprite._$P._filterCache:null;if(!out||sprite._repaint){tIsHaveGlowFilter=sprite._isHaveGlowFilter();scope.addValue("_isHaveGlowFilter",tIsHaveGlowFilter);if(tIsHaveGlowFilter){tPadding=50;tHalfPadding=25;}
b=new Rectangle();b.copyFrom((sprite).getSelfBounds());b.x+=(sprite).x;b.y+=(sprite).y;b.x-=(sprite).pivotX+4;b.y-=(sprite).pivotY+4;var tSX=b.x;var tSY=b.y;b.width+=(tPadding+8);b.height+=(tPadding+8);p.x=b.x*mat.a+b.y*mat.c;p.y=b.y*mat.d+b.x*mat.b;b.x=p.x;b.y=p.y;p.x=b.width*mat.a+b.height*mat.c;p.y=b.height*mat.d+b.width*mat.b;b.width=p.x;b.height=p.y;if(b.width<=0||b.height<=0){return;}
out&&out.recycle();scope.addValue("bounds",b);var submit=SubmitCMD.create([scope,sprite,context,0,0],Filter._filterStart);context.addRenderObject(submit);(context.ctx)._renderKey=0;(context.ctx)._shader2D.glTexture=null;var tX=sprite.x-tSX+tHalfPadding;var tY=sprite.y-tSY+tHalfPadding;next._fun.call(next,sprite,context,tX,tY);submit=SubmitCMD.create([scope,sprite,context,0,0],Filter._filterEnd);context.addRenderObject(submit);for(var i=0;i<len;i++){if(i!=0){submit=SubmitCMD.create([scope],Filter._useSrc);context.addRenderObject(submit);shaderValue=Value2D.create(0x01,0);Matrix.TEMP.identity();context.ctx.drawTarget(scope,0,0,b.width,b.height,Matrix.TEMP,"out",shaderValue,null,BlendMode.TOINT.overlay);submit=SubmitCMD.create([scope],Filter._useOut);context.addRenderObject(submit);};var fil=filters[i];fil.action.apply3d(scope,sprite,context,0,0);}
submit=SubmitCMD.create([scope,context],Filter._EndTarget);context.addRenderObject(submit);}else{tIsHaveGlowFilter=sprite._$P._isHaveGlowFilter?sprite._$P._isHaveGlowFilter:false;if(tIsHaveGlowFilter){tPadding=50;tHalfPadding=25;}
b=sprite.getBounds();if(b.width<=0||b.height<=0){return;}
b.width+=tPadding;b.height+=tPadding;p.x=b.x*mat.a+b.y*mat.c;p.y=b.y*mat.d+b.x*mat.b;b.x=p.x;b.y=p.y;p.x=b.width*mat.a+b.height*mat.c;p.y=b.height*mat.d+b.width*mat.b;b.width=p.x;b.height=p.y;scope.addValue("out",out);}
x=x-tHalfPadding-sprite.x;y=y-tHalfPadding-sprite.y;p.setTo(x,y);mat.transformPoint(p);x=p.x+b.x;y=p.y+b.y;shaderValue=Value2D.create(0x01,0);Matrix.TEMP.identity();(context.ctx).drawTarget(scope,x,y,b.width,b.height,Matrix.TEMP,"out",shaderValue,null,BlendMode.TOINT.overlay);submit=SubmitCMD.create([scope],Filter._recycleScope);context.addRenderObject(submit);mat.destroy();}}
Float32Array.prototype.slice||(Float32Array.prototype.slice=WebGL._float32ArraySlice);Uint16Array.prototype.slice||(Uint16Array.prototype.slice=WebGL._uint16ArraySlice);Uint8Array.prototype.slice||(Uint8Array.prototype.slice=WebGL._uint8ArraySlice);return true;}
WebGL.onStageResize=function(width,height){if(WebGL.mainContext==null)return;WebGL.mainContext.viewport(0,0,width,height);RenderState2D.width=width;RenderState2D.height=height;}
WebGL.onInvalidGLRes=function(){AtlasResourceManager.instance.freeAll();ResourceManager.releaseContentManagers(true);WebGL.doNodeRepaint(Laya.stage);WebGL.mainContext.viewport(0,0,RenderState2D.width,RenderState2D.height);Laya.stage.event("devicelost");}
WebGL.doNodeRepaint=function(sprite){(sprite.numChildren==0)&&(sprite.repaint());for(var i=0;i<sprite.numChildren;i++)
WebGL.doNodeRepaint(sprite.getChildAt(i));}
WebGL.init=function(canvas,width,height){WebGL.mainCanvas=canvas;HTMLCanvas._createContext=function(canvas){return new WebGLContext2D(canvas);}
WebGLCanvas._createContext=function(canvas){return new WebGLContext2D(canvas);};var gl=laya.webgl.WebGL.mainContext;if(gl.getShaderPrecisionFormat!=null){var vertexPrecisionFormat=gl.getShaderPrecisionFormat(0x8B31,0x8DF2);var framePrecisionFormat=gl.getShaderPrecisionFormat(0x8B30,0x8DF2);WebGL.shaderHighPrecision=(vertexPrecisionFormat.precision&&framePrecisionFormat.precision)?true:false;}else{WebGL.shaderHighPrecision=false;}
WebGL.compressAstc=gl.getExtension("WEBGL_compressed_texture_astc");WebGL.compressAtc=gl.getExtension("WEBGL_compressed_texture_atc");WebGL.compressEtc=gl.getExtension("WEBGL_compressed_texture_etc");WebGL.compressEtc1=gl.getExtension("WEBGL_compressed_texture_etc1");WebGL.compressPvrtc=gl.getExtension("WEBGL_compressed_texture_pvrtc");WebGL.compressS3tc=gl.getExtension("WEBGL_compressed_texture_s3tc");WebGL.compressS3tc_srgb=gl.getExtension("WEBGL_compressed_texture_s3tc_srgb");gl.deleteTexture1=gl.deleteTexture;gl.deleteTexture=function(t){if(t==WebGLContext.curBindTexValue){WebGLContext.curBindTexValue=null;}
gl.deleteTexture1(t);}
WebGL.onStageResize(width,height);if(WebGL.mainContext==null)
throw new Error("webGL getContext err!");System.__init__();AtlasResourceManager.__init__();ShaderDefines2D.__init__();Submit.__init__();WebGLContext2D.__init__();Value2D.__init__();Shader2D.__init__();Buffer2D.__int__(gl);BlendMode._init_(gl);if(Render.isConchApp){conch.setOnInvalidGLRes(WebGL.onInvalidGLRes);}}
WebGL.compressAstc=null;WebGL.compressAtc=null;WebGL.compressEtc=null;WebGL.compressEtc1=null;WebGL.compressPvrtc=null;WebGL.compressS3tc=null;WebGL.compressS3tc_srgb=null;WebGL.mainCanvas=null;WebGL.mainContext=null;WebGL.antialias=true;WebGL.shaderHighPrecision=false;WebGL._bg_null=[0,0,0,0];return WebGL;})()
var WebGLContext=(function(){function WebGLContext(){}
__class(WebGLContext,'laya.webgl.WebGLContext');WebGLContext.UseProgram=function(program){if(WebGLContext._useProgram===program)return false;WebGL.mainContext.useProgram(program);WebGLContext._useProgram=program;return true;}
WebGLContext.setDepthTest=function(gl,value){value!==WebGLContext._depthTest&&(WebGLContext._depthTest=value,value?gl.enable(0x0B71):gl.disable(0x0B71));}
WebGLContext.setDepthMask=function(gl,value){value!==WebGLContext._depthMask&&(WebGLContext._depthMask=value,gl.depthMask(value));}
WebGLContext.setDepthFunc=function(gl,value){value!==WebGLContext._depthFunc&&(WebGLContext._depthFunc=value,gl.depthFunc(value));}
WebGLContext.setBlend=function(gl,value){value!==WebGLContext._blend&&(WebGLContext._blend=value,value?gl.enable(0x0BE2):gl.disable(0x0BE2));}
WebGLContext.setBlendFunc=function(gl,sFactor,dFactor){(sFactor!==WebGLContext._sFactor||dFactor!==WebGLContext._dFactor)&&(WebGLContext._sFactor=sFactor,WebGLContext._dFactor=dFactor,gl.blendFunc(sFactor,dFactor));}
WebGLContext.setCullFace=function(gl,value){value!==WebGLContext._cullFace&&(WebGLContext._cullFace=value,value?gl.enable(0x0B44):gl.disable(0x0B44));}
WebGLContext.setFrontFace=function(gl,value){value!==WebGLContext._frontFace&&(WebGLContext._frontFace=value,gl.frontFace(value));}
WebGLContext.bindTexture=function(gl,target,texture){gl.bindTexture(target,texture);WebGLContext.curBindTexTarget=target;WebGLContext.curBindTexValue=texture;}
WebGLContext.DEPTH_BUFFER_BIT=0x00000100;WebGLContext.STENCIL_BUFFER_BIT=0x00000400;WebGLContext.COLOR_BUFFER_BIT=0x00004000;WebGLContext.POINTS=0x0000;WebGLContext.LINES=0x0001;WebGLContext.LINE_LOOP=0x0002;WebGLContext.LINE_STRIP=0x0003;WebGLContext.TRIANGLES=0x0004;WebGLContext.TRIANGLE_STRIP=0x0005;WebGLContext.TRIANGLE_FAN=0x0006;WebGLContext.ZERO=0;WebGLContext.ONE=1;WebGLContext.SRC_COLOR=0x0300;WebGLContext.ONE_MINUS_SRC_COLOR=0x0301;WebGLContext.SRC_ALPHA=0x0302;WebGLContext.ONE_MINUS_SRC_ALPHA=0x0303;WebGLContext.DST_ALPHA=0x0304;WebGLContext.ONE_MINUS_DST_ALPHA=0x0305;WebGLContext.DST_COLOR=0x0306;WebGLContext.ONE_MINUS_DST_COLOR=0x0307;WebGLContext.SRC_ALPHA_SATURATE=0x0308;WebGLContext.FUNC_ADD=0x8006;WebGLContext.BLEND_EQUATION=0x8009;WebGLContext.BLEND_EQUATION_RGB=0x8009;WebGLContext.BLEND_EQUATION_ALPHA=0x883D;WebGLContext.FUNC_SUBTRACT=0x800A;WebGLContext.FUNC_REVERSE_SUBTRACT=0x800B;WebGLContext.BLEND_DST_RGB=0x80C8;WebGLContext.BLEND_SRC_RGB=0x80C9;WebGLContext.BLEND_DST_ALPHA=0x80CA;WebGLContext.BLEND_SRC_ALPHA=0x80CB;WebGLContext.CONSTANT_COLOR=0x8001;WebGLContext.ONE_MINUS_CONSTANT_COLOR=0x8002;WebGLContext.CONSTANT_ALPHA=0x8003;WebGLContext.ONE_MINUS_CONSTANT_ALPHA=0x8004;WebGLContext.BLEND_COLOR=0x8005;WebGLContext.ARRAY_BUFFER=0x8892;WebGLContext.ELEMENT_ARRAY_BUFFER=0x8893;WebGLContext.ARRAY_BUFFER_BINDING=0x8894;WebGLContext.ELEMENT_ARRAY_BUFFER_BINDING=0x8895;WebGLContext.STREAM_DRAW=0x88E0;WebGLContext.STATIC_DRAW=0x88E4;WebGLContext.DYNAMIC_DRAW=0x88E8;WebGLContext.BUFFER_SIZE=0x8764;WebGLContext.BUFFER_USAGE=0x8765;WebGLContext.CURRENT_VERTEX_ATTRIB=0x8626;WebGLContext.FRONT=0x0404;WebGLContext.BACK=0x0405;WebGLContext.CULL_FACE=0x0B44;WebGLContext.FRONT_AND_BACK=0x0408;WebGLContext.BLEND=0x0BE2;WebGLContext.DITHER=0x0BD0;WebGLContext.STENCIL_TEST=0x0B90;WebGLContext.DEPTH_TEST=0x0B71;WebGLContext.SCISSOR_TEST=0x0C11;WebGLContext.POLYGON_OFFSET_FILL=0x8037;WebGLContext.SAMPLE_ALPHA_TO_COVERAGE=0x809E;WebGLContext.SAMPLE_COVERAGE=0x80A0;WebGLContext.NO_ERROR=0;WebGLContext.INVALID_ENUM=0x0500;WebGLContext.INVALID_VALUE=0x0501;WebGLContext.INVALID_OPERATION=0x0502;WebGLContext.OUT_OF_MEMORY=0x0505;WebGLContext.CW=0x0900;WebGLContext.CCW=0x0901;WebGLContext.LINE_WIDTH=0x0B21;WebGLContext.ALIASED_POINT_SIZE_RANGE=0x846D;WebGLContext.ALIASED_LINE_WIDTH_RANGE=0x846E;WebGLContext.CULL_FACE_MODE=0x0B45;WebGLContext.FRONT_FACE=0x0B46;WebGLContext.DEPTH_RANGE=0x0B70;WebGLContext.DEPTH_WRITEMASK=0x0B72;WebGLContext.DEPTH_CLEAR_VALUE=0x0B73;WebGLContext.DEPTH_FUNC=0x0B74;WebGLContext.STENCIL_CLEAR_VALUE=0x0B91;WebGLContext.STENCIL_FUNC=0x0B92;WebGLContext.STENCIL_FAIL=0x0B94;WebGLContext.STENCIL_PASS_DEPTH_FAIL=0x0B95;WebGLContext.STENCIL_PASS_DEPTH_PASS=0x0B96;WebGLContext.STENCIL_REF=0x0B97;WebGLContext.STENCIL_VALUE_MASK=0x0B93;WebGLContext.STENCIL_WRITEMASK=0x0B98;WebGLContext.STENCIL_BACK_FUNC=0x8800;WebGLContext.STENCIL_BACK_FAIL=0x8801;WebGLContext.STENCIL_BACK_PASS_DEPTH_FAIL=0x8802;WebGLContext.STENCIL_BACK_PASS_DEPTH_PASS=0x8803;WebGLContext.STENCIL_BACK_REF=0x8CA3;WebGLContext.STENCIL_BACK_VALUE_MASK=0x8CA4;WebGLContext.STENCIL_BACK_WRITEMASK=0x8CA5;WebGLContext.VIEWPORT=0x0BA2;WebGLContext.SCISSOR_BOX=0x0C10;WebGLContext.COLOR_CLEAR_VALUE=0x0C22;WebGLContext.COLOR_WRITEMASK=0x0C23;WebGLContext.UNPACK_ALIGNMENT=0x0CF5;WebGLContext.PACK_ALIGNMENT=0x0D05;WebGLContext.MAX_TEXTURE_SIZE=0x0D33;WebGLContext.MAX_VIEWPORT_DIMS=0x0D3A;WebGLContext.SUBPIXEL_BITS=0x0D50;WebGLContext.RED_BITS=0x0D52;WebGLContext.GREEN_BITS=0x0D53;WebGLContext.BLUE_BITS=0x0D54;WebGLContext.ALPHA_BITS=0x0D55;WebGLContext.DEPTH_BITS=0x0D56;WebGLContext.STENCIL_BITS=0x0D57;WebGLContext.POLYGON_OFFSET_UNITS=0x2A00;WebGLContext.POLYGON_OFFSET_FACTOR=0x8038;WebGLContext.TEXTURE_BINDING_2D=0x8069;WebGLContext.SAMPLE_BUFFERS=0x80A8;WebGLContext.SAMPLES=0x80A9;WebGLContext.SAMPLE_COVERAGE_VALUE=0x80AA;WebGLContext.SAMPLE_COVERAGE_INVERT=0x80AB;WebGLContext.NUM_COMPRESSED_TEXTURE_FORMATS=0x86A2;WebGLContext.COMPRESSED_TEXTURE_FORMATS=0x86A3;WebGLContext.DONT_CARE=0x1100;WebGLContext.FASTEST=0x1101;WebGLContext.NICEST=0x1102;WebGLContext.GENERATE_MIPMAP_HINT=0x8192;WebGLContext.BYTE=0x1400;WebGLContext.UNSIGNED_BYTE=0x1401;WebGLContext.SHORT=0x1402;WebGLContext.UNSIGNED_SHORT=0x1403;WebGLContext.INT=0x1404;WebGLContext.UNSIGNED_INT=0x1405;WebGLContext.FLOAT=0x1406;WebGLContext.DEPTH_COMPONENT=0x1902;WebGLContext.ALPHA=0x1906;WebGLContext.RGB=0x1907;WebGLContext.RGBA=0x1908;WebGLContext.LUMINANCE=0x1909;WebGLContext.LUMINANCE_ALPHA=0x190A;WebGLContext.UNSIGNED_SHORT_4_4_4_4=0x8033;WebGLContext.UNSIGNED_SHORT_5_5_5_1=0x8034;WebGLContext.UNSIGNED_SHORT_5_6_5=0x8363;WebGLContext.FRAGMENT_SHADER=0x8B30;WebGLContext.VERTEX_SHADER=0x8B31;WebGLContext.MAX_VERTEX_ATTRIBS=0x8869;WebGLContext.MAX_VERTEX_UNIFORM_VECTORS=0x8DFB;WebGLContext.MAX_VARYING_VECTORS=0x8DFC;WebGLContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS=0x8B4D;WebGLContext.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0x8B4C;WebGLContext.MAX_TEXTURE_IMAGE_UNITS=0x8872;WebGLContext.MAX_FRAGMENT_UNIFORM_VECTORS=0x8DFD;WebGLContext.SHADER_TYPE=0x8B4F;WebGLContext.DELETE_STATUS=0x8B80;WebGLContext.LINK_STATUS=0x8B82;WebGLContext.VALIDATE_STATUS=0x8B83;WebGLContext.ATTACHED_SHADERS=0x8B85;WebGLContext.ACTIVE_UNIFORMS=0x8B86;WebGLContext.ACTIVE_ATTRIBUTES=0x8B89;WebGLContext.SHADING_LANGUAGE_VERSION=0x8B8C;WebGLContext.CURRENT_PROGRAM=0x8B8D;WebGLContext.NEVER=0x0200;WebGLContext.LESS=0x0201;WebGLContext.EQUAL=0x0202;WebGLContext.LEQUAL=0x0203;WebGLContext.GREATER=0x0204;WebGLContext.NOTEQUAL=0x0205;WebGLContext.GEQUAL=0x0206;WebGLContext.ALWAYS=0x0207;WebGLContext.KEEP=0x1E00;WebGLContext.REPLACE=0x1E01;WebGLContext.INCR=0x1E02;WebGLContext.DECR=0x1E03;WebGLContext.INVERT=0x150A;WebGLContext.INCR_WRAP=0x8507;WebGLContext.DECR_WRAP=0x8508;WebGLContext.VENDOR=0x1F00;WebGLContext.RENDERER=0x1F01;WebGLContext.VERSION=0x1F02;WebGLContext.NEAREST=0x2600;WebGLContext.LINEAR=0x2601;WebGLContext.NEAREST_MIPMAP_NEAREST=0x2700;WebGLContext.LINEAR_MIPMAP_NEAREST=0x2701;WebGLContext.NEAREST_MIPMAP_LINEAR=0x2702;WebGLContext.LINEAR_MIPMAP_LINEAR=0x2703;WebGLContext.TEXTURE_MAG_FILTER=0x2800;WebGLContext.TEXTURE_MIN_FILTER=0x2801;WebGLContext.TEXTURE_WRAP_S=0x2802;WebGLContext.TEXTURE_WRAP_T=0x2803;WebGLContext.TEXTURE_2D=0x0DE1;WebGLContext.TEXTURE=0x1702;WebGLContext.TEXTURE_CUBE_MAP=0x8513;WebGLContext.TEXTURE_BINDING_CUBE_MAP=0x8514;WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_X=0x8515;WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_X=0x8516;WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Y=0x8517;WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Y=0x8518;WebGLContext.TEXTURE_CUBE_MAP_POSITIVE_Z=0x8519;WebGLContext.TEXTURE_CUBE_MAP_NEGATIVE_Z=0x851A;WebGLContext.MAX_CUBE_MAP_TEXTURE_SIZE=0x851C;WebGLContext.TEXTURE0=0x84C0;WebGLContext.TEXTURE1=0x84C1;WebGLContext.TEXTURE2=0x84C2;WebGLContext.TEXTURE3=0x84C3;WebGLContext.TEXTURE4=0x84C4;WebGLContext.TEXTURE5=0x84C5;WebGLContext.TEXTURE6=0x84C6;WebGLContext.TEXTURE7=0x84C7;WebGLContext.TEXTURE8=0x84C8;WebGLContext.TEXTURE9=0x84C9;WebGLContext.TEXTURE10=0x84CA;WebGLContext.TEXTURE11=0x84CB;WebGLContext.TEXTURE12=0x84CC;WebGLContext.TEXTURE13=0x84CD;WebGLContext.TEXTURE14=0x84CE;WebGLContext.TEXTURE15=0x84CF;WebGLContext.TEXTURE16=0x84D0;WebGLContext.TEXTURE17=0x84D1;WebGLContext.TEXTURE18=0x84D2;WebGLContext.TEXTURE19=0x84D3;WebGLContext.TEXTURE20=0x84D4;WebGLContext.TEXTURE21=0x84D5;WebGLContext.TEXTURE22=0x84D6;WebGLContext.TEXTURE23=0x84D7;WebGLContext.TEXTURE24=0x84D8;WebGLContext.TEXTURE25=0x84D9;WebGLContext.TEXTURE26=0x84DA;WebGLContext.TEXTURE27=0x84DB;WebGLContext.TEXTURE28=0x84DC;WebGLContext.TEXTURE29=0x84DD;WebGLContext.TEXTURE30=0x84DE;WebGLContext.TEXTURE31=0x84DF;WebGLContext.ACTIVE_TEXTURE=0x84E0;WebGLContext.REPEAT=0x2901;WebGLContext.CLAMP_TO_EDGE=0x812F;WebGLContext.MIRRORED_REPEAT=0x8370;WebGLContext.FLOAT_VEC2=0x8B50;WebGLContext.FLOAT_VEC3=0x8B51;WebGLContext.FLOAT_VEC4=0x8B52;WebGLContext.INT_VEC2=0x8B53;WebGLContext.INT_VEC3=0x8B54;WebGLContext.INT_VEC4=0x8B55;WebGLContext.BOOL=0x8B56;WebGLContext.BOOL_VEC2=0x8B57;WebGLContext.BOOL_VEC3=0x8B58;WebGLContext.BOOL_VEC4=0x8B59;WebGLContext.FLOAT_MAT2=0x8B5A;WebGLContext.FLOAT_MAT3=0x8B5B;WebGLContext.FLOAT_MAT4=0x8B5C;WebGLContext.SAMPLER_2D=0x8B5E;WebGLContext.SAMPLER_CUBE=0x8B60;WebGLContext.VERTEX_ATTRIB_ARRAY_ENABLED=0x8622;WebGLContext.VERTEX_ATTRIB_ARRAY_SIZE=0x8623;WebGLContext.VERTEX_ATTRIB_ARRAY_STRIDE=0x8624;WebGLContext.VERTEX_ATTRIB_ARRAY_TYPE=0x8625;WebGLContext.VERTEX_ATTRIB_ARRAY_NORMALIZED=0x886A;WebGLContext.VERTEX_ATTRIB_ARRAY_POINTER=0x8645;WebGLContext.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=0x889F;WebGLContext.COMPILE_STATUS=0x8B81;WebGLContext.LOW_FLOAT=0x8DF0;WebGLContext.MEDIUM_FLOAT=0x8DF1;WebGLContext.HIGH_FLOAT=0x8DF2;WebGLContext.LOW_INT=0x8DF3;WebGLContext.MEDIUM_INT=0x8DF4;WebGLContext.HIGH_INT=0x8DF5;WebGLContext.FRAMEBUFFER=0x8D40;WebGLContext.RENDERBUFFER=0x8D41;WebGLContext.RGBA4=0x8056;WebGLContext.RGB5_A1=0x8057;WebGLContext.RGB565=0x8D62;WebGLContext.DEPTH_COMPONENT16=0x81A5;WebGLContext.STENCIL_INDEX=0x1901;WebGLContext.STENCIL_INDEX8=0x8D48;WebGLContext.DEPTH_STENCIL=0x84F9;WebGLContext.RENDERBUFFER_WIDTH=0x8D42;WebGLContext.RENDERBUFFER_HEIGHT=0x8D43;WebGLContext.RENDERBUFFER_INTERNAL_FORMAT=0x8D44;WebGLContext.RENDERBUFFER_RED_SIZE=0x8D50;WebGLContext.RENDERBUFFER_GREEN_SIZE=0x8D51;WebGLContext.RENDERBUFFER_BLUE_SIZE=0x8D52;WebGLContext.RENDERBUFFER_ALPHA_SIZE=0x8D53;WebGLContext.RENDERBUFFER_DEPTH_SIZE=0x8D54;WebGLContext.RENDERBUFFER_STENCIL_SIZE=0x8D55;WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=0x8CD0;WebGLContext.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=0x8CD1;WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=0x8CD2;WebGLContext.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=0x8CD3;WebGLContext.COLOR_ATTACHMENT0=0x8CE0;WebGLContext.DEPTH_ATTACHMENT=0x8D00;WebGLContext.STENCIL_ATTACHMENT=0x8D20;WebGLContext.DEPTH_STENCIL_ATTACHMENT=0x821A;WebGLContext.NONE=0;WebGLContext.FRAMEBUFFER_COMPLETE=0x8CD5;WebGLContext.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=0x8CD6;WebGLContext.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=0x8CD7;WebGLContext.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=0x8CD9;WebGLContext.FRAMEBUFFER_UNSUPPORTED=0x8CDD;WebGLContext.FRAMEBUFFER_BINDING=0x8CA6;WebGLContext.RENDERBUFFER_BINDING=0x8CA7;WebGLContext.MAX_RENDERBUFFER_SIZE=0x84E8;WebGLContext.INVALID_FRAMEBUFFER_OPERATION=0x0506;WebGLContext.UNPACK_FLIP_Y_WEBGL=0x9240;WebGLContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL=0x9241;WebGLContext.CONTEXT_LOST_WEBGL=0x9242;WebGLContext.UNPACK_COLORSPACE_CONVERSION_WEBGL=0x9243;WebGLContext.BROWSER_DEFAULT_WEBGL=0x9244;WebGLContext._useProgram=null;WebGLContext._depthTest=true;WebGLContext._depthMask=true;WebGLContext._blend=false;WebGLContext._cullFace=false;WebGLContext.curBindTexTarget=null;WebGLContext.curBindTexValue=null;__static(WebGLContext,['_depthFunc',function(){return this._depthFunc=0x0201;},'_sFactor',function(){return this._sFactor=1;},'_dFactor',function(){return this._dFactor=0;},'_frontFace',function(){return this._frontFace=0x0901;}]);return WebGLContext;})()
var GraphicsGL=(function(_super){function GraphicsGL(){GraphicsGL.__super.call(this);}
__class(GraphicsGL,'laya.webgl.display.GraphicsGL',_super);var __proto=GraphicsGL.prototype;__proto.setShader=function(shader){this._saveToCmd(Render.context._setShader,[shader]);}
__proto.setIBVB=function(x,y,ib,vb,numElement,shader){this._saveToCmd(Render.context._setIBVB,[x,y,ib,vb,numElement,shader]);}
__proto.drawParticle=function(x,y,ps){var pt=RunDriver.createParticleTemplate2D(ps);pt.x=x;pt.y=y;this._saveToCmd(Render.context._drawParticle,[pt]);}
return GraphicsGL;})(Graphics)
var WebGLContext2D=(function(_super){var ContextParams;function WebGLContext2D(c){this._x=0;this._y=0;this._id=++WebGLContext2D._COUNT;this._path=null;this._drawCount=1;this._maxNumEle=0;this._clear=false;this._isMain=false;this._atlasResourceChange=0;this._submits=null;this._curSubmit=null;this._ib=null;this._vb=null;this._nBlendType=0;this._saveMark=null;this._shader2D=null;this.meshlist=[];this.mId=-1;this.mHaveKey=false;this.mHaveLineKey=false;this.mX=0;this.mY=0;WebGLContext2D.__super.call(this);this._width=99999999;this._height=99999999;this._clipRect=WebGLContext2D.MAXCLIPRECT;this.mOutPoint
this._canvas=c;WebGLContext2D._contextcount++;if(Render.isFlash){this._ib=IndexBuffer2D.create(0x88E4);GlUtils.fillIBQuadrangle(this._ib,16);}else
this._ib=IndexBuffer2D.QuadrangleIB;this.clear();}
__class(WebGLContext2D,'laya.webgl.canvas.WebGLContext2D',_super);var __proto=WebGLContext2D.prototype;__proto.setIsMainContext=function(){this._isMain=true;}
__proto.clearBG=function(r,g,b,a){var gl=WebGL.mainContext;gl.clearColor(r,g,b,a);gl.clear(0x00004000);}
__proto._getSubmits=function(){return this._submits;}
__proto._releaseMem=function(){if(!this._submits)
return;this._curMat.destroy();this._curMat=null;this._shader2D.destroy();this._shader2D=null;for(var i=0,n=this._submits._length;i<n;i++)
this._submits[i].releaseRender();this._submits.length=0;this._submits._length=0;this._submits=null;this._curSubmit=null;this._path&&this._path.recover();this._path=null;this._other&&(this._other.font=null);this._save=null;if(this._vb){this._vb.releaseResource();this._vb.destroy();this._vb.destory();this._vb=null;}}
__proto.destroy=function(){--WebGLContext2D._contextcount;this.sprite=null;this._releaseMem();this._targets&&this._targets.destroy();this._targets=null;this._canvas=null;this._ib&&(this._ib!=IndexBuffer2D.QuadrangleIB)&&this._ib.releaseResource();}
__proto.clear=function(){if(!this._submits){this._other=ContextParams.DEFAULT;this._curMat=Matrix.create();this._vb=VertexBuffer2D.create(-1);this._submits=[];this._save=[SaveMark.Create(this)];this._save.length=10;this._shader2D=new Shader2D();this._triangleMesh=MeshTexture.getAMesh();}
this._vb.clear();this._targets&&(this._targets.repaint=true);this._other=ContextParams.DEFAULT;this._clear=true;this._repaint=false;this._drawCount=1;this._renderKey=0;this._other.lineWidth=this._shader2D.ALPHA=1.0;this._nBlendType=0;this._clipRect=WebGLContext2D.MAXCLIPRECT;this._curSubmit=Submit.RENDERBASE;this._shader2D.glTexture=null;this._shader2D.fillStyle=this._shader2D.strokeStyle=DrawStyle.DEFAULT;for(var i=0,n=this._submits._length;i<n;i++)
this._submits[i].releaseRender();this._submits._length=0;this._curMat.identity();this._other.clear();this._saveMark=this._save[0];this._save._length=1;}
__proto.size=function(w,h){if(this._width!=w||this._height!=h){if(w==0||h==0){if(this._vb._byteLength!=0){this._width=w;this._height=h;this._vb.clear();this._vb.upload();}
for(var i=0,n=this._submits._length;i<n;i++)
this._submits[i].releaseRender();this._submits.length=0;this._submits._length=0;this._curSubmit=null;this._path&&this._path.recover();this._path=null;this.sprite=null;this._targets&&(this._targets.destroy());this._targets=null;}else{this._width=w;this._height=h;this._targets&&(this._targets.size(w,h));this._canvas.memorySize-=this._canvas.memorySize;}}
if(w===0&&h===0)this._releaseMem();}
__proto._getTransformMatrix=function(){return this._curMat;}
__proto.translate=function(x,y){if(x!==0||y!==0){SaveTranslate.save(this);if(this._curMat.bTransform){SaveTransform.save(this);this._curMat.transformPointN(Point.TEMP.setTo(x,y));x=Point.TEMP.x;y=Point.TEMP.y;}
this._x+=x;this._y+=y;}}
__proto.save=function(){this._save[this._save._length++]=SaveMark.Create(this);}
__proto.restore=function(){var sz=this._save._length;if(sz<1)
return;for(var i=sz-1;i>=0;i--){var o=this._save[i];o.restore(this);if(o.isSaveMark()){this._save._length=i;return;}}}
__proto._fillText=function(txt,words,x,y,fontStr,color,strokeColor,lineWidth,textAlign,underLine){(underLine===void 0)&&(underLine=0);var shader=this._shader2D;var curShader=this._curSubmit.shaderValue;var font=fontStr?FontInContext.create(fontStr):this._other.font;if(AtlasResourceManager.enabled){if(shader.ALPHA!==curShader.ALPHA)
shader.glTexture=null;DrawText.drawText(this,txt,words,this._curMat,font,textAlign||this._other.textAlign,color,strokeColor,lineWidth,x,y,underLine);}else{var preDef=this._shader2D.defines.getValue();var colorAdd=color?Color.create(color)._color:shader.colorAdd;if(shader.ALPHA!==curShader.ALPHA||colorAdd!==shader.colorAdd||curShader.colorAdd!==shader.colorAdd){shader.glTexture=null;shader.colorAdd=colorAdd;}
DrawText.drawText(this,txt,words,this._curMat,font,textAlign||this._other.textAlign,color,strokeColor,lineWidth,x,y,underLine);}}
__proto.fillWords=function(words,x,y,fontStr,color,underLine){this._fillText(null,words,x,y,fontStr,color,null,-1,null,underLine);}
__proto.fillBorderWords=function(words,x,y,font,color,borderColor,lineWidth){this._fillBorderText(null,words,x,y,font,color,borderColor,lineWidth,null);}
__proto.fillText=function(txt,x,y,fontStr,color,textAlign){this._fillText(txt,null,x,y,fontStr,color,null,-1,textAlign);}
__proto.strokeText=function(txt,x,y,fontStr,color,lineWidth,textAlign){this._fillText(txt,null,x,y,fontStr,null,color,lineWidth||1,textAlign);}
__proto.fillBorderText=function(txt,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign){this._fillBorderText(txt,null,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign);}
__proto._fillBorderText=function(txt,words,x,y,fontStr,fillColor,borderColor,lineWidth,textAlign){if(!AtlasResourceManager.enabled){this._fillText(txt,words,x,y,fontStr,null,borderColor,lineWidth||1,textAlign);this._fillText(txt,words,x,y,fontStr,fillColor,null,-1,textAlign);return;};var shader=this._shader2D;var curShader=this._curSubmit.shaderValue;if(shader.ALPHA!==curShader.ALPHA)
shader.glTexture=null;var font=fontStr?(WebGLContext2D._fontTemp.setFont(fontStr),WebGLContext2D._fontTemp):this._other.font;DrawText.drawText(this,txt,words,this._curMat,font,textAlign||this._other.textAlign,fillColor,borderColor,lineWidth||1,x,y,0);}
__proto.fillRect=function(x,y,width,height,fillStyle){var vb=this._vb;if(GlUtils.fillRectImgVb(vb,this._clipRect,x,y,width,height,Texture.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var pre=this._shader2D.fillStyle;fillStyle&&(this._shader2D.fillStyle=DrawStyle.create(fillStyle));var shader=this._shader2D;var curShader=this._curSubmit.shaderValue;if(shader.fillStyle!==curShader.fillStyle||shader.ALPHA!==curShader.ALPHA){shader.glTexture=null;var submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength-16*4)/32)*3,Value2D.create(0x02,0));submit.shaderValue.color=shader.fillStyle._color._color;submit.shaderValue.ALPHA=shader.ALPHA;this._submits[this._submits._length++]=submit;}
this._curSubmit._numEle+=6;this._shader2D.fillStyle=pre;}}
__proto.fillTexture=function(texture,x,y,width,height,type,offset,other){if(!(texture.loaded&&texture.bitmap&&texture.source)){if(this.sprite){Laya.timer.callLater(this,this._repaintSprite);}
return;};var vb=this._vb;var w=texture.bitmap.width,h=texture.bitmap.height,uv=texture.uv;var ox=offset.x%texture.width,oy=offset.y%texture.height;if(w!=other.w||h!=other.h){if(!other.w&&!other.h){other.oy=other.ox=0;switch(type){case"repeat":other.width=width;other.height=height;break;case"repeat-x":other.width=width;if(oy<0){if(texture.height+oy>height){other.height=height;}else{other.height=texture.height+oy;}}else{other.oy=oy;if(texture.height+oy>height){other.height=height-oy;}else{other.height=texture.height;}}
break;case"repeat-y":if(ox<0){if(texture.width+ox>width){other.width=width;}else{other.width=texture.width+ox;}}else{other.ox=ox;if(texture.width+ox>width){other.width=width-ox;}else{other.width=texture.width;}}
other.height=height;break;default:other.width=width;other.height=height;break;}}
other.w=w;other.h=h;other.uv=[0,0,other.width/w,0,other.width/w,other.height/h,0,other.height/h];}
x+=other.ox;y+=other.oy;ox-=other.ox;oy-=other.oy;if(GlUtils.fillRectImgVb(vb,this._clipRect,x,y,other.width,other.height,other.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var submit=SubmitTexture.create(this,this._ib,vb,((vb._byteLength-16*4)/32)*3,Value2D.create(0x100,0));this._submits[this._submits._length++]=submit;var shaderValue=submit.shaderValue;shaderValue.textureHost=texture;var tTextureX=uv[0]*w;var tTextureY=uv[1]*h;var tTextureW=(uv[2]-uv[0])*w;var tTextureH=(uv[5]-uv[3])*h;var tx=-ox/w;var ty=-oy/h;shaderValue.u_TexRange[0]=tTextureX/w;shaderValue.u_TexRange[1]=tTextureW/w;shaderValue.u_TexRange[2]=tTextureY/h;shaderValue.u_TexRange[3]=tTextureH/h;shaderValue.u_offset[0]=tx;shaderValue.u_offset[1]=ty;if(AtlasResourceManager.enabled&&!this._isMain)
submit.addTexture(texture,(vb._byteLength>>2)-16);this._curSubmit=submit;submit._renderType=10017;submit._numEle+=6;}}
__proto.setShader=function(shader){SaveBase.save(this,0x100000,this._shader2D,true);this._shader2D.shader=shader;}
__proto.setFilters=function(value){SaveBase.save(this,0x200000,this._shader2D,true);this._shader2D.filters=value;this._curSubmit=Submit.RENDERBASE;this._renderKey=0;this._drawCount++;}
__proto.drawTexture=function(tex,x,y,width,height,tx,ty){this._drawTextureM(tex,x,y,width,height,tx,ty,null,1);}
__proto.addTextureVb=function(invb,x,y){var finalVB=this._curSubmit._vb||this._vb;var vpos=(finalVB._byteLength>>2);finalVB.byteLength=((vpos+16)<<2);var vbdata=finalVB.getFloat32Array();for(var i=0,ci=0;i<16;i+=4){vbdata[vpos++]=invb[i]+x;vbdata[vpos++]=invb[i+1]+y;vbdata[vpos++]=invb[i+2];vbdata[vpos++]=invb[i+3];}
this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);finalVB._upload=true;}
__proto.willDrawTexture=function(tex,alpha){if(!(tex.loaded&&tex.bitmap&&tex.source)){if(this.sprite){Laya.timer.callLater(this,this._repaintSprite);}
return 0;};var webGLImg=tex.bitmap;var rid=webGLImg.id+this._shader2D.ALPHA*alpha+10016;if(rid==this._renderKey)return rid;var shader=this._shader2D;var preAlpha=shader.ALPHA;var curShader=this._curSubmit.shaderValue;shader.ALPHA*=alpha;this._renderKey=rid;this._drawCount++;shader.glTexture=webGLImg;var vb=this._vb;var submit=null;var vbSize=(vb._byteLength/32)*3;submit=SubmitTexture.create(this,this._ib,vb,vbSize,Value2D.create(0x01,0));this._submits[this._submits._length++]=submit;submit.shaderValue.textureHost=tex;submit._renderType=10016;submit._preIsSameTextureShader=this._curSubmit._renderType===10016&&shader.ALPHA===curShader.ALPHA;this._curSubmit=submit;shader.ALPHA=preAlpha;return rid;}
__proto.drawTextures=function(tex,pos,tx,ty){if(!(tex.loaded&&tex.bitmap&&tex.source)){this.sprite&&Laya.timer.callLater(this,this._repaintSprite);return;};var pre=this._clipRect;this._clipRect=WebGLContext2D.MAXCLIPRECT;if(!this._drawTextureM(tex,pos[0],pos[1],tex.width,tex.height,tx,ty,null,1)){alert("drawTextures err");return;}
this._clipRect=pre;Stat.drawCall++;if(pos.length<4)
return;var finalVB=this._curSubmit._vb||this._vb;var sx=this._curMat.a,sy=this._curMat.d;for(var i=2,sz=pos.length;i<sz;i+=2){GlUtils.copyPreImgVb(finalVB,(pos[i]-pos[i-2])*sx,(pos[i+1]-pos[i-1])*sy);this._curSubmit._numEle+=6;}
this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);}
__proto._drawTextureM=function(tex,x,y,width,height,tx,ty,m,alpha){if(!(tex.loaded&&tex.source)){if(this.sprite){Laya.timer.callLater(this,this._repaintSprite);}
return false;};var finalVB=this._curSubmit._vb||this._vb;var webGLImg=tex.bitmap;x+=tx;y+=ty;this._drawCount++;var rid=webGLImg.id+this._shader2D.ALPHA*alpha+10016;if(rid!=this._renderKey){this._renderKey=rid;var curShader=this._curSubmit.shaderValue;var shader=this._shader2D;var alphaBack=shader.ALPHA;shader.ALPHA*=alpha;shader.glTexture=webGLImg;var vb=this._vb;var submit=null;var vbSize=(vb._byteLength/32)*3;submit=SubmitTexture.create(this,this._ib,vb,vbSize,Value2D.create(0x01,0));this._submits[this._submits._length++]=submit;submit.shaderValue.textureHost=tex;submit._renderType=10016;submit._preIsSameTextureShader=this._curSubmit._renderType===10016&&shader.ALPHA===curShader.ALPHA;this._curSubmit=submit;finalVB=this._curSubmit._vb||this._vb;shader.ALPHA=alphaBack;}
if(GlUtils.fillRectImgVb(finalVB,this._clipRect,x,y,width||tex.width,height||tex.height,tex.uv,m||this._curMat,this._x,this._y,0,0)){if(AtlasResourceManager.enabled&&!this._isMain)
(this._curSubmit).addTexture(tex,(finalVB._byteLength>>2)-16);this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);return true;}
return false;}
__proto._repaintSprite=function(){if(this.sprite)
this.sprite.repaint();}
__proto._drawText=function(tex,x,y,width,height,m,tx,ty,dx,dy){var webGLImg=tex.bitmap;this._drawCount++;var rid=webGLImg.id+this._shader2D.ALPHA+10016;if(rid!=this._renderKey){this._renderKey=rid;var curShader=this._curSubmit.shaderValue;var shader=this._shader2D;shader.glTexture=webGLImg;var vb=this._vb;var submit=null;var submitID=NaN;var vbSize=(vb._byteLength/32)*3;if(AtlasResourceManager.enabled){submit=SubmitTexture.create(this,this._ib,vb,vbSize,Value2D.create(0x01,0));}else{submit=SubmitTexture.create(this,this._ib,vb,vbSize,TextSV.create());}
submit._preIsSameTextureShader=this._curSubmit._renderType===10016&&shader.ALPHA===curShader.ALPHA;this._submits[this._submits._length++]=submit;submit.shaderValue.textureHost=tex;submit._renderType=10016;this._curSubmit=submit;}
tex.active();var finalVB=this._curSubmit._vb||this._vb;if(GlUtils.fillRectImgVb(finalVB,this._clipRect,x+tx,y+ty,width||tex.width,height||tex.height,tex.uv,m||this._curMat,this._x,this._y,dx,dy,true)){if(AtlasResourceManager.enabled&&!this._isMain){(this._curSubmit).addTexture(tex,(finalVB._byteLength>>2)-16);}
this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);}}
__proto.drawTextureWithTransform=function(tex,x,y,width,height,transform,tx,ty,alpha){if(!transform){this._drawTextureM(tex,x,y,width,height,tx,ty,null,alpha);return;};var curMat=this._curMat;var prex=this._x;var prey=this._y;(tx!==0||ty!==0)&&(this._x=tx*curMat.a+ty*curMat.c,this._y=ty*curMat.d+tx*curMat.b);if(transform&&curMat.bTransform){Matrix.mul(transform,curMat,WebGLContext2D._tmpMatrix);transform=WebGLContext2D._tmpMatrix;transform._checkTransform();}else{this._x+=curMat.tx;this._y+=curMat.ty;}
this._drawTextureM(tex,x,y,width,height,0,0,transform,alpha);this._x=prex;this._y=prey;}
__proto.fillQuadrangle=function(tex,x,y,point4,m){var submit=this._curSubmit;var vb=this._vb;var shader=this._shader2D;var curShader=submit.shaderValue;this._renderKey=0;if(tex.bitmap){var t_tex=tex.bitmap;if(shader.glTexture!=t_tex||shader.ALPHA!==curShader.ALPHA){shader.glTexture=t_tex;submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength)/32)*3,Value2D.create(0x01,0));submit.shaderValue.glTexture=t_tex;this._submits[this._submits._length++]=submit;}
GlUtils.fillQuadrangleImgVb(vb,x,y,point4,tex.uv,m||this._curMat,this._x,this._y);}else{if(!submit.shaderValue.fillStyle||!submit.shaderValue.fillStyle.equal(tex)||shader.ALPHA!==curShader.ALPHA){shader.glTexture=null;submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength)/32)*3,Value2D.create(0x02,0));submit.shaderValue.defines.add(0x02);submit.shaderValue.fillStyle=DrawStyle.create(tex);this._submits[this._submits._length++]=submit;}
GlUtils.fillQuadrangleImgVb(vb,x,y,point4,Texture.DEF_UV,m||this._curMat,this._x,this._y);}
submit._numEle+=6;}
__proto.drawTexture2=function(x,y,pivotX,pivotY,transform,alpha,blendMode,args){if(alpha==0)return;var curMat=this._curMat;this._x=x*curMat.a+y*curMat.c;this._y=y*curMat.d+x*curMat.b;if(transform){if(curMat.bTransform||transform.bTransform){Matrix.mul(transform,curMat,WebGLContext2D._tmpMatrix);transform=WebGLContext2D._tmpMatrix;}else{this._x+=transform.tx+curMat.tx;this._y+=transform.ty+curMat.ty;transform=Matrix.EMPTY;}}
if(alpha===1&&!blendMode)
this._drawTextureM(args[0],args[1]-pivotX,args[2]-pivotY,args[3],args[4],0,0,transform,1);else{var preAlpha=this._shader2D.ALPHA;var preblendType=this._nBlendType;this._shader2D.ALPHA=alpha;blendMode&&(this._nBlendType=BlendMode.TOINT(blendMode));this._drawTextureM(args[0],args[1]-pivotX,args[2]-pivotY,args[3],args[4],0,0,transform,1);this._shader2D.ALPHA=preAlpha;this._nBlendType=preblendType;}
this._x=this._y=0;}
__proto.drawCanvas=function(canvas,x,y,width,height){var src=canvas.context;this._renderKey=0;if(src._targets){this._submits[this._submits._length++]=SubmitCanvas.create(src,0,null);this._curSubmit=Submit.RENDERBASE;src._targets.drawTo(this,x,y,width,height);}else{var submit=this._submits[this._submits._length++]=SubmitCanvas.create(src,this._shader2D.ALPHA,this._shader2D.filters);var sx=width/canvas.width;var sy=height/canvas.height;var mat=submit._matrix;this._curMat.copyTo(mat);sx!=1&&sy!=1&&mat.scale(sx,sy);var tx=mat.tx,ty=mat.ty;mat.tx=mat.ty=0;mat.transformPoint(Point.TEMP.setTo(x,y));mat.translate(Point.TEMP.x+tx,Point.TEMP.y+ty);this._curSubmit=Submit.RENDERBASE;}
if(Config.showCanvasMark){this.save();this.lineWidth=4;this.strokeStyle=src._targets?"yellow":"green";this.strokeRect(x-1,y-1,width+2,height+2,1);this.strokeRect(x,y,width,height,1);this.restore();}}
__proto.drawTarget=function(scope,x,y,width,height,m,proName,shaderValue,uv,blend){(blend===void 0)&&(blend=-1);var vb=this._vb;if(GlUtils.fillRectImgVb(vb,this._clipRect,x,y,width,height,uv||Texture.DEF_UV,m||this._curMat,this._x,this._y,0,0)){this._renderKey=0;var shader=this._shader2D;shader.glTexture=null;var curShader=this._curSubmit.shaderValue;var submit=this._curSubmit=SubmitTarget.create(this,this._ib,vb,((vb._byteLength-16*4)/32)*3,shaderValue,proName);if(blend==-1){submit.blendType=this._nBlendType;}else{submit.blendType=blend;}
submit.scope=scope;this._submits[this._submits._length++]=submit;this._curSubmit._numEle+=6;}}
__proto.mixRGBandAlpha=function(color){return this._mixRGBandAlpha(color,this._shader2D.ALPHA);}
__proto._mixRGBandAlpha=function(color,alpha){var a=((color&0xff000000)>>>24);if(a!=0){a*=alpha;}else{a=alpha*255;}
return(color&0x00ffffff)|(a<<24);}
__proto.drawTriangles=function(tex,x,y,vertices,uvs,indices,matrix,alpha,color,blendMode){if(!(tex.loaded&&tex.source)){if(this.sprite){Laya.timer.callLater(this,this._repaintSprite);}
return false;}
this._drawCount++;var webGLImg=tex.bitmap;var rgba=this._mixRGBandAlpha(0xffffffff,alpha);var vertNum=vertices.length/2;var eleNum=indices.length;this._renderKey=-1;var submit=this._curSubmit=SubmitTexture.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,Value2D.create(0x01,0));submit.shaderValue.textureHost=tex;submit._renderType=10016;this._submits[this._submits._length++]=submit;if(matrix){WebGLContext2D._tmpMatrix.a=matrix.a;WebGLContext2D._tmpMatrix.b=matrix.b;WebGLContext2D._tmpMatrix.c=matrix.c;WebGLContext2D._tmpMatrix.d=matrix.d;WebGLContext2D._tmpMatrix.tx=matrix.tx+x;WebGLContext2D._tmpMatrix.ty=matrix.ty+y;Matrix.mul(WebGLContext2D._tmpMatrix,this._curMat,WebGLContext2D._tmpMatrix);}else{WebGLContext2D._tmpMatrix.a=this._curMat.a;WebGLContext2D._tmpMatrix.b=this._curMat.b;WebGLContext2D._tmpMatrix.c=this._curMat.c;WebGLContext2D._tmpMatrix.d=this._curMat.d;WebGLContext2D._tmpMatrix.tx=this._curMat.tx+x;WebGLContext2D._tmpMatrix.ty=this._curMat.ty+y;}
this._triangleMesh.addData(vertices,uvs,indices,WebGLContext2D._tmpMatrix,rgba,this);this._curSubmit._numEle+=eleNum;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle);return true;}
__proto.transform=function(a,b,c,d,tx,ty){SaveTransform.save(this);Matrix.mul(Matrix.TEMP.setTo(a,b,c,d,tx,ty),this._curMat,this._curMat);this._curMat._checkTransform();}
__proto.setTransformByMatrix=function(value){value.copyTo(this._curMat);}
__proto.transformByMatrix=function(value){SaveTransform.save(this);Matrix.mul(value,this._curMat,this._curMat);this._curMat._checkTransform();}
__proto.rotate=function(angle){SaveTransform.save(this);this._curMat.rotateEx(angle);}
__proto.scale=function(scaleX,scaleY){SaveTransform.save(this);this._curMat.scaleEx(scaleX,scaleY);}
__proto.clipRect=function(x,y,width,height){if(this._curMat.b!=0||this._curMat.c!=0){this._renderKey=0;var submitStencil0=SubmitStencil.create(4);this.addRenderObject(submitStencil0);var vb=this._vb;var nPos=(vb._byteLength>>2);if(GlUtils.fillRectImgVb(vb,null,x,y,width,height,Texture.DEF_UV,this._curMat,this._x,this._y,0,0)){var shader=this._shader2D;shader.glTexture=null;var submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength-16*4)/32)*3,Value2D.create(0x02,0));submit.shaderValue.ALPHA=1.0;this._submits[this._submits._length++]=submit;this._curSubmit._numEle+=6;}else{alert("clipRect calc stencil rect error");};var submitStencil1=SubmitStencil.create(5);this.addRenderObject(submitStencil1);var vbdata=vb.getFloat32Array();var minx=Math.min(Math.min(Math.min(vbdata[nPos+0],vbdata[nPos+4]),vbdata[nPos+8]),vbdata[nPos+12]);var maxx=Math.max(Math.max(Math.max(vbdata[nPos+0],vbdata[nPos+4]),vbdata[nPos+8]),vbdata[nPos+12]);var miny=Math.min(Math.min(Math.min(vbdata[nPos+1],vbdata[nPos+5]),vbdata[nPos+9]),vbdata[nPos+13]);var maxy=Math.max(Math.max(Math.max(vbdata[nPos+1],vbdata[nPos+5]),vbdata[nPos+9]),vbdata[nPos+13]);SaveClipRectStencil.save(this,submitStencil1,x,y,width,height,minx,miny,maxx-minx,maxy-miny);this._curSubmit=Submit.RENDERBASE;}else{width*=this._curMat.a;height*=this._curMat.d;var p=Point.TEMP;this._curMat.transformPoint(p.setTo(x,y));if(width<0){p.x=p.x+width;width=-width;}
if(height<0){p.y=p.y+height;height=-height;}
this._renderKey=0;var submitSc=this._curSubmit=SubmitScissor.create(this);this._submits[this._submits._length++]=submitSc;submitSc.submitIndex=this._submits._length;submitSc.submitLength=9999999;SaveClipRect.save(this,submitSc);var clip=this._clipRect;var x1=clip.x,y1=clip.y;var r=p.x+width,b=p.y+height;x1<p.x&&(clip.x=p.x);y1<p.y&&(clip.y=p.y);clip.width=Math.min(r,x1+clip.width)-clip.x;clip.height=Math.min(b,y1+clip.height)-clip.y;this._shader2D.glTexture=null;submitSc.clipRect.copyFrom(clip);this._curSubmit=Submit.RENDERBASE;}}
__proto.setIBVB=function(x,y,ib,vb,numElement,mat,shader,shaderValues,startIndex,offset,type){(startIndex===void 0)&&(startIndex=0);(offset===void 0)&&(offset=0);(type===void 0)&&(type=0);if(ib===null){if(!Render.isFlash){ib=this._ib;}else{var falshVB=vb;(falshVB._selfIB)||(falshVB._selfIB=IndexBuffer2D.create(0x88E4));falshVB._selfIB.clear();ib=falshVB._selfIB;}
GlUtils.expandIBQuadrangle(ib,(vb._byteLength/(4*vb.vertexStride*4)));}
if(!shaderValues||!shader)
throw Error("setIBVB must input:shader shaderValues");var submit=SubmitOtherIBVB.create(this,vb,ib,numElement,shader,shaderValues,startIndex,offset,type);mat||(mat=Matrix.EMPTY);mat.translate(x,y);Matrix.mul(mat,this._curMat,submit._mat);mat.translate(-x,-y);this._submits[this._submits._length++]=submit;this._curSubmit=Submit.RENDERBASE;this._renderKey=0;}
__proto.addRenderObject=function(o){this._submits[this._submits._length++]=o;}
__proto.fillTrangles=function(tex,x,y,points,m){var submit=this._curSubmit;var vb=this._vb;var shader=this._shader2D;var curShader=submit.shaderValue;var length=points.length>>4;var t_tex=tex.bitmap;this._renderKey=0;if(shader.glTexture!=t_tex||shader.ALPHA!==curShader.ALPHA){submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength)/32)*3,Value2D.create(0x01,0));submit.shaderValue.textureHost=tex;this._submits[this._submits._length++]=submit;}
GlUtils.fillTranglesVB(vb,x,y,points,m||this._curMat,this._x,this._y);submit._numEle+=length*6;}
__proto.submitElement=function(start,end){var renderList=this._submits;end<0&&(end=renderList._length);while(start<end){start+=renderList[start].renderSubmit();}}
__proto.finish=function(){WebGL.mainContext.finish();}
__proto.flush=function(){var maxNum=Math.max(this._vb._byteLength/(4*16),this._maxNumEle/6)+8;if(maxNum>(this._ib.bufferLength/(6*2))){GlUtils.expandIBQuadrangle(this._ib,maxNum);}
if(!this._isMain&&AtlasResourceManager.enabled&&AtlasResourceManager._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=AtlasResourceManager._atlasRestore;var renderList=this._submits;for(var i=0,s=renderList._length;i<s;i++){var submit=renderList[i];if(submit.getRenderType()===10016)
(submit).checkTexture();}}
this.submitElement(0,this._submits._length);this._path&&this._path.reset();SkinMeshBuffer.instance&&SkinMeshBuffer.getInstance().reset();var sz=0;for(i=0,sz=this.meshlist.length;i<sz;i++){var curm=this.meshlist[i];curm.canReuse?(curm.releaseMesh()):(curm.destroy());}
this.meshlist.length=0;this._curSubmit=Submit.RENDERBASE;this._renderKey=0;this._triangleMesh=MeshTexture.getAMesh();this.meshlist.push(this._triangleMesh);return this._submits._length;}
__proto.setPathId=function(id){this.mId=id;if(this.mId!=-1){this.mHaveKey=false;var tVGM=VectorGraphManager.getInstance();if(tVGM.shapeDic[this.mId]){this.mHaveKey=true;}
this.mHaveLineKey=false;if(tVGM.shapeLineDic[this.mId]){this.mHaveLineKey=true;}}}
__proto.movePath=function(x,y){var _x1=x,_y1=y;x=this._curMat.a*_x1+this._curMat.c*_y1+this._curMat.tx;y=this._curMat.b*_x1+this._curMat.d*_y1+this._curMat.ty;this.mX+=x;this.mY+=y;}
__proto.beginPath=function(){var tPath=this._getPath();tPath.tempArray.length=0;tPath.closePath=false;this.mX=0;this.mY=0;}
__proto.closePath=function(){this._path.closePath=true;}
__proto.fill=function(isConvexPolygon){(isConvexPolygon===void 0)&&(isConvexPolygon=false);var tPath=this._getPath();this.drawPoly(0,0,tPath.tempArray,this.fillStyle._color.numColor,0,0,isConvexPolygon);}
__proto.stroke=function(){var tPath=this._getPath();if(this.lineWidth>0){if(this.mId==-1){tPath.drawLine(0,0,tPath.tempArray,this.lineWidth,this.strokeStyle._color.numColor);}else{if(this.mHaveLineKey){var tShapeLine=VectorGraphManager.getInstance().shapeLineDic[this.mId];tShapeLine.rebuild(tPath.tempArray);tPath.setGeomtry(tShapeLine);}else{VectorGraphManager.getInstance().addLine(this.mId,tPath.drawLine(0,0,tPath.tempArray,this.lineWidth,this.strokeStyle._color.numColor));}}
tPath.update();var tPosArray=[this.mX,this.mY];var tempSubmit=Submit.createShape(this,tPath.ib,tPath.vb,tPath.count,tPath.offset,Value2D.create(0x04,0));tempSubmit.shaderValue.ALPHA=this._shader2D.ALPHA;(tempSubmit.shaderValue).u_pos=tPosArray;tempSubmit.shaderValue.u_mmat2=RenderState2D.TEMPMAT4_ARRAY;this._submits[this._submits._length++]=tempSubmit;}}
__proto.line=function(fromX,fromY,toX,toY,lineWidth,mat){var submit=this._curSubmit;var vb=this._vb;if(GlUtils.fillLineVb(vb,this._clipRect,fromX,fromY,toX,toY,lineWidth,mat)){this._renderKey=0;var shader=this._shader2D;var curShader=submit.shaderValue;if(shader.strokeStyle!==curShader.strokeStyle||shader.ALPHA!==curShader.ALPHA){shader.glTexture=null;submit=this._curSubmit=Submit.createSubmit(this,this._ib,vb,((vb._byteLength-16*4)/32)*3,Value2D.create(0x02,0));submit.shaderValue.strokeStyle=shader.strokeStyle;submit.shaderValue.mainID=0x02;submit.shaderValue.ALPHA=shader.ALPHA;this._submits[this._submits._length++]=submit;}
submit._numEle+=6;}}
__proto.moveTo=function(x,y,b){(b===void 0)&&(b=true);var tPath=this._getPath();if(b){var _x1=x,_y1=y;x=this._curMat.a*_x1+this._curMat.c*_y1;y=this._curMat.b*_x1+this._curMat.d*_y1;}
tPath.addPoint(x,y);}
__proto.lineTo=function(x,y,b){(b===void 0)&&(b=true);var tPath=this._getPath();if(b){var _x1=x,_y1=y;x=this._curMat.a*_x1+this._curMat.c*_y1;y=this._curMat.b*_x1+this._curMat.d*_y1;}
tPath.addPoint(x,y);}
__proto.drawCurves=function(x,y,args){this.setPathId(-1);this.beginPath();this.strokeStyle=args[3];this.lineWidth=args[4];var points=args[2];x+=args[0],y+=args[1];this.movePath(x,y);this.moveTo(points[0],points[1]);var i=2,n=points.length;while(i<n){this.quadraticCurveTo(points[i++],points[i++],points[i++],points[i++]);}
this.stroke();}
__proto.arcTo=function(x1,y1,x2,y2,r){if(this.mId!=-1){if(this.mHaveKey){return;}};var i=0;var x=0,y=0;var tPath=this._getPath();this._curMat.copyTo(WebGLContext2D._tmpMatrix);WebGLContext2D._tmpMatrix.tx=WebGLContext2D._tmpMatrix.ty=0;WebGLContext2D._tempPoint.setTo(tPath.getEndPointX(),tPath.getEndPointY());WebGLContext2D._tmpMatrix.invertTransformPoint(WebGLContext2D._tempPoint);var dx=WebGLContext2D._tempPoint.x-x1;var dy=WebGLContext2D._tempPoint.y-y1;var len1=Math.sqrt(dx*dx+dy*dy);if(len1<=0.000001){return;};var ndx=dx/len1;var ndy=dy/len1;var dx2=x2-x1;var dy2=y2-y1;var len22=dx2*dx2+dy2*dy2;var len2=Math.sqrt(len22);if(len2<=0.000001){return;};var ndx2=dx2/len2;var ndy2=dy2/len2;var odx=ndx+ndx2;var ody=ndy+ndy2;var olen=Math.sqrt(odx*odx+ody*ody);if(olen<=0.000001){return;};var nOdx=odx/olen;var nOdy=ody/olen;var alpha=Math.acos(nOdx*ndx+nOdy*ndy);var halfAng=Math.PI/2-alpha;len1=r/Math.tan(halfAng);var ptx1=len1*ndx+x1;var pty1=len1*ndy+y1;var orilen=Math.sqrt(len1*len1+r*r);var orix=x1+nOdx*orilen;var oriy=y1+nOdy*orilen;var ptx2=len1*ndx2+x1;var pty2=len1*ndy2+y1;var dir=ndx*ndy2-ndy*ndx2;var fChgAng=0;var sinx=0.0;var cosx=0.0;if(dir>=0){fChgAng=halfAng*2;var fda=fChgAng/WebGLContext2D.SEGNUM;sinx=Math.sin(fda);cosx=Math.cos(fda);}
else{fChgAng=-halfAng*2;fda=fChgAng/WebGLContext2D.SEGNUM;sinx=Math.sin(fda);cosx=Math.cos(fda);}
x=this._curMat.a*ptx1+this._curMat.c*pty1;y=this._curMat.b*ptx1+this._curMat.d*pty1;if(x!=this._path.getEndPointX()||y!=this._path.getEndPointY()){tPath.addPoint(x,y);};var cvx=ptx1-orix;var cvy=pty1-oriy;var tx=0.0;var ty=0.0;for(i=0;i<WebGLContext2D.SEGNUM;i++){var cx=cvx*cosx+cvy*sinx;var cy=-cvx*sinx+cvy*cosx;x=cx+orix;y=cy+oriy;x1=this._curMat.a*x+this._curMat.c*y;y1=this._curMat.b*x+this._curMat.d*y;x=x1;y=y1;if(x!=this._path.getEndPointX()||y!=this._path.getEndPointY()){tPath.addPoint(x,y);}
cvx=cx;cvy=cy;}}
__proto.arc=function(cx,cy,r,startAngle,endAngle,counterclockwise,b){(counterclockwise===void 0)&&(counterclockwise=false);(b===void 0)&&(b=true);if(this.mId!=-1){var tShape=VectorGraphManager.getInstance().shapeDic[this.mId];if(tShape){if(this.mHaveKey&&!tShape.needUpdate(this._curMat))
return;}
cx=0;cy=0;};var a=0,da=0,hda=0,kappa=0;var dx=0,dy=0,x=0,y=0,tanx=0,tany=0;var px=0,py=0,ptanx=0,ptany=0;var i=0,ndivs=0,nvals=0;da=endAngle-startAngle;if(!counterclockwise){if(Math.abs(da)>=Math.PI*2){da=Math.PI*2;}else{while(da<0.0){da+=Math.PI*2;}}}else{if(Math.abs(da)>=Math.PI*2){da=-Math.PI*2;}else{while(da>0.0){da-=Math.PI*2;}}}
if(r<101){ndivs=Math.max(10,da*r/5);}else if(r<201){ndivs=Math.max(10,da*r/20);}else{ndivs=Math.max(10,da*r/40);}
hda=(da/ndivs)/2.0;kappa=Math.abs(4/3*(1-Math.cos(hda))/Math.sin(hda));if(counterclockwise)
kappa=-kappa;nvals=0;var tPath=this._getPath();var _x1=NaN,_y1=NaN;for(i=0;i<=ndivs;i++){a=startAngle+da*(i/ndivs);dx=Math.cos(a);dy=Math.sin(a);x=cx+dx*r;y=cy+dy*r;if(b){_x1=x,_y1=y;x=this._curMat.a*_x1+this._curMat.c*_y1;y=this._curMat.b*_x1+this._curMat.d*_y1;}
if(x!=this._path.getEndPointX()||y!=this._path.getEndPointY()){tPath.addPoint(x,y);}}
dx=Math.cos(endAngle);dy=Math.sin(endAngle);x=cx+dx*r;y=cy+dy*r;if(b){_x1=x,_y1=y;x=this._curMat.a*_x1+this._curMat.c*_y1;y=this._curMat.b*_x1+this._curMat.d*_y1;}
if(x!=this._path.getEndPointX()||y!=this._path.getEndPointY()){tPath.addPoint(x,y);}}
__proto.quadraticCurveTo=function(cpx,cpy,x,y){var tBezier=Bezier.I;var tResultArray=[];var _x1=x,_y1=y;x=this._curMat.a*_x1+this._curMat.c*_y1;y=this._curMat.b*_x1+this._curMat.d*_y1;_x1=cpx,_y1=cpy;cpx=this._curMat.a*_x1+this._curMat.c*_y1;cpy=this._curMat.b*_x1+this._curMat.d*_y1;var tArray=tBezier.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),cpx,cpy,x,y],30,2);for(var i=0,n=tArray.length/2;i<n;i++){this.lineTo(tArray[i*2],tArray[i*2+1],false);}
this.lineTo(x,y,false);}
__proto.rect=function(x,y,width,height){this._other=this._other.make();this._other.path||(this._other.path=new Path());this._other.path.rect(x,y,width,height);}
__proto.strokeRect=function(x,y,width,height,parameterLineWidth){var tW=parameterLineWidth*0.5;this.line(x-tW,y,x+width+tW,y,parameterLineWidth,this._curMat);this.line(x+width,y,x+width,y+height,parameterLineWidth,this._curMat);this.line(x,y,x,y+height,parameterLineWidth,this._curMat);this.line(x-tW,y+height,x+width+tW,y+height,parameterLineWidth,this._curMat);}
__proto.clip=function(){}
__proto.drawPoly=function(x,y,points,color,lineWidth,boderColor,isConvexPolygon){(isConvexPolygon===void 0)&&(isConvexPolygon=false);this._renderKey=0;this._shader2D.glTexture=null;var tPath=this._getPath();if(this.mId==-1){tPath.polygon(x,y,points,color,lineWidth?lineWidth:1,boderColor)}else{if(this.mHaveKey){var tShape=VectorGraphManager.getInstance().shapeDic[this.mId];tShape.setMatrix(this._curMat);tShape.rebuild(tPath.tempArray);tPath.setGeomtry(tShape);}else{var t=tPath.polygon(x,y,points,color,lineWidth?lineWidth:1,boderColor);VectorGraphManager.getInstance().addShape(this.mId,t);t.setMatrix(this._curMat);}}
tPath.update();var tPosArray=[this.mX,this.mY];var tempSubmit;tempSubmit=Submit.createShape(this,tPath.ib,tPath.vb,tPath.count,tPath.offset,Value2D.create(0x04,0));tempSubmit.shaderValue.ALPHA=this._shader2D.ALPHA;(tempSubmit.shaderValue).u_pos=tPosArray;tempSubmit.shaderValue.u_mmat2=RenderState2D.EMPTYMAT4_ARRAY;this._submits[this._submits._length++]=tempSubmit;if(lineWidth>0){if(this.mHaveLineKey){var tShapeLine=VectorGraphManager.getInstance().shapeLineDic[this.mId];tShapeLine.rebuild(tPath.tempArray);tPath.setGeomtry(tShapeLine);}else{VectorGraphManager.getInstance().addShape(this.mId,tPath.drawLine(x,y,points,lineWidth,boderColor));}
tPath.update();tempSubmit=Submit.createShape(this,tPath.ib,tPath.vb,tPath.count,tPath.offset,Value2D.create(0x04,0));tempSubmit.shaderValue.ALPHA=this._shader2D.ALPHA;tempSubmit.shaderValue.u_mmat2=RenderState2D.EMPTYMAT4_ARRAY;this._submits[this._submits._length++]=tempSubmit;}}
__proto.drawParticle=function(x,y,pt){pt.x=x;pt.y=y;this._submits[this._submits._length++]=pt;}
__proto._getPath=function(){return this._path||(this._path=new Path());}
__getset(0,__proto,'globalCompositeOperation',function(){return BlendMode.NAMES[this._nBlendType];},function(value){var n=BlendMode.TOINT[value];n==null||(this._nBlendType===n)||(SaveBase.save(this,0x10000,this,true),this._curSubmit=Submit.RENDERBASE,this._renderKey=0,this._nBlendType=n);});__getset(0,__proto,'strokeStyle',function(){return this._shader2D.strokeStyle;},function(value){this._shader2D.strokeStyle.equal(value)||(SaveBase.save(this,0x200,this._shader2D,false),this._shader2D.strokeStyle=DrawStyle.create(value));});__getset(0,__proto,'globalAlpha',function(){return this._shader2D.ALPHA;},function(value){value=Math.floor(value*1000)/1000;if(value!=this._shader2D.ALPHA){SaveBase.save(this,0x1,this._shader2D,true);this._shader2D.ALPHA=value;}});__getset(0,__proto,'asBitmap',null,function(value){if(value){this._targets||(this._targets=new RenderTargetMAX());this._targets.repaint=true;if(!this._width||!this._height)
throw Error("asBitmap no size!");this._targets.setSP(this.sprite);this._targets.size(this._width,this._height);}else
this._targets=null;});__getset(0,__proto,'fillStyle',function(){return this._shader2D.fillStyle;},function(value){this._shader2D.fillStyle.equal(value)||(SaveBase.save(this,0x2,this._shader2D,false),this._shader2D.fillStyle=DrawStyle.create(value));});__getset(0,__proto,'textAlign',function(){return this._other.textAlign;},function(value){(this._other.textAlign===value)||(this._other=this._other.make(),SaveBase.save(this,0x8000,this._other,false),this._other.textAlign=value);});__getset(0,__proto,'lineWidth',function(){return this._other.lineWidth;},function(value){(this._other.lineWidth===value)||(this._other=this._other.make(),SaveBase.save(this,0x100,this._other,false),this._other.lineWidth=value);});__getset(0,__proto,'textBaseline',function(){return this._other.textBaseline;},function(value){(this._other.textBaseline===value)||(this._other=this._other.make(),SaveBase.save(this,0x4000,this._other,false),this._other.textBaseline=value);});__getset(0,__proto,'font',null,function(str){if(str==this._other.font.toString())
return;this._other=this._other.make();SaveBase.save(this,0x8,this._other,false);this._other.font===FontInContext.EMPTY?(this._other.font=new FontInContext(str)):(this._other.font.setFont(str));});WebGLContext2D.__init__=function(){ContextParams.DEFAULT=new ContextParams();}
WebGLContext2D._tempPoint=new Point();WebGLContext2D._SUBMITVBSIZE=32000;WebGLContext2D._MAXSIZE=99999999;WebGLContext2D._RECTVBSIZE=16;WebGLContext2D.MAXCLIPRECT=new Rectangle(0,0,99999999,99999999);WebGLContext2D._COUNT=0;WebGLContext2D._tmpMatrix=new Matrix();WebGLContext2D.SEGNUM=32;WebGLContext2D._contextcount=0;__static(WebGLContext2D,['_fontTemp',function(){return this._fontTemp=new FontInContext();},'_drawStyleTemp',function(){return this._drawStyleTemp=new DrawStyle(null);}]);WebGLContext2D.__init$=function(){ContextParams=(function(){function ContextParams(){this.lineWidth=1;this.path=null;this.textAlign=null;this.textBaseline=null;this.font=FontInContext.EMPTY;}
__class(ContextParams,'');var __proto=ContextParams.prototype;__proto.clear=function(){this.lineWidth=1;this.path&&this.path.clear();this.textAlign=this.textBaseline=null;this.font=FontInContext.EMPTY;}
__proto.make=function(){return this===ContextParams.DEFAULT?new ContextParams():this;}
ContextParams.DEFAULT=null;return ContextParams;})()}
return WebGLContext2D;})(Context)
var Value2D=(function(_super){function Value2D(mainID,subID){this.size=[0,0];this.alpha=1.0;this.ALPHA=1.0;this.subID=0;this._cacheID=0;Value2D.__super.call(this);this.defines=new ShaderDefines2D();this.position=Value2D._POSITION;this.mainID=mainID;this.subID=subID;this.textureHost=null;this.texture=null;this.fillStyle=null;this.color=null;this.strokeStyle=null;this.colorAdd=null;this.glTexture=null;this.u_mmat2=null;this._cacheID=mainID|subID;this._inClassCache=Value2D._cache[this._cacheID];if(mainID>0&&!this._inClassCache){this._inClassCache=Value2D._cache[this._cacheID]=[];this._inClassCache._length=0;}
this.clear();}
__class(Value2D,'laya.webgl.shader.d2.value.Value2D',_super);var __proto=Value2D.prototype;__proto.setValue=function(value){}
__proto.refresh=function(){var size=this.size;size[0]=RenderState2D.width;size[1]=RenderState2D.height;this.alpha=this.ALPHA*RenderState2D.worldAlpha;this.mmat=RenderState2D.worldMatrix4;return this;}
__proto._ShaderWithCompile=function(){return Shader.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Shader2X.create);}
__proto._withWorldShaderDefines=function(){var defs=RenderState2D.worldShaderDefines;var sd=Shader.sharders[this.mainID|this.defines._value|defs.getValue()];if(!sd){var def={};var dic;var name;dic=this.defines.toNameDic();for(name in dic)def[name]="";dic=defs.toNameDic();for(name in dic)def[name]="";sd=Shader.withCompile2D(0,this.mainID,def,this.mainID|this.defines._value|defs.getValue(),Shader2X.create);};var worldFilters=RenderState2D.worldFilters;if(!worldFilters)return sd;var n=worldFilters.length,f;for(var i=0;i<n;i++){((f=worldFilters[i]))&&f.action.setValue(this);}
return sd;}
__proto.upload=function(){var renderstate2d=RenderState2D;this.alpha=this.ALPHA*renderstate2d.worldAlpha;if(RenderState2D.worldMatrix4!==RenderState2D.TEMPMAT4_ARRAY)this.defines.add(0x80);(WebGL.shaderHighPrecision)&&(this.defines.add(0x400));var sd=renderstate2d.worldShaderDefines?this._withWorldShaderDefines():(Shader.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile());var params;this.size[0]=renderstate2d.width,this.size[1]=renderstate2d.height;this.mmat=renderstate2d.worldMatrix4;if(BaseShader.activeShader!==sd){if(sd._shaderValueWidth!==renderstate2d.width||sd._shaderValueHeight!==renderstate2d.height){sd._shaderValueWidth=renderstate2d.width;sd._shaderValueHeight=renderstate2d.height;}
else{params=sd._params2dQuick2||sd._make2dQuick2();}
sd.upload(this,params);}
else{if(sd._shaderValueWidth!==renderstate2d.width||sd._shaderValueHeight!==renderstate2d.height){sd._shaderValueWidth=renderstate2d.width;sd._shaderValueHeight=renderstate2d.height;}
else{params=(sd._params2dQuick1)||sd._make2dQuick1();}
sd.upload(this,params);}}
__proto.setFilters=function(value){this.filters=value;if(!value)
return;var n=value.length,f;for(var i=0;i<n;i++){f=value[i];if(f){this.defines.add(f.type);f.action.setValue(this);}}}
__proto.clear=function(){this.defines.setValue(this.subID);}
__proto.release=function(){this._inClassCache[this._inClassCache._length++]=this;this.fillStyle=null;this.strokeStyle=null;this.clear();}
Value2D._initone=function(type,classT){Value2D._typeClass[type]=classT;Value2D._cache[type]=[];Value2D._cache[type]._length=0;}
Value2D.__init__=function(){Value2D._POSITION=[2,0x1406,false,4*CONST3D2D.BYTES_PE,0];Value2D._TEXCOORD=[2,0x1406,false,4*CONST3D2D.BYTES_PE,2*CONST3D2D.BYTES_PE];Value2D._initone(0x02,Color2dSV);Value2D._initone(0x04,PrimitiveSV);Value2D._initone(0x100,FillTextureSV);Value2D._initone(0x200,SkinSV);Value2D._initone(0x01,TextureSV);Value2D._initone(0x01|0x40,TextSV);Value2D._initone(0x01|0x08,TextureSV);}
Value2D.create=function(mainType,subType){var types=Value2D._cache[mainType|subType];if(types._length)
return types[--types._length];else
return new Value2D._typeClass[mainType|subType](subType);}
Value2D._POSITION=null;Value2D._TEXCOORD=null;Value2D._cache=[];Value2D._typeClass=[];Value2D.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return Value2D;})(ShaderValue)
var RenderSprite3D=(function(_super){function RenderSprite3D(type,next){RenderSprite3D.__super.call(this,type,next);}
__class(RenderSprite3D,'laya.webgl.utils.RenderSprite3D',_super);var __proto=RenderSprite3D.prototype;__proto.onCreate=function(type){switch(type){case 0x08:this._fun=this._blend;return;case 0x04:this._fun=this._transform;return;}}
__proto._mask=function(sprite,context,x,y){var next=this._next;var mask=sprite.mask;var submitCMD;var submitStencil;if(mask){context.ctx.save();var preBlendMode=(context.ctx).globalCompositeOperation;var tRect=new Rectangle();tRect.copyFrom(mask.getBounds());tRect.width=Math.round(tRect.width);tRect.height=Math.round(tRect.height);tRect.x=Math.round(tRect.x);tRect.y=Math.round(tRect.y);if(tRect.width>0&&tRect.height>0){var tf=sprite._style._tf;var scope=SubmitCMDScope.create();scope.addValue("bounds",tRect);submitCMD=SubmitCMD.create([scope,context],laya.webgl.utils.RenderSprite3D.tmpTarget);context.addRenderObject(submitCMD);mask.render(context,-tRect.x,-tRect.y);submitCMD=SubmitCMD.create([scope],laya.webgl.utils.RenderSprite3D.endTmpTarget);context.addRenderObject(submitCMD);context.ctx.save();context.clipRect(x-tf.translateX+tRect.x,y-tf.translateY+tRect.y,tRect.width,tRect.height);next._fun.call(next,sprite,context,x,y);context.ctx.restore();submitStencil=SubmitStencil.create(6);preBlendMode=(context.ctx).globalCompositeOperation;submitStencil.blendMode="mask";context.addRenderObject(submitStencil);Matrix.TEMP.identity();var shaderValue=Value2D.create(0x01,0);var uv=Texture.INV_UV;var w=tRect.width;var h=tRect.height;var tempLimit=32;if(tRect.width<tempLimit||tRect.height<tempLimit){uv=RenderSprite3D.tempUV;uv[0]=0;uv[1]=0;uv[2]=(tRect.width>=32)?1:tRect.width/tempLimit;uv[3]=0
uv[4]=(tRect.width>=32)?1:tRect.width/tempLimit;uv[5]=(tRect.height>=32)?1:tRect.height/tempLimit;uv[6]=0;uv[7]=(tRect.height>=32)?1:tRect.height/tempLimit;tRect.width=(tRect.width>=32)?tRect.width:tempLimit;tRect.height=(tRect.height>=32)?tRect.height:tempLimit;uv[1]*=-1;uv[3]*=-1;uv[5]*=-1;uv[7]*=-1;uv[1]+=1;uv[3]+=1;uv[5]+=1;uv[7]+=1;}
(context.ctx).drawTarget(scope,x+tRect.x-tf.translateX,y+tRect.y-tf.translateY,w,h,Matrix.TEMP,"tmpTarget",shaderValue,uv,6);submitCMD=SubmitCMD.create([scope],laya.webgl.utils.RenderSprite3D.recycleTarget);context.addRenderObject(submitCMD);submitStencil=SubmitStencil.create(6);submitStencil.blendMode=preBlendMode;context.addRenderObject(submitStencil);}
context.ctx.restore();}
else{next._fun.call(next,sprite,context,x,y);}}
__proto._blend=function(sprite,context,x,y){var style=sprite._style;var next=this._next;if(style.blendMode){context.ctx.save();context.ctx.globalCompositeOperation=style.blendMode;next._fun.call(next,sprite,context,x,y);context.ctx.restore();}
else{next._fun.call(next,sprite,context,x,y);}}
__proto._transform=function(sprite,context,x,y){'use strict';var transform=sprite.transform,_next=this._next;if(transform&&_next!=RenderSprite.NORENDER){var ctx=context.ctx;var style=sprite._style;transform.tx=x;transform.ty=y;var m2=ctx._getTransformMatrix();var m1=m2.clone();Matrix.mul(transform,m2,m2);m2._checkTransform();transform.tx=transform.ty=0;_next._fun.call(_next,sprite,context,0,0);m1.copyTo(m2);m1.destroy();}else{_next._fun.call(_next,sprite,context,x,y);}}
RenderSprite3D.tmpTarget=function(scope,context){var b=scope.getValue("bounds");var tmpTarget=RenderTarget2D.create(b.width,b.height);tmpTarget.start();tmpTarget.clear(0,0,0,0);scope.addValue("tmpTarget",tmpTarget);}
RenderSprite3D.endTmpTarget=function(scope){var tmpTarget=scope.getValue("tmpTarget");tmpTarget.end();}
RenderSprite3D.recycleTarget=function(scope){var tmpTarget=scope.getValue("tmpTarget");tmpTarget.recycle();scope.recycle();}
__static(RenderSprite3D,['tempUV',function(){return this.tempUV=new Array(8);}]);return RenderSprite3D;})(RenderSprite)
var ColorFilterActionGL=(function(_super){function ColorFilterActionGL(){this.data=null;ColorFilterActionGL.__super.call(this);}
__class(ColorFilterActionGL,'laya.filters.webgl.ColorFilterActionGL',_super);var __proto=ColorFilterActionGL.prototype;Laya.imps(__proto,{"laya.filters.IFilterActionGL":true})
__proto.setValue=function(shader){shader.colorMat=this.data._mat;shader.colorAlpha=this.data._alpha;}
__proto.apply3d=function(scope,sprite,context,x,y){var b=scope.getValue("bounds");var shaderValue=Value2D.create(0x01,0);shaderValue.setFilters([this.data]);var tMatrix=Matrix.TEMP;tMatrix.identity();context.ctx.drawTarget(scope,0,0,b.width,b.height,tMatrix,"src",shaderValue);}
return ColorFilterActionGL;})(FilterActionGL)
var Atlaser=(function(_super){function Atlaser(gridNumX,gridNumY,width,height,atlasID){this._atlasCanvas=null;this._inAtlasTextureKey=null;this._inAtlasTextureBitmapValue=null;this._inAtlasTextureOriUVValue=null;this._InAtlasWebGLImagesKey=null;this._InAtlasWebGLImagesOffsetValue=null;Atlaser.__super.call(this,gridNumX,gridNumY,atlasID);this._inAtlasTextureKey=[];this._inAtlasTextureBitmapValue=[];this._inAtlasTextureOriUVValue=[];this._InAtlasWebGLImagesKey={};this._InAtlasWebGLImagesOffsetValue=[];this._atlasCanvas=new AtlasWebGLCanvas();this._atlasCanvas._atlaser=this;this._atlasCanvas.width=width;this._atlasCanvas.height=height;this._atlasCanvas.activeResource();this._atlasCanvas.lock=true;}
__class(Atlaser,'laya.webgl.atlas.Atlaser',_super);var __proto=Atlaser.prototype;__proto.computeUVinAtlasTexture=function(texture,oriUV,offsetX,offsetY){var tex=texture;var _width=AtlasResourceManager.atlasTextureWidth;var _height=AtlasResourceManager.atlasTextureHeight;var u1=offsetX/_width,v1=offsetY/_height,u2=(offsetX+texture.bitmap.width)/_width,v2=(offsetY+texture.bitmap.height)/_height;var inAltasUVWidth=texture.bitmap.width/_width,inAltasUVHeight=texture.bitmap.height/_height;texture.uv=[u1+oriUV[0]*inAltasUVWidth,v1+oriUV[1]*inAltasUVHeight,u2-(1-oriUV[2])*inAltasUVWidth,v1+oriUV[3]*inAltasUVHeight,u2-(1-oriUV[4])*inAltasUVWidth,v2-(1-oriUV[5])*inAltasUVHeight,u1+oriUV[6]*inAltasUVWidth,v2-(1-oriUV[7])*inAltasUVHeight];}
__proto.findBitmapIsExist=function(bitmap){if((bitmap instanceof laya.webgl.resource.WebGLImage)){var webImage=bitmap;var sUrl=webImage.url;var object=this._InAtlasWebGLImagesKey[sUrl?sUrl:webImage.id]
if(object){return object.offsetInfoID;}}
return-1;}
__proto.addToAtlasTexture=function(mergeAtlasBitmap,offsetX,offsetY){if((mergeAtlasBitmap instanceof laya.webgl.resource.WebGLImage)){var webImage=mergeAtlasBitmap;var sUrl=webImage.url;this._InAtlasWebGLImagesKey[sUrl?sUrl:webImage.id]={bitmap:mergeAtlasBitmap,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length};this._InAtlasWebGLImagesOffsetValue.push([offsetX,offsetY]);}
this._atlasCanvas.texSubImage2D(offsetX,offsetY,mergeAtlasBitmap.atlasSource);mergeAtlasBitmap.clearAtlasSource();}
__proto.addToAtlas=function(texture,offsetX,offsetY){texture._atlasID=this._inAtlasTextureKey.length;var oriUV=texture.uv.slice();var oriBitmap=texture.bitmap;this._inAtlasTextureKey.push(texture);this._inAtlasTextureOriUVValue.push(oriUV);this._inAtlasTextureBitmapValue.push(oriBitmap);this.computeUVinAtlasTexture(texture,oriUV,offsetX,offsetY);texture.bitmap=this._atlasCanvas;}
__proto.clear=function(){for(var i=0,n=this._inAtlasTextureKey.length;i<n;i++){this._inAtlasTextureKey[i].bitmap=this._inAtlasTextureBitmapValue[i];this._inAtlasTextureKey[i].uv=this._inAtlasTextureOriUVValue[i];this._inAtlasTextureKey[i]._atlasID=-1;this._inAtlasTextureKey[i].bitmap.lock=false;this._inAtlasTextureKey[i].bitmap.releaseResource();}
this._inAtlasTextureKey.length=0;this._inAtlasTextureBitmapValue.length=0;this._inAtlasTextureOriUVValue.length=0;this._InAtlasWebGLImagesKey=null;this._InAtlasWebGLImagesOffsetValue.length=0;}
__proto.dispose=function(){this.clear();this._atlasCanvas.destroy();}
__getset(0,__proto,'InAtlasWebGLImagesOffsetValue',function(){return this._InAtlasWebGLImagesOffsetValue;});__getset(0,__proto,'texture',function(){return this._atlasCanvas;});__getset(0,__proto,'inAtlasWebGLImagesKey',function(){return this._InAtlasWebGLImagesKey;});return Atlaser;})(AtlasGrid)
var ShaderDefines2D=(function(_super){function ShaderDefines2D(){ShaderDefines2D.__super.call(this,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name,ShaderDefines2D.__int2nameMap);}
__class(ShaderDefines2D,'laya.webgl.shader.d2.ShaderDefines2D',_super);ShaderDefines2D.__init__=function(){ShaderDefines2D.reg("TEXTURE2D",0x01);ShaderDefines2D.reg("COLOR2D",0x02);ShaderDefines2D.reg("PRIMITIVE",0x04);ShaderDefines2D.reg("GLOW_FILTER",0x08);ShaderDefines2D.reg("BLUR_FILTER",0x10);ShaderDefines2D.reg("COLOR_FILTER",0x20);ShaderDefines2D.reg("COLOR_ADD",0x40);ShaderDefines2D.reg("WORLDMAT",0x80);ShaderDefines2D.reg("FILLTEXTURE",0x100);ShaderDefines2D.reg("FSHIGHPRECISION",0x400);}
ShaderDefines2D.reg=function(name,value){ShaderDefines._reg(name,value,ShaderDefines2D.__name2int,ShaderDefines2D.__int2name);}
ShaderDefines2D.toText=function(value,int2name,int2nameMap){return ShaderDefines._toText(value,int2name,int2nameMap);}
ShaderDefines2D.toInt=function(names){return ShaderDefines._toInt(names,ShaderDefines2D.__name2int);}
ShaderDefines2D.TEXTURE2D=0x01;ShaderDefines2D.COLOR2D=0x02;ShaderDefines2D.PRIMITIVE=0x04;ShaderDefines2D.FILTERGLOW=0x08;ShaderDefines2D.FILTERBLUR=0x10;ShaderDefines2D.FILTERCOLOR=0x20;ShaderDefines2D.COLORADD=0x40;ShaderDefines2D.WORLDMAT=0x80;ShaderDefines2D.FILLTEXTURE=0x100;ShaderDefines2D.SKINMESH=0x200;ShaderDefines2D.SHADERDEFINE_FSHIGHPRECISION=0x400;ShaderDefines2D.__name2int={};ShaderDefines2D.__int2name=[];ShaderDefines2D.__int2nameMap=[];return ShaderDefines2D;})(ShaderDefines)
var Ellipse=(function(_super){function Ellipse(x,y,width,height,color,borderWidth,borderColor){Ellipse.__super.call(this,x,y,width,height,40,color,borderWidth,borderColor);}
__class(Ellipse,'laya.webgl.shapes.Ellipse',_super);return Ellipse;})(BasePoly)
var Line=(function(_super){function Line(x,y,points,borderWidth,color){this._points=[];this.rebuild(points);Line.__super.call(this,x,y,0,0,0,color,borderWidth,color,0);}
__class(Line,'laya.webgl.shapes.Line',_super);var __proto=Line.prototype;__proto.rebuild=function(points){var len=points.length;var preLen=this._points.length;if(len!=preLen){this.mUint16Array=new Uint16Array((len/2-1)*6);this.mFloat32Array=new Float32Array(len*5);}
this._points.length=0;var tCurrX=NaN;var tCurrY=NaN;var tLastX=-1;var tLastY=-1;var tLen=points.length/2;for(var i=0;i<tLen;i++){tCurrX=points[i*2];tCurrY=points[i*2+1];if(Math.abs(tLastX-tCurrX)>0.01||Math.abs(tLastY-tCurrY)>0.01){this._points.push(tCurrX,tCurrY);}
tLastX=tCurrX;tLastY=tCurrY;}}
__proto.getData=function(ib,vb,start){var indices=[];var verts=[];(this.borderWidth>0)&&this.createLine2(this._points,indices,this.borderWidth,start,verts,this._points.length/2);this.mUint16Array.set(indices,0);this.mFloat32Array.set(verts,0);ib.append(this.mUint16Array);vb.append(this.mFloat32Array);}
return Line;})(BasePoly)
var LoopLine=(function(_super){function LoopLine(x,y,points,width,color){this._points=[];var tCurrX=NaN;var tCurrY=NaN;var tLastX=-1;var tLastY=-1;var tLen=points.length/2-1;for(var i=0;i<tLen;i++){tCurrX=points[i*2];tCurrY=points[i*2+1];if(Math.abs(tLastX-tCurrX)>0.01||Math.abs(tLastY-tCurrY)>0.01){this._points.push(tCurrX,tCurrY);}
tLastX=tCurrX;tLastY=tCurrY;}
tCurrX=points[tLen*2];tCurrY=points[tLen*2+1];tLastX=this._points[0];tLastY=this._points[1];if(Math.abs(tLastX-tCurrX)>0.01||Math.abs(tLastY-tCurrY)>0.01){this._points.push(tCurrX,tCurrY);}
LoopLine.__super.call(this,x,y,0,0,this._points.length/2,0,width,color);}
__class(LoopLine,'laya.webgl.shapes.LoopLine',_super);var __proto=LoopLine.prototype;__proto.getData=function(ib,vb,start){if(this.borderWidth>0){var color=this.color;var r=((color>>16)&0x0000ff)/255,g=((color>>8)&0xff)/255,b=(color&0x0000ff)/255;var verts=[];var tLastX=-1,tLastY=-1;var tCurrX=0,tCurrY=0;var indices=[];var tLen=Math.floor(this._points.length/2);for(var i=0;i<tLen;i++){tCurrX=this._points[i*2];tCurrY=this._points[i*2+1];verts.push(this.x+tCurrX,this.y+tCurrY,r,g,b);}
this.createLoopLine(verts,indices,this.borderWidth,start+verts.length/5);ib.append(new Uint16Array(indices));vb.append(new Float32Array(verts));}}
__proto.createLoopLine=function(p,indices,lineWidth,len,outVertex,outIndex){var tLen=p.length/5;var points=p.concat();var result=outVertex?outVertex:p;var color=this.borderColor;var r=((color>>16)&0x0000ff)/255,g=((color>>8)&0xff)/255,b=(color&0x0000ff)/255;var firstPoint=[points[0],points[1]];var lastPoint=[points[points.length-5],points[points.length-4]];var midPointX=lastPoint[0]+(firstPoint[0]-lastPoint[0])*0.5;var midPointY=lastPoint[1]+(firstPoint[1]-lastPoint[1])*0.5;points.unshift(midPointX,midPointY,0,0,0);points.push(midPointX,midPointY,0,0,0);var length=points.length/5;var iStart=len,w=lineWidth/2;var px,py,p1x,p1y,p2x,p2y,p3x,p3y;var perpx,perpy,perp2x,perp2y,perp3x,perp3y;var a1,b1,c1,a2,b2,c2;var denom,pdist,dist;p1x=points[0];p1y=points[1];p2x=points[5];p2y=points[6];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;result.push(p1x-perpx,p1y-perpy,r,g,b,p1x+perpx,p1y+perpy,r,g,b);for(var i=1;i<length-1;i++){p1x=points[(i-1)*5];p1y=points[(i-1)*5+1];p2x=points[(i)*5];p2y=points[(i)*5+1];p3x=points[(i+1)*5];p3y=points[(i+1)*5+1];perpx=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(perpx*perpx+perpy*perpy);perpx=perpx/dist*w;perpy=perpy/dist*w;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x=perp2x/dist*w;perp2y=perp2y/dist*w;a1=(-perpy+p1y)-(-perpy+p2y);b1=(-perpx+p2x)-(-perpx+p1x);c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y);a2=(-perp2y+p3y)-(-perp2y+p2y);b2=(-perp2x+p2x)-(-perp2x+p3x);c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);denom=a1*b2-a2*b1;if(Math.abs(denom)<0.1){denom+=10.1;result.push(p2x-perpx,p2y-perpy,r,g,b,p2x+perpx,p2y+perpy,r,g,b);continue;}
px=(b1*c2-b2*c1)/denom;py=(a2*c1-a1*c2)/denom;pdist=(px-p2x)*(px-p2x)+(py-p2y)+(py-p2y);result.push(px,py,r,g,b,p2x-(px-p2x),p2y-(py-p2y),r,g,b);}
if(outIndex){indices=outIndex;};var groupLen=this.edges+1;for(i=1;i<groupLen;i++){indices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+i*2+1,iStart+i*2+1,iStart+i*2,iStart+(i-1)*2);}
indices.push(iStart+(i-1)*2,iStart+(i-1)*2+1,iStart+1,iStart+1,iStart,iStart+(i-1)*2);return result;}
return LoopLine;})(BasePoly)
var Polygon=(function(_super){function Polygon(x,y,points,color,borderWidth,borderColor){this._points=null;this._start=-1;this._repaint=false;this.earcutTriangles=null;this._mat=Matrix.create();this._points=points.slice(0,points.length);Polygon.__super.call(this,x,y,0,0,this._points.length/2,color,borderWidth,borderColor);}
__class(Polygon,'laya.webgl.shapes.Polygon',_super);var __proto=Polygon.prototype;__proto.rebuild=function(point){if(!this._repaint){this._points.length=0;this._points=this._points.concat(point);}}
__proto.setMatrix=function(mat){mat.copyTo(this._mat);}
__proto.needUpdate=function(mat){this._repaint=(this._mat.a==mat.a&&this._mat.b==mat.b&&this._mat.c==mat.c&&this._mat.d==mat.d&&this._mat.tx==mat.tx&&this._mat.ty==mat.ty);return!this._repaint;}
__proto.getData=function(ib,vb,start){var indices,i=0;var tArray=this._points;var tLen=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=start){this._start=start;indices=[];tLen=this.earcutTriangles.length;for(i=0;i<tLen;i++){indices.push(this.earcutTriangles[i]+start);}
this.mUint16Array=new Uint16Array(indices);}}
else{this._start=start;indices=[];var verts=[];var vertsEarcut=[];var color=this.color;var r=((color>>16)&0x0000ff)/255,g=((color>>8)&0xff)/255,b=(color&0x0000ff)/255;tLen=Math.floor(tArray.length/2);for(i=0;i<tLen;i++){verts.push(this.x+tArray[i*2],this.y+tArray[i*2+1],r,g,b);vertsEarcut.push(this.x+tArray[i*2],this.y+tArray[i*2+1]);}
this.earcutTriangles=Earcut.earcut(vertsEarcut,null,2);tLen=this.earcutTriangles.length;for(i=0;i<tLen;i++){indices.push(this.earcutTriangles[i]+start);}
this.mUint16Array=new Uint16Array(indices);this.mFloat32Array=new Float32Array(verts);}
ib.append(this.mUint16Array);vb.append(this.mFloat32Array);}
return Polygon;})(BasePoly)
var SubmitCanvas=(function(_super){function SubmitCanvas(){this._matrix=new Matrix();this._matrix4=CONST3D2D.defaultMatrix4.concat();SubmitCanvas.__super.call(this,10000);this.shaderValue=new Value2D(0,0);}
__class(SubmitCanvas,'laya.webgl.submit.SubmitCanvas',_super);var __proto=SubmitCanvas.prototype;__proto.renderSubmit=function(){if(this._ctx_src._targets){this._ctx_src._targets.flush(this._ctx_src);return 1;};var preAlpha=RenderState2D.worldAlpha;var preMatrix4=RenderState2D.worldMatrix4;var preMatrix=RenderState2D.worldMatrix;var preFilters=RenderState2D.worldFilters;var preWorldShaderDefines=RenderState2D.worldShaderDefines;var v=this.shaderValue;var m=this._matrix;var m4=this._matrix4;var mout=Matrix.TEMP;Matrix.mul(m,preMatrix,mout);m4[0]=mout.a;m4[1]=mout.b;m4[4]=mout.c;m4[5]=mout.d;m4[12]=mout.tx;m4[13]=mout.ty;RenderState2D.worldMatrix=mout.clone();RenderState2D.worldMatrix4=m4;RenderState2D.worldAlpha=RenderState2D.worldAlpha*v.alpha;if(v.filters&&v.filters.length){RenderState2D.worldFilters=v.filters;RenderState2D.worldShaderDefines=v.defines;}
this._ctx_src.flush();RenderState2D.worldAlpha=preAlpha;RenderState2D.worldMatrix4=preMatrix4;RenderState2D.worldMatrix.destroy();RenderState2D.worldMatrix=preMatrix;RenderState2D.worldFilters=preFilters;RenderState2D.worldShaderDefines=preWorldShaderDefines;return 1;}
__proto.releaseRender=function(){var cache=SubmitCanvas._cache;this._ctx_src=null;cache[cache._length++]=this;}
__proto.getRenderType=function(){return 10003;}
SubmitCanvas.create=function(ctx_src,alpha,filters){var o=(!SubmitCanvas._cache._length)?(new SubmitCanvas()):SubmitCanvas._cache[--SubmitCanvas._cache._length];o._ctx_src=ctx_src;var v=o.shaderValue;v.alpha=alpha;v.defines.setValue(0);filters&&filters.length&&v.setFilters(filters);return o;}
SubmitCanvas._cache=(SubmitCanvas._cache=[],SubmitCanvas._cache._length=0,SubmitCanvas._cache);return SubmitCanvas;})(Submit)
var SubmitTexture=(function(_super){function SubmitTexture(renderType){this._preIsSameTextureShader=false;this._isSameTexture=true;this._texs=new Array;this._texsID=new Array;this._vbPos=new Array;(renderType===void 0)&&(renderType=10000);SubmitTexture.__super.call(this,renderType);}
__class(SubmitTexture,'laya.webgl.submit.SubmitTexture',_super);var __proto=SubmitTexture.prototype;__proto.releaseRender=function(){var cache=SubmitTexture._cache;cache[cache._length++]=this;this.shaderValue.release();this._preIsSameTextureShader=false;this._vb=null;this._texs.length=0;this._vbPos.length=0;this._isSameTexture=true;}
__proto.addTexture=function(tex,vbpos){this._texsID[this._texs.length]=tex._uvID;this._texs.push(tex);this._vbPos.push(vbpos);}
__proto.checkTexture=function(){if(this._texs.length<1){this._isSameTexture=true;return;};var _tex=this.shaderValue.textureHost;var webGLImg=_tex.bitmap;if(webGLImg===null)return;var vbdata=this._vb.getFloat32Array();for(var i=0,s=this._texs.length;i<s;i++){var tex=this._texs[i];tex.active();var newUV=tex.uv;if(this._texsID[i]!==tex._uvID){this._texsID[i]=tex._uvID;var vbPos=this._vbPos[i];vbdata[vbPos+2]=newUV[0];vbdata[vbPos+3]=newUV[1];vbdata[vbPos+6]=newUV[2];vbdata[vbPos+7]=newUV[3];vbdata[vbPos+10]=newUV[4];vbdata[vbPos+11]=newUV[5];vbdata[vbPos+14]=newUV[6];vbdata[vbPos+15]=newUV[7];this._vb.setNeedUpload();}
if(tex.bitmap!==webGLImg){this._isSameTexture=false;}}}
__proto.renderSubmit=function(){if(this._numEle===0){SubmitTexture._shaderSet=false;return 1;};var _tex=this.shaderValue.textureHost;if(_tex){var source=_tex.source;if(!_tex.bitmap||!source){SubmitTexture._shaderSet=false;return 1;}
this.shaderValue.texture=source;}
this._vb.bind_upload(this._ib);var gl=WebGL.mainContext;if(BlendMode.activeBlendFunction!==this._blendFn){gl.enable(0x0BE2);this._blendFn(gl);BlendMode.activeBlendFunction=this._blendFn;}
Stat.drawCall++;Stat.trianglesFaces+=this._numEle/3;if(this._preIsSameTextureShader&&BaseShader.activeShader&&SubmitTexture._shaderSet)
(BaseShader.activeShader).uploadTexture2D(this.shaderValue.texture);else this.shaderValue.upload();SubmitTexture._shaderSet=true;if(this._texs.length>1&&!this._isSameTexture){var webGLImg=_tex.bitmap;var index=0;var shader=BaseShader.activeShader;for(var i=0,s=this._texs.length;i<s;i++){var tex2=this._texs[i];if(tex2.bitmap!==webGLImg||(i+1)===s){shader.uploadTexture2D(tex2.source);gl.drawElements(0x0004,(i-index+1)*6,0x1403,this._startIdx+index*6*CONST3D2D.BYTES_PIDX);webGLImg=tex2.bitmap;index=i;}}}else{gl.drawElements(0x0004,this._numEle,0x1403,this._startIdx);}
return 1;}
SubmitTexture.create=function(context,ib,vb,pos,sv){var o=SubmitTexture._cache._length?SubmitTexture._cache[--SubmitTexture._cache._length]:new SubmitTexture();if(vb==null){vb=o._selfVb||(o._selfVb=VertexBuffer2D.create(-1));vb.clear();pos=0;}
o._ib=ib;o._vb=vb;o._startIdx=pos*CONST3D2D.BYTES_PIDX;o._numEle=0;var blendType=context._nBlendType;o._blendFn=context._targets?BlendMode.targetFns[blendType]:BlendMode.fns[blendType];o.shaderValue=sv;o.shaderValue.setValue(context._shader2D);var filters=context._shader2D.filters;filters&&o.shaderValue.setFilters(filters);return o;}
SubmitTexture._cache=(SubmitTexture._cache=[],SubmitTexture._cache._length=0,SubmitTexture._cache);SubmitTexture._shaderSet=true;return SubmitTexture;})(Submit)
var MeshTexture=(function(_super){function MeshTexture(){MeshTexture.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0);this.canReuse=true;this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo);}
__class(MeshTexture,'laya.webgl.utils.MeshTexture',_super);var __proto=MeshTexture.prototype;__proto.addData=function(vertices,uvs,idx,matrix,rgba,ctx){var sz=vertices.length/2;var startpos=this._vb.needSize(sz*MeshTexture.const_stride);var f32pos=startpos>>2;var vbdata=this._vb.getFloat32Array();var ci=0;for(var i=0;i<sz;i++){var x=vertices[ci],y=vertices[ci+1];var x1=x*matrix.a+y*matrix.c+matrix.tx;var y1=x*matrix.b+y*matrix.d+matrix.ty;vbdata[f32pos++]=x1;vbdata[f32pos++]=y1;vbdata[f32pos++]=uvs[ci];vbdata[f32pos++]=uvs[ci+1];ci+=2;}
this._vb.setNeedUpload();var vertN=this.vertNum;if(vertN>0){sz=idx.length;if(sz>MeshTexture.tmpIdx.length)MeshTexture.tmpIdx=new Uint16Array(sz);for(var ii=0;ii<sz;ii++){MeshTexture.tmpIdx[ii]=idx[ii]+vertN;}
this._ib.appendU16Array(MeshTexture.tmpIdx,idx.length);}else{this._ib.append(idx);}
this._ib.setNeedUpload();this.vertNum+=sz;this.indexNum+=idx.length;}
__proto.releaseMesh=function(){this._vb._byteLength=0;this._ib._byteLength=0;this.vertNum=0;this.indexNum=0;laya.webgl.utils.MeshTexture._POOL.push(this);}
__proto.destroy=function(){this._ib.destroy();this._vb.destroy();}
MeshTexture.getAMesh=function(){if(laya.webgl.utils.MeshTexture._POOL.length){return laya.webgl.utils.MeshTexture._POOL.pop();}
return new MeshTexture();}
MeshTexture.const_stride=16;MeshTexture._POOL=[];__static(MeshTexture,['_fixattriInfo',function(){return this._fixattriInfo=[0x1406,2,0,0x1406,2,8];},'tmpIdx',function(){return this.tmpIdx=new Uint16Array(4);}]);return MeshTexture;})(Mesh2D)
var BaseShader=(function(_super){function BaseShader(){BaseShader.__super.call(this);this.lock=true;}
__class(BaseShader,'laya.webgl.shader.BaseShader',_super);BaseShader.activeShader=null;BaseShader.bindShader=null;return BaseShader;})(Resource)
var RenderTarget2D=(function(_super){function RenderTarget2D(width,height,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){this._type=0;this._svWidth=NaN;this._svHeight=NaN;this._preRenderTarget=null;this._alreadyResolved=false;this._looked=false;this._surfaceFormat=0;this._surfaceType=0;this._depthStencilFormat=0;this._mipMap=false;this._repeat=false;this._minFifter=0;this._magFifter=0;this._destroy=false;(surfaceFormat===void 0)&&(surfaceFormat=0x1908);(surfaceType===void 0)&&(surfaceType=0x1401);(depthStencilFormat===void 0)&&(depthStencilFormat=0x84F9);(mipMap===void 0)&&(mipMap=false);(repeat===void 0)&&(repeat=false);(minFifter===void 0)&&(minFifter=-1);(magFifter===void 0)&&(magFifter=-1);this._type=1;this._w=width;this._h=height;this._surfaceFormat=surfaceFormat;this._surfaceType=surfaceType;this._depthStencilFormat=depthStencilFormat;this._mipMap=mipMap;this._repeat=repeat;this._minFifter=minFifter;this._magFifter=magFifter;this._createWebGLRenderTarget();this.bitmap.lock=true;RenderTarget2D.__super.call(this,this.bitmap,Texture.INV_UV);}
__class(RenderTarget2D,'laya.webgl.resource.RenderTarget2D',_super);var __proto=RenderTarget2D.prototype;Laya.imps(__proto,{"laya.resource.IDispose":true})
__proto.getType=function(){return this._type;}
__proto.getTexture=function(){return this;}
__proto.size=function(w,h){if(this._w==w&&this._h==h)return;this._w=w;this._h=h;this.release();if(this._w!=0&&this._h!=0)this._createWebGLRenderTarget();}
__proto.release=function(){this.destroy();}
__proto.recycle=function(){RenderTarget2D.POOL.push(this);}
__proto.start=function(){var gl=WebGL.mainContext;this._preRenderTarget=RenderState2D.curRenderTarget;RenderState2D.curRenderTarget=this;gl.bindFramebuffer(0x8D40,this.bitmap.frameBuffer);this._alreadyResolved=false;if(this._type==1){gl.viewport(0,0,this._w,this._h);this._svWidth=RenderState2D.width;this._svHeight=RenderState2D.height;RenderState2D.width=this._w;RenderState2D.height=this._h;BaseShader.activeShader=null;}
return this;}
__proto.clear=function(r,g,b,a){(r===void 0)&&(r=0.0);(g===void 0)&&(g=0.0);(b===void 0)&&(b=0.0);(a===void 0)&&(a=1.0);var gl=WebGL.mainContext;gl.clearColor(r,g,b,a);var clearFlag=0x00004000;switch(this._depthStencilFormat){case 0x81A5:clearFlag|=0x00000100;break;case 0x8D48:clearFlag|=0x00000400;break;case 0x84F9:clearFlag|=0x00000100;clearFlag|=0x00000400
break;}
gl.clear(clearFlag);}
__proto.end=function(){var gl=WebGL.mainContext;gl.bindFramebuffer(0x8D40,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null);this._alreadyResolved=true;RenderState2D.curRenderTarget=this._preRenderTarget;if(this._type==1){gl.viewport(0,0,this._svWidth,this._svHeight);RenderState2D.width=this._svWidth;RenderState2D.height=this._svHeight;BaseShader.activeShader=null;}else gl.viewport(0,0,Laya.stage.width,Laya.stage.height);}
__proto.getData=function(x,y,width,height){var gl=WebGL.mainContext;gl.bindFramebuffer(0x8D40,(this.bitmap).frameBuffer);var canRead=(gl.checkFramebufferStatus(0x8D40)===0x8CD5);if(!canRead){gl.bindFramebuffer(0x8D40,null);return null;};var pixels=new Uint8Array(this._w*this._h*4);gl.readPixels(x,y,width,height,this._surfaceFormat,this._surfaceType,pixels);gl.bindFramebuffer(0x8D40,null);return pixels;}
__proto.destroy=function(foreDiposeTexture){(foreDiposeTexture===void 0)&&(foreDiposeTexture=false);if(!this._destroy){this._loaded=false;this.bitmap.offAll();this.bitmap.disposeResource();this.bitmap.dispose();this.offAll();this.bitmap=null;this._alreadyResolved=false;this._destroy=true;_super.prototype.destroy.call(this);}}
__proto.dispose=function(){}
__proto._createWebGLRenderTarget=function(){this.bitmap=new WebGLRenderTarget(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter);this.bitmap.activeResource();this._alreadyResolved=true;this._destroy=false;this._loaded=true;this.bitmap.on("recovered",this,function(e){this.event("recovered");})}
__getset(0,__proto,'surfaceFormat',function(){return this._surfaceFormat;});__getset(0,__proto,'magFifter',function(){return this._magFifter;});__getset(0,__proto,'surfaceType',function(){return this._surfaceType;});__getset(0,__proto,'mipMap',function(){return this._mipMap;});__getset(0,__proto,'depthStencilFormat',function(){return this._depthStencilFormat;});__getset(0,__proto,'minFifter',function(){return this._minFifter;});__getset(0,__proto,'source',function(){if(this._alreadyResolved)
return Laya.superGet(Texture,this,'source');return null;});RenderTarget2D.create=function(w,h,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){(surfaceFormat===void 0)&&(surfaceFormat=0x1908);(surfaceType===void 0)&&(surfaceType=0x1401);(depthStencilFormat===void 0)&&(depthStencilFormat=0x84F9);(mipMap===void 0)&&(mipMap=false);(repeat===void 0)&&(repeat=false);(minFifter===void 0)&&(minFifter=-1);(magFifter===void 0)&&(magFifter=-1);var t=RenderTarget2D.POOL.pop();t||(t=new RenderTarget2D(w,h));if(!t.bitmap||t._w!=w||t._h!=h||t._surfaceFormat!=surfaceFormat||t._surfaceType!=surfaceType||t._depthStencilFormat!=depthStencilFormat||t._mipMap!=mipMap||t._repeat!=repeat||t._minFifter!=minFifter||t._magFifter!=magFifter){t._w=w;t._h=h;t._surfaceFormat=surfaceFormat;t._surfaceType=surfaceType;t._depthStencilFormat=depthStencilFormat;t._mipMap=mipMap;t._repeat=repeat;t._minFifter=minFifter;t._magFifter=magFifter;t.release();t._createWebGLRenderTarget();}
return t;}
RenderTarget2D.TYPE2D=1;RenderTarget2D.TYPE3D=2;RenderTarget2D.POOL=[];return RenderTarget2D;})(Texture)
var Buffer=(function(_super){function Buffer(){this._glBuffer=null;this._buffer=null;this._bufferType=0;this._bufferUsage=0;this._byteLength=0;Buffer.__super.call(this);Buffer._gl=WebGL.mainContext;}
__class(Buffer,'laya.webgl.utils.Buffer',_super);var __proto=Buffer.prototype;__proto._bind=function(){this.activeResource();if(Buffer._bindActive[this._bufferType]!==this._glBuffer){(this._bufferType===0x8892)&&(Buffer._bindVertexBuffer=this._glBuffer);Buffer._gl.bindBuffer(this._bufferType,Buffer._bindActive[this._bufferType]=this._glBuffer);BaseShader.activeShader=null;}}
__proto.recreateResource=function(){this._glBuffer||(this._glBuffer=Buffer._gl.createBuffer());this.completeCreate();}
__proto.disposeResource=function(){if(this._glBuffer){WebGL.mainContext.deleteBuffer(this._glBuffer);this._glBuffer=null;}
this.memorySize=0;}
__getset(0,__proto,'bufferUsage',function(){return this._bufferUsage;});Buffer._gl=null;Buffer._bindActive={};Buffer._bindVertexBuffer=null;Buffer._enableAtributes=[];return Buffer;})(Resource)
var SkinSV=(function(_super){function SkinSV(type){this.texcoord=null;this.offsetX=300;this.offsetY=0;SkinSV.__super.call(this,0x200,0);var _vlen=8*CONST3D2D.BYTES_PE;this.position=[2,0x1406,false,_vlen,0];this.texcoord=[2,0x1406,false,_vlen,2*CONST3D2D.BYTES_PE];this.color=[4,0x1406,false,_vlen,4*CONST3D2D.BYTES_PE];}
__class(SkinSV,'laya.webgl.shader.d2.skinAnishader.SkinSV',_super);return SkinSV;})(Value2D)
var Color2dSV=(function(_super){function Color2dSV(args){Color2dSV.__super.call(this,0x02,0);this.color=[];}
__class(Color2dSV,'laya.webgl.shader.d2.value.Color2dSV',_super);var __proto=Color2dSV.prototype;__proto.setValue=function(value){value.fillStyle&&(this.color=value.fillStyle._color._color);value.strokeStyle&&(this.color=value.strokeStyle._color._color);}
return Color2dSV;})(Value2D)
var FillTextureSV=(function(_super){function FillTextureSV(type){this.u_colorMatrix=null;this.strength=0;this.colorMat=null;this.colorAlpha=null;this.u_TexRange=[0,1,0,1];this.u_offset=[0,0];this.texcoord=Value2D._TEXCOORD;FillTextureSV.__super.call(this,0x100,0);}
__class(FillTextureSV,'laya.webgl.shader.d2.value.FillTextureSV',_super);var __proto=FillTextureSV.prototype;__proto.setValue=function(vo){this.ALPHA=vo.ALPHA;vo.filters&&this.setFilters(vo.filters);}
__proto.clear=function(){this.texture=null;this.shader=null;this.defines.setValue(0);}
return FillTextureSV;})(Value2D)
var TextureSV=(function(_super){function TextureSV(subID){this.u_colorMatrix=null;this.strength=0;this.blurInfo=null;this.colorMat=null;this.colorAlpha=null;this.texcoord=Value2D._TEXCOORD;(subID===void 0)&&(subID=0);TextureSV.__super.call(this,0x01,subID);}
__class(TextureSV,'laya.webgl.shader.d2.value.TextureSV',_super);var __proto=TextureSV.prototype;__proto.setValue=function(vo){this.ALPHA=vo.ALPHA;vo.filters&&this.setFilters(vo.filters);}
__proto.clear=function(){this.texture=null;this.shader=null;this.defines.setValue(0);}
return TextureSV;})(Value2D)
var PrimitiveSV=(function(_super){function PrimitiveSV(args){this.a_color=null;this.u_pos=[0,0];PrimitiveSV.__super.call(this,0x04,0);this.position=[2,0x1406,false,5*CONST3D2D.BYTES_PE,0];this.a_color=[3,0x1406,false,5*CONST3D2D.BYTES_PE,2*CONST3D2D.BYTES_PE];}
__class(PrimitiveSV,'laya.webgl.shader.d2.value.PrimitiveSV',_super);return PrimitiveSV;})(Value2D)
var AtlasWebGLCanvas=(function(_super){function AtlasWebGLCanvas(){this._atlaser=null;this._flashCacheImage=null;this._flashCacheImageNeedFlush=false;AtlasWebGLCanvas.__super.call(this);}
__class(AtlasWebGLCanvas,'laya.webgl.atlas.AtlasWebGLCanvas',_super);var __proto=AtlasWebGLCanvas.prototype;__proto.recreateResource=function(){var gl=WebGL.mainContext;var glTex=this._source=gl.createTexture();var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,glTex);gl.texImage2D(0x0DE1,0,0x1908,this._w,this._h,0,0x1908,0x1401,null);gl.texParameteri(0x0DE1,0x2801,0x2601);gl.texParameteri(0x0DE1,0x2800,0x2601);gl.texParameteri(0x0DE1,0x2802,0x812F);gl.texParameteri(0x0DE1,0x2803,0x812F);(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));this.memorySize=this._w*this._h*4;this.completeCreate();}
__proto.disposeResource=function(){if(this._source){WebGL.mainContext.deleteTexture(this._source);this._source=null;this.memorySize=0;}}
__proto.texSubImage2D=function(xoffset,yoffset,bitmap){if(!Render.isFlash){var gl=WebGL.mainContext;var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,this._source);gl.pixelStorei(0x9241,true);(xoffset-1>=0)&&(gl.texSubImage2D(0x0DE1,0,xoffset-1,yoffset,0x1908,0x1401,bitmap));(xoffset+1<=this._w)&&(gl.texSubImage2D(0x0DE1,0,xoffset+1,yoffset,0x1908,0x1401,bitmap));(yoffset-1>=0)&&(gl.texSubImage2D(0x0DE1,0,xoffset,yoffset-1,0x1908,0x1401,bitmap));(yoffset+1<=this._h)&&(gl.texSubImage2D(0x0DE1,0,xoffset,yoffset+1,0x1908,0x1401,bitmap));gl.texSubImage2D(0x0DE1,0,xoffset,yoffset,0x1908,0x1401,bitmap);gl.pixelStorei(0x9241,false);(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));}else{if(!this._flashCacheImage){this._flashCacheImage=HTMLImage.create("");this._flashCacheImage._image.createCanvas(this._w,this._h);};var bmData=bitmap.bitmapdata;this._flashCacheImage._image.copyPixels(bmData,0,0,bmData.width,bmData.height,xoffset,yoffset);(this._flashCacheImageNeedFlush)||(this._flashCacheImageNeedFlush=true);}}
__proto.texSubImage2DPixel=function(xoffset,yoffset,width,height,pixel){var gl=WebGL.mainContext;var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,this._source);var pixels=new Uint8Array(pixel.data);gl.pixelStorei(0x9241,true);gl.texSubImage2D(0x0DE1,0,xoffset,yoffset,width,height,0x1908,0x1401,pixels);gl.pixelStorei(0x9241,false);(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));}
__getset(0,__proto,'width',_super.prototype._$get_width,function(value){this._w=value;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){this._h=value;});return AtlasWebGLCanvas;})(Bitmap)
var WebGLCanvas=(function(_super){function WebGLCanvas(){this.flipY=true;this.premulAlpha=false;this.alwaysChange=false;WebGLCanvas.__super.call(this);}
__class(WebGLCanvas,'laya.webgl.resource.WebGLCanvas',_super);var __proto=WebGLCanvas.prototype;__proto.getCanvas=function(){return this._canvas;}
__proto.clear=function(){this._ctx&&this._ctx.clear();}
__proto.destroy=function(){this._ctx&&this._ctx.destroy();this._ctx=null;}
__proto._setContext=function(context){this._ctx=context;}
__proto.getContext=function(contextID,other){return this._ctx?this._ctx:(this._ctx=WebGLCanvas._createContext(this));}
__proto.size=function(w,h){if(this._w!=w||this._h!=h){this._w=w;this._h=h;this._ctx&&this._ctx.size(w,h);this._canvas&&(this._canvas.height=h,this._canvas.width=w);}}
__proto.activeResource=function(force){(force===void 0)&&(force=false);if(!this._source){this.recreateResource();}}
__proto.recreateResource=function(){this.createWebGlTexture();this.completeCreate();}
__proto.disposeResource=function(){if(this._source&&!this.iscpuSource){WebGL.mainContext.deleteTexture(this._source);this._source=null;this.memorySize=0;}}
__proto.createWebGlTexture=function(){var gl=WebGL.mainContext;if(!this._canvas){};var glTex=this._source=gl.createTexture();this.iscpuSource=false;var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,glTex);gl.pixelStorei(0x9240,this.flipY?1:0);this.premulAlpha&&gl.pixelStorei(0x9241,true);gl.texImage2D(0x0DE1,0,0x1908,0x1908,0x1401,this._imgData);this.premulAlpha&&gl.pixelStorei(0x9241,false);gl.texParameteri(0x0DE1,0x2800,0x2601);gl.texParameteri(0x0DE1,0x2801,0x2601);gl.texParameteri(0x0DE1,0x2802,0x812F);gl.texParameteri(0x0DE1,0x2803,0x812F);gl.pixelStorei(0x9240,0);this.memorySize=this._w*this._h*4;(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));}
__proto.reloadCanvasData=function(){var gl=WebGL.mainContext;if(!this._source){throw"reloadCanvasData error, gl texture not created!";};var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,this._source);this.premulAlpha&&gl.pixelStorei(0x9241,true);gl.texImage2D(0x0DE1,0,0x1908,0x1908,0x1401,this._imgData);this.premulAlpha&&gl.pixelStorei(0x9241,false);gl.pixelStorei(0x9240,0);(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));}
__proto.texSubImage2D=function(webglCanvas,xoffset,yoffset){var gl=WebGL.mainContext;var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,this._source);gl.pixelStorei(0x9241,true);gl.texSubImage2D(0x0DE1,0,xoffset,yoffset,0x1908,0x1401,webglCanvas._source);gl.pixelStorei(0x9241,false);(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));}
__proto.toBase64=function(type,encoderOptions,callBack){var base64Data=null;if(this._canvas){base64Data=this._canvas.toDataURL(type,encoderOptions);}
callBack.call(this,base64Data);}
__getset(0,__proto,'context',function(){return this._ctx;});__getset(0,__proto,'source',function(){if(this.alwaysChange)this.reloadCanvasData();return this._source;});__getset(0,__proto,'asBitmap',null,function(value){this._ctx&&(this._ctx.asBitmap=value);});WebGLCanvas._createContext=null;return WebGLCanvas;})(Bitmap)
var WebGLCharImage=(function(_super){function WebGLCharImage(content,drawValue){this.CborderSize=12;WebGLCharImage.__super.call(this);this.char=content;this.isSpace=content===' ';this.xs=drawValue.scaleX;this.ys=drawValue.scaleY;this.font=drawValue.font.toString();this.fontSize=drawValue.font.size;this.fillColor=drawValue.fillColor;this.borderColor=drawValue.borderColor;this.lineWidth=drawValue.lineWidth;this.underLine=drawValue.underLine;var bIsConchApp=Render.isConchApp;var pCanvas;if(bIsConchApp){pCanvas=ConchTextCanvas;pCanvas._source=ConchTextCanvas;pCanvas._source.canvas=ConchTextCanvas;}else{pCanvas=Browser.canvas.source;}
this.canvas=pCanvas;this._enableMerageInAtlas=true;if(bIsConchApp){this._ctx=pCanvas;}else{this._ctx=this.canvas.getContext('2d',undefined);};var t=Utils.measureText(this.char,this.font);this.cw=t.width*this.xs;this.ch=(t.height||this.fontSize)*this.ys;this.onresize(this.cw+this.CborderSize*2,this.ch+this.CborderSize*2);this.texture=new Texture(this);}
__class(WebGLCharImage,'laya.webgl.resource.WebGLCharImage',_super);var __proto=WebGLCharImage.prototype;Laya.imps(__proto,{"laya.webgl.resource.IMergeAtlasBitmap":true})
__proto.active=function(){this.texture.active();}
__proto.recreateResource=function(){var bIsConchApp=Render.isConchApp;this.onresize(this.cw+this.CborderSize*2,this.ch+this.CborderSize*2);this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w);if(bIsConchApp){var nFontSize=this.fontSize;if(this.xs!=1||this.ys!=1){nFontSize=parseInt(nFontSize*((this.xs>this.ys)?this.xs:this.ys)+"");};var sFont="normal 100 "+nFontSize+"px Arial";if(this.borderColor){sFont+=" 1 "+this.borderColor;}
this._ctx.font=sFont;this._ctx.textBaseline="top";this._ctx.fillStyle=this.fillColor;this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null);}else{this._ctx.save();(this._ctx).clearRect(0,0,this.cw+this.CborderSize*2,this.ch+this.CborderSize*2);this._ctx.font=this.font;if(Text.RightToLeft){this._ctx.textAlign="end";}
this._ctx.textBaseline="top";this._ctx.translate(this.CborderSize,this.CborderSize);if(this.xs!=1||this.ys!=1){this._ctx.scale(this.xs,this.ys);}
if(this.fillColor&&this.borderColor){this._ctx.strokeStyle=this.borderColor;this._ctx.lineWidth=this.lineWidth;this._ctx.strokeText(this.char,0,0,null,null,0,null);this._ctx.fillStyle=this.fillColor;this._ctx.fillText(this.char,0,0,null,null,null);}else{if(this.lineWidth===-1){this._ctx.fillStyle=this.fillColor?this.fillColor:"white";this._ctx.fillText(this.char,0,0,null,null,null);}else{this._ctx.strokeStyle=this.borderColor?this.borderColor:'white';this._ctx.lineWidth=this.lineWidth;this._ctx.strokeText(this.char,0,0,null,null,0,null);}}
if(this.underLine){this._ctx.lineWidth=1;this._ctx.strokeStyle=this.fillColor;this._ctx.beginPath();this._ctx.moveTo(0,this.fontSize+1);var nW=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(nW,this.fontSize+1);this._ctx.stroke();}
this._ctx.restore();}
this.borderSize=this.CborderSize;this.completeCreate();}
__proto.onresize=function(w,h){this._w=w;this._h=h;this._allowMerageInAtlas=true;}
__proto.clearAtlasSource=function(){}
__getset(0,__proto,'allowMerageInAtlas',function(){return this._allowMerageInAtlas;});__getset(0,__proto,'atlasSource',function(){return this.canvas;});__getset(0,__proto,'enableMerageInAtlas',function(){return this._enableMerageInAtlas;},function(value){this._enableMerageInAtlas=value;});WebGLCharImage.createOneChar=function(content,drawValue){var char=new WebGLCharImage(content,drawValue);return char;}
return WebGLCharImage;})(Bitmap)
var WebGLRenderTarget=(function(_super){function WebGLRenderTarget(width,height,surfaceFormat,surfaceType,depthStencilFormat,mipMap,repeat,minFifter,magFifter){(surfaceFormat===void 0)&&(surfaceFormat=0x1908);(surfaceType===void 0)&&(surfaceType=0x1401);(depthStencilFormat===void 0)&&(depthStencilFormat=0x84F9);(mipMap===void 0)&&(mipMap=false);(repeat===void 0)&&(repeat=false);(minFifter===void 0)&&(minFifter=-1);(magFifter===void 0)&&(magFifter=1);WebGLRenderTarget.__super.call(this);this._w=width;this._h=height;this._surfaceFormat=surfaceFormat;this._surfaceType=surfaceType;this._depthStencilFormat=depthStencilFormat;this._mipMap=mipMap;this._repeat=repeat;this._minFifter=minFifter;this._magFifter=magFifter;}
__class(WebGLRenderTarget,'laya.webgl.resource.WebGLRenderTarget',_super);var __proto=WebGLRenderTarget.prototype;__proto.recreateResource=function(){var gl=WebGL.mainContext;this._frameBuffer||(this._frameBuffer=gl.createFramebuffer());this._source||(this._source=gl.createTexture());var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,this._source);gl.texImage2D(0x0DE1,0,0x1908,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var minFifter=this._minFifter;var magFifter=this._magFifter;var repeat=this._repeat?0x2901:0x812F;var isPot=Arith.isPOT(this._w,this._h);if(isPot){if(this._mipMap)
(minFifter!==-1)||(minFifter=0x2703);else
(minFifter!==-1)||(minFifter=0x2601);(magFifter!==-1)||(magFifter=0x2601);gl.texParameteri(0x0DE1,0x2801,minFifter);gl.texParameteri(0x0DE1,0x2800,magFifter);gl.texParameteri(0x0DE1,0x2802,repeat);gl.texParameteri(0x0DE1,0x2803,repeat);this._mipMap&&gl.generateMipmap(0x0DE1);}else{(minFifter!==-1)||(minFifter=0x2601);(magFifter!==-1)||(magFifter=0x2601);gl.texParameteri(0x0DE1,0x2801,minFifter);gl.texParameteri(0x0DE1,0x2800,magFifter);gl.texParameteri(0x0DE1,0x2802,0x812F);gl.texParameteri(0x0DE1,0x2803,0x812F);}
gl.bindFramebuffer(0x8D40,this._frameBuffer);gl.framebufferTexture2D(0x8D40,0x8CE0,0x0DE1,this._source,0);if(this._depthStencilFormat){this._depthStencilBuffer||(this._depthStencilBuffer=gl.createRenderbuffer());gl.bindRenderbuffer(0x8D41,this._depthStencilBuffer);gl.renderbufferStorage(0x8D41,this._depthStencilFormat,this._w,this._h);switch(this._depthStencilFormat){case 0x81A5:gl.framebufferRenderbuffer(0x8D40,0x8D00,0x8D41,this._depthStencilBuffer);break;case 0x8D48:gl.framebufferRenderbuffer(0x8D40,0x8D20,0x8D41,this._depthStencilBuffer);break;case 0x84F9:gl.framebufferRenderbuffer(0x8D40,0x821A,0x8D41,this._depthStencilBuffer);break;}}
gl.bindFramebuffer(0x8D40,null);(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));gl.bindRenderbuffer(0x8D41,null);if(isPot&&this._mipMap)
this.memorySize=this._w*this._h*4*(1+1/3);else
this.memorySize=this._w*this._h*4;this.completeCreate();}
__proto.disposeResource=function(){if(this._frameBuffer){WebGL.mainContext.deleteTexture(this._source);WebGL.mainContext.deleteFramebuffer(this._frameBuffer);WebGL.mainContext.deleteRenderbuffer(this._depthStencilBuffer);this._source=null;this._frameBuffer=null;this._depthStencilBuffer=null;this.memorySize=0;}}
__getset(0,__proto,'depthStencilBuffer',function(){return this._depthStencilBuffer;});__getset(0,__proto,'frameBuffer',function(){return this._frameBuffer;});return WebGLRenderTarget;})(Bitmap)
var WebGLSubImage=(function(_super){function WebGLSubImage(canvas,offsetX,offsetY,width,height,atlasImage,src){this.offsetX=0;this.offsetY=0;WebGLSubImage.__super.call(this);this.repeat=true;this.mipmap=false;this.minFifter=-1;this.magFifter=-1;this.atlasImage=atlasImage;this.canvas=canvas;this._ctx=canvas.getContext('2d',undefined);this._w=width;this._h=height;this.offsetX=offsetX;this.offsetY=offsetY;this.src=src;this._enableMerageInAtlas=true;(AtlasResourceManager.enabled)&&(this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight)?this._allowMerageInAtlas=true:this._allowMerageInAtlas=false;}
__class(WebGLSubImage,'laya.webgl.resource.WebGLSubImage',_super);var __proto=WebGLSubImage.prototype;Laya.imps(__proto,{"laya.webgl.resource.IMergeAtlasBitmap":true})
__proto.size=function(w,h){this._w=w;this._h=h;this._ctx&&this._ctx.size(w,h);this.canvas&&(this.canvas.height=h,this.canvas.width=w);}
__proto.recreateResource=function(){this.size(this._w,this._h);this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h);(!(this._allowMerageInAtlas&&this._enableMerageInAtlas))?(this.createWebGlTexture()):(this.memorySize=0);this.completeCreate();}
__proto.createWebGlTexture=function(){var gl=WebGL.mainContext;if(!this.canvas){throw"create GLTextur err:no data:"+this.canvas;};var glTex=this._source=gl.createTexture();var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,glTex);gl.pixelStorei(0x9241,true);gl.texImage2D(0x0DE1,0,0x1908,0x1908,0x1401,this.canvas);gl.pixelStorei(0x9241,false);var minFifter=this.minFifter;var magFifter=this.magFifter;var repeat=this.repeat?0x2901:0x812F;var isPOT=Arith.isPOT(this.width,this.height);if(isPOT){if(this.mipmap)
(minFifter!==-1)||(minFifter=0x2703);else
(minFifter!==-1)||(minFifter=0x2601);(magFifter!==-1)||(magFifter=0x2601);gl.texParameteri(0x0DE1,0x2800,magFifter);gl.texParameteri(0x0DE1,0x2801,minFifter);gl.texParameteri(0x0DE1,0x2802,repeat);gl.texParameteri(0x0DE1,0x2803,repeat);this.mipmap&&gl.generateMipmap(0x0DE1);}else{(minFifter!==-1)||(minFifter=0x2601);(magFifter!==-1)||(magFifter=0x2601);gl.texParameteri(0x0DE1,0x2801,minFifter);gl.texParameteri(0x0DE1,0x2800,magFifter);gl.texParameteri(0x0DE1,0x2802,0x812F);gl.texParameteri(0x0DE1,0x2803,0x812F);}
(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));this.canvas=null;if(isPOT&&this.mipmap)
this.memorySize=this._w*this._h*4*(1+1/3);else
this.memorySize=this._w*this._h*4;}
__proto.disposeResource=function(){if(!(AtlasResourceManager.enabled&&this._allowMerageInAtlas)&&this._source){WebGL.mainContext.deleteTexture(this._source);this._source=null;this.memorySize=0;}}
__proto.clearAtlasSource=function(){}
__getset(0,__proto,'allowMerageInAtlas',function(){return this._allowMerageInAtlas;});__getset(0,__proto,'atlasSource',function(){return this.canvas;});__getset(0,__proto,'enableMerageInAtlas',function(){return this._allowMerageInAtlas;},function(value){this._allowMerageInAtlas=value;});return WebGLSubImage;})(Bitmap)
var Shader=(function(_super){function Shader(vs,ps,saveName,nameMap){this.customCompile=false;this._curActTexIndex=0;this.tag={};this._program=null;this._params=null;this._paramsMap={};this._offset=0;Shader.__super.call(this);if((!vs)||(!ps))throw"Shader Error";if(Render.isConchApp||Render.isFlash){this.customCompile=true;}
this._id=++Shader._count;this._vs=vs;this._ps=ps;this._nameMap=nameMap?nameMap:{};saveName!=null&&(Shader.sharders[saveName]=this);}
__class(Shader,'laya.webgl.shader.Shader',_super);var __proto=Shader.prototype;__proto.recreateResource=function(){this._compile();this.completeCreate();this.memorySize=0;}
__proto.disposeResource=function(){WebGL.mainContext.deleteShader(this._vshader);WebGL.mainContext.deleteShader(this._pshader);WebGL.mainContext.deleteProgram(this._program);this._vshader=this._pshader=this._program=null;this._params=null;this._paramsMap={};this.memorySize=0;this._curActTexIndex=0;}
__proto._compile=function(){if(!this._vs||!this._ps||this._params)
return;this._reCompile=true;this._params=[];var text=[this._vs,this._ps];var result;if(this.customCompile)
result=ShaderCompile.preGetParams(this._vs,this._ps);var gl=WebGL.mainContext;this._program=gl.createProgram();this._vshader=Shader._createShader(gl,text[0],0x8B31);this._pshader=Shader._createShader(gl,text[1],0x8B30);gl.attachShader(this._program,this._vshader);gl.attachShader(this._program,this._pshader);gl.linkProgram(this._program);if(!this.customCompile&&!gl.getProgramParameter(this._program,0x8B82)){throw gl.getProgramInfoLog(this._program);};var one,i=0,j=0,n=0,location;var attribNum=this.customCompile?result.attributes.length:gl.getProgramParameter(this._program,0x8B89);for(i=0;i<attribNum;i++){var attrib=this.customCompile?result.attributes[i]:gl.getActiveAttrib(this._program,i);location=gl.getAttribLocation(this._program,attrib.name);one={vartype:"attribute",glfun:null,ivartype:0,attrib:attrib,location:location,name:attrib.name,type:attrib.type,isArray:false,isSame:false,preValue:null,indexOfParams:0};this._params.push(one);};var nUniformNum=this.customCompile?result.uniforms.length:gl.getProgramParameter(this._program,0x8B86);for(i=0;i<nUniformNum;i++){var uniform=this.customCompile?result.uniforms[i]:gl.getActiveUniform(this._program,i);location=gl.getUniformLocation(this._program,uniform.name);one={vartype:"uniform",glfun:null,ivartype:1,attrib:attrib,location:location,name:uniform.name,type:uniform.type,isArray:false,isSame:false,preValue:null,indexOfParams:0};if(one.name.indexOf('[0]')>0){one.name=one.name.substr(0,one.name.length-3);one.isArray=true;one.location=gl.getUniformLocation(this._program,one.name);}
this._params.push(one);}
for(i=0,n=this._params.length;i<n;i++){one=this._params[i];one.indexOfParams=i;one.index=1;one.value=[one.location,null];one.codename=one.name;one.name=this._nameMap[one.codename]?this._nameMap[one.codename]:one.codename;this._paramsMap[one.name]=one;one._this=this;one.uploadedValue=[];if(one.vartype==="attribute"){one.fun=this._attribute;continue;}
switch(one.type){case 0x1404:one.fun=one.isArray?this._uniform1iv:this._uniform1i;break;case 0x1406:one.fun=one.isArray?this._uniform1fv:this._uniform1f;break;case 0x8B50:one.fun=one.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 0x8B51:one.fun=one.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 0x8B52:one.fun=one.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 0x8B5E:one.fun=this._uniform_sampler2D;break;case 0x8B60:one.fun=this._uniform_samplerCube;break;case 0x8B5C:one.glfun=gl.uniformMatrix4fv;one.fun=this._uniformMatrix4fv;break;case 0x8B56:one.fun=this._uniform1i;break;case 0x8B5A:case 0x8B5B:throw new Error("compile shader err!");break;default:throw new Error("compile shader err!");break;}}}
__proto.getUniform=function(name){return this._paramsMap[name];}
__proto._attribute=function(one,value){var gl=WebGL.mainContext;var enableAtributes=Buffer._enableAtributes;var location=one.location;(enableAtributes[location])||(gl.enableVertexAttribArray(location));gl.vertexAttribPointer(location,value[0],value[1],value[2],value[3],value[4]+this._offset);enableAtributes[location]=Buffer._bindVertexBuffer;return 1;}
__proto._uniform1f=function(one,value){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value){WebGL.mainContext.uniform1f(one.location,uploadedValue[0]=value);return 1;}
return 0;}
__proto._uniform1fv=function(one,value){if(value.length<4){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]){WebGL.mainContext.uniform1fv(one.location,value);uploadedValue[0]=value[0];uploadedValue[1]=value[1];uploadedValue[2]=value[2];uploadedValue[3]=value[3];return 1;}
return 0;}else{WebGL.mainContext.uniform1fv(one.location,value);return 1;}}
__proto._uniform_vec2=function(one,value){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]){WebGL.mainContext.uniform2f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1]);return 1;}
return 0;}
__proto._uniform_vec2v=function(one,value){if(value.length<2){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]){WebGL.mainContext.uniform2fv(one.location,value);uploadedValue[0]=value[0];uploadedValue[1]=value[1];uploadedValue[2]=value[2];uploadedValue[3]=value[3];return 1;}
return 0;}else{WebGL.mainContext.uniform2fv(one.location,value);return 1;}}
__proto._uniform_vec3=function(one,value){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]){WebGL.mainContext.uniform3f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2]);return 1;}
return 0;}
__proto._uniform_vec3v=function(one,value){WebGL.mainContext.uniform3fv(one.location,value);return 1;}
__proto._uniform_vec4=function(one,value){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]){WebGL.mainContext.uniform4f(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3]);return 1;}
return 0;}
__proto._uniform_vec4v=function(one,value){WebGL.mainContext.uniform4fv(one.location,value);return 1;}
__proto._uniformMatrix2fv=function(one,value){WebGL.mainContext.uniformMatrix2fv(one.location,false,value);return 1;}
__proto._uniformMatrix3fv=function(one,value){WebGL.mainContext.uniformMatrix3fv(one.location,false,value);return 1;}
__proto._uniformMatrix4fv=function(one,value){WebGL.mainContext.uniformMatrix4fv(one.location,false,value);return 1;}
__proto._uniform1i=function(one,value){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value){WebGL.mainContext.uniform1i(one.location,uploadedValue[0]=value);return 1;}
return 0;}
__proto._uniform1iv=function(one,value){WebGL.mainContext.uniform1iv(one.location,value);return 1;}
__proto._uniform_ivec2=function(one,value){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]){WebGL.mainContext.uniform2i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1]);return 1;}
return 0;}
__proto._uniform_ivec2v=function(one,value){WebGL.mainContext.uniform2iv(one.location,value);return 1;}
__proto._uniform_vec3i=function(one,value){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]){WebGL.mainContext.uniform3i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2]);return 1;}
return 0;}
__proto._uniform_vec3vi=function(one,value){WebGL.mainContext.uniform3iv(one.location,value);return 1;}
__proto._uniform_vec4i=function(one,value){var uploadedValue=one.uploadedValue;if(uploadedValue[0]!==value[0]||uploadedValue[1]!==value[1]||uploadedValue[2]!==value[2]||uploadedValue[3]!==value[3]){WebGL.mainContext.uniform4i(one.location,uploadedValue[0]=value[0],uploadedValue[1]=value[1],uploadedValue[2]=value[2],uploadedValue[3]=value[3]);return 1;}
return 0;}
__proto._uniform_vec4vi=function(one,value){WebGL.mainContext.uniform4iv(one.location,value);return 1;}
__proto._uniform_sampler2D=function(one,value){var gl=WebGL.mainContext;var uploadedValue=one.uploadedValue;if(uploadedValue[0]==null){uploadedValue[0]=this._curActTexIndex;gl.uniform1i(one.location,this._curActTexIndex);gl.activeTexture(Shader._TEXTURES[this._curActTexIndex]);WebGLContext.bindTexture(gl,0x0DE1,value);this._curActTexIndex++;return 1;}else{gl.activeTexture(Shader._TEXTURES[uploadedValue[0]]);WebGLContext.bindTexture(gl,0x0DE1,value);return 0;}}
__proto._uniform_samplerCube=function(one,value){var gl=WebGL.mainContext;var uploadedValue=one.uploadedValue;if(uploadedValue[0]==null){uploadedValue[0]=this._curActTexIndex;gl.uniform1i(one.location,this._curActTexIndex);gl.activeTexture(Shader._TEXTURES[this._curActTexIndex]);WebGLContext.bindTexture(gl,0x8513,value);this._curActTexIndex++;return 1;}else{gl.activeTexture(Shader._TEXTURES[uploadedValue[0]]);WebGLContext.bindTexture(gl,0x8513,value);return 0;}}
__proto._noSetValue=function(one){console.log("no....:"+one.name);}
__proto.uploadOne=function(name,value){this.activeResource();WebGLContext.UseProgram(this._program);var one=this._paramsMap[name];one.fun.call(this,one,value);}
__proto.uploadTexture2D=function(value){Stat.shaderCall++;var gl=WebGL.mainContext;gl.activeTexture(0x84C0);WebGLContext.bindTexture(gl,0x0DE1,value);}
__proto.upload=function(shaderValue,params){BaseShader.activeShader=BaseShader.bindShader=this;this._lastUseFrameCount===Stat.loopCount||this.activeResource();WebGLContext.UseProgram(this._program);if(this._reCompile){params=this._params;this._reCompile=false;}else{params=params||this._params;};var gl=WebGL.mainContext;var one,value,n=params.length,shaderCall=0;for(var i=0;i<n;i++){one=params[i];if((value=shaderValue[one.name])!==null)
shaderCall+=one.fun.call(this,one,value);}
Stat.shaderCall+=shaderCall;}
__proto.uploadArray=function(shaderValue,length,_bufferUsage){BaseShader.activeShader=this;BaseShader.bindShader=this;this.activeResource();WebGLContext.UseProgram(this._program);var params=this._params,value;var one,shaderCall=0;for(var i=length-2;i>=0;i-=2){one=this._paramsMap[shaderValue[i]];if(!one)
continue;value=shaderValue[i+1];if(value!=null){_bufferUsage&&_bufferUsage[one.name]&&_bufferUsage[one.name].bind();shaderCall+=one.fun.call(this,one,value);}}
Stat.shaderCall+=shaderCall;}
__proto.getParams=function(){return this._params;}
Shader.getShader=function(name){return Shader.sharders[name];}
Shader.create=function(vs,ps,saveName,nameMap){return new Shader(vs,ps,saveName,nameMap);}
Shader.withCompile=function(nameID,define,shaderName,createShader){if(shaderName&&Shader.sharders[shaderName])
return Shader.sharders[shaderName];var pre=Shader._preCompileShader[0.0002*nameID];if(!pre)
throw new Error("withCompile shader err!"+nameID);return pre.createShader(define,shaderName,createShader);}
Shader.withCompile2D=function(nameID,mainID,define,shaderName,createShader){if(shaderName&&Shader.sharders[shaderName])
return Shader.sharders[shaderName];var pre=Shader._preCompileShader[0.0002*nameID+mainID];if(!pre)
throw new Error("withCompile shader err!"+nameID+" "+mainID);return pre.createShader(define,shaderName,createShader);}
Shader.addInclude=function(fileName,txt){ShaderCompile.addInclude(fileName,txt);}
Shader.preCompile=function(nameID,vs,ps,nameMap){var id=0.0002*nameID;Shader._preCompileShader[id]=new ShaderCompile(id,vs,ps,nameMap);}
Shader.preCompile2D=function(nameID,mainID,vs,ps,nameMap){var id=0.0002*nameID+mainID;Shader._preCompileShader[id]=new ShaderCompile(id,vs,ps,nameMap);}
Shader._createShader=function(gl,str,type){var shader=gl.createShader(type);gl.shaderSource(shader,str);gl.compileShader(shader);return shader;}
Shader._TEXTURES=[0x84C0,0x84C1,0x84C2,0x84C3,0x84C4,0x84C5,0x84C6,,0x84C7,0x84C8];Shader._count=0;Shader._preCompileShader={};Shader.SHADERNAME2ID=0.0002;Shader.sharders=(Shader.sharders=[],Shader.sharders.length=0x20,Shader.sharders);__static(Shader,['nameKey',function(){return this.nameKey=new StringKey();}]);return Shader;})(BaseShader)
var Buffer2D=(function(_super){function Buffer2D(){this._maxsize=0;this._upload=true;this._uploadSize=0;Buffer2D.__super.call(this);this.lock=true;}
__class(Buffer2D,'laya.webgl.utils.Buffer2D',_super);var __proto=Buffer2D.prototype;__proto.needSize=function(sz){var old=this._byteLength;if(sz){var needsz=this._byteLength+sz;needsz<=this._buffer.byteLength||(this._resizeBuffer(needsz<<1,true));this._byteLength=needsz;}
return old;}
__proto._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength);if(Stat.loopCount%30==0){if(this._buffer.byteLength>(this._maxsize+64)){this.memorySize=this._buffer.byteLength;this._buffer=this._buffer.slice(0,this._maxsize+64);this._checkArrayUse();}
this._maxsize=this._byteLength;}
if(this._uploadSize<this._buffer.byteLength){this._uploadSize=this._buffer.byteLength;Buffer._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage);this.memorySize=this._uploadSize;}
Buffer._gl.bufferSubData(this._bufferType,0,this._buffer);}
__proto._bufferSubData=function(offset,dataStart,dataLength){(offset===void 0)&&(offset=0);(dataStart===void 0)&&(dataStart=0);(dataLength===void 0)&&(dataLength=0);this._maxsize=Math.max(this._maxsize,this._byteLength);if(Stat.loopCount%30==0){if(this._buffer.byteLength>(this._maxsize+64)){this.memorySize=this._buffer.byteLength;this._buffer=this._buffer.slice(0,this._maxsize+64);this._checkArrayUse();}
this._maxsize=this._byteLength;}
if(this._uploadSize<this._buffer.byteLength){this._uploadSize=this._buffer.byteLength;Buffer._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage);this.memorySize=this._uploadSize;}
if(dataStart||dataLength){var subBuffer=this._buffer.slice(dataStart,dataLength);Buffer._gl.bufferSubData(this._bufferType,offset,subBuffer);}else{Buffer._gl.bufferSubData(this._bufferType,offset,this._buffer);}}
__proto._checkArrayUse=function(){}
__proto._bind_upload=function(){if(!this._upload)
return false;this._upload=false;this._bind();this._bufferData();return true;}
__proto._bind_subUpload=function(offset,dataStart,dataLength){(offset===void 0)&&(offset=0);(dataStart===void 0)&&(dataStart=0);(dataLength===void 0)&&(dataLength=0);if(!this._upload)
return false;this._upload=false;this._bind();this._bufferSubData(offset,dataStart,dataLength);return true;}
__proto._resizeBuffer=function(nsz,copy){if(nsz<this._buffer.byteLength)
return this;this.memorySize=nsz;if(copy&&this._buffer&&this._buffer.byteLength>0){var newbuffer=new ArrayBuffer(nsz);var n=new Uint8Array(newbuffer);n.set(new Uint8Array(this._buffer),0);this._buffer=newbuffer;}else
this._buffer=new ArrayBuffer(nsz);this._checkArrayUse();this._upload=true;return this;}
__proto.append=function(data){this._upload=true;var byteLen=0,n;byteLen=data.byteLength;if((data instanceof Uint8Array)){this._resizeBuffer(this._byteLength+byteLen,true);n=new Uint8Array(this._buffer,this._byteLength);}else if((data instanceof Uint16Array)){this._resizeBuffer(this._byteLength+byteLen,true);n=new Uint16Array(this._buffer,this._byteLength);}else if((data instanceof Float32Array)){this._resizeBuffer(this._byteLength+byteLen,true);n=new Float32Array(this._buffer,this._byteLength);}
n.set(data,0);this._byteLength+=byteLen;this._checkArrayUse();}
__proto.appendU16Array=function(data,len){this._resizeBuffer(this._byteLength+len*2,true);var u=new Uint16Array(this._buffer,this._byteLength,len);for(var i=0;i<len;i++){u[i]=data[i];}
this._byteLength+=len*2;this._checkArrayUse();}
__proto.appendEx=function(data,type){this._upload=true;var byteLen=0,n;byteLen=data.byteLength;this._resizeBuffer(this._byteLength+byteLen,true);n=new type(this._buffer,this._byteLength);n.set(data,0);this._byteLength+=byteLen;this._checkArrayUse();}
__proto.appendEx2=function(data,type,dataLen,perDataLen){(perDataLen===void 0)&&(perDataLen=1);this._upload=true;var byteLen=0,n;byteLen=dataLen*perDataLen;this._resizeBuffer(this._byteLength+byteLen,true);n=new type(this._buffer,this._byteLength);var i=0;for(i=0;i<dataLen;i++){n[i]=data[i];}
this._byteLength+=byteLen;this._checkArrayUse();}
__proto.getBuffer=function(){return this._buffer;}
__proto.setNeedUpload=function(){this._upload=true;}
__proto.getNeedUpload=function(){return this._upload;}
__proto.upload=function(){var scuess=this._bind_upload();Buffer._gl.bindBuffer(this._bufferType,null);Buffer._bindActive[this._bufferType]=null;BaseShader.activeShader=null
return scuess;}
__proto.subUpload=function(offset,dataStart,dataLength){(offset===void 0)&&(offset=0);(dataStart===void 0)&&(dataStart=0);(dataLength===void 0)&&(dataLength=0);var scuess=this._bind_subUpload();Buffer._gl.bindBuffer(this._bufferType,null);Buffer._bindActive[this._bufferType]=null;BaseShader.activeShader=null
return scuess;}
__proto.disposeResource=function(){_super.prototype.disposeResource.call(this);this._upload=true;this._uploadSize=0;}
__proto.clear=function(){this._byteLength=0;this._upload=true;}
__getset(0,__proto,'bufferLength',function(){return this._buffer.byteLength;});__getset(0,__proto,'byteLength',null,function(value){if(this._byteLength===value)
return;value<=this._buffer.byteLength||(this._resizeBuffer(value*2+256,true));this._byteLength=value;});Buffer2D.__int__=function(gl){IndexBuffer2D.QuadrangleIB=IndexBuffer2D.create(0x88E4);GlUtils.fillIBQuadrangle(IndexBuffer2D.QuadrangleIB,16);}
Buffer2D.FLOAT32=4;Buffer2D.SHORT=2;return Buffer2D;})(Buffer)
var GlowSV=(function(_super){function GlowSV(args){this.u_blurX=false;this.u_color=null;this.u_offset=null;this.u_strength=NaN;this.u_texW=0;this.u_texH=0;GlowSV.__super.call(this,0x08|0x01);}
__class(GlowSV,'laya.webgl.shader.d2.value.GlowSV',_super);var __proto=GlowSV.prototype;__proto.setValue=function(vo){_super.prototype.setValue.call(this,vo);}
__proto.clear=function(){_super.prototype.clear.call(this);}
return GlowSV;})(TextureSV)
var TextSV=(function(_super){function TextSV(args){TextSV.__super.call(this,0x40);this.defines.add(0x40);}
__class(TextSV,'laya.webgl.shader.d2.value.TextSV',_super);var __proto=TextSV.prototype;__proto.release=function(){TextSV.pool[TextSV._length++]=this;this.clear();}
__proto.clear=function(){_super.prototype.clear.call(this);}
TextSV.create=function(){if(TextSV._length)return TextSV.pool[--TextSV._length];else return new TextSV(null);}
TextSV.pool=[];TextSV._length=0;return TextSV;})(TextureSV)
var Shader2X=(function(_super){function Shader2X(vs,ps,saveName,nameMap){this._params2dQuick1=null;this._params2dQuick2=null;this._shaderValueWidth=NaN;this._shaderValueHeight=NaN;Shader2X.__super.call(this,vs,ps,saveName,nameMap);}
__class(Shader2X,'laya.webgl.shader.d2.Shader2X',_super);var __proto=Shader2X.prototype;__proto.upload2dQuick1=function(shaderValue){this.upload(shaderValue,this._params2dQuick1||this._make2dQuick1());}
__proto._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource();this._params2dQuick1=[];var params=this._params,one;for(var i=0,n=params.length;i<n;i++){one=params[i];if(!Render.isFlash&&(one.name==="size"||one.name==="position"||one.name==="texcoord"))continue;this._params2dQuick1.push(one);}}
return this._params2dQuick1;}
__proto.disposeResource=function(){_super.prototype.disposeResource.call(this);this._params2dQuick1=null;this._params2dQuick2=null;}
__proto.upload2dQuick2=function(shaderValue){this.upload(shaderValue,this._params2dQuick2||this._make2dQuick2());}
__proto._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource();this._params2dQuick2=[];var params=this._params,one;for(var i=0,n=params.length;i<n;i++){one=params[i];if(!Render.isFlash&&(one.name==="size"))continue;this._params2dQuick2.push(one);}}
return this._params2dQuick2;}
Shader2X.create=function(vs,ps,saveName,nameMap){return new Shader2X(vs,ps,saveName,nameMap);}
return Shader2X;})(Shader)
var IndexBuffer2D=(function(_super){function IndexBuffer2D(bufferUsage){this._uint8Array=null;this._uint16Array=null;(bufferUsage===void 0)&&(bufferUsage=0x88E4);IndexBuffer2D.__super.call(this);this._bufferUsage=bufferUsage;this._bufferType=0x8893;Render.isFlash||(this._buffer=new ArrayBuffer(8));}
__class(IndexBuffer2D,'laya.webgl.utils.IndexBuffer2D',_super);var __proto=IndexBuffer2D.prototype;__proto._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer));this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer));}
__proto.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer));}
__proto.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer));}
__proto.destory=function(){this._uint16Array=null;this._uint8Array=null;this._buffer=null;}
IndexBuffer2D.QuadrangleIB=null;IndexBuffer2D.create=function(bufferUsage){(bufferUsage===void 0)&&(bufferUsage=0x88E4);return new IndexBuffer2D(bufferUsage);}
return IndexBuffer2D;})(Buffer2D)
var VertexBuffer2D=(function(_super){function VertexBuffer2D(vertexStride,bufferUsage){this._floatArray32=null;this._vertexStride=0;VertexBuffer2D.__super.call(this);this._vertexStride=vertexStride;this._bufferUsage=bufferUsage;this._bufferType=0x8892;Render.isFlash||(this._buffer=new ArrayBuffer(8));this.getFloat32Array();}
__class(VertexBuffer2D,'laya.webgl.utils.VertexBuffer2D',_super);var __proto=VertexBuffer2D.prototype;__proto.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer));}
__proto.bind=function(ibBuffer){(ibBuffer)&&(ibBuffer._bind());this._bind();}
__proto.insertData=function(data,pos){var vbdata=this.getFloat32Array();vbdata.set(data,pos);this._upload=true;}
__proto.bind_upload=function(ibBuffer){(ibBuffer._bind_upload())||(ibBuffer._bind());(this._bind_upload())||(this._bind());}
__proto._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer));}
__proto.disposeResource=function(){_super.prototype.disposeResource.call(this);var enableAtributes=Buffer._enableAtributes;for(var i=0;i<10;i++){WebGL.mainContext.disableVertexAttribArray(i);enableAtributes[i]=null;}}
__proto.destory=function(){this._byteLength=0;this._upload=true;this._buffer=null;this._floatArray32=null;}
__getset(0,__proto,'vertexStride',function(){return this._vertexStride;});VertexBuffer2D.create=function(vertexStride,bufferUsage){(bufferUsage===void 0)&&(bufferUsage=0x88E8);return new VertexBuffer2D(vertexStride,bufferUsage);}
return VertexBuffer2D;})(Buffer2D)
var WebGLImage=(function(_super){function WebGLImage(data,def,format,mipmap){this._format=0;this._mipmap=false;this._allowMerageInAtlas=false;this._enableMerageInAtlas=false;this.repeat=false;this._image=null;this.minFifter=0;this.magFifter=0;(format===void 0)&&(format=0x1908);(mipmap===void 0)&&(mipmap=true);WebGLImage.__super.call(this,data,def);this._format=format;this._mipmap=mipmap;this.repeat=false;this.minFifter=-1;this.magFifter=-1;if((typeof data=='string')){this._url=data;this._src=data;this._image=new Browser.window.Image();if(def){def.onload&&(this.onload=def.onload);def.onerror&&(this.onerror=def.onerror);def.onCreate&&def.onCreate(this);}
this._image.crossOrigin=(data&&(data.indexOf("data:")==0))?null:"";(data)&&(this._image.src=data);}else if((data instanceof ArrayBuffer)){this._src=def;this._url=this._src;var readData=new Byte(data);var magicNumber=readData.readUTFBytes(4);var version=readData.readUTFBytes(2);var dataType=readData.getInt16();readData.endian="bigEndian";this._w=readData.getInt16();this._h=readData.getInt16();var originalWidth=readData.getInt16();var originalHeight=readData.getInt16();this._image=new Uint8Array(data,readData.pos);this._format=WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL;(AtlasResourceManager.enabled)&&(this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight)?this._allowMerageInAtlas=true:this._allowMerageInAtlas=false;}else{this._src=def;this._url=this._src;this._image=data["source"]||data;this.onresize();}
this._$5__enableMerageInAtlas=true;}
__class(WebGLImage,'laya.webgl.resource.WebGLImage',_super);var __proto=WebGLImage.prototype;Laya.imps(__proto,{"laya.webgl.resource.IMergeAtlasBitmap":true})
__proto._init_=function(src,def){}
__proto._createWebGlTexture=function(){if(!this._image){throw"create GLTextur err:no data:"+this._image;};var gl=WebGL.mainContext;var glTex=this._source=gl.createTexture();var preTarget=WebGLContext.curBindTexTarget;var preTexture=WebGLContext.curBindTexValue;WebGLContext.bindTexture(gl,0x0DE1,glTex);gl.pixelStorei(0x9241,true);switch(this._format){case 0x1908:gl.texImage2D(0x0DE1,0,this._format,0x1908,0x1401,this._image);break;case WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:gl.compressedTexImage2D(0x0DE1,0,this._format,this._w,this._h,0,this._image);break;}
gl.pixelStorei(0x9241,false);var minFifter=this.minFifter;var magFifter=this.magFifter;var repeat=this.repeat?0x2901:0x812F;var isPot=Arith.isPOT(this._w,this._h);if(isPot){if(this.mipmap)
(minFifter!==-1)||(minFifter=0x2703);else
(minFifter!==-1)||(minFifter=0x2601);(magFifter!==-1)||(magFifter=0x2601);gl.texParameteri(0x0DE1,0x2801,minFifter);gl.texParameteri(0x0DE1,0x2800,magFifter);gl.texParameteri(0x0DE1,0x2802,repeat);gl.texParameteri(0x0DE1,0x2803,repeat);this.mipmap&&gl.generateMipmap(0x0DE1);}else{(minFifter!==-1)||(minFifter=0x2601);(magFifter!==-1)||(magFifter=0x2601);gl.texParameteri(0x0DE1,0x2801,minFifter);gl.texParameteri(0x0DE1,0x2800,magFifter);gl.texParameteri(0x0DE1,0x2802,0x812F);gl.texParameteri(0x0DE1,0x2803,0x812F);}
(preTarget&&preTexture)&&(WebGLContext.bindTexture(gl,preTarget,preTexture));this._image.onload=null;this._image=null;if(isPot&&this.mipmap)
this.memorySize=this._w*this._h*4*(1+1/3);else
this.memorySize=this._w*this._h*4;this._recreateLock=false;}
__proto.recreateResource=function(){var _$this=this;if(this._src==null||this._src==="")
return;this._needReleaseAgain=false;if(!this._image){this._recreateLock=true;var _this=this;this._image=new Browser.window.Image();this._image.crossOrigin=this._src.indexOf("data:")==0?null:"";this._image.onload=function(){if(_this._needReleaseAgain){_this._needReleaseAgain=false;_this._image.onload=null;_this._image=null;return;}
(!(_this._allowMerageInAtlas&&_this._enableMerageInAtlas))?(_this._createWebGlTexture()):(_$this.memorySize=0,_$this._recreateLock=false);_this.completeCreate();};this._image.src=this._src;}else{if(this._recreateLock){return;}
(!(this._allowMerageInAtlas&&this._$5__enableMerageInAtlas))?(this._createWebGlTexture()):(this.memorySize=0,this._recreateLock=false);this.completeCreate();}}
__proto.disposeResource=function(){if(this._recreateLock){this._needReleaseAgain=true;}
if(this._source){WebGL.mainContext.deleteTexture(this._source);this._source=null;this._image=null;this.memorySize=0;}}
__proto.onresize=function(){this._w=this._image.width;this._h=this._image.height;(AtlasResourceManager.enabled)&&(this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight)?this._allowMerageInAtlas=true:this._allowMerageInAtlas=false;}
__proto.clearAtlasSource=function(){this._image=null;}
__getset(0,__proto,'format',function(){return this._format;});__getset(0,__proto,'enableMerageInAtlas',function(){return this._$5__enableMerageInAtlas;},function(value){this._$5__enableMerageInAtlas=value;});__getset(0,__proto,'mipmap',function(){return this._mipmap;});__getset(0,__proto,'allowMerageInAtlas',function(){return this._allowMerageInAtlas;});__getset(0,__proto,'atlasSource',function(){return this._image;});__getset(0,__proto,'onload',null,function(value){var _$this=this;this._onload=value;this._image&&(this._image.onload=this._onload!=null?(function(){_$this.onresize();_$this._onload();}):null);});__getset(0,__proto,'onerror',null,function(value){var _$this=this;this._onerror=value;this._image&&(this._image.onerror=this._onerror!=null?(function(){_$this._onerror()}):null);});return WebGLImage;})(HTMLImage)
Laya.__init([DrawText,AtlasGrid,WebGLContext2D,ShaderCompile]);})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var Bezier=laya.maths.Bezier,Browser=laya.utils.Browser,Byte=laya.utils.Byte,Event=laya.events.Event;var EventDispatcher=laya.events.EventDispatcher,Graphics=laya.display.Graphics,HTMLCanvas=laya.resource.HTMLCanvas;var Handler=laya.utils.Handler,Loader=laya.net.Loader,MathUtil=laya.maths.MathUtil,Matrix=laya.maths.Matrix;var Node=laya.display.Node,Point=laya.maths.Point,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render;var RenderContext=laya.renders.RenderContext,Resource=laya.resource.Resource,RunDriver=laya.utils.RunDriver;var Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Texture=laya.resource.Texture,URL=laya.net.URL,Utils=laya.utils.Utils;var AnimationContent=(function(){function AnimationContent(){this.nodes=null;this.name=null;this.playTime=NaN;this.bone3DMap=null;this.totalKeyframeDatasLength=0;}
__class(AnimationContent,'laya.ani.AnimationContent');return AnimationContent;})()
var AnimationNodeContent=(function(){function AnimationNodeContent(){this.name=null;this.parentIndex=0;this.parent=null;this.keyframeWidth=0;this.lerpType=0;this.interpolationMethod=null;this.childs=null;this.keyFrame=null;this.playTime=NaN;this.extenData=null;this.dataOffset=0;}
__class(AnimationNodeContent,'laya.ani.AnimationNodeContent');return AnimationNodeContent;})()
var AnimationParser01=(function(){function AnimationParser01(){}
__class(AnimationParser01,'laya.ani.AnimationParser01');AnimationParser01.parse=function(templet,reader){var data=reader.__getBuffer();var i=0,j=0,k=0,n=0,l=0,m=0,o=0;var aniClassName=reader.readUTFString();templet._aniClassName=aniClassName;var strList=reader.readUTFString().split("\n");var aniCount=reader.getUint8();var publicDataPos=reader.getUint32();var publicExtDataPos=reader.getUint32();var publicData;if(publicDataPos>0)
publicData=data.slice(publicDataPos,publicExtDataPos);var publicRead=new Byte(publicData);if(publicExtDataPos>0)
templet._publicExtData=data.slice(publicExtDataPos,data.byteLength);templet._useParent=!!reader.getUint8();templet._anis.length=aniCount;for(i=0;i<aniCount;i++){var ani=templet._anis[i]=new AnimationContent();{};ani.nodes=new Array;var name=ani.name=strList[reader.getUint16()];templet._aniMap[name]=i;ani.bone3DMap={};ani.playTime=reader.getFloat32();var boneCount=ani.nodes.length=reader.getUint8();ani.totalKeyframeDatasLength=0;for(j=0;j<boneCount;j++){var node=ani.nodes[j]=new AnimationNodeContent();{};node.childs=[];var nameIndex=reader.getInt16();if(nameIndex>=0){node.name=strList[nameIndex];ani.bone3DMap[node.name]=j;}
node.keyFrame=new Array;node.parentIndex=reader.getInt16();node.parentIndex==-1?node.parent=null:node.parent=ani.nodes[node.parentIndex]
node.lerpType=reader.getUint8();var keyframeParamsOffset=reader.getUint32();publicRead.pos=keyframeParamsOffset;var keyframeDataCount=node.keyframeWidth=publicRead.getUint16();ani.totalKeyframeDatasLength+=keyframeDataCount;if(node.lerpType===0||node.lerpType===1){node.interpolationMethod=[];node.interpolationMethod.length=keyframeDataCount;for(k=0;k<keyframeDataCount;k++)
node.interpolationMethod[k]=AnimationTemplet.interpolation[publicRead.getUint8()];}
if(node.parent!=null)
node.parent.childs.push(node);var privateDataLen=reader.getUint16();if(privateDataLen>0){node.extenData=data.slice(reader.pos,reader.pos+privateDataLen);reader.pos+=privateDataLen;};var keyframeCount=reader.getUint16();node.keyFrame.length=keyframeCount;var startTime=0;var keyFrame;for(k=0,n=keyframeCount;k<n;k++){keyFrame=node.keyFrame[k]=new KeyFramesContent();{};keyFrame.duration=reader.getFloat32();keyFrame.startTime=startTime;if(node.lerpType===2){keyFrame.interpolationData=[];var interDataLength=reader.getUint8();var lerpType=0;lerpType=reader.getFloat32();switch(lerpType){case 254:keyFrame.interpolationData.length=keyframeDataCount;for(o=0;o<keyframeDataCount;o++)
keyFrame.interpolationData[o]=0;break;case 255:keyFrame.interpolationData.length=keyframeDataCount;for(o=0;o<keyframeDataCount;o++)
keyFrame.interpolationData[o]=5;break;default:keyFrame.interpolationData.push(lerpType);for(m=1;m<interDataLength;m++){keyFrame.interpolationData.push(reader.getFloat32());}}}
keyFrame.data=new Float32Array(keyframeDataCount);for(l=0;l<keyframeDataCount;l++){keyFrame.data[l]=reader.getFloat32();if(keyFrame.data[l]>-0.00000001&&keyFrame.data[l]<0.00000001)keyFrame.data[l]=0;}
startTime+=keyFrame.duration;}
keyFrame.startTime=ani.playTime;node.playTime=ani.playTime;templet._calculateKeyFrame(node,keyframeCount,keyframeDataCount);}}}
return AnimationParser01;})()
var AnimationParser02=(function(){function AnimationParser02(){}
__class(AnimationParser02,'laya.ani.AnimationParser02');AnimationParser02.READ_DATA=function(){AnimationParser02._DATA.offset=AnimationParser02._reader.getUint32();AnimationParser02._DATA.size=AnimationParser02._reader.getUint32();}
AnimationParser02.READ_BLOCK=function(){var count=AnimationParser02._BLOCK.count=AnimationParser02._reader.getUint16();var blockStarts=AnimationParser02._BLOCK.blockStarts=[];var blockLengths=AnimationParser02._BLOCK.blockLengths=[];for(var i=0;i<count;i++){blockStarts.push(AnimationParser02._reader.getUint32());blockLengths.push(AnimationParser02._reader.getUint32());}}
AnimationParser02.READ_STRINGS=function(){var offset=AnimationParser02._reader.getUint32();var count=AnimationParser02._reader.getUint16();var prePos=AnimationParser02._reader.pos;AnimationParser02._reader.pos=offset+AnimationParser02._DATA.offset;for(var i=0;i<count;i++)
AnimationParser02._strings[i]=AnimationParser02._reader.readUTFString();AnimationParser02._reader.pos=prePos;}
AnimationParser02.parse=function(templet,reader){AnimationParser02._templet=templet;AnimationParser02._reader=reader;var arrayBuffer=reader.__getBuffer();AnimationParser02.READ_DATA();AnimationParser02.READ_BLOCK();AnimationParser02.READ_STRINGS();for(var i=0,n=AnimationParser02._BLOCK.count;i<n;i++){var index=reader.getUint16();var blockName=AnimationParser02._strings[index];var fn=AnimationParser02["READ_"+blockName];if(fn==null)
throw new Error("model file err,no this function:"+index+" "+blockName);else
fn.call();}}
AnimationParser02.READ_ANIMATIONS=function(){var reader=AnimationParser02._reader;var arrayBuffer=reader.__getBuffer();var i=0,j=0,k=0,n=0,l=0;var keyframeWidth=reader.getUint16();var interpolationMethod=[];interpolationMethod.length=keyframeWidth;for(i=0;i<keyframeWidth;i++)
interpolationMethod[i]=AnimationTemplet.interpolation[reader.getByte()];var aniCount=reader.getUint8();AnimationParser02._templet._anis.length=aniCount;for(i=0;i<aniCount;i++){var ani=AnimationParser02._templet._anis[i]={};ani.nodes=new Array;var aniName=ani.name=AnimationParser02._strings[reader.getUint16()];AnimationParser02._templet._aniMap[aniName]=i;ani.bone3DMap={};ani.playTime=reader.getFloat32();var boneCount=ani.nodes.length=reader.getInt16();ani.totalKeyframeDatasLength=0;for(j=0;j<boneCount;j++){var node=ani.nodes[j]={};node.keyframeWidth=keyframeWidth;node.childs=[];var nameIndex=reader.getUint16();if(nameIndex>=0){node.name=AnimationParser02._strings[nameIndex];ani.bone3DMap[node.name]=j;}
node.keyFrame=new Array;node.parentIndex=reader.getInt16();node.parentIndex==-1?node.parent=null:node.parent=ani.nodes[node.parentIndex]
ani.totalKeyframeDatasLength+=keyframeWidth;node.interpolationMethod=interpolationMethod;if(node.parent!=null)
node.parent.childs.push(node);var keyframeCount=reader.getUint16();node.keyFrame.length=keyframeCount;var keyFrame=null,lastKeyFrame=null;for(k=0,n=keyframeCount;k<n;k++){keyFrame=node.keyFrame[k]={};keyFrame.startTime=reader.getFloat32();(lastKeyFrame)&&(lastKeyFrame.duration=keyFrame.startTime-lastKeyFrame.startTime);var offset=AnimationParser02._DATA.offset;var keyframeDataOffset=reader.getUint32();var keyframeDataLength=keyframeWidth*4;var keyframeArrayBuffer=arrayBuffer.slice(offset+keyframeDataOffset,offset+keyframeDataOffset+keyframeDataLength);keyFrame.data=new Float32Array(keyframeArrayBuffer);lastKeyFrame=keyFrame;}
keyFrame.duration=0;node.playTime=ani.playTime;AnimationParser02._templet._calculateKeyFrame(node,keyframeCount,keyframeWidth);}}}
AnimationParser02._templet=null;AnimationParser02._reader=null;AnimationParser02._strings=[];__static(AnimationParser02,['_BLOCK',function(){return this._BLOCK={count:0};},'_DATA',function(){return this._DATA={offset:0,size:0};}]);return AnimationParser02;})()
var AnimationState=(function(){function AnimationState(){}
__class(AnimationState,'laya.ani.AnimationState');AnimationState.stopped=0;AnimationState.paused=1;AnimationState.playing=2;return AnimationState;})()
var Bone=(function(){function Bone(){this.name=null;this.root=null;this.parentBone=null;this.length=10;this.transform=null;this.inheritScale=true;this.inheritRotation=true;this.rotation=NaN;this.resultRotation=NaN;this.d=-1;this._tempMatrix=null;this._sprite=null;this.resultTransform=new Transform();this.resultMatrix=new Matrix();this._children=[];}
__class(Bone,'laya.ani.bone.Bone');var __proto=Bone.prototype;__proto.setTempMatrix=function(matrix){this._tempMatrix=matrix;var i=0,n=0;var tBone;for(i=0,n=this._children.length;i<n;i++){tBone=this._children[i];tBone.setTempMatrix(this._tempMatrix);}}
__proto.update=function(pMatrix){this.rotation=this.transform.skX;var tResultMatrix;if(pMatrix){tResultMatrix=this.resultTransform.getMatrix();Matrix.mul(tResultMatrix,pMatrix,this.resultMatrix);this.resultRotation=this.rotation;}
else{this.resultRotation=this.rotation+this.parentBone.resultRotation;if(this.parentBone){if(this.inheritRotation&&this.inheritScale){tResultMatrix=this.resultTransform.getMatrix();Matrix.mul(tResultMatrix,this.parentBone.resultMatrix,this.resultMatrix);}
else{var temp=0;var parent=this.parentBone;var tAngle=NaN;var cos=NaN;var sin=NaN;var tParentMatrix=this.parentBone.resultMatrix;tResultMatrix=this.resultTransform.getMatrix();var worldX=tParentMatrix.a*tResultMatrix.tx+tParentMatrix.c*tResultMatrix.ty+tParentMatrix.tx;var worldY=tParentMatrix.b*tResultMatrix.tx+tParentMatrix.d*tResultMatrix.ty+tParentMatrix.ty;var tTestMatrix=new Matrix();if(this.inheritRotation){tAngle=Math.atan2(parent.resultMatrix.b,parent.resultMatrix.a);cos=Math.cos(tAngle),sin=Math.sin(tAngle);tTestMatrix.setTo(cos,sin,-sin,cos,0,0);Matrix.mul(this._tempMatrix,tTestMatrix,Matrix.TEMP);Matrix.TEMP.copyTo(tTestMatrix);tResultMatrix=this.resultTransform.getMatrix();Matrix.mul(tResultMatrix,tTestMatrix,this.resultMatrix);if(this.resultTransform.scX*this.resultTransform.scY<0){this.resultMatrix.rotate(Math.PI*0.5);}
this.resultMatrix.tx=worldX;this.resultMatrix.ty=worldY;}
else if(this.inheritScale){tResultMatrix=this.resultTransform.getMatrix();Matrix.TEMP.identity();Matrix.TEMP.d=this.d;Matrix.mul(tResultMatrix,Matrix.TEMP,this.resultMatrix);this.resultMatrix.tx=worldX;this.resultMatrix.ty=worldY;}
else{tResultMatrix=this.resultTransform.getMatrix();Matrix.TEMP.identity();Matrix.TEMP.d=this.d;Matrix.mul(tResultMatrix,Matrix.TEMP,this.resultMatrix);this.resultMatrix.tx=worldX;this.resultMatrix.ty=worldY;}}}
else{tResultMatrix=this.resultTransform.getMatrix();tResultMatrix.copyTo(this.resultMatrix);}};var i=0,n=0;var tBone;for(i=0,n=this._children.length;i<n;i++){tBone=this._children[i];tBone.update();}}
__proto.updateChild=function(){var i=0,n=0;var tBone;for(i=0,n=this._children.length;i<n;i++){tBone=this._children[i];tBone.update();}}
__proto.setRotation=function(rd){if(this._sprite){this._sprite.rotation=rd*180/Math.PI;}}
__proto.updateDraw=function(x,y){if(!Bone.ShowBones||Bone.ShowBones[this.name]){if(this._sprite){this._sprite.x=x+this.resultMatrix.tx;this._sprite.y=y+this.resultMatrix.ty;}
else{this._sprite=new Sprite();this._sprite.graphics.drawCircle(0,0,5,"#ff0000");this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00");this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center");Laya.stage.addChild(this._sprite);this._sprite.x=x+this.resultMatrix.tx;this._sprite.y=y+this.resultMatrix.ty;}};var i=0,n=0;var tBone;for(i=0,n=this._children.length;i<n;i++){tBone=this._children[i];tBone.updateDraw(x,y);}}
__proto.addChild=function(bone){this._children.push(bone);bone.parentBone=this;}
__proto.findBone=function(boneName){if(this.name==boneName){return this;}
else{var i=0,n=0;var tBone;var tResult;for(i=0,n=this._children.length;i<n;i++){tBone=this._children[i];tResult=tBone.findBone(boneName);if(tResult){return tResult;}}}
return null;}
__proto.localToWorld=function(local){var localX=local[0];var localY=local[1];local[0]=localX*this.resultMatrix.a+localY*this.resultMatrix.c+this.resultMatrix.tx;local[1]=localX*this.resultMatrix.b+localY*this.resultMatrix.d+this.resultMatrix.ty;}
Bone.ShowBones={};return Bone;})()
var BoneSlot=(function(){function BoneSlot(){this.name=null;this.parent=null;this.attachmentName=null;this.srcDisplayIndex=-1;this.type="src";this.templet=null;this.currSlotData=null;this.currTexture=null;this.currDisplayData=null;this.displayIndex=-1;this._diyTexture=null;this._parentMatrix=null;this._resultMatrix=null;this._replaceDic={};this._curDiyUV=null;this._curDiyVS=null;this._skinSprite=null;this.deformData=null;this._mVerticleArr=null;}
__class(BoneSlot,'laya.ani.bone.BoneSlot');var __proto=BoneSlot.prototype;__proto.showSlotData=function(slotData,freshIndex){(freshIndex===void 0)&&(freshIndex=true);this.currSlotData=slotData;if(freshIndex)
this.displayIndex=this.srcDisplayIndex;this.currDisplayData=null;this.currTexture=null;}
__proto.showDisplayByName=function(name){if(this.currSlotData){this.showDisplayByIndex(this.currSlotData.getDisplayByName(name));}}
__proto.replaceDisplayByName=function(tarName,newName){if(!this.currSlotData)return;var preIndex=0;preIndex=this.currSlotData.getDisplayByName(tarName);var newIndex=0;newIndex=this.currSlotData.getDisplayByName(newName);this.replaceDisplayByIndex(preIndex,newIndex);}
__proto.replaceDisplayByIndex=function(tarIndex,newIndex){if(!this.currSlotData)return;this._replaceDic[tarIndex]=newIndex;if(this.displayIndex==tarIndex){this.showDisplayByIndex(tarIndex);}}
__proto.showDisplayByIndex=function(index){if(this._replaceDic[index]!=null)index=this._replaceDic[index];if(this.currSlotData&&index>-1&&index<this.currSlotData.displayArr.length){this.displayIndex=index;this.currDisplayData=this.currSlotData.displayArr[index];if(this.currDisplayData){var tName=this.currDisplayData.name;this.currTexture=this.templet.getTexture(tName);if(this.currTexture&&!Render.isConchApp&&this.currDisplayData.type==0&&this.currDisplayData.uvs){this.currTexture=this.currDisplayData.createTexture(this.currTexture);}}}else{this.displayIndex=-1;this.currDisplayData=null;this.currTexture=null;}}
__proto.replaceSkin=function(_texture){this._diyTexture=_texture;if(this._curDiyUV)this._curDiyUV.length=0;if(this.currDisplayData&&this._diyTexture==this.currDisplayData.texture){this._diyTexture=null;}}
__proto.setParentMatrix=function(parentMatrix){this._parentMatrix=parentMatrix;}
__proto.draw=function(graphics,boneMatrixArray,noUseSave,alpha){(noUseSave===void 0)&&(noUseSave=false);(alpha===void 0)&&(alpha=1);if((this._diyTexture==null&&this.currTexture==null)||this.currDisplayData==null){if(!(this.currDisplayData&&this.currDisplayData.type==3)){return;}};var tTexture=this.currTexture;if(this._diyTexture)tTexture=this._diyTexture;var tSkinSprite;switch(this.currDisplayData.type){case 0:if(graphics){var tCurrentMatrix=this.getDisplayMatrix();if(this._parentMatrix){var tRotateKey=false;if(tCurrentMatrix){Matrix.mul(tCurrentMatrix,this._parentMatrix,Matrix.TEMP);var tResultMatrix;if(noUseSave){if(this._resultMatrix==null)this._resultMatrix=new Matrix();tResultMatrix=this._resultMatrix;}else{tResultMatrix=new Matrix();}
if((!Render.isWebGL&&this.currDisplayData.uvs)||(Render.isWebGL&&this._diyTexture&&this.currDisplayData.uvs)){var tTestMatrix=BoneSlot._tempMatrix;tTestMatrix.identity();if(this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]){tTestMatrix.d=-1;}
if(this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]){tRotateKey=true;tTestMatrix.rotate(-Math.PI/2);}
Matrix.mul(tTestMatrix,Matrix.TEMP,tResultMatrix);}else{Matrix.TEMP.copyTo(tResultMatrix);}
if(tRotateKey){graphics.drawTexture(tTexture,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,tResultMatrix);}else{graphics.drawTexture(tTexture,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,tResultMatrix);}}}}
break;case 1:if(noUseSave){if(this._skinSprite==null){this._skinSprite=BoneSlot.createSkinMesh();}
tSkinSprite=this._skinSprite;}else{tSkinSprite=BoneSlot.createSkinMesh();}
if(tSkinSprite==null){return;};var tIBArray;var tRed=1;var tGreed=1;var tBlue=1;var tAlpha=1;if(this.currDisplayData.bones==null){var tVertices=this.currDisplayData.weights;if(this.deformData){tVertices=this.deformData;};var tUVs;if(this._diyTexture){if(!this._curDiyUV){this._curDiyUV=[];}
if(this._curDiyUV.length==0){this._curDiyUV=UVTools.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV);this._curDiyUV=UVTools.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV);}
tUVs=this._curDiyUV;}else{tUVs=this.currDisplayData.uvs;}
this._mVerticleArr=tVertices;var tTriangleNum=this.currDisplayData.triangles.length/3;tIBArray=this.currDisplayData.triangles;tSkinSprite.init2(tTexture,null,tIBArray,this._mVerticleArr,tUVs);var tCurrentMatrix2=this.getDisplayMatrix();if(this._parentMatrix){if(tCurrentMatrix2){Matrix.mul(tCurrentMatrix2,this._parentMatrix,Matrix.TEMP);var tResultMatrix2;if(noUseSave){if(this._resultMatrix==null)this._resultMatrix=new Matrix();tResultMatrix2=this._resultMatrix;}else{tResultMatrix2=new Matrix();}
Matrix.TEMP.copyTo(tResultMatrix2);tSkinSprite.transform=tResultMatrix2;}}}else{this.skinMesh(boneMatrixArray,tSkinSprite,alpha);}
graphics.drawSkin(tSkinSprite);break;case 2:if(noUseSave){if(this._skinSprite==null){this._skinSprite=BoneSlot.createSkinMesh();}
tSkinSprite=this._skinSprite;}else{tSkinSprite=BoneSlot.createSkinMesh();}
if(tSkinSprite==null){return;}
this.skinMesh(boneMatrixArray,tSkinSprite,alpha);graphics.drawSkin(tSkinSprite);break;case 3:break;}}
__proto.skinMesh=function(boneMatrixArray,skinSprite,alpha){var tTexture=this.currTexture;var tBones=this.currDisplayData.bones;var tUvs;if(this._diyTexture){tTexture=this._diyTexture;if(!this._curDiyUV){this._curDiyUV=[];}
if(this._curDiyUV.length==0){this._curDiyUV=UVTools.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV);this._curDiyUV=UVTools.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV);}
tUvs=this._curDiyUV;}else{tUvs=this.currDisplayData.uvs;};var tWeights=this.currDisplayData.weights;var tTriangles=this.currDisplayData.triangles;var tIBArray;var tRx=0;var tRy=0;var nn=0;var tMatrix;var tX=NaN;var tY=NaN;var tB=0;var tWeight=0;var tVertices=[];var i=0,j=0,n=0;var tRed=1;var tGreed=1;var tBlue=1;var tAlpha=alpha;if(this.deformData&&this.deformData.length>0){var f=0;for(i=0,n=tBones.length;i<n;){nn=tBones[i++]+i;tRx=0,tRy=0;for(;i<nn;i++){tMatrix=boneMatrixArray[tBones[i]]
tX=tWeights[tB]+this.deformData[f++];tY=tWeights[tB+1]+this.deformData[f++];tWeight=tWeights[tB+2];tRx+=(tX*tMatrix.a+tY*tMatrix.c+tMatrix.tx)*tWeight;tRy+=(tX*tMatrix.b+tY*tMatrix.d+tMatrix.ty)*tWeight;tB+=3;}
tVertices.push(tRx,tRy);}}else{for(i=0,n=tBones.length;i<n;){nn=tBones[i++]+i;tRx=0,tRy=0;for(;i<nn;i++){tMatrix=boneMatrixArray[tBones[i]]
tX=tWeights[tB];tY=tWeights[tB+1];tWeight=tWeights[tB+2];tRx+=(tX*tMatrix.a+tY*tMatrix.c+tMatrix.tx)*tWeight;tRy+=(tX*tMatrix.b+tY*tMatrix.d+tMatrix.ty)*tWeight;tB+=3;}
tVertices.push(tRx,tRy);}}
this._mVerticleArr=tVertices;tIBArray=tTriangles;skinSprite.init2(tTexture,null,tIBArray,this._mVerticleArr,tUvs);}
__proto.drawBonePoint=function(graphics){if(graphics&&this._parentMatrix){graphics.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000");}}
__proto.getDisplayMatrix=function(){if(this.currDisplayData){return this.currDisplayData.transform.getMatrix();}
return null;}
__proto.getMatrix=function(){return this._resultMatrix;}
__proto.copy=function(){var tBoneSlot=new BoneSlot();tBoneSlot.type="copy";tBoneSlot.name=this.name;tBoneSlot.attachmentName=this.attachmentName;tBoneSlot.srcDisplayIndex=this.srcDisplayIndex;tBoneSlot.parent=this.parent;tBoneSlot.displayIndex=this.displayIndex;tBoneSlot.templet=this.templet;tBoneSlot.currSlotData=this.currSlotData;tBoneSlot.currTexture=this.currTexture;tBoneSlot.currDisplayData=this.currDisplayData;return tBoneSlot;}
BoneSlot.createSkinMesh=function(){if(Render.isWebGL||Render.isConchApp){return RunDriver.skinAniSprite();}else{if(!Render.isWebGL){if(Skeleton.useSimpleMeshInCanvas){return new SimpleSkinMeshCanvas();}else{return new SkinMeshCanvas();}}}
return null;}
__static(BoneSlot,['_tempMatrix',function(){return this._tempMatrix=new Matrix();}]);return BoneSlot;})()
var CanvasMeshRender=(function(){function CanvasMeshRender(){this.mesh=null;this.transform=null;this.context=null;this.mode=0;}
__class(CanvasMeshRender,'laya.ani.bone.canvasmesh.CanvasMeshRender');var __proto=CanvasMeshRender.prototype;__proto.renderToContext=function(context){this.context=context.ctx||context;if(this.mesh){if(this.mode==0){this._renderWithIndexes(this.mesh);}else{this._renderNoIndexes(this.mesh);}}}
__proto._renderNoIndexes=function(mesh){var i=0,len=mesh.vertices.length/2;var index=0;for(i=0;i<len-2;i++){index=i*2;this._renderDrawTriangle(mesh,index,(index+2),(index+4));}}
__proto._renderWithIndexes=function(mesh){var indexes=mesh.indexes;var i=0,len=indexes.length;for(i=0;i<len;i+=3){var index0=indexes[i]*2;var index1=indexes[i+1]*2;var index2=indexes[i+2]*2;this._renderDrawTriangle(mesh,index0,index1,index2);}}
__proto._renderDrawTriangle=function(mesh,index0,index1,index2){var context=this.context;var uvs=mesh.uvs;var vertices=mesh.vertices;var texture=mesh.texture;var source=texture.bitmap;var textureSource=source.source;var textureWidth=texture.width;var textureHeight=texture.height;var sourceWidth=source.width;var sourceHeight=source.height;var u0=NaN;var u1=NaN;var u2=NaN;var v0=NaN;var v1=NaN;var v2=NaN;if(mesh.useUvTransform){var ut=mesh.uvTransform;u0=((uvs[index0]*ut.a)+(uvs[index0+1]*ut.c)+ut.tx)*sourceWidth;u1=((uvs[index1]*ut.a)+(uvs[index1+1]*ut.c)+ut.tx)*sourceWidth;u2=((uvs[index2]*ut.a)+(uvs[index2+1]*ut.c)+ut.tx)*sourceWidth;v0=((uvs[index0]*ut.b)+(uvs[index0+1]*ut.d)+ut.ty)*sourceHeight;v1=((uvs[index1]*ut.b)+(uvs[index1+1]*ut.d)+ut.ty)*sourceHeight;v2=((uvs[index2]*ut.b)+(uvs[index2+1]*ut.d)+ut.ty)*sourceHeight;}
else{u0=uvs[index0]*sourceWidth;u1=uvs[index1]*sourceWidth;u2=uvs[index2]*sourceWidth;v0=uvs[index0+1]*sourceHeight;v1=uvs[index1+1]*sourceHeight;v2=uvs[index2+1]*sourceHeight;};var x0=vertices[index0];var x1=vertices[index1];var x2=vertices[index2];var y0=vertices[index0+1];var y1=vertices[index1+1];var y2=vertices[index2+1];if(mesh.canvasPadding>0){var paddingX=mesh.canvasPadding;var paddingY=mesh.canvasPadding;var centerX=(x0+x1+x2)/3;var centerY=(y0+y1+y2)/3;var normX=x0-centerX;var normY=y0-centerY;var dist=Math.sqrt((normX*normX)+(normY*normY));x0=centerX+((normX/dist)*(dist+paddingX));y0=centerY+((normY/dist)*(dist+paddingY));normX=x1-centerX;normY=y1-centerY;dist=Math.sqrt((normX*normX)+(normY*normY));x1=centerX+((normX/dist)*(dist+paddingX));y1=centerY+((normY/dist)*(dist+paddingY));normX=x2-centerX;normY=y2-centerY;dist=Math.sqrt((normX*normX)+(normY*normY));x2=centerX+((normX/dist)*(dist+paddingX));y2=centerY+((normY/dist)*(dist+paddingY));}
context.save();if(this.transform){var mt=this.transform;context.transform(mt.a,mt.b,mt.c,mt.d,mt.tx,mt.ty);}
context.beginPath();context.moveTo(x0,y0);context.lineTo(x1,y1);context.lineTo(x2,y2);context.closePath();context.clip();var delta=(u0*v1)+(v0*u2)+(u1*v2)-(v1*u2)-(v0*u1)-(u0*v2);var dDelta=1/delta;var deltaA=(x0*v1)+(v0*x2)+(x1*v2)-(v1*x2)-(v0*x1)-(x0*v2);var deltaB=(u0*x1)+(x0*u2)+(u1*x2)-(x1*u2)-(x0*u1)-(u0*x2);var deltaC=(u0*v1*x2)+(v0*x1*u2)+(x0*u1*v2)-(x0*v1*u2)-(v0*u1*x2)-(u0*x1*v2);var deltaD=(y0*v1)+(v0*y2)+(y1*v2)-(v1*y2)-(v0*y1)-(y0*v2);var deltaE=(u0*y1)+(y0*u2)+(u1*y2)-(y1*u2)-(y0*u1)-(u0*y2);var deltaF=(u0*v1*y2)+(v0*y1*u2)+(y0*u1*v2)-(y0*v1*u2)-(v0*u1*y2)-(u0*y1*v2);context.transform(deltaA*dDelta,deltaD*dDelta,deltaB*dDelta,deltaE*dDelta,deltaC*dDelta,deltaF*dDelta);context.drawImage(textureSource,texture.uv[0]*sourceWidth,texture.uv[1]*sourceHeight,textureWidth,textureHeight,texture.uv[0]*sourceWidth,texture.uv[1]*sourceHeight,textureWidth,textureHeight);context.restore();}
return CanvasMeshRender;})()
var MeshData=(function(){function MeshData(){this.texture=null;this.uvs=[0,0,1,0,1,1,0,1];this.vertices=[0,0,100,0,100,100,0,100];this.indexes=[0,1,3,3,1,2];this.uvTransform=null;this.useUvTransform=false;this.canvasPadding=1;}
__class(MeshData,'laya.ani.bone.canvasmesh.MeshData');var __proto=MeshData.prototype;__proto.getBounds=function(){return Rectangle._getWrapRec(this.vertices);}
return MeshData;})()
var DeformAniData=(function(){function DeformAniData(){this.skinName=null;this.deformSlotDataList=[];}
__class(DeformAniData,'laya.ani.bone.DeformAniData');return DeformAniData;})()
var DeformSlotData=(function(){function DeformSlotData(){this.deformSlotDisplayList=[];}
__class(DeformSlotData,'laya.ani.bone.DeformSlotData');return DeformSlotData;})()
var DeformSlotDisplayData=(function(){function DeformSlotDisplayData(){this.boneSlot=null;this.slotIndex=-1;this.attachment=null;this.deformData=null;this.frameIndex=0;this.timeList=[];this.vectices=[];this.tweenKeyList=[];}
__class(DeformSlotDisplayData,'laya.ani.bone.DeformSlotDisplayData');var __proto=DeformSlotDisplayData.prototype;__proto.binarySearch1=function(values,target){var low=0;var high=values.length-2;if(high==0)
return 1;var current=high>>>1;while(true){if(values[Math.floor(current+1)]<=target)
low=current+1;else
high=current;if(low==high)
return low+1;current=(low+high)>>>1;}
return 0;}
__proto.apply=function(time,boneSlot,alpha){(alpha===void 0)&&(alpha=1);time+=0.05;if(this.timeList.length<=0){return;};var i=0;var n=0;var tTime=this.timeList[0];if(time<tTime){return;};var tVertexCount=this.vectices[0].length;var tVertices=[];var tFrameIndex=this.binarySearch1(this.timeList,time);this.frameIndex=tFrameIndex;if(time>=this.timeList[this.timeList.length-1]){var lastVertices=this.vectices[this.vectices.length-1];if(alpha<1){for(i=0;i<tVertexCount;i++){tVertices[i]+=(lastVertices[i]-tVertices[i])*alpha;}}else{for(i=0;i<tVertexCount;i++){tVertices[i]=lastVertices[i];}}
this.deformData=tVertices;return;};var tTweenKey=this.tweenKeyList[this.frameIndex];var tPrevVertices=this.vectices[this.frameIndex-1];var tNextVertices=this.vectices[this.frameIndex];var tPreFrameTime=this.timeList[this.frameIndex-1];var tFrameTime=this.timeList[this.frameIndex];if(this.tweenKeyList[tFrameIndex-1]){alpha=(time-tPreFrameTime)/(tFrameTime-tPreFrameTime);}else{alpha=0;};var tPrev=NaN;for(i=0;i<tVertexCount;i++){tPrev=tPrevVertices[i];tVertices[i]=tPrev+(tNextVertices[i]-tPrev)*alpha;}
this.deformData=tVertices;}
return DeformSlotDisplayData;})()
var DrawOrderData=(function(){function DrawOrderData(){this.time=NaN;this.drawOrder=[];}
__class(DrawOrderData,'laya.ani.bone.DrawOrderData');return DrawOrderData;})()
var EventData=(function(){function EventData(){this.name=null;this.intValue=0;this.floatValue=NaN;this.stringValue=null;this.time=NaN;}
__class(EventData,'laya.ani.bone.EventData');return EventData;})()
var IkConstraint=(function(){function IkConstraint(data,bones){this._targetBone=null;this._bones=null;this._data=null;this.name=null;this.mix=NaN;this.bendDirection=NaN;this.isSpine=true;this._sp=null;this.isDebug=false;this._data=data;this._targetBone=bones[data.targetBoneIndex];this.isSpine=data.isSpine;if(this._bones==null)this._bones=[];this._bones.length=0;for(var i=0,n=data.boneIndexs.length;i<n;i++){this._bones.push(bones[data.boneIndexs[i]]);}
this.name=data.name;this.mix=data.mix;this.bendDirection=data.bendDirection;}
__class(IkConstraint,'laya.ani.bone.IkConstraint');var __proto=IkConstraint.prototype;__proto.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:if(this.isSpine){this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix);}else{this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix);}
break;}}
__proto._applyIk1=function(bone,targetX,targetY,alpha){var pp=bone.parentBone;var id=1/(pp.resultMatrix.a*pp.resultMatrix.d-pp.resultMatrix.b*pp.resultMatrix.c);var x=targetX-pp.resultMatrix.tx;var y=targetY-pp.resultMatrix.ty;var tx=(x*pp.resultMatrix.d-y*pp.resultMatrix.c)*id-bone.transform.x;var ty=(y*pp.resultMatrix.a-x*pp.resultMatrix.b)*id-bone.transform.y;var rotationIK=Math.atan2(ty,tx)*IkConstraint.radDeg-0-bone.transform.skX;if(bone.transform.scX<0)rotationIK+=180;if(rotationIK>180)
rotationIK-=360;else if(rotationIK<-180)rotationIK+=360;bone.transform.skX=bone.transform.skY=bone.transform.skX+rotationIK*alpha;bone.update();}
__proto.updatePos=function(x,y){if(this._sp){this._sp.pos(x,y);}}
__proto._applyIk2=function(parent,child,targetX,targetY,bendDir,alpha){if(alpha==0){return;};var px=parent.resultTransform.x,py=parent.resultTransform.y;var psx=parent.transform.scX,psy=parent.transform.scY;var csx=child.transform.scX;var os1=0,os2=0,s2=0;if(psx<0){psx=-psx;os1=180;s2=-1;}else{os1=0;s2=1;}
if(psy<0){psy=-psy;s2=-s2;}
if(csx<0){csx=-csx;os2=180;}else{os2=0};var cx=child.resultTransform.x,cy=NaN,cwx=NaN,cwy=NaN;var a=parent.resultMatrix.a,b=parent.resultMatrix.c;var c=parent.resultMatrix.b,d=parent.resultMatrix.d;var u=Math.abs(psx-psy)<=0.0001;if(!u){cy=0;cwx=a*cx+parent.resultMatrix.tx;cwy=c*cx+parent.resultMatrix.ty;}else{cy=child.resultTransform.y;cwx=a*cx+b*cy+parent.resultMatrix.tx;cwy=c*cx+d*cy+parent.resultMatrix.ty;}
if(this.isDebug){if(!this._sp){this._sp=new Sprite();Laya.stage.addChild(this._sp);}
this._sp.graphics.clear();this._sp.graphics.drawCircle(targetX,targetY,15,"#ffff00");this._sp.graphics.drawCircle(cwx,cwy,15,"#ff00ff");}
parent.setRotation(Math.atan2(cwy-parent.resultMatrix.ty,cwx-parent.resultMatrix.tx));var pp=parent.parentBone;a=pp.resultMatrix.a;b=pp.resultMatrix.c;c=pp.resultMatrix.b;d=pp.resultMatrix.d;var id=1/(a*d-b*c);var x=targetX-pp.resultMatrix.tx,y=targetY-pp.resultMatrix.ty;var tx=(x*d-y*b)*id-px;var ty=(y*a-x*c)*id-py;x=cwx-pp.resultMatrix.tx;y=cwy-pp.resultMatrix.ty;var dx=(x*d-y*b)*id-px;var dy=(y*a-x*c)*id-py;var l1=Math.sqrt(dx*dx+dy*dy);var l2=child.length*csx;var a1=NaN,a2=NaN;if(u){l2*=psx;var cos=(tx*tx+ty*ty-l1*l1-l2*l2)/(2*l1*l2);if(cos<-1)
cos=-1;else if(cos>1)cos=1;a2=Math.acos(cos)*bendDir;a=l1+l2*cos;b=l2*Math.sin(a2);a1=Math.atan2(ty*a-tx*b,tx*a+ty*b);}else{a=psx*l2;b=psy*l2;var aa=a*a,bb=b*b,dd=tx*tx+ty*ty,ta=Math.atan2(ty,tx);c=bb*l1*l1+aa*dd-aa*bb;var c1=-2*bb*l1,c2=bb-aa;d=c1*c1-4*c2*c;if(d>0){var q=Math.sqrt(d);if(c1<0)q=-q;q=-(c1+q)/2;var r0=q/c2,r1=c/q;var r=Math.abs(r0)<Math.abs(r1)?r0:r1;if(r*r<=dd){y=Math.sqrt(dd-r*r)*bendDir;a1=ta-Math.atan2(y,r);a2=Math.atan2(y/psy,(r-l1)/psx);}};var minAngle=0,minDist=Number.MAX_VALUE,minX=0,minY=0;var maxAngle=0,maxDist=0,maxX=0,maxY=0;x=l1+a;d=x*x;if(d>maxDist){maxAngle=0;maxDist=d;maxX=x;}
x=l1-a;d=x*x;if(d<minDist){minAngle=Math.PI;minDist=d;minX=x;};var angle=Math.acos(-a*l1/(aa-bb));x=a*Math.cos(angle)+l1;y=b*Math.sin(angle);d=x*x+y*y;if(d<minDist){minAngle=angle;minDist=d;minX=x;minY=y;}
if(d>maxDist){maxAngle=angle;maxDist=d;maxX=x;maxY=y;}
if(dd<=(minDist+maxDist)/2){a1=ta-Math.atan2(minY*bendDir,minX);a2=minAngle*bendDir;}else{a1=ta-Math.atan2(maxY*bendDir,maxX);a2=maxAngle*bendDir;}};var os=Math.atan2(cy,cx)*s2;var rotation=parent.resultTransform.skX;a1=(a1-os)*IkConstraint.radDeg+os1-rotation;if(a1>180)
a1-=360;else if(a1<-180)a1+=360;parent.resultTransform.x=px;parent.resultTransform.y=py;parent.resultTransform.skX=parent.resultTransform.skY=rotation+a1*alpha;rotation=child.resultTransform.skX;rotation=rotation%360;a2=((a2+os)*IkConstraint.radDeg-0)*s2+os2-rotation;if(a2>180)
a2-=360;else if(a2<-180)a2+=360;child.resultTransform.x=cx;child.resultTransform.y=cy;child.resultTransform.skX=child.resultTransform.skY=child.resultTransform.skY+a2*alpha;parent.update();}
__proto._applyIk3=function(parent,child,targetX,targetY,bendDir,alpha){if(alpha==0){return;};var cwx=NaN,cwy=NaN;var x=child.resultMatrix.a*child.length;var y=child.resultMatrix.b*child.length;var lLL=x*x+y*y;var lL=Math.sqrt(lLL);var parentX=parent.resultMatrix.tx;var parentY=parent.resultMatrix.ty;var childX=child.resultMatrix.tx;var childY=child.resultMatrix.ty;var dX=childX-parentX;var dY=childY-parentY;var lPP=dX*dX+dY*dY;var lP=Math.sqrt(lPP);dX=targetX-parent.resultMatrix.tx;dY=targetY-parent.resultMatrix.ty;var lTT=dX*dX+dY*dY;var lT=Math.sqrt(lTT);var ikRadianA=0;if(lL+lP<=lT||lT+lL<=lP||lT+lP<=lL){var rate=NaN;if(lL+lP<=lT){rate=1;}else{rate=-1;}
childX=parentX+rate*(targetX-parentX)*lP/lT;childY=parentY+rate*(targetY-parentY)*lP/lT;}
else{var h=(lPP-lLL+lTT)/(2*lTT);var r=Math.sqrt(lPP-h*h*lTT)/lT;var hX=parentX+(dX*h);var hY=parentY+(dY*h);var rX=-dY*r;var rY=dX*r;if(bendDir>0){childX=hX-rX;childY=hY-rY;}
else{childX=hX+rX;childY=hY+rY;}}
cwx=childX;cwy=childY;if(this.isDebug){if(!this._sp){this._sp=new Sprite();Laya.stage.addChild(this._sp);}
this._sp.graphics.clear();this._sp.graphics.drawCircle(parentX,parentY,15,"#ff00ff");this._sp.graphics.drawCircle(targetX,targetY,15,"#ffff00");this._sp.graphics.drawCircle(cwx,cwy,15,"#ff00ff");};var pRotation=NaN;pRotation=Math.atan2(cwy-parent.resultMatrix.ty,cwx-parent.resultMatrix.tx);parent.setRotation(pRotation);var pTarMatrix;pTarMatrix=IkConstraint._tempMatrix;pTarMatrix.identity();pTarMatrix.rotate(pRotation);pTarMatrix.scale(parent.resultMatrix.getScaleX(),parent.resultMatrix.getScaleY());pTarMatrix.translate(parent.resultMatrix.tx,parent.resultMatrix.ty);pTarMatrix.copyTo(parent.resultMatrix);parent.updateChild();var childRotation=NaN;childRotation=Math.atan2(targetY-cwy,targetX-cwx);child.setRotation(childRotation);var childTarMatrix;childTarMatrix=IkConstraint._tempMatrix;childTarMatrix.identity();childTarMatrix.rotate(childRotation);childTarMatrix.scale(child.resultMatrix.getScaleX(),child.resultMatrix.getScaleY());childTarMatrix.translate(cwx,cwy);pTarMatrix.copyTo(child.resultMatrix);child.updateChild();}
__static(IkConstraint,['radDeg',function(){return this.radDeg=180/Math.PI;},'degRad',function(){return this.degRad=Math.PI/180;},'_tempMatrix',function(){return this._tempMatrix=new Matrix();}]);return IkConstraint;})()
var IkConstraintData=(function(){function IkConstraintData(){this.name=null;this.targetBoneName=null;this.bendDirection=1;this.mix=1;this.isSpine=true;this.targetBoneIndex=-1;this.boneNames=[];this.boneIndexs=[];}
__class(IkConstraintData,'laya.ani.bone.IkConstraintData');return IkConstraintData;})()
var MeshTools=(function(){function MeshTools(){}
__class(MeshTools,'laya.ani.bone.MeshTools');MeshTools.findEdge=function(verticles,offI,min){(offI===void 0)&&(offI=0);(min===void 0)&&(min=true);var i=0,len=0;var tIndex=0;len=verticles.length;tIndex=-1;for(i=0;i<len;i+=2){if(tIndex<0||(min==(verticles[tIndex+offI]<verticles[i+offI]))){tIndex=i;}}
return tIndex;}
MeshTools.findBestTriangle=function(verticles){var topI=0;topI=MeshTools.findEdge(verticles,1,true);var bottomI=0;bottomI=MeshTools.findEdge(verticles,1,false);var leftI=0;leftI=MeshTools.findEdge(verticles,0,true);var rightI=0;rightI=MeshTools.findEdge(verticles,0,false);var rst;rst=MeshTools._bestTriangle;rst.length=0;rst.push(leftI,rightI);if(rst.indexOf(topI)<0)rst.push(topI);if(rst.indexOf(bottomI)<0)rst.push(bottomI);return rst;}
MeshTools.solveMesh=function(mesh,rst){rst=rst||[];rst.length=0;var mUv;mUv=mesh.uvs;var mVer;mVer=mesh.vertices;var uvAbs;var indexs;indexs=MeshTools.findBestTriangle(mUv);var index0=0;var index1=0;var index2=0;index0=indexs[0];index1=indexs[1];index2=indexs[2];MeshTools._absArr.length=0;uvAbs=MeshTools.solvePoints(mesh.texture.uv,mUv[index0],mUv[index0+1],mUv[index1]-mUv[index0],mUv[index1+1]-mUv[index0+1],mUv[index2]-mUv[index0],mUv[index2+1]-mUv[index0+1],MeshTools._absArr);var newVerticles;newVerticles=MeshTools.transPoints(uvAbs,mVer[index0],mVer[index0+1],mVer[index1]-mVer[index0],mVer[index1+1]-mVer[index0+1],mVer[index2]-mVer[index0],mVer[index2+1]-mVer[index0+1],rst);return newVerticles;}
MeshTools.solvePoints=function(pointList,oX,oY,v1x,v1y,v2x,v2y,rst){rst=rst||[];var i=0,len=0;len=pointList.length;var tRst;for(i=0;i<len;i+=2){tRst=MeshTools.solve2(pointList[i],pointList[i+1],oX,oY,v1x,v1y,v2x,v2y);rst.push(tRst[0],tRst[1]);}
return rst;}
MeshTools.transPoints=function(abs,oX,oY,v1x,v1y,v2x,v2y,rst){rst=rst||[];var i=0,len=0;len=abs.length;var tRst;for(i=0;i<len;i+=2){tRst=MeshTools.transPoint(abs[i],abs[i+1],oX,oY,v1x,v1y,v2x,v2y,rst);}
return rst;}
MeshTools.transPoint=function(a,b,oX,oY,v1x,v1y,v2x,v2y,rst){rst=rst||[];var nX=NaN;var nY=NaN;nX=oX+v1x*a+v2x*b;nY=oY+v1y*a+v2y*b;rst.push(nX,nY)
return rst;}
MeshTools.solve2=function(rx,ry,oX,oY,v1x,v1y,v2x,v2y,rv,rst){(rv===void 0)&&(rv=false);rst=rst||[];var a=NaN,b=NaN;if(v1x==0){return MeshTools.solve2(rx,ry,oX,oY,v2x,v2y,v1x,v1y,true,rst);};var dX=NaN;var dY=NaN;dX=rx-oX;dY=ry-oY;b=(dY-dX*v1y/v1x)/(v2y-v2x*v1y/v1x);a=(dX-b*v2x)/v1x;if(rv){rst.push(b,a);}else{rst.push(a,b);}
return rst;}
MeshTools.solve=function(pointC,point0,v1,v2){return MeshTools.solve2(pointC.x,pointC.y,point0.x,point0.y,v1.x,v1.y,v2.x,v2.y);}
MeshTools._bestTriangle=[];MeshTools._absArr=[];return MeshTools;})()
var PathConstraint=(function(){function PathConstraint(data,bones){this.target=null;this.data=null;this.bones=null;this.position=NaN;this.spacing=NaN;this.rotateMix=NaN;this.translateMix=NaN;this._debugKey=false;this._spaces=null;this._segments=[];this._curves=[];this.data=data;this.position=data.position;this.spacing=data.spacing;this.rotateMix=data.rotateMix;this.translateMix=data.translateMix;this.bones=[];var tBoneIds=this.data.bones;for(var i=0,n=tBoneIds.length;i<n;i++){this.bones.push(bones[tBoneIds[i]]);}}
__class(PathConstraint,'laya.ani.bone.PathConstraint');var __proto=PathConstraint.prototype;__proto.apply=function(boneList,graphics){if(!this.target)
return;var tTranslateMix=this.translateMix;var tRotateMix=this.translateMix;var tTranslate=tTranslateMix>0;var tRotate=tRotateMix>0;var tSpacingMode=this.data.spacingMode;var tLengthSpacing=tSpacingMode=="length";var tRotateMode=this.data.rotateMode;var tTangents=tRotateMode=="tangent";var tScale=tRotateMode=="chainScale";var lengths=[];var boneCount=this.bones.length;var spacesCount=tTangents?boneCount:boneCount+1;var spaces=[];this._spaces=spaces;spaces[0]=this.position;var spacing=this.spacing;if(tScale||tLengthSpacing){for(var i=0,n=spacesCount-1;i<n;){var bone=this.bones[i];var length=bone.length;var x=length*bone.resultMatrix.a;var y=length*bone.resultMatrix.b;length=Math.sqrt(x*x+y*y);if(tScale)
lengths[i]=length;spaces[++i]=tLengthSpacing?Math.max(0,length+spacing):spacing;}}
else{for(i=1;i<spacesCount;i++){spaces[i]=spacing;}};var positions=this.computeWorldPositions(this.target,boneList,graphics,spacesCount,tTangents,this.data.positionMode=="percent",tSpacingMode=="percent");if(this._debugKey){for(i=0;i<positions.length;i++){graphics.drawCircle(positions[i++],positions[i++],5,"#00ff00");};var tLinePos=[];for(i=0;i<positions.length;i++){tLinePos.push(positions[i++],positions[i++]);}
graphics.drawLines(0,0,tLinePos,"#ff0000");};var skeletonX=NaN;var skeletonY=NaN;var boneX=positions[0];var boneY=positions[1];var offsetRotation=this.data.offsetRotation;var tip=tRotateMode=="chain"&&offsetRotation==0;var p=NaN;for(i=0,p=3;i<boneCount;i++,p+=3){bone=this.bones[i];bone.resultMatrix.tx+=(boneX-bone.resultMatrix.tx)*tTranslateMix;bone.resultMatrix.ty+=(boneY-bone.resultMatrix.ty)*tTranslateMix;x=positions[p];y=positions[p+1];var dx=x-boneX,dy=y-boneY;if(tScale){length=lengths[i];if(length!=0){var s=(Math.sqrt(dx*dx+dy*dy)/length-1)*tRotateMix+1;bone.resultMatrix.a*=s;bone.resultMatrix.c*=s;}}
boneX=x;boneY=y;if(tRotate){var a=bone.resultMatrix.a;var b=bone.resultMatrix.c;var c=bone.resultMatrix.b;var d=bone.resultMatrix.d;var r=NaN;var cos=NaN;var sin=NaN;if(tTangents){r=positions[p-1];}
else if(spaces[i+1]==0){r=positions[p+2];}
else{r=Math.atan2(dy,dx);}
r-=Math.atan2(c,a)-offsetRotation/180*Math.PI;if(tip){cos=Math.cos(r);sin=Math.sin(r);length=bone.length;boneX+=(length*(cos*a-sin*c)-dx)*tRotateMix;boneY+=(length*(sin*a+cos*c)-dy)*tRotateMix;}
if(r>Math.PI){r-=(Math.PI*2);}
else if(r<-Math.PI){r+=(Math.PI*2);}
r*=tRotateMix;cos=Math.cos(r);sin=Math.sin(r);bone.resultMatrix.a=cos*a-sin*c;bone.resultMatrix.c=cos*b-sin*d;bone.resultMatrix.b=sin*a+cos*c;bone.resultMatrix.d=sin*b+cos*d;}}}
__proto.computeWorldVertices2=function(boneSlot,boneList,start,count,worldVertices,offset){var tBones=boneSlot.currDisplayData.bones;var tWeights=boneSlot.currDisplayData.weights;var tTriangles=boneSlot.currDisplayData.triangles;var tMatrix;var i=0;var v=0;var skip=0;var n=0;var w=0;var b=0;var wx=0;var wy=0;var vx=0;var vy=0;var bone;var len=0;if(tBones==null){if(!tTriangles)tTriangles=tWeights;if(boneSlot.deformData)
tTriangles=boneSlot.deformData;var parentName;parentName=boneSlot.parent;if(boneList){len=boneList.length;for(i=0;i<len;i++){if(boneList[i].name==parentName){bone=boneList[i];break;}}};var tBoneMt;if(bone){tBoneMt=bone.resultMatrix;}
if(!tBoneMt)tBoneMt=PathConstraint._tempMt;var x=tBoneMt.tx;var y=tBoneMt.ty;var a=tBoneMt.a,bb=tBoneMt.b,c=tBoneMt.c,d=tBoneMt.d;if(bone)d*=bone.d;for(v=start,w=offset;w<count;v+=2,w+=2){vx=tTriangles[v],vy=tTriangles[v+1];worldVertices[w]=vx*a+vy*bb+x;worldVertices[w+1]=-(vx*c+vy*d+y);}
return;}
for(i=0;i<start;i+=2){n=tBones[v];v+=n+1;skip+=n;};var skeletonBones=boneList;for(w=offset,b=skip*3;w<count;w+=2){wx=0,wy=0;n=tBones[v++];n+=v;for(;v<n;v++,b+=3){tMatrix=skeletonBones[tBones[v]].resultMatrix;vx=tWeights[b];vy=tWeights[b+1];var weight=tWeights[b+2];wx+=(vx*tMatrix.a+vy*tMatrix.c+tMatrix.tx)*weight;wy+=(vx*tMatrix.b+vy*tMatrix.d+tMatrix.ty)*weight;}
worldVertices[w]=wx;worldVertices[w+1]=wy;}}
__proto.computeWorldPositions=function(boneSlot,boneList,graphics,spacesCount,tangents,percentPosition,percentSpacing){var tBones=boneSlot.currDisplayData.bones;var tWeights=boneSlot.currDisplayData.weights;var tTriangles=boneSlot.currDisplayData.triangles;var tRx=0;var tRy=0;var nn=0;var tMatrix;var tX=NaN;var tY=NaN;var tB=0;var tWeight=0;var tVertices=[];var i=0,j=0,n=0;var verticesLength=boneSlot.currDisplayData.verLen;var target=boneSlot;var position=this.position;var spaces=this._spaces;var world=[];var out=[];var closed=false;var curveCount=verticesLength/6;var prevCurve=-1;var pathLength=NaN;var o=0,curve=0;var p=NaN;var space=NaN;var prev=NaN;var length=NaN;if(!true){var lengths=boneSlot.currDisplayData.lengths;curveCount-=closed?1:2;pathLength=lengths[curveCount];if(percentPosition)
position*=pathLength;if(percentSpacing){for(i=0;i<spacesCount;i++)
spaces[i]*=pathLength;}
world.length=8;for(i=0,o=0,curve=0;i<spacesCount;i++,o+=3){space=spaces[i];position+=space;p=position;if(closed){p%=pathLength;if(p<0)
p+=pathLength;curve=0;}
else if(p<0){if(prevCurve!=PathConstraint.BEFORE){prevCurve=PathConstraint.BEFORE;this.computeWorldVertices2(target,boneList,2,4,world,0);}
this.addBeforePosition(p,world,0,out,o);continue;}
else if(p>pathLength){if(prevCurve!=PathConstraint.AFTER){prevCurve=PathConstraint.AFTER;this.computeWorldVertices2(target,boneList,verticesLength-6,4,world,0);}
this.addAfterPosition(p-pathLength,world,0,out,o);continue;}
for(;;curve++){length=lengths[curve];if(p>length)
continue;if(curve==0)
p/=length;else{prev=lengths[curve-1];p=(p-prev)/(length-prev);}
break;}
if(curve!=prevCurve){prevCurve=curve;if(closed&&curve==curveCount){this.computeWorldVertices2(target,boneList,verticesLength-4,4,world,0);this.computeWorldVertices2(target,boneList,0,4,world,4);}
else
this.computeWorldVertices2(target,boneList,curve*6+2,8,world,0);}
this.addCurvePosition(p,world[0],world[1],world[2],world[3],world[4],world[5],world[6],world[7],out,o,tangents||(i>0&&space==0));}
return out;}
if(closed){verticesLength+=2;world[verticesLength-2]=world[0];world[verticesLength-1]=world[1];}
else{curveCount--;verticesLength-=4;this.computeWorldVertices2(boneSlot,boneList,2,verticesLength,tVertices,0);if(this._debugKey){for(i=0;i<tVertices.length;){graphics.drawCircle(tVertices[i++],tVertices[i++],10,"#ff0000");}}
world=tVertices;}
this._curves.length=curveCount;var curves=this._curves;pathLength=0;var x1=world[0],y1=world[1],cx1=0,cy1=0,cx2=0,cy2=0,x2=0,y2=0;var tmpx=NaN,tmpy=NaN,dddfx=NaN,dddfy=NaN,ddfx=NaN,ddfy=NaN,dfx=NaN,dfy=NaN;var w=0;for(i=0,w=2;i<curveCount;i++,w+=6){cx1=world[w];cy1=world[w+1];cx2=world[w+2];cy2=world[w+3];x2=world[w+4];y2=world[w+5];tmpx=(x1-cx1*2+cx2)*0.1875;tmpy=(y1-cy1*2+cy2)*0.1875;dddfx=((cx1-cx2)*3-x1+x2)*0.09375;dddfy=((cy1-cy2)*3-y1+y2)*0.09375;ddfx=tmpx*2+dddfx;ddfy=tmpy*2+dddfy;dfx=(cx1-x1)*0.75+tmpx+dddfx*0.16666667;dfy=(cy1-y1)*0.75+tmpy+dddfy*0.16666667;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx;dfy+=ddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);dfx+=ddfx+dddfx;dfy+=ddfy+dddfy;pathLength+=Math.sqrt(dfx*dfx+dfy*dfy);curves[i]=pathLength;x1=x2;y1=y2;}
if(percentPosition)
position*=pathLength;if(percentSpacing){for(i=0;i<spacesCount;i++)
spaces[i]*=pathLength;};var segments=this._segments;var curveLength=0;var segment=0;for(i=0,o=0,curve=0,segment=0;i<spacesCount;i++,o+=3){space=spaces[i];position+=space;p=position;if(closed){p%=pathLength;if(p<0)
p+=pathLength;curve=0;}
else if(p<0){this.addBeforePosition(p,world,0,out,o);continue;}
else if(p>pathLength){this.addAfterPosition(p-pathLength,world,verticesLength-4,out,o);continue;}
for(;;curve++){length=curves[curve];if(p>length)
continue;if(curve==0)
p/=length;else{prev=curves[curve-1];p=(p-prev)/(length-prev);}
break;}
if(curve!=prevCurve){prevCurve=curve;var ii=curve*6;x1=world[ii];y1=world[ii+1];cx1=world[ii+2];cy1=world[ii+3];cx2=world[ii+4];cy2=world[ii+5];x2=world[ii+6];y2=world[ii+7];tmpx=(x1-cx1*2+cx2)*0.03;tmpy=(y1-cy1*2+cy2)*0.03;dddfx=((cx1-cx2)*3-x1+x2)*0.006;dddfy=((cy1-cy2)*3-y1+y2)*0.006;ddfx=tmpx*2+dddfx;ddfy=tmpy*2+dddfy;dfx=(cx1-x1)*0.3+tmpx+dddfx*0.16666667;dfy=(cy1-y1)*0.3+tmpy+dddfy*0.16666667;curveLength=Math.sqrt(dfx*dfx+dfy*dfy);segments[0]=curveLength;for(ii=1;ii<8;ii++){dfx+=ddfx;dfy+=ddfy;ddfx+=dddfx;ddfy+=dddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[ii]=curveLength;}
dfx+=ddfx;dfy+=ddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[8]=curveLength;dfx+=ddfx+dddfx;dfy+=ddfy+dddfy;curveLength+=Math.sqrt(dfx*dfx+dfy*dfy);segments[9]=curveLength;segment=0;}
p*=curveLength;for(;;segment++){length=segments[segment];if(p>length)
continue;if(segment==0)
p/=length;else{prev=segments[segment-1];p=segment+(p-prev)/(length-prev);}
break;}
this.addCurvePosition(p*0.1,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents||(i>0&&space==0));}
return out;}
__proto.addBeforePosition=function(p,temp,i,out,o){var x1=temp[i],y1=temp[i+1],dx=temp[i+2]-x1,dy=temp[i+3]-y1,r=Math.atan2(dy,dx);out[o]=x1+p*Math.cos(r);out[o+1]=y1+p*Math.sin(r);out[o+2]=r;}
__proto.addAfterPosition=function(p,temp,i,out,o){var x1=temp[i+2],y1=temp[i+3],dx=x1-temp[i],dy=y1-temp[i+1],r=Math.atan2(dy,dx);out[o]=x1+p*Math.cos(r);out[o+1]=y1+p*Math.sin(r);out[o+2]=r;}
__proto.addCurvePosition=function(p,x1,y1,cx1,cy1,cx2,cy2,x2,y2,out,o,tangents){if(p==0)
p=0.0001;var tt=p*p,ttt=tt*p,u=1-p,uu=u*u,uuu=uu*u;var ut=u*p,ut3=ut*3,uut3=u*ut3,utt3=ut3*p;var x=x1*uuu+cx1*uut3+cx2*utt3+x2*ttt,y=y1*uuu+cy1*uut3+cy2*utt3+y2*ttt;out[o]=x;out[o+1]=y;if(tangents){out[o+2]=Math.atan2(y-(y1*uu+cy1*ut*2+cy2*tt),x-(x1*uu+cx1*ut*2+cx2*tt));}
else{out[o+2]=0;}}
PathConstraint.NONE=-1;PathConstraint.BEFORE=-2;PathConstraint.AFTER=-3;__static(PathConstraint,['_tempMt',function(){return this._tempMt=new Matrix();}]);return PathConstraint;})()
var PathConstraintData=(function(){function PathConstraintData(){this.name=null;this.target=null;this.positionMode=null;this.spacingMode=null;this.rotateMode=null;this.offsetRotation=NaN;this.position=NaN;this.spacing=NaN;this.rotateMix=NaN;this.translateMix=NaN;this.bones=[];}
__class(PathConstraintData,'laya.ani.bone.PathConstraintData');return PathConstraintData;})()
var SkinData=(function(){function SkinData(){this.name=null;this.slotArr=[];}
__class(SkinData,'laya.ani.bone.SkinData');return SkinData;})()
var SkinSlotDisplayData=(function(){function SkinSlotDisplayData(){this.name=null;this.attachmentName=null;this.type=0;this.transform=null;this.width=NaN;this.height=NaN;this.texture=null;this.bones=null;this.uvs=null;this.weights=null;this.triangles=null;this.vertices=null;this.lengths=null;this.verLen=0;}
__class(SkinSlotDisplayData,'laya.ani.bone.SkinSlotDisplayData');var __proto=SkinSlotDisplayData.prototype;__proto.createTexture=function(currTexture){if(this.texture)return this.texture;this.texture=new Texture(currTexture.bitmap,this.uvs);if(this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]){this.texture.width=currTexture.height;this.texture.height=currTexture.width;this.texture.offsetX=-currTexture.offsetX;this.texture.offsetY=-currTexture.offsetY;this.texture.sourceWidth=currTexture.sourceHeight;this.texture.sourceHeight=currTexture.sourceWidth;}else{this.texture.width=currTexture.width;this.texture.height=currTexture.height;this.texture.offsetX=-currTexture.offsetX;this.texture.offsetY=-currTexture.offsetY;this.texture.sourceWidth=currTexture.sourceWidth;this.texture.sourceHeight=currTexture.sourceHeight;}
if(!Render.isWebGL){if(this.uvs[1]>this.uvs[5]){this.texture.offsetY=this.texture.sourceHeight-this.texture.height-this.texture.offsetY;}}
return this.texture;}
__proto.destory=function(){if(this.texture)this.texture.destroy();}
return SkinSlotDisplayData;})()
var SlotData=(function(){function SlotData(){this.name=null;this.displayArr=[];}
__class(SlotData,'laya.ani.bone.SlotData');var __proto=SlotData.prototype;__proto.getDisplayByName=function(name){var tDisplay;for(var i=0,n=this.displayArr.length;i<n;i++){tDisplay=this.displayArr[i];if(tDisplay.attachmentName==name){return i;}}
return-1;}
return SlotData;})()
var TfConstraint=(function(){function TfConstraint(data,bones){this._data=null;this._bones=null;this.target=null;this.rotateMix=NaN;this.translateMix=NaN;this.scaleMix=NaN;this.shearMix=NaN;this._temp=__newvec(2,0);this._data=data;if(this._bones==null){this._bones=[];}
this.target=bones[data.targetIndex];var j=0,n=0;for(j=0,n=data.boneIndexs.length;j<n;j++){this._bones.push(bones[data.boneIndexs[j]]);}
this.rotateMix=data.rotateMix;this.translateMix=data.translateMix;this.scaleMix=data.scaleMix;this.shearMix=data.shearMix;}
__class(TfConstraint,'laya.ani.bone.TfConstraint');var __proto=TfConstraint.prototype;__proto.apply=function(){var tTfBone;var ta=this.target.resultMatrix.a,tb=this.target.resultMatrix.b,tc=this.target.resultMatrix.c,td=this.target.resultMatrix.d;for(var j=0,n=this._bones.length;j<n;j++){tTfBone=this._bones[j];if(this.rotateMix>0){var a=tTfBone.resultMatrix.a,b=tTfBone.resultMatrix.b,c=tTfBone.resultMatrix.c,d=tTfBone.resultMatrix.d;var r=Math.atan2(tc,ta)-Math.atan2(c,a)+this._data.offsetRotation*Math.PI/180;if(r>Math.PI)
r-=Math.PI*2;else if(r<-Math.PI)r+=Math.PI*2;r*=this.rotateMix;var cos=Math.cos(r),sin=Math.sin(r);tTfBone.resultMatrix.a=cos*a-sin*c;tTfBone.resultMatrix.b=cos*b-sin*d;tTfBone.resultMatrix.c=sin*a+cos*c;tTfBone.resultMatrix.d=sin*b+cos*d;}
if(this.translateMix){this._temp[0]=this._data.offsetX;this._temp[1]=this._data.offsetY;this.target.localToWorld(this._temp);tTfBone.resultMatrix.tx+=(this._temp[0]-tTfBone.resultMatrix.tx)*this.translateMix;tTfBone.resultMatrix.ty+=(this._temp[1]-tTfBone.resultMatrix.ty)*this.translateMix;tTfBone.updateChild();}
if(this.scaleMix>0){var bs=Math.sqrt(tTfBone.resultMatrix.a*tTfBone.resultMatrix.a+tTfBone.resultMatrix.c*tTfBone.resultMatrix.c);var ts=Math.sqrt(ta*ta+tc*tc);var s=bs>0.00001?(bs+(ts-bs+this._data.offsetScaleX)*this.scaleMix)/bs:0;tTfBone.resultMatrix.a*=s;tTfBone.resultMatrix.c*=s;bs=Math.sqrt(tTfBone.resultMatrix.b*tTfBone.resultMatrix.b+tTfBone.resultMatrix.d*tTfBone.resultMatrix.d);ts=Math.sqrt(tb*tb+td*td);s=bs>0.00001?(bs+(ts-bs+this._data.offsetScaleY)*this.scaleMix)/bs:0;tTfBone.resultMatrix.b*=s;tTfBone.resultMatrix.d*=s;}
if(this.shearMix>0){b=tTfBone.resultMatrix.b,d=tTfBone.resultMatrix.d;var by=Math.atan2(d,b);r=Math.atan2(td,tb)-Math.atan2(tc,ta)-(by-Math.atan2(tTfBone.resultMatrix.c,tTfBone.resultMatrix.a));if(r>Math.PI)
r-=Math.PI*2;else if(r<-Math.PI)r+=Math.PI*2;r=by+(r+this._data.offsetShearY*Math.PI/180)*this.shearMix;s=Math.sqrt(b*b+d*d);tTfBone.resultMatrix.b=Math.cos(r)*s;tTfBone.resultMatrix.d=Math.sin(r)*s;}}}
return TfConstraint;})()
var TfConstraintData=(function(){function TfConstraintData(){this.name=null;this.targetIndex=0;this.rotateMix=NaN;this.translateMix=NaN;this.scaleMix=NaN;this.shearMix=NaN;this.offsetRotation=NaN;this.offsetX=NaN;this.offsetY=NaN;this.offsetScaleX=NaN;this.offsetScaleY=NaN;this.offsetShearY=NaN;this.boneIndexs=[];}
__class(TfConstraintData,'laya.ani.bone.TfConstraintData');return TfConstraintData;})()
var Transform=(function(){function Transform(){this.skX=0;this.skY=0;this.scX=1;this.scY=1;this.x=0;this.y=0;this.skewX=0;this.skewY=0;this.mMatrix=null;}
__class(Transform,'laya.ani.bone.Transform');var __proto=Transform.prototype;__proto.initData=function(data){if(data.x!=undefined){this.x=data.x;}
if(data.y!=undefined){this.y=data.y;}
if(data.skX!=undefined){this.skX=data.skX;}
if(data.skY!=undefined){this.skY=data.skY;}
if(data.scX!=undefined){this.scX=data.scX;}
if(data.scY!=undefined){this.scY=data.scY;}}
__proto.getMatrix=function(){var tMatrix;if(this.mMatrix){tMatrix=this.mMatrix;}else{tMatrix=this.mMatrix=new Matrix();}
tMatrix.identity();tMatrix.scale(this.scX,this.scY);if(this.skewX||this.skewY){this.skew(tMatrix,this.skewX*Math.PI/180,this.skewY*Math.PI/180);}
tMatrix.rotate(this.skX*Math.PI/180);tMatrix.translate(this.x,this.y);return tMatrix;}
__proto.skew=function(m,x,y){var sinX=Math.sin(y);var cosX=Math.cos(y);var sinY=Math.sin(x);var cosY=Math.cos(x);m.setTo(m.a*cosY-m.b*sinX,m.a*sinY+m.b*cosX,m.c*cosY-m.d*sinX,m.c*sinY+m.d*cosX,m.tx*cosY-m.ty*sinX,m.tx*sinY+m.ty*cosX);return m;}
return Transform;})()
var UVTools=(function(){function UVTools(){}
__class(UVTools,'laya.ani.bone.UVTools');UVTools.getRelativeUV=function(bigUV,smallUV,rst){var startX=bigUV[0];var width=bigUV[2]-bigUV[0];var startY=bigUV[1];var height=bigUV[5]-bigUV[1];if(!rst)rst=[];rst.length=smallUV.length;var i=0,len=0;len=rst.length;var dWidth=1/width;var dHeight=1/height;for(i=0;i<len;i+=2){rst[i]=(smallUV[i]-startX)*dWidth;rst[i+1]=(smallUV[i+1]-startY)*dHeight;}
return rst;}
UVTools.getAbsoluteUV=function(bigUV,smallUV,rst){if(bigUV[0]==0&&bigUV[1]==0&&bigUV[4]==1&&bigUV[5]==1){if(rst){Utils.copyArray(rst,smallUV);return rst;}else{return smallUV;}};var startX=bigUV[0];var width=bigUV[2]-bigUV[0];var startY=bigUV[1];var height=bigUV[5]-bigUV[1];if(!rst)rst=[];rst.length=smallUV.length;var i=0,len=0;len=rst.length;for(i=0;i<len;i+=2){rst[i]=smallUV[i]*width+startX;rst[i+1]=smallUV[i+1]*height+startY;}
return rst;}
return UVTools;})()
var KeyFramesContent=(function(){function KeyFramesContent(){this.startTime=NaN;this.duration=NaN;this.interpolationData=null;this.data=null;this.nextData=null;}
__class(KeyFramesContent,'laya.ani.KeyFramesContent');return KeyFramesContent;})()
var BezierLerp=(function(){function BezierLerp(){}
__class(BezierLerp,'laya.ani.math.BezierLerp');BezierLerp.getBezierRate=function(t,px0,py0,px1,py1){var key=BezierLerp._getBezierParamKey(px0,py0,px1,py1);var vKey=key*100+t;if(BezierLerp._bezierResultCache[vKey])return BezierLerp._bezierResultCache[vKey];var points=BezierLerp._getBezierPoints(px0,py0,px1,py1,key);var i=0,len=0;len=points.length;for(i=0;i<len;i+=2){if(t<=points[i]){BezierLerp._bezierResultCache[vKey]=points[i+1];return points[i+1];}}
BezierLerp._bezierResultCache[vKey]=1;return 1;}
BezierLerp._getBezierParamKey=function(px0,py0,px1,py1){return(((px0*100+py0)*100+px1)*100+py1)*100;}
BezierLerp._getBezierPoints=function(px0,py0,px1,py1,key){if(BezierLerp._bezierPointsCache[key])return BezierLerp._bezierPointsCache[key];var controlPoints;controlPoints=[0,0,px0,py0,px1,py1,1,1];var bz;bz=new Bezier();var points;points=bz.getBezierPoints(controlPoints,100,3);BezierLerp._bezierPointsCache[key]=points;return points;}
BezierLerp._bezierResultCache={};BezierLerp._bezierPointsCache={};return BezierLerp;})()
var AnimationPlayer=(function(_super){function AnimationPlayer(){this._destroyed=false;this._templet=null;this._currentTime=NaN;this._currentFrameTime=NaN;this._playStart=NaN;this._playEnd=NaN;this._playDuration=NaN;this._overallDuration=NaN;this._stopWhenCircleFinish=false;this._elapsedPlaybackTime=NaN;this._startUpdateLoopCount=NaN;this._currentAnimationClipIndex=0;this._currentKeyframeIndex=0;this._paused=false;this._cacheFrameRate=0;this._cacheFrameRateInterval=NaN;this._cachePlayRate=NaN;this._fullFrames=null;this.isCache=true;this.playbackRate=1.0;this.returnToZeroStopped=false;AnimationPlayer.__super.call(this);this._destroyed=false;this._currentAnimationClipIndex=-1;this._currentKeyframeIndex=-1;this._currentTime=0.0;this._overallDuration=Number.MAX_VALUE;this._stopWhenCircleFinish=false;this._elapsedPlaybackTime=0;this._startUpdateLoopCount=-1;this._cachePlayRate=1.0;this.cacheFrameRate=60;this.returnToZeroStopped=false;}
__class(AnimationPlayer,'laya.ani.AnimationPlayer',_super);var __proto=AnimationPlayer.prototype;Laya.imps(__proto,{"laya.resource.IDestroy":true})
__proto._onTempletLoadedComputeFullKeyframeIndices=function(cachePlayRate,cacheFrameRate,templet){if(this._templet===templet&&this._cachePlayRate===cachePlayRate&&this._cacheFrameRate===cacheFrameRate)
this._computeFullKeyframeIndices();}
__proto._computeFullKeyframeIndices=function(){var anifullFrames=this._fullFrames=[];var templet=this._templet;var cacheFrameInterval=this._cacheFrameRateInterval*this._cachePlayRate;for(var i=0,iNum=templet.getAnimationCount();i<iNum;i++){var aniFullFrame=[];for(var j=0,jNum=templet.getAnimation(i).nodes.length;j<jNum;j++){var node=templet.getAnimation(i).nodes[j];var frameCount=Math.floor(node.playTime/cacheFrameInterval+0.01);var nodeFullFrames=new Uint16Array(frameCount+1);var lastFrameIndex=-1;for(var n=0,nNum=node.keyFrame.length;n<nNum;n++){var keyFrame=node.keyFrame[n];var tm=keyFrame.startTime;var endTm=tm+keyFrame.duration+cacheFrameInterval;do{var frameIndex=Math.floor(tm/cacheFrameInterval+0.5);for(var k=lastFrameIndex+1;k<frameIndex;k++)
nodeFullFrames[k]=n;lastFrameIndex=frameIndex;nodeFullFrames[frameIndex]=n;tm+=cacheFrameInterval;}while(tm<=endTm);}
aniFullFrame.push(nodeFullFrames);}
anifullFrames.push(aniFullFrame);}}
__proto._onAnimationTempletLoaded=function(){(this.destroyed)||(this._calculatePlayDuration());}
__proto._calculatePlayDuration=function(){if(this.state!==0){var oriDuration=this._templet.getAniDuration(this._currentAnimationClipIndex);(this._playEnd===0)&&(this._playEnd=oriDuration);if(this._playEnd>oriDuration)
this._playEnd=oriDuration;this._playDuration=this._playEnd-this._playStart;}}
__proto._setPlayParams=function(time,cacheFrameInterval){this._currentTime=time;this._currentKeyframeIndex=Math.max(Math.floor((this.currentPlayTime)/cacheFrameInterval+0.01),0);this._currentFrameTime=this._currentKeyframeIndex*cacheFrameInterval;}
__proto._setPlayParamsWhenStop=function(currentAniClipPlayDuration,cacheFrameInterval){this._currentTime=currentAniClipPlayDuration;this._currentKeyframeIndex=Math.max(Math.floor(currentAniClipPlayDuration/cacheFrameInterval+0.01),0);this._currentFrameTime=this._currentKeyframeIndex*cacheFrameInterval;this._currentAnimationClipIndex=-1;}
__proto._update=function(elapsedTime){if(this._currentAnimationClipIndex===-1||this._paused||!this._templet||!this._templet.loaded)
return;var cacheFrameInterval=this._cacheFrameRateInterval*this._cachePlayRate;var time=0;(this._startUpdateLoopCount!==Stat.loopCount)&&(time=elapsedTime*this.playbackRate,this._elapsedPlaybackTime+=time);var currentAniClipPlayDuration=this.playDuration;if((this._overallDuration!==0&&this._elapsedPlaybackTime>=this._overallDuration)||(this._overallDuration===0&&this._elapsedPlaybackTime>=currentAniClipPlayDuration)){this._setPlayParamsWhenStop(currentAniClipPlayDuration,cacheFrameInterval);this.event("stopped");return;}
time+=this._currentTime;if(currentAniClipPlayDuration>0){if(time>=currentAniClipPlayDuration){do{time-=currentAniClipPlayDuration;if(this._stopWhenCircleFinish){this._setPlayParamsWhenStop(currentAniClipPlayDuration,cacheFrameInterval);this._stopWhenCircleFinish=false;this.event("stopped");return;}
if(time<currentAniClipPlayDuration){this._setPlayParams(time,cacheFrameInterval);this.event("complete");}}while(time>=currentAniClipPlayDuration)}else{this._setPlayParams(time,cacheFrameInterval);}}else{if(this._stopWhenCircleFinish){this._setPlayParamsWhenStop(currentAniClipPlayDuration,cacheFrameInterval);this._stopWhenCircleFinish=false;this.event("stopped");return;}
this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0;this.event("complete");}}
__proto._destroy=function(){this.offAll();this._templet=null;this._fullFrames=null;this._destroyed=true;}
__proto.play=function(index,playbackRate,overallDuration,playStart,playEnd){(index===void 0)&&(index=0);(playbackRate===void 0)&&(playbackRate=1.0);(overallDuration===void 0)&&(overallDuration=2147483647);(playStart===void 0)&&(playStart=0);(playEnd===void 0)&&(playEnd=0);if(!this._templet)
throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(overallDuration<0||playStart<0||playEnd<0)
throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if((playEnd!==0)&&(playStart>playEnd))
throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0;this._currentFrameTime=0;this._elapsedPlaybackTime=0;this.playbackRate=playbackRate;this._overallDuration=overallDuration;this._playStart=playStart;this._playEnd=playEnd;this._paused=false;this._currentAnimationClipIndex=index;this._currentKeyframeIndex=0;this._startUpdateLoopCount=Stat.loopCount;this.event("played");if(this._templet.loaded)
this._calculatePlayDuration();else
this._templet.once("loaded",this,this._onAnimationTempletLoaded);this._update(0);}
__proto.playByFrame=function(index,playbackRate,overallDuration,playStartFrame,playEndFrame,fpsIn3DBuilder){(index===void 0)&&(index=0);(playbackRate===void 0)&&(playbackRate=1.0);(overallDuration===void 0)&&(overallDuration=2147483647);(playStartFrame===void 0)&&(playStartFrame=0);(playEndFrame===void 0)&&(playEndFrame=0);(fpsIn3DBuilder===void 0)&&(fpsIn3DBuilder=30);var interval=1000.0/fpsIn3DBuilder;this.play(index,playbackRate,overallDuration,playStartFrame*interval,playEndFrame*interval);}
__proto.stop=function(immediate){(immediate===void 0)&&(immediate=true);if(immediate){this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0;this._currentAnimationClipIndex=-1;this.event("stopped");}else{this._stopWhenCircleFinish=true;}}
__getset(0,__proto,'playEnd',function(){return this._playEnd;});__getset(0,__proto,'templet',function(){return this._templet;},function(value){if(!this.state===0)
this.stop(true);if(this._templet!==value){this._templet=value;if(value.loaded)
this._computeFullKeyframeIndices();else
value.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]);}});__getset(0,__proto,'playStart',function(){return this._playStart;});__getset(0,__proto,'playDuration',function(){return this._playDuration;});__getset(0,__proto,'state',function(){if(this._currentAnimationClipIndex===-1)
return 0;if(this._paused)
return 1;return 2;});__getset(0,__proto,'currentKeyframeIndex',function(){return this._currentKeyframeIndex;});__getset(0,__proto,'overallDuration',function(){return this._overallDuration;});__getset(0,__proto,'currentFrameTime',function(){return this._currentFrameTime;});__getset(0,__proto,'currentAnimationClipIndex',function(){return this._currentAnimationClipIndex;});__getset(0,__proto,'currentPlayTime',function(){return this._currentTime+this._playStart;});__getset(0,__proto,'cachePlayRate',function(){return this._cachePlayRate;},function(value){if(this._cachePlayRate!==value){this._cachePlayRate=value;if(this._templet)
if(this._templet.loaded)
this._computeFullKeyframeIndices();else
this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[value,this._cacheFrameRate]);}});__getset(0,__proto,'cacheFrameRate',function(){return this._cacheFrameRate;},function(value){if(this._cacheFrameRate!==value){this._cacheFrameRate=value;this._cacheFrameRateInterval=1000.0/this._cacheFrameRate;if(this._templet)
if(this._templet.loaded)
this._computeFullKeyframeIndices();else
this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,value]);}});__getset(0,__proto,'currentTime',null,function(value){if(this._currentAnimationClipIndex===-1||!this._templet||!this._templet.loaded)
return;if(value<this._playStart||value>this._playEnd)
throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=Stat.loopCount;var cacheFrameInterval=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=value;this._currentKeyframeIndex=Math.max(Math.floor(this.currentPlayTime/cacheFrameInterval),0);this._currentFrameTime=this._currentKeyframeIndex*cacheFrameInterval;});__getset(0,__proto,'paused',function(){return this._paused;},function(value){this._paused=value;value&&this.event("paused");});__getset(0,__proto,'cacheFrameRateInterval',function(){return this._cacheFrameRateInterval;});__getset(0,__proto,'destroyed',function(){return this._destroyed;});return AnimationPlayer;})(EventDispatcher)
var GraphicsAni=(function(_super){function GraphicsAni(){GraphicsAni.__super.call(this);if(Render.isConchNode){this["drawSkin"]=function(skin){skin.transform||(skin.transform=Matrix.EMPTY);this.setSkinMesh&&this.setSkinMesh(skin._ps,skin.mVBData,skin.mEleNum,0,skin.mTexture,skin.transform);};}}
__class(GraphicsAni,'laya.ani.GraphicsAni',_super);var __proto=GraphicsAni.prototype;__proto.drawSkin=function(skin){var arr=[skin];this._saveToCmd(Render._context._drawSkin,arr);}
return GraphicsAni;})(Graphics)
var SkinMeshCanvas=(function(_super){function SkinMeshCanvas(){SkinMeshCanvas.__super.call(this);this.mesh=new MeshData();}
__class(SkinMeshCanvas,'laya.ani.bone.canvasmesh.SkinMeshCanvas',_super);var __proto=SkinMeshCanvas.prototype;__proto.init2=function(texture,vs,ps,verticles,uvs){if(this.transform){this.transform=null;};var _ps;if(ps){_ps=ps;}else{_ps=[];_ps.push(0,1,3,3,1,2);}
this.mesh.texture=texture;this.mesh.indexes=_ps;this.mesh.vertices=verticles;this.mesh.uvs=uvs;}
__proto.render=function(context,x,y){if(!this.mesh.texture)return;if(!this.transform){this.transform=SkinMeshCanvas._tempMatrix;this.transform.identity();this.transform.translate(x,y);this.renderToContext(context);this.transform.translate(-x,-y);this.transform=null;}else{this.transform.translate(x,y);this.renderToContext(context);this.transform.translate(-x,-y);}}
__static(SkinMeshCanvas,['_tempMatrix',function(){return this._tempMatrix=new Matrix();}]);return SkinMeshCanvas;})(CanvasMeshRender)
var AnimationTemplet=(function(_super){function AnimationTemplet(){this._aniMap={};this.unfixedLastAniIndex=-1;AnimationTemplet.__super.call(this);this._anis=new Array;}
__class(AnimationTemplet,'laya.ani.AnimationTemplet',_super);var __proto=AnimationTemplet.prototype;__proto.parse=function(data){var reader=new Byte(data);this._aniVersion=reader.readUTFString();AnimationParser01.parse(this,reader);}
__proto._calculateKeyFrame=function(node,keyframeCount,keyframeDataCount){var keyFrames=node.keyFrame;keyFrames[keyframeCount]=keyFrames[0];for(var i=0;i<keyframeCount;i++){var keyFrame=keyFrames[i];keyFrame.nextData=(keyFrame.duration===0)?keyFrame.data:keyFrames[i+1].data;}
keyFrames.length--;}
__proto.onAsynLoaded=function(url,data,params){var reader=new Byte(data);this._aniVersion=reader.readUTFString();switch(this._aniVersion){case"LAYAANIMATION:02":AnimationParser02.parse(this,reader);break;default:AnimationParser01.parse(this,reader);}
this._endLoaded();}
__proto.disposeResource=function(){this._aniVersion=null;this._anis=null;this._aniMap=null;this._publicExtData=null;this.unfixedCurrentFrameIndexes=null;this.unfixedCurrentTimes=null;this.unfixedKeyframes=null;this._aniClassName=null;this._animationDatasCache=null;}
__proto.getAnimationCount=function(){return this._anis.length;}
__proto.getAnimation=function(aniIndex){return this._anis[aniIndex];}
__proto.getAniDuration=function(aniIndex){return this._anis[aniIndex].playTime;}
__proto.getNodes=function(aniIndex){return this._anis[aniIndex].nodes;}
__proto.getNodeIndexWithName=function(aniIndex,name){return this._anis[aniIndex].bone3DMap[name];}
__proto.getNodeCount=function(aniIndex){return this._anis[aniIndex].nodes.length;}
__proto.getTotalkeyframesLength=function(aniIndex){return this._anis[aniIndex].totalKeyframeDatasLength;}
__proto.getPublicExtData=function(){return this._publicExtData;}
__proto.getAnimationDataWithCache=function(key,cacheDatas,aniIndex,frameIndex){var aniDatas=cacheDatas[aniIndex];if(!aniDatas){return null;}else{var keyDatas=aniDatas[key];if(!keyDatas)
return null;else{return keyDatas[frameIndex];}}}
__proto.setAnimationDataWithCache=function(key,cacheDatas,aniIndex,frameIndex,data){var aniDatas=(cacheDatas[aniIndex])||(cacheDatas[aniIndex]={});var aniDatasCache=(aniDatas[key])||(aniDatas[key]=[]);aniDatasCache[frameIndex]=data;}
__proto.getOriginalData=function(aniIndex,originalData,nodesFrameIndices,frameIndex,playCurTime){var oneAni=this._anis[aniIndex];var nodes=oneAni.nodes;var j=0;for(var i=0,n=nodes.length,outOfs=0;i<n;i++){var node=nodes[i];var key;key=node.keyFrame[nodesFrameIndices[i][frameIndex]];node.dataOffset=outOfs;var dt=playCurTime-key.startTime;var lerpType=node.lerpType;if(lerpType){switch(lerpType){case 0:case 1:for(j=0;j<node.keyframeWidth;)
j+=node.interpolationMethod[j](node,j,originalData,outOfs+j,key.data,dt,null,key.duration,key.nextData);break;case 2:;var interpolationData=key.interpolationData;var interDataLen=interpolationData.length;var dataIndex=0;for(j=0;j<interDataLen;){var type=interpolationData[j];switch(type){case 6:j+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData,interpolationData,j+1);break;case 7:j+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData,interpolationData,j+1);break;default:j+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData);}
dataIndex++;}
break;}}else{for(j=0;j<node.keyframeWidth;)
j+=node.interpolationMethod[j](node,j,originalData,outOfs+j,key.data,dt,null,key.duration,key.nextData);}
outOfs+=node.keyframeWidth;}}
__proto.getNodesCurrentFrameIndex=function(aniIndex,playCurTime){var ani=this._anis[aniIndex];var nodes=ani.nodes;if(aniIndex!==this.unfixedLastAniIndex){this.unfixedCurrentFrameIndexes=new Uint32Array(nodes.length);this.unfixedCurrentTimes=new Float32Array(nodes.length);this.unfixedLastAniIndex=aniIndex;}
for(var i=0,n=nodes.length,outOfs=0;i<n;i++){var node=nodes[i];if(playCurTime<this.unfixedCurrentTimes[i])
this.unfixedCurrentFrameIndexes[i]=0;this.unfixedCurrentTimes[i]=playCurTime;while((this.unfixedCurrentFrameIndexes[i]<node.keyFrame.length)){if(node.keyFrame[this.unfixedCurrentFrameIndexes[i]].startTime>this.unfixedCurrentTimes[i])
break;this.unfixedCurrentFrameIndexes[i]++;}
this.unfixedCurrentFrameIndexes[i]--;}
return this.unfixedCurrentFrameIndexes;}
__proto.getOriginalDataUnfixedRate=function(aniIndex,originalData,playCurTime){var oneAni=this._anis[aniIndex];var nodes=oneAni.nodes;if(aniIndex!==this.unfixedLastAniIndex){this.unfixedCurrentFrameIndexes=new Uint32Array(nodes.length);this.unfixedCurrentTimes=new Float32Array(nodes.length);this.unfixedKeyframes=__newvec(nodes.length);this.unfixedLastAniIndex=aniIndex;};var j=0;for(var i=0,n=nodes.length,outOfs=0;i<n;i++){var node=nodes[i];if(playCurTime<this.unfixedCurrentTimes[i])
this.unfixedCurrentFrameIndexes[i]=0;this.unfixedCurrentTimes[i]=playCurTime;while(this.unfixedCurrentFrameIndexes[i]<node.keyFrame.length){if(node.keyFrame[this.unfixedCurrentFrameIndexes[i]].startTime>this.unfixedCurrentTimes[i])
break;this.unfixedKeyframes[i]=node.keyFrame[this.unfixedCurrentFrameIndexes[i]];this.unfixedCurrentFrameIndexes[i]++;};var key=this.unfixedKeyframes[i];node.dataOffset=outOfs;var dt=playCurTime-key.startTime;var lerpType=node.lerpType;if(lerpType){switch(node.lerpType){case 0:case 1:for(j=0;j<node.keyframeWidth;)
j+=node.interpolationMethod[j](node,j,originalData,outOfs+j,key.data,dt,null,key.duration,key.nextData);break;case 2:;var interpolationData=key.interpolationData;var interDataLen=interpolationData.length;var dataIndex=0;for(j=0;j<interDataLen;){var type=interpolationData[j];switch(type){case 6:j+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData,interpolationData,j+1);break;case 7:j+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData,interpolationData,j+1);break;default:j+=AnimationTemplet.interpolation[type](node,dataIndex,originalData,outOfs+dataIndex,key.data,dt,null,key.duration,key.nextData);}
dataIndex++;}
break;}}else{for(j=0;j<node.keyframeWidth;)
j+=node.interpolationMethod[j](node,j,originalData,outOfs+j,key.data,dt,null,key.duration,key.nextData);}
outOfs+=node.keyframeWidth;}}
AnimationTemplet._LinearInterpolation_0=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){var amount=duration===0?0:dt/duration;out[outOfs]=(1.0-amount)*data[index]+amount*nextData[index];return 1;}
AnimationTemplet._QuaternionInterpolation_1=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){var amount=duration===0?0:dt/duration;MathUtil.slerpQuaternionArray(data,index,nextData,index,amount,out,outOfs);return 4;}
AnimationTemplet._AngleInterpolation_2=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){return 0;}
AnimationTemplet._RadiansInterpolation_3=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){return 0;}
AnimationTemplet._Matrix4x4Interpolation_4=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){for(var i=0;i<16;i++,index++)
out[outOfs+i]=data[index]+dt*dData[index];return 16;}
AnimationTemplet._NoInterpolation_5=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData){out[outOfs]=data[index];return 1;}
AnimationTemplet._BezierInterpolation_6=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData,offset){(offset===void 0)&&(offset=0);out[outOfs]=data[index]+(nextData[index]-data[index])*BezierLerp.getBezierRate(dt/duration,interData[offset],interData[offset+1],interData[offset+2],interData[offset+3]);return 5;}
AnimationTemplet._BezierInterpolation_7=function(bone,index,out,outOfs,data,dt,dData,duration,nextData,interData,offset){(offset===void 0)&&(offset=0);out[outOfs]=interData[offset+4]+interData[offset+5]*BezierLerp.getBezierRate((dt*0.001+interData[offset+6])/interData[offset+7],interData[offset],interData[offset+1],interData[offset+2],interData[offset+3]);return 9;}
AnimationTemplet.load=function(url){return Laya.loader.create(url,null,null,AnimationTemplet);}
AnimationTemplet.interpolation=[AnimationTemplet._LinearInterpolation_0,AnimationTemplet._QuaternionInterpolation_1,AnimationTemplet._AngleInterpolation_2,AnimationTemplet._RadiansInterpolation_3,AnimationTemplet._Matrix4x4Interpolation_4,AnimationTemplet._NoInterpolation_5,AnimationTemplet._BezierInterpolation_6,AnimationTemplet._BezierInterpolation_7];return AnimationTemplet;})(Resource)
var CacheAbleSkinMesh=(function(_super){function CacheAbleSkinMesh(){this.isCached=false;this.canvas=null;this.tex=null;this.rec=null;CacheAbleSkinMesh.__super.call(this);}
__class(CacheAbleSkinMesh,'laya.ani.bone.canvasmesh.CacheAbleSkinMesh',_super);var __proto=CacheAbleSkinMesh.prototype;__proto.getCanvasPic=function(){var canvas=new HTMLCanvas("2D");var ctx=canvas.getContext('2d');this.rec=this.mesh.getBounds();debugger;canvas.size(this.rec.width,this.rec.height);var preTransform;preTransform=this.transform;this.transform=CacheAbleSkinMesh.tempMt;this.transform.identity();this.transform.translate(-this.rec.x,-this.rec.y);this.renderToContext(ctx);this.transform.translate(+this.rec.x,+this.rec.y);this.transform=preTransform;return new Texture(canvas);}
__proto.render=function(context,x,y){if(!this.mesh.texture)return;if(!this.isCached){this.isCached=true;this.tex=this.getCanvasPic();}
if(!this.transform){this.transform=SkinMeshCanvas._tempMatrix;this.transform.identity();this.transform.translate(x,y);this._renderTextureToContext(context);this.transform.translate(-x,-y);this.transform=null;}else{this.transform.translate(x,y);this._renderTextureToContext(context);this.transform.translate(-x,-y);}}
__proto._renderTextureToContext=function(context){this.context=context.ctx||context;context.save();var texture;texture=this.tex;if(this.transform){var mt=this.transform;context.transform(mt.a,mt.b,mt.c,mt.d,mt.tx,mt.ty);}
this.rec=this.mesh.getBounds();context.translate(this.rec.x,this.rec.y);context.drawTexture(texture,0,0,texture.width,texture.height,0,0);context.restore();}
__static(CacheAbleSkinMesh,['tempMt',function(){return this.tempMt=new Matrix();}]);return CacheAbleSkinMesh;})(SkinMeshCanvas)
var SimpleSkinMeshCanvas=(function(_super){function SimpleSkinMeshCanvas(){this.cacheOK=false;this.cacheCmdOK=false;this.transformCmds=[];this.drawCmds=[]
SimpleSkinMeshCanvas.__super.call(this);this.tempMesh=new MeshData();}
__class(SimpleSkinMeshCanvas,'laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas',_super);var __proto=SimpleSkinMeshCanvas.prototype;__proto.init2=function(texture,vs,ps,verticles,uvs){_super.prototype.init2.call(this,texture,vs,ps,verticles,uvs);this.cacheOK=false;this.cacheCmdOK=false;this.transformCmds.length=6;this.drawCmds.length=9;}
__proto.renderToContext=function(context){this.context=context.ctx||context;if(this.mesh){if(this.mesh.uvs.length<=8){if(this.mode==0){this._renderWithIndexes(this.mesh);}
else{this._renderNoIndexes(this.mesh);}
return;}
if(!this.cacheOK){this.tempMesh.texture=this.mesh.texture;this.tempMesh.uvs=this.mesh.texture.uv;this.tempMesh.vertices=MeshTools.solveMesh(this.mesh,this.tempMesh.vertices);this.cacheOK=true;}
if(this.mode==0){this._renderWithIndexes(this.tempMesh);}
else{this._renderNoIndexes(this.tempMesh);}}}
__proto._renderWithIndexes=function(mesh){if(this.cacheCmdOK){this.renderByCache(mesh);return;};var indexes=mesh.indexes;var i=0,len=indexes.length;if(len>1)
len=1;for(i=0;i<len;i+=3){var index0=indexes[i]*2;var index1=indexes[i+1]*2;var index2=indexes[i+2]*2;this._renderDrawTriangle(mesh,index0,index1,index2);}
this.cacheCmdOK=true;}
__proto._renderDrawTriangle=function(mesh,index0,index1,index2){var context=this.context;var uvs=mesh.uvs;var vertices=mesh.vertices;var texture=mesh.texture;var source=texture.bitmap;var textureSource=source.source;var textureWidth=texture.width;var textureHeight=texture.height;var sourceWidth=source.width;var sourceHeight=source.height;var u0=NaN;var u1=NaN;var u2=NaN;var v0=NaN;var v1=NaN;var v2=NaN;if(mesh.useUvTransform){var ut=mesh.uvTransform;u0=((uvs[index0]*ut.a)+(uvs[index0+1]*ut.c)+ut.tx)*sourceWidth;u1=((uvs[index1]*ut.a)+(uvs[index1+1]*ut.c)+ut.tx)*sourceWidth;u2=((uvs[index2]*ut.a)+(uvs[index2+1]*ut.c)+ut.tx)*sourceWidth;v0=((uvs[index0]*ut.b)+(uvs[index0+1]*ut.d)+ut.ty)*sourceHeight;v1=((uvs[index1]*ut.b)+(uvs[index1+1]*ut.d)+ut.ty)*sourceHeight;v2=((uvs[index2]*ut.b)+(uvs[index2+1]*ut.d)+ut.ty)*sourceHeight;}
else{u0=uvs[index0]*sourceWidth;u1=uvs[index1]*sourceWidth;u2=uvs[index2]*sourceWidth;v0=uvs[index0+1]*sourceHeight;v1=uvs[index1+1]*sourceHeight;v2=uvs[index2+1]*sourceHeight;};var x0=vertices[index0];var x1=vertices[index1];var x2=vertices[index2];var y0=vertices[index0+1];var y1=vertices[index1+1];var y2=vertices[index2+1];var delta=(u0*v1)+(v0*u2)+(u1*v2)-(v1*u2)-(v0*u1)-(u0*v2);var dDelta=1/delta;var deltaA=(x0*v1)+(v0*x2)+(x1*v2)-(v1*x2)-(v0*x1)-(x0*v2);var deltaB=(u0*x1)+(x0*u2)+(u1*x2)-(x1*u2)-(x0*u1)-(u0*x2);var deltaC=(u0*v1*x2)+(v0*x1*u2)+(x0*u1*v2)-(x0*v1*u2)-(v0*u1*x2)-(u0*x1*v2);var deltaD=(y0*v1)+(v0*y2)+(y1*v2)-(v1*y2)-(v0*y1)-(y0*v2);var deltaE=(u0*y1)+(y0*u2)+(u1*y2)-(y1*u2)-(y0*u1)-(u0*y2);var deltaF=(u0*v1*y2)+(v0*y1*u2)+(y0*u1*v2)-(y0*v1*u2)-(v0*u1*y2)-(u0*y1*v2);this.transformCmds[0]=deltaA*dDelta;this.transformCmds[1]=deltaD*dDelta;this.transformCmds[2]=deltaB*dDelta;this.transformCmds[3]=deltaE*dDelta;this.transformCmds[4]=deltaC*dDelta;this.transformCmds[5]=deltaF*dDelta;this.drawCmds[0]=textureSource;this.drawCmds[1]=texture.uv[0]*sourceWidth;this.drawCmds[2]=texture.uv[1]*sourceHeight;this.drawCmds[3]=textureWidth;this.drawCmds[4]=textureHeight;this.drawCmds[5]=texture.uv[0]*sourceWidth;this.drawCmds[6]=texture.uv[1]*sourceHeight;this.drawCmds[7]=textureWidth;this.drawCmds[8]=textureHeight;context.save();if(this.transform){var mt=this.transform;context.transform(mt.a,mt.b,mt.c,mt.d,mt.tx,mt.ty);}
context.transform.apply(context,this.transformCmds);context.drawImage.apply(context,this.drawCmds);context.restore();}
__proto.renderByCache=function(mesh){var context=this.context;context.save();if(this.transform){var mt=this.transform;context.transform(mt.a,mt.b,mt.c,mt.d,mt.tx,mt.ty);}
context.transform.apply(context,this.transformCmds);context.drawImage.apply(context,this.drawCmds);context.restore();}
return SimpleSkinMeshCanvas;})(SkinMeshCanvas)
var Skeleton=(function(_super){function Skeleton(templet,aniMode){this._templet=null;this._player=null;this._curOriginalData=null;this._boneMatrixArray=[];this._lastTime=0;this._currAniName=null;this._currAniIndex=-1;this._pause=true;this._aniClipIndex=-1;this._clipIndex=-1;this._skinIndex=0;this._skinName="default";this._aniMode=0;this._graphicsCache=null;this._boneSlotDic=null;this._bindBoneBoneSlotDic=null;this._boneSlotArray=null;this._index=-1;this._total=-1;this._indexControl=false;this._aniPath=null;this._texturePath=null;this._complete=null;this._loadAniMode=0;this._yReverseMatrix=null;this._ikArr=null;this._tfArr=null;this._pathDic=null;this._rootBone=null;this._boneList=null;this._aniSectionDic=null;this._eventIndex=0;this._drawOrderIndex=0;this._drawOrder=null;this._lastAniClipIndex=-1;this._lastUpdateAniClipIndex=-1;Skeleton.__super.call(this);(aniMode===void 0)&&(aniMode=0);if(templet)this.init(templet,aniMode);}
__class(Skeleton,'laya.ani.bone.Skeleton',_super);var __proto=Skeleton.prototype;__proto.init=function(templet,aniMode){(aniMode===void 0)&&(aniMode=0);var i=0,n=0;if(aniMode==1){this._graphicsCache=[];for(i=0,n=templet.getAnimationCount();i<n;i++){this._graphicsCache.push([]);}}
this._yReverseMatrix=templet.yReverseMatrix;this._aniMode=aniMode;this._templet=templet;this._player=new AnimationPlayer();this._player.cacheFrameRate=templet.rate;this._player.templet=templet;this._player.play();this._parseSrcBoneMatrix();this._boneList=templet.mBoneArr;this._rootBone=templet.mRootBone;this._aniSectionDic=templet.aniSectionDic;if(templet.ikArr.length>0){this._ikArr=[];for(i=0,n=templet.ikArr.length;i<n;i++){this._ikArr.push(new IkConstraint(templet.ikArr[i],this._boneList));}}
if(templet.pathArr.length>0){var tPathData;var tPathConstraint;if(this._pathDic==null)this._pathDic={};var tBoneSlot;for(i=0,n=templet.pathArr.length;i<n;i++){tPathData=templet.pathArr[i];tPathConstraint=new PathConstraint(tPathData,this._boneList);tBoneSlot=this._boneSlotDic[tPathData.name];if(tBoneSlot){tPathConstraint=new PathConstraint(tPathData,this._boneList);tPathConstraint.target=tBoneSlot;}
this._pathDic[tPathData.name]=tPathConstraint;}}
if(templet.tfArr.length>0){this._tfArr=[];for(i=0,n=templet.tfArr.length;i<n;i++){this._tfArr.push(new TfConstraint(templet.tfArr[i],this._boneList));}}
if(templet.skinDataArray.length>0){var tSkinData=this._templet.skinDataArray[this._skinIndex];this._skinName=tSkinData.name;}
this._player.on("played",this,this._onPlay);this._player.on("stopped",this,this._onStop);this._player.on("paused",this,this._onPause);}
__proto.load=function(path,complete,aniMode){(aniMode===void 0)&&(aniMode=0);this._aniPath=path;this._complete=complete;this._loadAniMode=aniMode;Laya.loader.load([{url:path,type:"arraybuffer"}],Handler.create(this,this._onLoaded));}
__proto._onLoaded=function(){var arraybuffer=Loader.getRes(this._aniPath);if(arraybuffer==null)return;if(Templet.TEMPLET_DICTIONARY==null){Templet.TEMPLET_DICTIONARY={};};var tFactory;tFactory=Templet.TEMPLET_DICTIONARY[this._aniPath];if(tFactory){if(tFactory.isParseFail){this._parseFail();}else{if(tFactory.isParserComplete){this._parseComplete();}else{tFactory.on("complete",this,this._parseComplete);tFactory.on("error",this,this._parseFail);}}}else{tFactory=new Templet();tFactory._setUrl(this._aniPath);Templet.TEMPLET_DICTIONARY[this._aniPath]=tFactory;tFactory.on("complete",this,this._parseComplete);tFactory.on("error",this,this._parseFail);tFactory.isParserComplete=false;tFactory.parseData(null,arraybuffer);}}
__proto._parseComplete=function(){var tTemple=Templet.TEMPLET_DICTIONARY[this._aniPath];if(tTemple){this.init(tTemple,this._loadAniMode);this.play(0,true);}
this._complete&&this._complete.runWith(this);}
__proto._parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败");}
__proto._onPlay=function(){this.event("played");}
__proto._onStop=function(){var tEventData;var tEventAniArr=this._templet.eventAniArr;var tEventArr=tEventAniArr[this._aniClipIndex];if(tEventArr&&this._eventIndex<tEventArr.length){for(;this._eventIndex<tEventArr.length;this._eventIndex++){tEventData=tEventArr[this._eventIndex];if(tEventData.time>=this._player.playStart&&tEventData.time<=this._player.playEnd){this.event("label",tEventData);}}}
this._eventIndex=0;this._drawOrder=null;this.event("stopped");}
__proto._onPause=function(){this.event("paused");}
__proto._parseSrcBoneMatrix=function(){var i=0,n=0;n=this._templet.srcBoneMatrixArr.length;for(i=0;i<n;i++){this._boneMatrixArray.push(new Matrix());}
if(this._aniMode==0){this._boneSlotDic=this._templet.boneSlotDic;this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic;this._boneSlotArray=this._templet.boneSlotArray;}else{if(this._boneSlotDic==null)this._boneSlotDic={};if(this._bindBoneBoneSlotDic==null)this._bindBoneBoneSlotDic={};if(this._boneSlotArray==null)this._boneSlotArray=[];var tArr=this._templet.boneSlotArray;var tBS;var tBSArr;for(i=0,n=tArr.length;i<n;i++){tBS=tArr[i];tBSArr=this._bindBoneBoneSlotDic[tBS.parent];if(tBSArr==null){this._bindBoneBoneSlotDic[tBS.parent]=tBSArr=[];}
this._boneSlotDic[tBS.name]=tBS=tBS.copy();tBSArr.push(tBS);this._boneSlotArray.push(tBS);}}}
__proto._emitMissedEvents=function(startTime,endTime,startIndex){(startIndex===void 0)&&(startIndex=0);var tEventAniArr=this._templet.eventAniArr;var tEventArr=tEventAniArr[this._player.currentAnimationClipIndex];if(tEventArr){var i=0,len=0;var tEventData;len=tEventArr.length;for(i=startIndex;i<len;i++){tEventData=tEventArr[i];if(tEventData.time>=this._player.playStart&&tEventData.time<=this._player.playEnd){this.event("label",tEventData);}}}}
__proto._update=function(autoKey){(autoKey===void 0)&&(autoKey=true);if(this._pause)return;if(autoKey&&this._indexControl){return;};var tCurrTime=this.timer.currTimer;var preIndex=this._player.currentKeyframeIndex;var dTime=tCurrTime-this._lastTime;if(autoKey){this._player._update(dTime);}else{preIndex=-1;}
this._lastTime=tCurrTime;if(!this._player)return;this._index=this._clipIndex=this._player.currentKeyframeIndex;if(this._index<0)return;if(dTime>0&&this._clipIndex==preIndex&&this._lastUpdateAniClipIndex==this._aniClipIndex){return;}
this._lastUpdateAniClipIndex=this._aniClipIndex;if(preIndex>this._clipIndex&&this._eventIndex!=0){this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex);this._eventIndex=0;};var tEventData;var tEventAniArr=this._templet.eventAniArr;var tEventArr=tEventAniArr[this._aniClipIndex];if(tEventArr&&this._eventIndex<tEventArr.length){tEventData=tEventArr[this._eventIndex];if(tEventData.time>=this._player.playStart&&tEventData.time<=this._player.playEnd){if(this._player.currentPlayTime>=tEventData.time){this.event("label",tEventData);this._eventIndex++;}}else{this._eventIndex++;}};var tGraphics;if(this._aniMode==0){tGraphics=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex);if(tGraphics){if(this.graphics!=tGraphics){this.graphics=tGraphics;}
return;}else{var i=0,minIndex=0;minIndex=this._clipIndex;while((!this._templet.getGrahicsDataWithCache(this._aniClipIndex,minIndex-1))&&(minIndex>0)){minIndex--;}
if(minIndex<this._clipIndex){for(i=minIndex;i<this._clipIndex;i++){this._createGraphics(i);}}}}else if(this._aniMode==1){tGraphics=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex);if(tGraphics){if(this.graphics!=tGraphics){this.graphics=tGraphics;}
return;}else{minIndex=this._clipIndex;while((!this._getGrahicsDataWithCache(this._aniClipIndex,minIndex-1))&&(minIndex>0)){minIndex--;}
if(minIndex<this._clipIndex){for(i=minIndex;i<this._clipIndex;i++){this._createGraphics(i);}}}}
this._createGraphics();}
__proto._createGraphics=function(_clipIndex){(_clipIndex===void 0)&&(_clipIndex=-1);if(_clipIndex==-1)_clipIndex=this._clipIndex;var curTime=_clipIndex*this._player.cacheFrameRateInterval;var tDrawOrderData;var tDrawOrderAniArr=this._templet.drawOrderAniArr;var tDrawOrderArr=tDrawOrderAniArr[this._aniClipIndex];if(tDrawOrderArr&&tDrawOrderArr.length>0){this._drawOrderIndex=0;tDrawOrderData=tDrawOrderArr[this._drawOrderIndex];while(curTime>=tDrawOrderData.time){this._drawOrder=tDrawOrderData.drawOrder;this._drawOrderIndex++;if(this._drawOrderIndex>=tDrawOrderArr.length){break;}
tDrawOrderData=tDrawOrderArr[this._drawOrderIndex];}};var tGraphics;if(this._aniMode==0||this._aniMode==1){this.graphics=new GraphicsAni();}else{if((this.graphics instanceof laya.ani.GraphicsAni)){this.graphics.clear();}else{this.graphics=new GraphicsAni();}}
tGraphics=this.graphics;var bones=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],_clipIndex,curTime);var tSectionArr=this._aniSectionDic[this._aniClipIndex];var tParentMatrix;var tStartIndex=0;var i=0,j=0,k=0,n=0;var tDBBoneSlot;var tDBBoneSlotArr;var tParentTransform;var tSrcBone;var boneCount=this._templet.srcBoneMatrixArr.length;for(i=0,n=tSectionArr[0];i<boneCount;i++){tSrcBone=this._boneList[i];tParentTransform=this._templet.srcBoneMatrixArr[i];tSrcBone.resultTransform.scX=tParentTransform.scX*this._curOriginalData[tStartIndex++];tSrcBone.resultTransform.skX=tParentTransform.skX+this._curOriginalData[tStartIndex++];tSrcBone.resultTransform.skY=tParentTransform.skY+this._curOriginalData[tStartIndex++];tSrcBone.resultTransform.scY=tParentTransform.scY*this._curOriginalData[tStartIndex++];tSrcBone.resultTransform.x=tParentTransform.x+this._curOriginalData[tStartIndex++];tSrcBone.resultTransform.y=tParentTransform.y+this._curOriginalData[tStartIndex++];if(this._templet.tMatrixDataLen===8){tSrcBone.resultTransform.skewX=tParentTransform.skewX+this._curOriginalData[tStartIndex++];tSrcBone.resultTransform.skewY=tParentTransform.skewY+this._curOriginalData[tStartIndex++];}};var tSlotDic={};var tSlotAlphaDic={};var tBoneData;for(n+=tSectionArr[1];i<n;i++){tBoneData=bones[i];tSlotDic[tBoneData.name]=this._curOriginalData[tStartIndex++];tSlotAlphaDic[tBoneData.name]=this._curOriginalData[tStartIndex++];this._curOriginalData[tStartIndex++];this._curOriginalData[tStartIndex++];this._curOriginalData[tStartIndex++];this._curOriginalData[tStartIndex++];};var tBendDirectionDic={};var tMixDic={};for(n+=tSectionArr[2];i<n;i++){tBoneData=bones[i];tBendDirectionDic[tBoneData.name]=this._curOriginalData[tStartIndex++];tMixDic[tBoneData.name]=this._curOriginalData[tStartIndex++];this._curOriginalData[tStartIndex++];this._curOriginalData[tStartIndex++];this._curOriginalData[tStartIndex++];this._curOriginalData[tStartIndex++];}
if(this._pathDic){var tPathConstraint;for(n+=tSectionArr[3];i<n;i++){tBoneData=bones[i];tPathConstraint=this._pathDic[tBoneData.name];if(tPathConstraint){var tByte=new Byte(tBoneData.extenData);switch(tByte.getByte()){case 1:tPathConstraint.position=this._curOriginalData[tStartIndex++];break;case 2:tPathConstraint.spacing=this._curOriginalData[tStartIndex++];break;case 3:tPathConstraint.rotateMix=this._curOriginalData[tStartIndex++];tPathConstraint.translateMix=this._curOriginalData[tStartIndex++];break;}}}}
if(this._yReverseMatrix){this._rootBone.update(this._yReverseMatrix);}else{this._rootBone.update(Matrix.TEMP.identity());}
if(this._ikArr){var tIkConstraint;for(i=0,n=this._ikArr.length;i<n;i++){tIkConstraint=this._ikArr[i];if(tBendDirectionDic.hasOwnProperty(tIkConstraint.name)){tIkConstraint.bendDirection=tBendDirectionDic[tIkConstraint.name];}
if(tMixDic.hasOwnProperty(tIkConstraint.name)){tIkConstraint.mix=tMixDic[tIkConstraint.name]}
tIkConstraint.apply();}}
if(this._pathDic){for(var tPathStr in this._pathDic){tPathConstraint=this._pathDic[tPathStr];tPathConstraint.apply(this._boneList,tGraphics);}}
if(this._tfArr){var tTfConstraint;for(i=0,k=this._tfArr.length;i<k;i++){tTfConstraint=this._tfArr[i];tTfConstraint.apply();}}
for(i=0,k=this._boneList.length;i<k;i++){tSrcBone=this._boneList[i];tDBBoneSlotArr=this._bindBoneBoneSlotDic[tSrcBone.name];tSrcBone.resultMatrix.copyTo(this._boneMatrixArray[i]);if(tDBBoneSlotArr){for(j=0,n=tDBBoneSlotArr.length;j<n;j++){tDBBoneSlot=tDBBoneSlotArr[j];if(tDBBoneSlot){tDBBoneSlot.setParentMatrix(tSrcBone.resultMatrix);}}}};var tDeformDic={};var tDeformAniArr=this._templet.deformAniArr;var tDeformAniData;var tDeformSlotData;var tDeformSlotDisplayData;if(tDeformAniArr&&tDeformAniArr.length>0){if(this._lastAniClipIndex!=this._aniClipIndex){this._lastAniClipIndex=this._aniClipIndex;for(i=0,n=this._boneSlotArray.length;i<n;i++){tDBBoneSlot=this._boneSlotArray[i];tDBBoneSlot.deformData=null;}};var tSkinDeformAni=tDeformAniArr[this._aniClipIndex];tDeformAniData=(tSkinDeformAni["default"]);this._setDeform(tDeformAniData,tDeformDic,this._boneSlotArray,curTime);var tSkin;for(tSkin in tSkinDeformAni){if(tSkin!="default"&&tSkin!=this._skinName){tDeformAniData=tSkinDeformAni[tSkin];this._setDeform(tDeformAniData,tDeformDic,this._boneSlotArray,curTime);}}
tDeformAniData=(tSkinDeformAni[this._skinName]);this._setDeform(tDeformAniData,tDeformDic,this._boneSlotArray,curTime);};var tSlotData2;var tSlotData3;var tObject;if(this._drawOrder){for(i=0,n=this._drawOrder.length;i<n;i++){tDBBoneSlot=this._boneSlotArray[this._drawOrder[i]];tSlotData2=tSlotDic[tDBBoneSlot.name];tSlotData3=tSlotAlphaDic[tDBBoneSlot.name];if(!isNaN(tSlotData3)){tGraphics.save();tGraphics.alpha(tSlotData3);}
if(!isNaN(tSlotData2)&&tSlotData2!=-2){if(this._templet.attachmentNames){tDBBoneSlot.showDisplayByName(this._templet.attachmentNames[tSlotData2]);}else{tDBBoneSlot.showDisplayByIndex(tSlotData2);}}
if(tDeformDic[this._drawOrder[i]]){tObject=tDeformDic[this._drawOrder[i]];if(tDBBoneSlot.currDisplayData&&tObject[tDBBoneSlot.currDisplayData.attachmentName]){tDBBoneSlot.deformData=tObject[tDBBoneSlot.currDisplayData.attachmentName];}else{tDBBoneSlot.deformData=null;}}else{tDBBoneSlot.deformData=null;}
if(!isNaN(tSlotData3)){tDBBoneSlot.draw(tGraphics,this._boneMatrixArray,this._aniMode==2,tSlotData3);}else{tDBBoneSlot.draw(tGraphics,this._boneMatrixArray,this._aniMode==2);}
if(!isNaN(tSlotData3)){tGraphics.restore();}}}else{for(i=0,n=this._boneSlotArray.length;i<n;i++){tDBBoneSlot=this._boneSlotArray[i];tSlotData2=tSlotDic[tDBBoneSlot.name];tSlotData3=tSlotAlphaDic[tDBBoneSlot.name];if(!isNaN(tSlotData3)){tGraphics.save();tGraphics.alpha(tSlotData3);}
if(!isNaN(tSlotData2)&&tSlotData2!=-2){if(this._templet.attachmentNames){tDBBoneSlot.showDisplayByName(this._templet.attachmentNames[tSlotData2]);}else{tDBBoneSlot.showDisplayByIndex(tSlotData2);}}
if(tDeformDic[i]){tObject=tDeformDic[i];if(tDBBoneSlot.currDisplayData&&tObject[tDBBoneSlot.currDisplayData.attachmentName]){tDBBoneSlot.deformData=tObject[tDBBoneSlot.currDisplayData.attachmentName];}else{tDBBoneSlot.deformData=null;}}else{tDBBoneSlot.deformData=null;}
if(!isNaN(tSlotData3)){tDBBoneSlot.draw(tGraphics,this._boneMatrixArray,this._aniMode==2,tSlotData3);}else{tDBBoneSlot.draw(tGraphics,this._boneMatrixArray,this._aniMode==2);}
if(!isNaN(tSlotData3)){tGraphics.restore();}}}
if(this._aniMode==0){this._templet.setGrahicsDataWithCache(this._aniClipIndex,_clipIndex,tGraphics);}else if(this._aniMode==1){this._setGrahicsDataWithCache(this._aniClipIndex,_clipIndex,tGraphics);}}
__proto._setDeform=function(tDeformAniData,tDeformDic,_boneSlotArray,curTime){if(!tDeformAniData)return;var tDeformSlotData;var tDeformSlotDisplayData;var tDBBoneSlot;var i=0,n=0,j=0;if(tDeformAniData){for(i=0,n=tDeformAniData.deformSlotDataList.length;i<n;i++){tDeformSlotData=tDeformAniData.deformSlotDataList[i];for(j=0;j<tDeformSlotData.deformSlotDisplayList.length;j++){tDeformSlotDisplayData=tDeformSlotData.deformSlotDisplayList[j];tDBBoneSlot=_boneSlotArray[tDeformSlotDisplayData.slotIndex];tDeformSlotDisplayData.apply(curTime,tDBBoneSlot);if(!tDeformDic[tDeformSlotDisplayData.slotIndex]){tDeformDic[tDeformSlotDisplayData.slotIndex]={};}
tDeformDic[tDeformSlotDisplayData.slotIndex][tDeformSlotDisplayData.attachment]=tDeformSlotDisplayData.deformData;}}}}
__proto.getAnimNum=function(){return this._templet.getAnimationCount();}
__proto.getAniNameByIndex=function(index){return this._templet.getAniNameByIndex(index);}
__proto.getSlotByName=function(name){return this._boneSlotDic[name];}
__proto.showSkinByName=function(name,freshSlotIndex){(freshSlotIndex===void 0)&&(freshSlotIndex=true);this.showSkinByIndex(this._templet.getSkinIndexByName(name),freshSlotIndex);}
__proto.showSkinByIndex=function(skinIndex,freshSlotIndex){(freshSlotIndex===void 0)&&(freshSlotIndex=true);for(var i=0;i<this._boneSlotArray.length;i++){(this._boneSlotArray[i]).showSlotData(null,freshSlotIndex);}
if(this._templet.showSkinByIndex(this._boneSlotDic,skinIndex,freshSlotIndex)){var tSkinData=this._templet.skinDataArray[skinIndex];this._skinIndex=skinIndex;this._skinName=tSkinData.name;}
this._clearCache();}
__proto.showSlotSkinByIndex=function(slotName,index){if(this._aniMode==0)return;var tBoneSlot=this.getSlotByName(slotName);if(tBoneSlot){tBoneSlot.showDisplayByIndex(index);}
this._clearCache();}
__proto.showSlotSkinByName=function(slotName,name){if(this._aniMode==0)return;var tBoneSlot=this.getSlotByName(slotName);if(tBoneSlot){tBoneSlot.showDisplayByName(name);}
this._clearCache();}
__proto.replaceSlotSkinName=function(slotName,oldName,newName){if(this._aniMode==0)return;var tBoneSlot=this.getSlotByName(slotName);if(tBoneSlot){tBoneSlot.replaceDisplayByName(oldName,newName);}
this._clearCache();}
__proto.replaceSlotSkinByIndex=function(slotName,oldIndex,newIndex){if(this._aniMode==0)return;var tBoneSlot=this.getSlotByName(slotName);if(tBoneSlot){tBoneSlot.replaceDisplayByIndex(oldIndex,newIndex);}
this._clearCache();}
__proto.setSlotSkin=function(slotName,texture){if(this._aniMode==0)return;var tBoneSlot=this.getSlotByName(slotName);if(tBoneSlot){tBoneSlot.replaceSkin(texture);}
this._clearCache();}
__proto._clearCache=function(){if(this._aniMode==1){for(var i=0,n=this._graphicsCache.length;i<n;i++){this._graphicsCache[i].length=0;}}}
__proto.play=function(nameOrIndex,loop,force,start,end,freshSkin){(force===void 0)&&(force=true);(start===void 0)&&(start=0);(end===void 0)&&(end=0);(freshSkin===void 0)&&(freshSkin=true);this._indexControl=false;var index=-1;var duration=NaN;if(loop){duration=2147483647;}else{duration=0;}
if((typeof nameOrIndex=='string')){for(var i=0,n=this._templet.getAnimationCount();i<n;i++){var animation=this._templet.getAnimation(i);if(animation&&nameOrIndex==animation.name){index=i;break;}}}else{index=nameOrIndex;}
if(index>-1&&index<this.getAnimNum()){this._aniClipIndex=index;if(force||this._pause||this._currAniIndex!=index){this._currAniIndex=index;this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(index));this._drawOrder=null;this._eventIndex=0;this._player.play(index,this._player.playbackRate,duration,start,end);if(freshSkin)
this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex);if(this._pause){this._pause=false;this._lastTime=Browser.now();this.timer.frameLoop(1,this,this._update,null,true);}
this._update();}}}
__proto.stop=function(){if(!this._pause){this._pause=true;if(this._player){this._player.stop(true);}
this.timer.clear(this,this._update);}}
__proto.playbackRate=function(value){if(this._player){this._player.playbackRate=value;}}
__proto.paused=function(){if(!this._pause){this._pause=true;if(this._player){this._player.paused=true;}
this.timer.clear(this,this._update);}}
__proto.resume=function(){this._indexControl=false;if(this._pause){this._pause=false;if(this._player){this._player.paused=false;}
this._lastTime=Browser.now();this.timer.frameLoop(1,this,this._update,null,true);}}
__proto._getGrahicsDataWithCache=function(aniIndex,frameIndex){return this._graphicsCache[aniIndex][frameIndex];}
__proto._setGrahicsDataWithCache=function(aniIndex,frameIndex,graphics){this._graphicsCache[aniIndex][frameIndex]=graphics;}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._templet=null;if(this._player)this._player.offAll();this._player=null;this._curOriginalData=null;this._boneMatrixArray.length=0;this._lastTime=0;this.timer.clear(this,this._update);}
__getset(0,__proto,'url',function(){return this._aniPath;},function(path){this.load(path);});__getset(0,__proto,'index',function(){return this._index;},function(value){if(this.player){this._index=value;this._player.currentTime=this._index*1000/this._player.cacheFrameRate;this._indexControl=true;this._update(false);}});__getset(0,__proto,'total',function(){if(this._templet&&this._player){this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1000*this._player.cacheFrameRate);}else{this._total=-1;}
return this._total;});__getset(0,__proto,'templet',function(){return this._templet;});__getset(0,__proto,'player',function(){return this._player;});Skeleton.useSimpleMeshInCanvas=false;return Skeleton;})(Sprite)
var MovieClip=(function(_super){function MovieClip(parentMovieClip){this._start=0;this._Pos=0;this._data=null;this._curIndex=0;this._preIndex=0;this._playIndex=0;this._playing=false;this._ended=true;this._count=0;this._ids=null;this._loadedImage={};this._idOfSprite=null;this._parentMovieClip=null;this._movieClipList=null;this._labels=null;this.basePath=null;this._atlasPath=null;this._url=null;this._isRoot=false;this._completeHandler=null;this._endFrame=-1;this.interval=30;this.loop=false;MovieClip.__super.call(this);this._ids={};this._idOfSprite=[];this._reset();this._playing=false;this._parentMovieClip=parentMovieClip;if(!parentMovieClip){this._movieClipList=[this];this._isRoot=true;this._setUpNoticeType(0x1);}else{this._isRoot=false;this._movieClipList=parentMovieClip._movieClipList;this._movieClipList.push(this);}}
__class(MovieClip,'laya.ani.swf.MovieClip',_super);var __proto=MovieClip.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);this._clear();_super.prototype.destroy.call(this,destroyChild);}
__proto._setDisplay=function(value){_super.prototype._setDisplay.call(this,value);if(this._isRoot){this._$3__onDisplay(value);}}
__proto._$3__onDisplay=function(value){if(value)this.timer.loop(this.interval,this,this.updates,null,true);else this.timer.clear(this,this.updates);}
__proto.updates=function(){if(this._parentMovieClip)return;var i=0,len=0;len=this._movieClipList.length;for(i=0;i<len;i++){this._movieClipList[i]&&this._movieClipList[i]._update();}}
__proto.addLabel=function(label,index){if(!this._labels)this._labels={};this._labels[index]=label;}
__proto.removeLabel=function(label){if(!label)this._labels=null;else if(!this._labels){for(var name in this._labels){if(this._labels[name]===label){delete this._labels[name];break;}}}}
__proto._update=function(){if(!this._data)return;if(!this._playing)return;this._playIndex++;if(this._playIndex>=this._count){if(!this.loop){this._playIndex--;this.stop();return;}
this._playIndex=0;}
this._parse(this._playIndex);if(this._labels&&this._labels[this._playIndex])this.event("label",this._labels[this._playIndex]);if(this._endFrame!=-1&&this._endFrame==this._playIndex){this._endFrame=-1;if(this._completeHandler!=null){var handler=this._completeHandler;this._completeHandler=null;handler.run();}
this.stop();}}
__proto.stop=function(){this._playing=false;}
__proto.gotoAndStop=function(index){this.index=index;this.stop();}
__proto._clear=function(){this.stop();this._idOfSprite.length=0;if(!this._parentMovieClip){this.timer.clear(this,this.updates);var i=0,len=0;len=this._movieClipList.length;for(i=0;i<len;i++){if(this._movieClipList[i]!=this)
this._movieClipList[i]._clear();}
this._movieClipList.length=0;}
if(this._atlasPath){Loader.clearRes(this._atlasPath);};var key;for(key in this._loadedImage){if(this._loadedImage[key]){Loader.clearRes(key);this._loadedImage[key]=false;}}
this.removeChildren();this.graphics=null;this._parentMovieClip=null;}
__proto.play=function(index,loop){(index===void 0)&&(index=0);(loop===void 0)&&(loop=true);this.loop=loop;this._playing=true;if(this._data)
this._displayFrame(index);}
__proto._displayFrame=function(frameIndex){(frameIndex===void 0)&&(frameIndex=-1);if(frameIndex!=-1){if(this._curIndex>frameIndex)this._reset();this._parse(frameIndex);}}
__proto._reset=function(rm){(rm===void 0)&&(rm=true);if(rm&&this._curIndex!=1)this.removeChildren();this._preIndex=this._curIndex=-1;this._Pos=this._start;}
__proto._parse=function(frameIndex){var curChild=this;var mc,sp,key=0,type=0,tPos=0,ttype=0,ifAdd=false;var _idOfSprite=this._idOfSprite,_data=this._data,eStr;if(this._ended)this._reset();_data.pos=this._Pos;this._ended=false;this._playIndex=frameIndex;if(this._curIndex>frameIndex&&frameIndex<this._preIndex){this._reset(true);_data.pos=this._Pos;}
while((this._curIndex<=frameIndex)&&(!this._ended)){type=_data.getUint16();switch(type){case 12:key=_data.getUint16();tPos=this._ids[_data.getUint16()];this._Pos=_data.pos;_data.pos=tPos;if((ttype=_data.getUint8())==0){var pid=_data.getUint16();sp=_idOfSprite[key]
if(!sp){sp=_idOfSprite[key]=new Sprite();var spp=new Sprite();spp.loadImage(this.basePath+pid+".png");this._loadedImage[this.basePath+pid+".png"]=true;sp.addChild(spp);spp.size(_data.getFloat32(),_data.getFloat32());var mat=_data._getMatrix();spp.transform=mat;}
sp.alpha=1;}else if(ttype==1){mc=_idOfSprite[key]
if(!mc){_idOfSprite[key]=mc=new MovieClip(this);mc.interval=this.interval;mc._ids=this._ids;mc.basePath=this.basePath;mc._setData(_data,tPos);mc._initState();mc.play(0);}
mc.alpha=1;}
_data.pos=this._Pos;break;case 3:;var node=_idOfSprite[_data.getUint16()];if(node){this.addChild(node);node.zOrder=_data.getUint16();ifAdd=true;}
break;case 4:node=_idOfSprite[_data.getUint16()];node&&node.removeSelf();break;case 5:_idOfSprite[_data.getUint16()][MovieClip._ValueList[_data.getUint16()]]=(_data.getFloat32());break;case 6:_idOfSprite[_data.getUint16()].visible=(_data.getUint8()>0);break;case 7:sp=_idOfSprite[_data.getUint16()];var mt=sp.transform||Matrix.create();mt.setTo(_data.getFloat32(),_data.getFloat32(),_data.getFloat32(),_data.getFloat32(),_data.getFloat32(),_data.getFloat32());sp.transform=mt;break;case 8:_idOfSprite[_data.getUint16()].setPos(_data.getFloat32(),_data.getFloat32());break;case 9:_idOfSprite[_data.getUint16()].setSize(_data.getFloat32(),_data.getFloat32());break;case 10:_idOfSprite[_data.getUint16()].alpha=_data.getFloat32();break;case 11:_idOfSprite[_data.getUint16()].setScale(_data.getFloat32(),_data.getFloat32());break;case 98:eStr=_data.getString();this.event(eStr);if(eStr=="stop")this.stop();break;case 99:this._curIndex=_data.getUint16();ifAdd&&this.updateZOrder();break;case 100:this._count=this._curIndex+1;this._ended=true;if(this._playing){this.event("enterframe");this.event("end");this.event("complete");}
this._reset(false);break;}}
if(this._playing&&!this._ended)this.event("enterframe");this._Pos=_data.pos;}
__proto._setData=function(data,start){this._data=data;this._start=start+3;}
__proto.load=function(url,atlas,atlasPath){(atlas===void 0)&&(atlas=false);this._url=url=URL.formatURL(url);if(atlas)this._atlasPath=atlasPath?atlasPath:url.split(".swf")[0]+".json";this.stop();this._clear();this._movieClipList=[this];var urls;urls=[{url:url,type:"arraybuffer"}];if(this._atlasPath){urls.push({url:this._atlasPath,type:"atlas"});}
Laya.loader.load(urls,Handler.create(this,this._onLoaded));}
__proto._onLoaded=function(){var data;data=Loader.getRes(this._url);if(!data){this.event("error","file not find");return;}
this.basePath=this._atlasPath?Loader.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"/image/";this._initData(data);}
__proto._initState=function(){this._reset();this._ended=false;var preState=this._playing;this._playing=false;this._curIndex=0;while(!this._ended)this._parse(++this._curIndex);this._playing=preState;}
__proto._initData=function(data){this._data=new Byte(data);var i=0,len=this._data.getUint16();for(i=0;i<len;i++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1000/this._data.getUint16();this._setData(this._data,this._ids[32767]);this._initState();this.play(0);this.event("loaded");if(!this._parentMovieClip)this.timer.loop(this.interval,this,this.updates,null,true);}
__proto.playTo=function(start,end,complete){this._completeHandler=complete;this._endFrame=end;this.play(start,false);}
__getset(0,__proto,'index',function(){return this._playIndex;},function(value){this._playIndex=value;if(this._data)
this._displayFrame(this._playIndex);if(this._labels&&this._labels[value])this.event("label",this._labels[value]);});__getset(0,__proto,'count',function(){return this._count;});__getset(0,__proto,'playing',function(){return this._playing;});__getset(0,__proto,'url',null,function(path){this.load(path);});MovieClip._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"];return MovieClip;})(Sprite)
var Templet=(function(_super){function Templet(){this._mainTexture=null;this._textureJson=null;this._graphicsCache=[];this.srcBoneMatrixArr=[];this.ikArr=[];this.tfArr=[];this.pathArr=[];this.boneSlotDic={};this.bindBoneBoneSlotDic={};this.boneSlotArray=[];this.skinDataArray=[];this.skinDic={};this.subTextureDic={};this.isParseFail=false;this.yReverseMatrix=null;this.drawOrderAniArr=[];this.eventAniArr=[];this.attachmentNames=null;this.deformAniArr=[];this._isDestroyed=false;this._rate=30;this.isParserComplete=false;this.aniSectionDic={};this._skBufferUrl=null;this._textureDic={};this._loadList=null;this._path=null;this.tMatrixDataLen=0;this.mRootBone=null;Templet.__super.call(this);this.skinSlotDisplayDataArr=[];this.mBoneArr=[];}
__class(Templet,'laya.ani.bone.Templet',_super);var __proto=Templet.prototype;__proto.loadAni=function(url){this._skBufferUrl=url;Laya.loader.load(url,Handler.create(this,this.onComplete),null,"arraybuffer");}
__proto.onComplete=function(content){if(this._isDestroyed){this.destroy();return;};var tSkBuffer=Loader.getRes(this._skBufferUrl);if(!tSkBuffer){this.event("error","load failed:"+this._skBufferUrl);return;}
this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/";this.parseData(null,tSkBuffer);}
__proto.parseData=function(texture,skeletonData,playbackRate){(playbackRate===void 0)&&(playbackRate=30);if(!this._path&&this.url)this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/";this._mainTexture=texture;if(this._mainTexture){if(Render.isWebGL&&texture.bitmap){texture.bitmap.enableMerageInAtlas=false;}}
this._rate=playbackRate;this.parse(skeletonData);}
__proto.buildArmature=function(aniMode){(aniMode===void 0)&&(aniMode=0);return new Skeleton(this,aniMode);}
__proto.parse=function(data){_super.prototype.parse.call(this,data);this._endLoaded();if(this._aniVersion!=Templet.LAYA_ANIMATION_VISION){console.log("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+Templet.LAYA_ANIMATION_VISION);this._loaded=false;}
if(this.loaded){if(this._mainTexture){this._parsePublicExtData();}else{this._parseTexturePath();}}else{this.event("error",this);this.isParseFail=true;}}
__proto._parseTexturePath=function(){if(this._isDestroyed){this.destroy();return;};var i=0;this._loadList=[];var tByte=new Byte(this.getPublicExtData());var tX=0,tY=0,tWidth=0,tHeight=0;var tFrameX=0,tFrameY=0,tFrameWidth=0,tFrameHeight=0;var tTempleData=0;var tTextureLen=tByte.getInt32();var tTextureName=tByte.readUTFString();var tTextureNameArr=tTextureName.split("\n");var tTexture;var tSrcTexturePath;for(i=0;i<tTextureLen;i++){tSrcTexturePath=this._path+tTextureNameArr[i*2];tTextureName=tTextureNameArr[i*2+1];tX=tByte.getFloat32();tY=tByte.getFloat32();tWidth=tByte.getFloat32();tHeight=tByte.getFloat32();tTempleData=tByte.getFloat32();tFrameX=isNaN(tTempleData)?0:tTempleData;tTempleData=tByte.getFloat32();tFrameY=isNaN(tTempleData)?0:tTempleData;tTempleData=tByte.getFloat32();tFrameWidth=isNaN(tTempleData)?tWidth:tTempleData;tTempleData=tByte.getFloat32();tFrameHeight=isNaN(tTempleData)?tHeight:tTempleData;if(this._loadList.indexOf(tSrcTexturePath)==-1){this._loadList.push(tSrcTexturePath);}}
Laya.loader.load(this._loadList,Handler.create(this,this._textureComplete));}
__proto._textureComplete=function(){var tTexture;var tTextureName;for(var i=0,n=this._loadList.length;i<n;i++){tTextureName=this._loadList[i];tTexture=this._textureDic[tTextureName]=Loader.getRes(tTextureName);if(Render.isWebGL&&tTexture&&tTexture.bitmap){tTexture.bitmap.enableMerageInAtlas=false;}}
this._parsePublicExtData();}
__proto._parsePublicExtData=function(){var i=0,j=0,k=0,l=0,n=0;for(i=0,n=this.getAnimationCount();i<n;i++){this._graphicsCache.push([]);};var isSpine=false;isSpine=this._aniClassName!="Dragon";var tByte=new Byte(this.getPublicExtData());var tX=0,tY=0,tWidth=0,tHeight=0;var tFrameX=0,tFrameY=0,tFrameWidth=0,tFrameHeight=0;var tTempleData=0;var tTextureLen=tByte.getInt32();var tTextureName=tByte.readUTFString();var tTextureNameArr=tTextureName.split("\n");var tTexture;var tSrcTexturePath;for(i=0;i<tTextureLen;i++){tTexture=this._mainTexture;tSrcTexturePath=this._path+tTextureNameArr[i*2];tTextureName=tTextureNameArr[i*2+1];if(this._mainTexture==null){tTexture=this._textureDic[tSrcTexturePath];}
if(!tTexture){this.event("error",this);this.isParseFail=true;return;}
tX=tByte.getFloat32();tY=tByte.getFloat32();tWidth=tByte.getFloat32();tHeight=tByte.getFloat32();tTempleData=tByte.getFloat32();tFrameX=isNaN(tTempleData)?0:tTempleData;tTempleData=tByte.getFloat32();tFrameY=isNaN(tTempleData)?0:tTempleData;tTempleData=tByte.getFloat32();tFrameWidth=isNaN(tTempleData)?tWidth:tTempleData;tTempleData=tByte.getFloat32();tFrameHeight=isNaN(tTempleData)?tHeight:tTempleData;this.subTextureDic[tTextureName]=Texture.create(tTexture,tX,tY,tWidth,tHeight,-tFrameX,-tFrameY,tFrameWidth,tFrameHeight);}
this._mainTexture=tTexture;var tAniCount=tByte.getUint16();var tSectionArr;for(i=0;i<tAniCount;i++){tSectionArr=[];tSectionArr.push(tByte.getUint16());tSectionArr.push(tByte.getUint16());tSectionArr.push(tByte.getUint16());tSectionArr.push(tByte.getUint16());this.aniSectionDic[i]=tSectionArr;};var tBone;var tParentBone;var tName;var tParentName;var tBoneLen=tByte.getInt16();var tBoneDic={};var tRootBone;for(i=0;i<tBoneLen;i++){tBone=new Bone();if(i==0){tRootBone=tBone;}else{tBone.root=tRootBone;}
tBone.d=isSpine?-1:1;tName=tByte.readUTFString();tParentName=tByte.readUTFString();tBone.length=tByte.getFloat32();if(tByte.getByte()==1){tBone.inheritRotation=false;}
if(tByte.getByte()==1){tBone.inheritScale=false;}
tBone.name=tName;if(tParentName){tParentBone=tBoneDic[tParentName];if(tParentBone){tParentBone.addChild(tBone);}else{this.mRootBone=tBone;}}
tBoneDic[tName]=tBone;this.mBoneArr.push(tBone);}
this.tMatrixDataLen=tByte.getUint16();var tLen=tByte.getUint16();var parentIndex=0;var boneLength=Math.floor(tLen/this.tMatrixDataLen);var tResultTransform;var tMatrixArray=this.srcBoneMatrixArr;for(i=0;i<boneLength;i++){tResultTransform=new Transform();tResultTransform.scX=tByte.getFloat32();tResultTransform.skX=tByte.getFloat32();tResultTransform.skY=tByte.getFloat32();tResultTransform.scY=tByte.getFloat32();tResultTransform.x=tByte.getFloat32();tResultTransform.y=tByte.getFloat32();if(this.tMatrixDataLen===8){tResultTransform.skewX=tByte.getFloat32();tResultTransform.skewY=tByte.getFloat32();}
tMatrixArray.push(tResultTransform);tBone=this.mBoneArr[i];tBone.transform=tResultTransform;};var tIkConstraintData;var tIkLen=tByte.getUint16();var tIkBoneLen=0;for(i=0;i<tIkLen;i++){tIkConstraintData=new IkConstraintData();tIkBoneLen=tByte.getUint16();for(j=0;j<tIkBoneLen;j++){tIkConstraintData.boneNames.push(tByte.readUTFString());tIkConstraintData.boneIndexs.push(tByte.getInt16());}
tIkConstraintData.name=tByte.readUTFString();tIkConstraintData.targetBoneName=tByte.readUTFString();tIkConstraintData.targetBoneIndex=tByte.getInt16();tIkConstraintData.bendDirection=tByte.getFloat32();tIkConstraintData.mix=tByte.getFloat32();tIkConstraintData.isSpine=isSpine;this.ikArr.push(tIkConstraintData);};var tTfConstraintData;var tTfLen=tByte.getUint16();var tTfBoneLen=0;for(i=0;i<tTfLen;i++){tTfConstraintData=new TfConstraintData();tTfBoneLen=tByte.getUint16();for(j=0;j<tTfBoneLen;j++){tTfConstraintData.boneIndexs.push(tByte.getInt16());}
tTfConstraintData.name=tByte.getUTFString();tTfConstraintData.targetIndex=tByte.getInt16();tTfConstraintData.rotateMix=tByte.getFloat32();tTfConstraintData.translateMix=tByte.getFloat32();tTfConstraintData.scaleMix=tByte.getFloat32();tTfConstraintData.shearMix=tByte.getFloat32();tTfConstraintData.offsetRotation=tByte.getFloat32();tTfConstraintData.offsetX=tByte.getFloat32();tTfConstraintData.offsetY=tByte.getFloat32();tTfConstraintData.offsetScaleX=tByte.getFloat32();tTfConstraintData.offsetScaleY=tByte.getFloat32();tTfConstraintData.offsetShearY=tByte.getFloat32();this.tfArr.push(tTfConstraintData);};var tPathConstraintData;var tPathLen=tByte.getUint16();var tPathBoneLen=0;for(i=0;i<tPathLen;i++){tPathConstraintData=new PathConstraintData();tPathConstraintData.name=tByte.readUTFString();tPathBoneLen=tByte.getUint16();for(j=0;j<tPathBoneLen;j++){tPathConstraintData.bones.push(tByte.getInt16());}
tPathConstraintData.target=tByte.readUTFString();tPathConstraintData.positionMode=tByte.readUTFString();tPathConstraintData.spacingMode=tByte.readUTFString();tPathConstraintData.rotateMode=tByte.readUTFString();tPathConstraintData.offsetRotation=tByte.getFloat32();tPathConstraintData.position=tByte.getFloat32();tPathConstraintData.spacing=tByte.getFloat32();tPathConstraintData.rotateMix=tByte.getFloat32();tPathConstraintData.translateMix=tByte.getFloat32();this.pathArr.push(tPathConstraintData);};var tDeformSlotLen=0;var tDeformSlotDisplayLen=0;var tDSlotIndex=0;var tDAttachment;var tDeformTimeLen=0;var tDTime=NaN;var tDeformVecticesLen=0;var tDeformAniData;var tDeformSlotData;var tDeformSlotDisplayData;var tDeformVectices;var tDeformAniLen=tByte.getInt16();for(i=0;i<tDeformAniLen;i++){var tDeformSkinLen=tByte.getUint8();var tSkinDic={};this.deformAniArr.push(tSkinDic);for(var f=0;f<tDeformSkinLen;f++){tDeformAniData=new DeformAniData();tDeformAniData.skinName=tByte.getUTFString();tSkinDic[tDeformAniData.skinName]=tDeformAniData;tDeformSlotLen=tByte.getInt16();for(j=0;j<tDeformSlotLen;j++){tDeformSlotData=new DeformSlotData();tDeformAniData.deformSlotDataList.push(tDeformSlotData);tDeformSlotDisplayLen=tByte.getInt16();for(k=0;k<tDeformSlotDisplayLen;k++){tDeformSlotDisplayData=new DeformSlotDisplayData();tDeformSlotData.deformSlotDisplayList.push(tDeformSlotDisplayData);tDeformSlotDisplayData.slotIndex=tDSlotIndex=tByte.getInt16();tDeformSlotDisplayData.attachment=tDAttachment=tByte.getUTFString();tDeformTimeLen=tByte.getInt16();for(l=0;l<tDeformTimeLen;l++){if(tByte.getByte()==1){tDeformSlotDisplayData.tweenKeyList.push(true);}else{tDeformSlotDisplayData.tweenKeyList.push(false);}
tDTime=tByte.getFloat32();tDeformSlotDisplayData.timeList.push(tDTime);tDeformVectices=[];tDeformSlotDisplayData.vectices.push(tDeformVectices);tDeformVecticesLen=tByte.getInt16();for(n=0;n<tDeformVecticesLen;n++){tDeformVectices.push(tByte.getFloat32());}}}}}};var tDrawOrderArr;var tDrawOrderAniLen=tByte.getInt16();var tDrawOrderLen=0;var tDrawOrderData;var tDoLen=0;for(i=0;i<tDrawOrderAniLen;i++){tDrawOrderLen=tByte.getInt16();tDrawOrderArr=[];for(j=0;j<tDrawOrderLen;j++){tDrawOrderData=new DrawOrderData();tDrawOrderData.time=tByte.getFloat32();tDoLen=tByte.getInt16();for(k=0;k<tDoLen;k++){tDrawOrderData.drawOrder.push(tByte.getInt16());}
tDrawOrderArr.push(tDrawOrderData);}
this.drawOrderAniArr.push(tDrawOrderArr);};var tEventArr;var tEventAniLen=tByte.getInt16();var tEventLen=0;var tEventData;for(i=0;i<tEventAniLen;i++){tEventLen=tByte.getInt16();tEventArr=[];for(j=0;j<tEventLen;j++){tEventData=new EventData();tEventData.name=tByte.getUTFString();tEventData.intValue=tByte.getInt32();tEventData.floatValue=tByte.getFloat32();tEventData.stringValue=tByte.getUTFString();tEventData.time=tByte.getFloat32();tEventArr.push(tEventData);}
this.eventAniArr.push(tEventArr);};var tAttachmentLen=tByte.getInt16();if(tAttachmentLen>0){this.attachmentNames=[];for(i=0;i<tAttachmentLen;i++){this.attachmentNames.push(tByte.getUTFString());}};var tBoneSlotLen=tByte.getInt16();var tDBBoneSlot;var tDBBoneSlotArr;for(i=0;i<tBoneSlotLen;i++){tDBBoneSlot=new BoneSlot();tDBBoneSlot.name=tByte.readUTFString();tDBBoneSlot.parent=tByte.readUTFString();tDBBoneSlot.attachmentName=tByte.readUTFString();tDBBoneSlot.srcDisplayIndex=tDBBoneSlot.displayIndex=tByte.getInt16();tDBBoneSlot.templet=this;this.boneSlotDic[tDBBoneSlot.name]=tDBBoneSlot;tDBBoneSlotArr=this.bindBoneBoneSlotDic[tDBBoneSlot.parent];if(tDBBoneSlotArr==null){this.bindBoneBoneSlotDic[tDBBoneSlot.parent]=tDBBoneSlotArr=[];}
tDBBoneSlotArr.push(tDBBoneSlot);this.boneSlotArray.push(tDBBoneSlot);};var tNameString=tByte.readUTFString();var tNameArray=tNameString.split("\n");var tNameStartIndex=0;var tSkinDataLen=tByte.getUint8();var tSkinData,tSlotData,tDisplayData;var tSlotDataLen=0,tDisplayDataLen=0;var tUvLen=0,tWeightLen=0,tTriangleLen=0,tVerticeLen=0,tLengthLen=0;for(i=0;i<tSkinDataLen;i++){tSkinData=new SkinData();tSkinData.name=tNameArray[tNameStartIndex++];tSlotDataLen=tByte.getUint8();for(j=0;j<tSlotDataLen;j++){tSlotData=new SlotData();tSlotData.name=tNameArray[tNameStartIndex++];tDBBoneSlot=this.boneSlotDic[tSlotData.name];tDisplayDataLen=tByte.getUint8();for(k=0;k<tDisplayDataLen;k++){tDisplayData=new SkinSlotDisplayData();this.skinSlotDisplayDataArr.push(tDisplayData);tDisplayData.name=tNameArray[tNameStartIndex++];tDisplayData.attachmentName=tNameArray[tNameStartIndex++];tDisplayData.transform=new Transform();tDisplayData.transform.scX=tByte.getFloat32();tDisplayData.transform.skX=tByte.getFloat32();tDisplayData.transform.skY=tByte.getFloat32();tDisplayData.transform.scY=tByte.getFloat32();tDisplayData.transform.x=tByte.getFloat32();tDisplayData.transform.y=tByte.getFloat32();tSlotData.displayArr.push(tDisplayData);tDisplayData.width=tByte.getFloat32();tDisplayData.height=tByte.getFloat32();tDisplayData.type=tByte.getUint8();tDisplayData.verLen=tByte.getUint16();tBoneLen=tByte.getUint16();if(tBoneLen>0){tDisplayData.bones=[];for(l=0;l<tBoneLen;l++){var tBoneId=tByte.getUint16();tDisplayData.bones.push(tBoneId);}}
tUvLen=tByte.getUint16();if(tUvLen>0){tDisplayData.uvs=[];for(l=0;l<tUvLen;l++){tDisplayData.uvs.push(tByte.getFloat32());}}
tWeightLen=tByte.getUint16();if(tWeightLen>0){tDisplayData.weights=[];for(l=0;l<tWeightLen;l++){tDisplayData.weights.push(tByte.getFloat32());}}
tTriangleLen=tByte.getUint16();if(tTriangleLen>0){tDisplayData.triangles=[];for(l=0;l<tTriangleLen;l++){tDisplayData.triangles.push(tByte.getUint16());}}
tVerticeLen=tByte.getUint16();if(tVerticeLen>0){tDisplayData.vertices=[];for(l=0;l<tVerticeLen;l++){tDisplayData.vertices.push(tByte.getFloat32());}}
tLengthLen=tByte.getUint16();if(tLengthLen>0){tDisplayData.lengths=[];for(l=0;l<tLengthLen;l++){tDisplayData.lengths.push(tByte.getFloat32());}}}
tSkinData.slotArr.push(tSlotData);}
this.skinDic[tSkinData.name]=tSkinData;this.skinDataArray.push(tSkinData);};var tReverse=tByte.getUint8();if(tReverse==1){this.yReverseMatrix=new Matrix(1,0,0,-1,0,0);if(tRootBone){tRootBone.setTempMatrix(this.yReverseMatrix);}}else{if(tRootBone){tRootBone.setTempMatrix(new Matrix());}}
this.showSkinByIndex(this.boneSlotDic,0);this.isParserComplete=true;this.event("complete",this);}
__proto.getTexture=function(name){var tTexture=this.subTextureDic[name];if(tTexture==null){return this._mainTexture;}
return tTexture;}
__proto.showSkinByIndex=function(boneSlotDic,skinIndex,freshDisplayIndex){(freshDisplayIndex===void 0)&&(freshDisplayIndex=true);if(skinIndex<0&&skinIndex>=this.skinDataArray.length)return false;var i=0,n=0;var tBoneSlot;var tSlotData;var tSkinData=this.skinDataArray[skinIndex];if(tSkinData){for(i=0,n=tSkinData.slotArr.length;i<n;i++){tSlotData=tSkinData.slotArr[i];if(tSlotData){tBoneSlot=boneSlotDic[tSlotData.name];if(tBoneSlot){tBoneSlot.showSlotData(tSlotData,freshDisplayIndex);if(freshDisplayIndex&&tBoneSlot.attachmentName!="undefined"&&tBoneSlot.attachmentName!="null"){tBoneSlot.showDisplayByName(tBoneSlot.attachmentName);}else{tBoneSlot.showDisplayByIndex(tBoneSlot.displayIndex);}}}}
return true;}
return false;}
__proto.getSkinIndexByName=function(skinName){var tSkinData;for(var i=0,n=this.skinDataArray.length;i<n;i++){tSkinData=this.skinDataArray[i];if(tSkinData.name==skinName){return i;}}
return-1;}
__proto.getGrahicsDataWithCache=function(aniIndex,frameIndex){return this._graphicsCache[aniIndex][frameIndex];}
__proto.setGrahicsDataWithCache=function(aniIndex,frameIndex,graphics){this._graphicsCache[aniIndex][frameIndex]=graphics;}
__proto.destroy=function(){this._isDestroyed=true;var tTexture;for(var $each_tTexture in this.subTextureDic){tTexture=this.subTextureDic[$each_tTexture];if(tTexture)
tTexture.destroy();}
var $each_tTexture;for($each_tTexture in this._textureDic){tTexture=this._textureDic[$each_tTexture];if(tTexture)
tTexture.destroy();};var tSkinSlotDisplayData;for(var i=0,n=this.skinSlotDisplayDataArr.length;i<n;i++){tSkinSlotDisplayData=this.skinSlotDisplayDataArr[i];tSkinSlotDisplayData.destory();}
this.skinSlotDisplayDataArr.length=0;if(this.url){delete Templet.TEMPLET_DICTIONARY[this.url];}
laya.resource.Resource.prototype.destroy.call(this);}
__proto.getAniNameByIndex=function(index){var tAni=this.getAnimation(index);if(tAni)return tAni.name;return null;}
__getset(0,__proto,'rate',function(){return this._rate;},function(v){this._rate=v;});Templet.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0";Templet.TEMPLET_DICTIONARY=null;return Templet;})(AnimationTemplet)})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var Browser=laya.utils.Browser,Color=laya.utils.Color,ColorFilterAction=laya.filters.ColorFilterAction;var ColorFilterActionGL=laya.filters.webgl.ColorFilterActionGL,Filter=laya.filters.Filter,FilterActionGL=laya.filters.webgl.FilterActionGL;var Matrix=laya.maths.Matrix,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext;var RenderTarget2D=laya.webgl.resource.RenderTarget2D,RunDriver=laya.utils.RunDriver,ShaderDefines2D=laya.webgl.shader.d2.ShaderDefines2D;var Sprite=laya.display.Sprite,Texture=laya.resource.Texture,Value2D=laya.webgl.shader.d2.value.Value2D;var FilterAction=(function(){function FilterAction(){this.data=null;}
__class(FilterAction,'laya.filters.FilterAction');var __proto=FilterAction.prototype;Laya.imps(__proto,{"laya.filters.IFilterAction":true})
__proto.apply=function(data){return null;}
return FilterAction;})()
var WebGLFilter=(function(){function WebGLFilter(){}
__class(WebGLFilter,'laya.filters.WebGLFilter');WebGLFilter.enable=function(){if(WebGLFilter.isInit)return;WebGLFilter.isInit=true;if(!Render.isWebGL)return;RunDriver.createFilterAction=function(type){var action;switch(type){case 0x20:action=new ColorFilterActionGL();break;case 0x10:action=new BlurFilterActionGL();break;case 0x08:action=new GlowFilterActionGL();break;}
return action;}}
WebGLFilter.isInit=false;WebGLFilter.__init$=function(){BlurFilterActionGL;ColorFilterActionGL;GlowFilterActionGL;Render;RunDriver;{RunDriver.createFilterAction=function(type){var action;switch(type){case 0x10:action=new FilterAction();break;case 0x08:action=new FilterAction();break;case 0x20:action=new ColorFilterAction();break;}
return action;}}}
return WebGLFilter;})()
var BlurFilter=(function(_super){function BlurFilter(strength){this.strength=NaN;this.strength_sig2_2sig2_gauss1=[];BlurFilter.__super.call(this);(strength===void 0)&&(strength=4);if(Render.isWebGL)WebGLFilter.enable();this.strength=strength;this._action=RunDriver.createFilterAction(0x10);this._action.data=this;}
__class(BlurFilter,'laya.filters.BlurFilter',_super);var __proto=BlurFilter.prototype;__proto.callNative=function(sp){sp.conchModel&&sp.conchModel.blurFilter&&sp.conchModel.blurFilter(this.strength);}
__getset(0,__proto,'action',function(){return this._action;});__getset(0,__proto,'type',function(){return 0x10;});return BlurFilter;})(Filter)
var GlowFilter=(function(_super){function GlowFilter(color,blur,offX,offY){this._color=null;GlowFilter.__super.call(this);this._elements=new Float32Array(9);(blur===void 0)&&(blur=4);(offX===void 0)&&(offX=6);(offY===void 0)&&(offY=6);if(Render.isWebGL){WebGLFilter.enable();}
this._color=new Color(color);this.blur=Math.min(blur,20);this.offX=offX;this.offY=offY;this._action=RunDriver.createFilterAction(0x08);this._action.data=this;}
__class(GlowFilter,'laya.filters.GlowFilter',_super);var __proto=GlowFilter.prototype;__proto.getColor=function(){return this._color._color;}
__proto.callNative=function(sp){sp.conchModel&&sp.conchModel.glowFilter&&sp.conchModel.glowFilter(this._color.strColor,this._elements[4],this._elements[5],this._elements[6]);}
__getset(0,__proto,'type',function(){return 0x08;});__getset(0,__proto,'action',function(){return this._action;});__getset(0,__proto,'offY',function(){return this._elements[6];},function(value){this._elements[6]=value;});__getset(0,__proto,'offX',function(){return this._elements[5];},function(value){this._elements[5]=value;});__getset(0,__proto,'blur',function(){return this._elements[4];},function(value){this._elements[4]=value;});return GlowFilter;})(Filter)
var BlurFilterActionGL=(function(_super){function BlurFilterActionGL(){this.data=null;BlurFilterActionGL.__super.call(this);}
__class(BlurFilterActionGL,'laya.filters.webgl.BlurFilterActionGL',_super);var __proto=BlurFilterActionGL.prototype;__proto.setValueMix=function(shader){shader.defines.add(this.data.type);var o=shader;}
__proto.apply3d=function(scope,sprite,context,x,y){var b=scope.getValue("bounds");var shaderValue=Value2D.create(0x01,0);shaderValue.setFilters([this.data]);var tMatrix=Matrix.EMPTY;tMatrix.identity();context.ctx.drawTarget(scope,0,0,b.width,b.height,Matrix.EMPTY,"src",shaderValue);shaderValue.setFilters(null);}
__proto.setValue=function(shader){shader.strength=this.data.strength;var sigma=this.data.strength/3.0;var sigma2=sigma*sigma;this.data.strength_sig2_2sig2_gauss1[0]=this.data.strength;this.data.strength_sig2_2sig2_gauss1[1]=sigma2;this.data.strength_sig2_2sig2_gauss1[2]=2.0*sigma2;this.data.strength_sig2_2sig2_gauss1[3]=1.0/(2.0*Math.PI*sigma2);shader.strength_sig2_2sig2_gauss1=this.data.strength_sig2_2sig2_gauss1;}
__getset(0,__proto,'typeMix',function(){return 0x10;});return BlurFilterActionGL;})(FilterActionGL)
var GlowFilterActionGL=(function(_super){function GlowFilterActionGL(){this.data=null;this._initKey=false;this._textureWidth=0;this._textureHeight=0;GlowFilterActionGL.__super.call(this);}
__class(GlowFilterActionGL,'laya.filters.webgl.GlowFilterActionGL',_super);var __proto=GlowFilterActionGL.prototype;Laya.imps(__proto,{"laya.filters.IFilterActionGL":true})
__proto.setValueMix=function(shader){}
__proto.apply3d=function(scope,sprite,context,x,y){var b=scope.getValue("bounds");scope.addValue("color",this.data.getColor());var w=b.width,h=b.height;this._textureWidth=w;this._textureHeight=h;var shaderValue;var mat=Matrix.TEMP;mat.identity();shaderValue=Value2D.create(0x01,0);shaderValue.setFilters([this.data]);context.ctx.drawTarget(scope,0,0,this._textureWidth,this._textureHeight,mat,"src",shaderValue,null);shaderValue=Value2D.create(0x01,0);context.ctx.drawTarget(scope,0,0,this._textureWidth,this._textureHeight,mat,"src",shaderValue);return null;}
__proto.setSpriteWH=function(sprite){this._textureWidth=sprite.width;this._textureHeight=sprite.height;}
__proto.setValue=function(shader){shader.u_offsetX=this.data.offX;shader.u_offsetY=-this.data.offY;shader.u_strength=1.0;shader.u_blurX=this.data.blur;shader.u_blurY=this.data.blur;shader.u_textW=this._textureWidth;shader.u_textH=this._textureHeight;shader.u_color=this.data.getColor();}
__getset(0,__proto,'typeMix',function(){return 0x08;});GlowFilterActionGL.tmpTarget=function(scope,sprite,context,x,y){var b=scope.getValue("bounds");var out=scope.getValue("out");out.end();var tmpTarget=RenderTarget2D.create(b.width,b.height);tmpTarget.start();var color=scope.getValue("color");if(color){tmpTarget.clear(color[0],color[1],color[2],0);}
scope.addValue("tmpTarget",tmpTarget);}
GlowFilterActionGL.startOut=function(scope,sprite,context,x,y){var tmpTarget=scope.getValue("tmpTarget");tmpTarget.end();var out=scope.getValue("out");out.start();var color=scope.getValue("color");if(color){out.clear(color[0],color[1],color[2],0);}}
GlowFilterActionGL.recycleTarget=function(scope,sprite,context,x,y){var src=scope.getValue("src");var tmpTarget=scope.getValue("tmpTarget");tmpTarget.recycle();}
return GlowFilterActionGL;})(FilterActionGL)
Laya.__init([WebGLFilter]);})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var Browser=laya.utils.Browser,CSSStyle=laya.display.css.CSSStyle,ClassUtils=laya.utils.ClassUtils;var Event=laya.events.Event,HTMLChar=laya.utils.HTMLChar,Loader=laya.net.Loader,Node=laya.display.Node,Rectangle=laya.maths.Rectangle;var Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite;var Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Text=laya.display.Text,Texture=laya.resource.Texture;var URL=laya.net.URL,Utils=laya.utils.Utils;var HTMLParse=(function(){function HTMLParse(){}
__class(HTMLParse,'laya.html.utils.HTMLParse');HTMLParse.parse=function(ower,xmlString,url){xmlString=xmlString.replace(/<br>/g,"<br/>");xmlString="<root>"+xmlString+"</root>";xmlString=xmlString.replace(HTMLParse.spacePattern,HTMLParse.char255);var xml=Utils.parseXMLFromString(xmlString);HTMLParse._parseXML(ower,xml.childNodes[0].childNodes,url);}
HTMLParse._parseXML=function(parent,xml,url,href){var i=0,n=0;if(xml.join||xml.item){for(i=0,n=xml.length;i<n;++i){HTMLParse._parseXML(parent,xml[i],url,href);}}else{var node;var nodeName;if(xml.nodeType==3){var txt;if((parent instanceof laya.html.dom.HTMLDivElement)){if(xml.nodeName==null){xml.nodeName="#text";}
nodeName=xml.nodeName.toLowerCase();txt=xml.textContent.replace(/^\s+|\s+$/g,'');if(txt.length>0){node=ClassUtils.getInstance(nodeName);if(node){parent.addChild(node);((node).innerTEXT=txt.replace(HTMLParse.char255AndOneSpacePattern," "));}}}else{txt=xml.textContent.replace(/^\s+|\s+$/g,'');if(txt.length>0){((parent).innerTEXT=txt.replace(HTMLParse.char255AndOneSpacePattern," "));}}
return;}else{nodeName=xml.nodeName.toLowerCase();if(nodeName=="#comment")return;node=ClassUtils.getInstance(nodeName);if(node){node=parent.addChild(node);(node).URI=url;(node).href=href;var attributes=xml.attributes;if(attributes&&attributes.length>0){for(i=0,n=attributes.length;i<n;++i){var attribute=attributes[i];var attrName=attribute.nodeName;var value=attribute.value;node._setAttributes(attrName,value);}}
HTMLParse._parseXML(node,xml.childNodes,url,(node).href);}else{HTMLParse._parseXML(parent,xml.childNodes,url,href);}}}}
HTMLParse.char255=String.fromCharCode(255);HTMLParse.spacePattern=/&nbsp;|&#160;/g;HTMLParse.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g");return HTMLParse;})()
var Layout=(function(){function Layout(){}
__class(Layout,'laya.html.utils.Layout');Layout.later=function(element){if(Layout._will==null){Layout._will=[];Laya.stage.frameLoop(1,null,function(){if(Layout._will.length<1)
return;for(var i=0;i<Layout._will.length;i++){laya.html.utils.Layout.layout(Layout._will[i]);}
Layout._will.length=0;});}
Layout._will.push(element);}
Layout.layout=function(element){if(!element||!element._style)return null;if((element._style._type&0x200)===0)
return null;element.getStyle()._type&=~0x200;var arr=Layout._multiLineLayout(element);if(Render.isConchApp&&element["layaoutCallNative"]){(element).layaoutCallNative();}
return arr;}
Layout._multiLineLayout=function(element){if(Text.RightToLeft)return Layout._multiLineLayout2(element);var elements=new Array;element._addChildsToLayout(elements);var i=0,n=elements.length,j=0;var style=element._getCSSStyle();var letterSpacing=style.letterSpacing;var leading=style.leading;var lineHeight=style.lineHeight;var widthAuto=style._widthAuto()||!style.wordWrap;var width=widthAuto?999999:element.width;var height=element.height;var maxWidth=0;var exWidth=style.italic?style.fontSize/3:0;var align=style._getAlign();var valign=style._getValign();var endAdjust=valign!==0||align!==0||lineHeight!=0;var oneLayout;var x=0;var y=0;var w=0;var h=0;var tBottom=0;var lines=new Array;var curStyle;var curPadding;var curLine=lines[0]=new LayoutLine();var newLine=false,nextNewline=false;var htmlWord;var sprite;curLine.h=0;if(style.italic)
width-=style.fontSize/3;var tWordWidth=0;var tLineFirstKey=true;function addLine(){curLine.y=y;y+=curLine.h+leading;if(curLine.h==0)y+=lineHeight;curLine.mWidth=tWordWidth;tWordWidth=0;curLine=new LayoutLine();lines.push(curLine);curLine.h=0;x=0;tLineFirstKey=true;newLine=false;}
for(i=0;i<n;i++){oneLayout=elements[i];if(oneLayout==null){if(!tLineFirstKey){x+=Layout.DIV_ELEMENT_PADDING;}
curLine.wordStartIndex=curLine.elements.length;continue;}
tLineFirstKey=false;if((oneLayout instanceof laya.html.dom.HTMLBrElement)){addLine();curLine.y=y;continue;}else if(oneLayout._isChar()){htmlWord=oneLayout;if(!htmlWord.isWord){if(lines.length>0&&(x+w)>width&&curLine.wordStartIndex>0){var tLineWord=0;tLineWord=curLine.elements.length-curLine.wordStartIndex+1;curLine.elements.length=curLine.wordStartIndex;i-=tLineWord;addLine();continue;}
newLine=false;tWordWidth+=htmlWord.width;}else{newLine=nextNewline||(htmlWord.char==='\n');curLine.wordStartIndex=curLine.elements.length;}
w=htmlWord.width+letterSpacing;h=htmlWord.height;nextNewline=false;newLine=newLine||((x+w)>width);newLine&&addLine();curLine.minTextHeight=Math.min(curLine.minTextHeight,oneLayout.height);}else{curStyle=oneLayout._getCSSStyle();sprite=oneLayout;curPadding=curStyle.padding;curStyle._getCssFloat()===0||(endAdjust=true);newLine=nextNewline||curStyle.lineElement;w=sprite.width*sprite._style._tf.scaleX+curPadding[1]+curPadding[3]+letterSpacing;h=sprite.height*sprite._style._tf.scaleY+curPadding[0]+curPadding[2];nextNewline=curStyle.lineElement;newLine=newLine||((x+w)>width&&curStyle.wordWrap);newLine&&addLine();}
curLine.elements.push(oneLayout);curLine.h=Math.max(curLine.h,h);oneLayout.x=x;oneLayout.y=y;x+=w;curLine.w=x-letterSpacing;curLine.y=y;maxWidth=Math.max(x+exWidth,maxWidth);}
y=curLine.y+curLine.h;if(endAdjust){var tY=0;var tWidth=width;if(widthAuto&&element.width>0){tWidth=element.width;}
for(i=0,n=lines.length;i<n;i++){lines[i].updatePos(0,tWidth,i,tY,align,valign,lineHeight);tY+=Math.max(lineHeight,lines[i].h+leading);}
y=tY;}
widthAuto&&(element.width=maxWidth);(y>element.height)&&(element.height=y);return[maxWidth,y];}
Layout._multiLineLayout2=function(element){var elements=new Array;element._addChildsToLayout(elements);var i=0,n=elements.length,j=0;var style=element._getCSSStyle();var letterSpacing=style.letterSpacing;var leading=style.leading;var lineHeight=style.lineHeight;var widthAuto=style._widthAuto()||!style.wordWrap;var width=widthAuto?999999:element.width;var height=element.height;var maxWidth=0;var exWidth=style.italic?style.fontSize/3:0;var align=2-style._getAlign();var valign=style._getValign();var endAdjust=valign!==0||align!==0||lineHeight!=0;var oneLayout;var x=0;var y=0;var w=0;var h=0;var tBottom=0;var lines=new Array;var curStyle;var curPadding;var curLine=lines[0]=new LayoutLine();var newLine=false,nextNewline=false;var htmlWord;var sprite;curLine.h=0;if(style.italic)
width-=style.fontSize/3;var tWordWidth=0;var tLineFirstKey=true;function addLine(){curLine.y=y;y+=curLine.h+leading;if(curLine.h==0)y+=lineHeight;curLine.mWidth=tWordWidth;tWordWidth=0;curLine=new LayoutLine();lines.push(curLine);curLine.h=0;x=0;tLineFirstKey=true;newLine=false;}
for(i=0;i<n;i++){oneLayout=elements[i];if(oneLayout==null){if(!tLineFirstKey){x+=Layout.DIV_ELEMENT_PADDING;}
curLine.wordStartIndex=curLine.elements.length;continue;}
tLineFirstKey=false;if((oneLayout instanceof laya.html.dom.HTMLBrElement)){addLine();curLine.y=y;continue;}else if(oneLayout._isChar()){htmlWord=oneLayout;if(!htmlWord.isWord){if(lines.length>0&&(x+w)>width&&curLine.wordStartIndex>0){var tLineWord=0;tLineWord=curLine.elements.length-curLine.wordStartIndex+1;curLine.elements.length=curLine.wordStartIndex;i-=tLineWord;addLine();continue;}
newLine=false;tWordWidth+=htmlWord.width;}else{newLine=nextNewline||(htmlWord.char==='\n');curLine.wordStartIndex=curLine.elements.length;}
w=htmlWord.width+letterSpacing;h=htmlWord.height;nextNewline=false;newLine=newLine||((x+w)>width);newLine&&addLine();curLine.minTextHeight=Math.min(curLine.minTextHeight,oneLayout.height);}else{curStyle=oneLayout._getCSSStyle();sprite=oneLayout;curPadding=curStyle.padding;curStyle._getCssFloat()===0||(endAdjust=true);newLine=nextNewline||curStyle.lineElement;w=sprite.width*sprite._style._tf.scaleX+curPadding[1]+curPadding[3]+letterSpacing;h=sprite.height*sprite._style._tf.scaleY+curPadding[0]+curPadding[2];nextNewline=curStyle.lineElement;newLine=newLine||((x+w)>width&&curStyle.wordWrap);newLine&&addLine();}
curLine.elements.push(oneLayout);curLine.h=Math.max(curLine.h,h);oneLayout.x=x;oneLayout.y=y;x+=w;curLine.w=x-letterSpacing;curLine.y=y;maxWidth=Math.max(x+exWidth,maxWidth);}
y=curLine.y+curLine.h;if(endAdjust){var tY=0;var tWidth=width;for(i=0,n=lines.length;i<n;i++){lines[i].updatePos(0,tWidth,i,tY,align,valign,lineHeight);tY+=Math.max(lineHeight,lines[i].h+leading);}
y=tY;}
widthAuto&&(element.width=maxWidth);(y>element.height)&&(element.height=y);for(i=0,n=lines.length;i<n;i++){lines[i].revertOrder(width);}
return[maxWidth,y];}
Layout._will=null;Layout.DIV_ELEMENT_PADDING=0;return Layout;})()
var LayoutLine=(function(){function LayoutLine(){this.x=0;this.y=0;this.w=0;this.h=0;this.wordStartIndex=0;this.minTextHeight=99999;this.mWidth=0;this.elements=new Array;}
__class(LayoutLine,'laya.html.utils.LayoutLine');var __proto=LayoutLine.prototype;__proto.updatePos=function(left,width,lineNum,dy,align,valign,lineHeight){var w=0;var one
if(this.elements.length>0){one=this.elements[this.elements.length-1];w=one.x+one.width-this.elements[0].x;};var dx=0,ddy=NaN;align===1&&(dx=(width-w)/2);align===2&&(dx=(width-w));lineHeight===0||valign!=0||(valign=1);for(var i=0,n=this.elements.length;i<n;i++){one=this.elements[i];var tCSSStyle=one._getCSSStyle();dx!==0&&(one.x+=dx);switch(tCSSStyle._getValign()){case 0:one.y=dy;break;case 1:;var tMinTextHeight=0;if(this.minTextHeight!=99999){tMinTextHeight=this.minTextHeight;};var tBottomLineY=(tMinTextHeight+lineHeight)/2;tBottomLineY=Math.max(tBottomLineY,this.h);if((one instanceof laya.html.dom.HTMLImageElement)){ddy=dy+tBottomLineY-one.height;}else{ddy=dy+tBottomLineY-one.height;}
one.y=ddy;break;case 2:one.y=dy+(lineHeight-one.height);break;}}}
__proto.revertOrder=function(width){var one
if(this.elements.length>0){var i=0,len=0;len=this.elements.length;for(i=0;i<len;i++){one=this.elements[i];one.x=width-one.x-one.width;}}}
return LayoutLine;})()
var HTMLElement=(function(_super){function HTMLElement(){this.URI=null;this._href=null;HTMLElement.__super.call(this);this._text=HTMLElement._EMPTYTEXT;this.setStyle(new CSSStyle(this));this._getCSSStyle().valign="middle";this.mouseEnabled=true;}
__class(HTMLElement,'laya.html.dom.HTMLElement',_super);var __proto=HTMLElement.prototype;__proto.layaoutCallNative=function(){var n=0;if(this._childs&&(n=this._childs.length)>0){for(var i=0;i<n;i++){this._childs[i].layaoutCallNative&&this._childs[i].layaoutCallNative();}};var word=this._getWords();word?laya.html.dom.HTMLElement.fillWords(this,word,0,0,this.style.font,this.style.color,this.style.underLine):this.graphics.clear();}
__proto.appendChild=function(c){return this.addChild(c);}
__proto._getWords2=function(){var txt=this._text.text;if(!txt||txt.length===0)
return null;var i=0,n=0;var realWords;var drawWords;if(!this._text.drawWords){realWords=txt.split(" ");n=realWords.length-1;drawWords=[];for(i=0;i<n;i++){drawWords.push(realWords[i]," ")}
if(n>=0)
drawWords.push(realWords[n]);this._text.drawWords=drawWords;}else{drawWords=this._text.drawWords;};var words=this._text.words;if(words&&words.length===drawWords.length)
return words;words===null&&(this._text.words=words=[]);words.length=drawWords.length;var size;var style=this.style;var fontStr=style.font;for(i=0,n=drawWords.length;i<n;i++){size=Utils.measureText(drawWords[i],fontStr);var tHTMLChar=words[i]=new HTMLChar(drawWords[i],size.width,size.height||style.fontSize,style);if(tHTMLChar.char.length>1){tHTMLChar.charNum=tHTMLChar.char;}
if(this.href){var tSprite=new Sprite();this.addChild(tSprite);tHTMLChar.setSprite(tSprite);}}
return words;}
__proto._getWords=function(){if(!Text.CharacterCache)return this._getWords2();var txt=this._text.text;if(!txt||txt.length===0)
return null;var words=this._text.words;if(words&&words.length===txt.length)
return words;words===null&&(this._text.words=words=[]);words.length=txt.length;var size;var style=this.style;var fontStr=style.font;var startX=0;for(var i=0,n=txt.length;i<n;i++){size=Utils.measureText(txt.charAt(i),fontStr);var tHTMLChar=words[i]=new HTMLChar(txt.charAt(i),size.width,size.height||style.fontSize,style);if(this.href){var tSprite=new Sprite();this.addChild(tSprite);tHTMLChar.setSprite(tSprite);}}
return words;}
__proto.showLinkSprite=function(){var words=this._text.words;if(words){var tLinkSpriteList=[];var tSprite;var tHtmlChar;for(var i=0;i<words.length;i++){tHtmlChar=words[i];tSprite=new Sprite();tSprite.graphics.drawRect(0,0,tHtmlChar.width,tHtmlChar.height,"#ff0000");tSprite.width=tHtmlChar.width;tSprite.height=tHtmlChar.height;this.addChild(tSprite);tLinkSpriteList.push(tSprite);}}}
__proto._layoutLater=function(){var style=this.style;if((style._type&0x200))return;if(style.widthed(this)&&(this._childs.length>0||this._getWords()!=null)&&style.block){Layout.later(this);style._type|=0x200;}
else{this.parent&&(this.parent)._layoutLater();}}
__proto._setAttributes=function(name,value){switch(name){case'style':this.style.cssText(value);return;case'class':this.className=value;return;}
_super.prototype._setAttributes.call(this,name,value);}
__proto.updateHref=function(){if(this._href!=null){var words=this._getWords();if(words){var tHTMLChar;var tSprite;for(var i=0;i<words.length;i++){tHTMLChar=words[i];tSprite=tHTMLChar.getSprite();if(tSprite){tSprite.size(tHTMLChar.width,tHTMLChar.height);tSprite.on("click",this,this.onLinkHandler);}}}}}
__proto.onLinkHandler=function(e){switch(e.type){case"click":;var target=this;while(target){target.event("link",[this.href]);target=target.parent;}
break;}}
__proto.formatURL=function(url){if(!this.URI)return url;return URL.formatURL(url,this.URI?this.URI.path:null);}
__getset(0,__proto,'href',function(){return this._href;},function(url){this._href=url;if(url!=null){this._getCSSStyle().underLine=1;this.updateHref();}});__getset(0,__proto,'color',null,function(value){this.style.color=value;});__getset(0,__proto,'onClick',null,function(value){var fn;eval("fn=function(event){"+value+";}");this.on("click",this,fn);});__getset(0,__proto,'id',null,function(value){HTMLDocument.document.setElementById(value,this);});__getset(0,__proto,'innerTEXT',function(){return this._text.text;},function(value){this.text=value;});__getset(0,__proto,'style',function(){return this._style;});__getset(0,__proto,'text',function(){return this._text.text;},function(value){if(this._text==HTMLElement._EMPTYTEXT){this._text={text:value,words:null};}
else{this._text.text=value;this._text.words&&(this._text.words.length=0);}
Render.isConchApp&&this.layaoutCallNative();this._renderType|=0x800;this.repaint();this.updateHref();});__getset(0,__proto,'parent',_super.prototype._$get_parent,function(value){if((value instanceof laya.html.dom.HTMLElement)){var p=value;this.URI||(this.URI=p.URI);this.style.inherit(p.style);}
Laya.superSet(Sprite,this,'parent',value);});__getset(0,__proto,'className',null,function(value){this.style.attrs(HTMLDocument.document.styleSheets['.'+value]);});HTMLElement.fillWords=function(ele,words,x,y,font,color,underLine){ele.graphics.clear();for(var i=0,n=words.length;i<n;i++){var a=words[i];ele.graphics.fillText(a.char,a.x+x,a.y+y,font,color,'left',underLine);}}
HTMLElement._EMPTYTEXT={text:null,words:null};return HTMLElement;})(Sprite)
var HTMLBrElement=(function(_super){function HTMLBrElement(){HTMLBrElement.__super.call(this);this.style.lineElement=true;this.style.block=true;}
__class(HTMLBrElement,'laya.html.dom.HTMLBrElement',_super);return HTMLBrElement;})(HTMLElement)
var HTMLDivElement=(function(_super){function HTMLDivElement(){this.contextHeight=NaN;this.contextWidth=NaN;HTMLDivElement.__super.call(this);this.style.block=true;this.style.lineElement=true;this.style.width=200;this.style.height=200;HTMLStyleElement;}
__class(HTMLDivElement,'laya.html.dom.HTMLDivElement',_super);var __proto=HTMLDivElement.prototype;__proto.appendHTML=function(text){HTMLParse.parse(this,text,this.URI);this.layout();}
__proto._addChildsToLayout=function(out){var words=this._getWords();if(words==null&&this._childs.length==0)return false;words&&words.forEach(function(o){out.push(o);});var tFirstKey=true;for(var i=0,len=this._childs.length;i<len;i++){var o=this._childs[i];if(tFirstKey){tFirstKey=false;}else{out.push(null);}
o._addToLayout(out)}
return true;}
__proto._addToLayout=function(out){this.layout();}
__proto.layout=function(){if(!this.style)return;this.style._type|=0x200;var tArray=Layout.layout(this);if(tArray){if(!this._$P.mHtmlBounds)this._set$P("mHtmlBounds",new Rectangle());var tRectangle=this._$P.mHtmlBounds;tRectangle.x=tRectangle.y=0;tRectangle.width=this.contextWidth=tArray[0];tRectangle.height=this.contextHeight=tArray[1];this.setBounds(tRectangle);}}
__getset(0,__proto,'height',function(){if(this._height)return this._height;return this.contextHeight;},_super.prototype._$set_height);__getset(0,__proto,'innerHTML',null,function(text){this.destroyChildren();this.appendHTML(text);});__getset(0,__proto,'width',function(){if(this._width)return this._width;return this.contextWidth;},function(value){var changed=false;if(value===0){changed=value!=this._width;}else{changed=value!=this.width;}
Laya.superSet(HTMLElement,this,'width',value);if(changed)
this.layout();});return HTMLDivElement;})(HTMLElement)
var HTMLDocument=(function(_super){function HTMLDocument(){this.all=new Array;this.styleSheets=CSSStyle.styleSheets;HTMLDocument.__super.call(this);}
__class(HTMLDocument,'laya.html.dom.HTMLDocument',_super);var __proto=HTMLDocument.prototype;__proto.getElementById=function(id){return this.all[id];}
__proto.setElementById=function(id,e){this.all[id]=e;}
__static(HTMLDocument,['document',function(){return this.document=new HTMLDocument();}]);return HTMLDocument;})(HTMLElement)
var HTMLImageElement=(function(_super){function HTMLImageElement(){this._tex=null;this._url=null;this._renderArgs=[];HTMLImageElement.__super.call(this);this.style.block=true;}
__class(HTMLImageElement,'laya.html.dom.HTMLImageElement',_super);var __proto=HTMLImageElement.prototype;__proto._addToLayout=function(out){!this._style.absolute&&out.push(this);}
__proto.render=function(context,x,y){if(!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1)return;Stat.spriteCount++;this._renderArgs[0]=this._tex;this._renderArgs[1]=this.x;this._renderArgs[2]=this.y;this._renderArgs[3]=this.width||this._tex.width;this._renderArgs[4]=this.height||this._tex.height;context.ctx.drawTexture2(x,y,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs);}
__proto.layaoutCallNative=function(){var n=0;if(this._childs&&(n=this._childs.length)>0){for(var i=0;i<n;i++){this._childs[i].layaoutCallNative&&this._childs[i].layaoutCallNative();}}}
__getset(0,__proto,'src',null,function(url){var _$this=this;url=this.formatURL(url);if(this._url==url)return;this._url=url;var tex=this._tex=Loader.getRes(url);if(!tex){this._tex=tex=new Texture();tex.load(url);Loader.cacheRes(url,tex);}
function onloaded(){var style=_$this._style;var w=style.widthed(_$this)?-1:_$this._tex.width;var h=style.heighted(_$this)?-1:_$this._tex.height;if(!style.widthed(_$this)&&_$this._width!=_$this._tex.width){_$this.width=_$this._tex.width;_$this.parent&&(_$this.parent)._layoutLater();}
if(!style.heighted(_$this)&&_$this._height!=_$this._tex.height){_$this.height=_$this._tex.height;_$this.parent&&(_$this.parent)._layoutLater();}
if(Render.isConchApp){_$this._renderArgs[0]=_$this._tex;_$this._renderArgs[1]=_$this.x;_$this._renderArgs[2]=_$this.y;_$this._renderArgs[3]=_$this.width||_$this._tex.width;_$this._renderArgs[4]=_$this.height||_$this._tex.height;_$this.graphics.drawTexture(_$this._tex,0,0,_$this._renderArgs[3],_$this._renderArgs[4]);}
_$this.repaint();_$this.parentRepaint();}
tex.loaded?onloaded():tex.on("loaded",null,onloaded);});return HTMLImageElement;})(HTMLElement)
var HTMLLinkElement=(function(_super){function HTMLLinkElement(){this.type=null;HTMLLinkElement.__super.call(this);this.visible=false;}
__class(HTMLLinkElement,'laya.html.dom.HTMLLinkElement',_super);var __proto=HTMLLinkElement.prototype;__proto._onload=function(data){switch(this.type){case'text/css':CSSStyle.parseCSS(data,this.URI);break;}}
__getset(0,__proto,'href',_super.prototype._$get_href,function(url){var _$this=this;url=this.formatURL(url);this.URI=new URL(url);var l=new Loader();l.once("complete",null,function(data){_$this._onload(data);});l.load(url,"text");});HTMLLinkElement._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\\s]*{","g");return HTMLLinkElement;})(HTMLElement)
var HTMLStyleElement=(function(_super){function HTMLStyleElement(){HTMLStyleElement.__super.call(this);this.visible=false;}
__class(HTMLStyleElement,'laya.html.dom.HTMLStyleElement',_super);var __proto=HTMLStyleElement.prototype;__getset(0,__proto,'text',_super.prototype._$get_text,function(value){CSSStyle.parseCSS(value,null);});return HTMLStyleElement;})(HTMLElement)
var HTMLIframeElement=(function(_super){function HTMLIframeElement(){HTMLIframeElement.__super.call(this);this._getCSSStyle().valign="middle";}
__class(HTMLIframeElement,'laya.html.dom.HTMLIframeElement',_super);var __proto=HTMLIframeElement.prototype;__getset(0,__proto,'href',_super.prototype._$get_href,function(url){var _$this=this;url=this.formatURL(url);var l=new Loader();l.once("complete",null,function(data){var pre=_$this.URI;_$this.URI=new URL(url);_$this.innerHTML=data;!pre||(_$this.URI=pre);});l.load(url,"text");});return HTMLIframeElement;})(HTMLDivElement)})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var BlendMode=laya.webgl.canvas.BlendMode,Event=laya.events.Event,HTMLCanvas=laya.resource.HTMLCanvas;var Handler=laya.utils.Handler,IndexBuffer2D=laya.webgl.utils.IndexBuffer2D,Loader=laya.net.Loader,MathUtil=laya.maths.MathUtil;var Matrix=laya.maths.Matrix,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite;var Shader=laya.webgl.shader.Shader,Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Texture=laya.resource.Texture;var Utils=laya.utils.Utils,Value2D=laya.webgl.shader.d2.value.Value2D,VertexBuffer2D=laya.webgl.utils.VertexBuffer2D;var WebGL=laya.webgl.WebGL,WebGLContext=laya.webgl.WebGLContext;var EmitterBase=(function(){function EmitterBase(){this._frameTime=0;this._emissionRate=60;this._emissionTime=0;this.minEmissionTime=1/60;this._particleTemplate=null;}
__class(EmitterBase,'laya.particle.emitter.EmitterBase');var __proto=EmitterBase.prototype;__proto.start=function(duration){(duration===void 0)&&(duration=2147483647);if(this._emissionRate!=0)
this._emissionTime=duration;}
__proto.stop=function(){this._emissionTime=0;}
__proto.clear=function(){this._emissionTime=0;}
__proto.emit=function(){}
__proto.advanceTime=function(passedTime){(passedTime===void 0)&&(passedTime=1);this._emissionTime-=passedTime;if(this._emissionTime<0)return;this._frameTime+=passedTime;if(this._frameTime<this.minEmissionTime)return;while(this._frameTime>this.minEmissionTime){this._frameTime-=this.minEmissionTime;this.emit();}}
__getset(0,__proto,'particleTemplate',null,function(particleTemplate){this._particleTemplate=particleTemplate;});__getset(0,__proto,'emissionRate',function(){return this._emissionRate;},function(_emissionRate){if(_emissionRate<=0)return;this._emissionRate=_emissionRate;(_emissionRate>0)&&(this.minEmissionTime=1/_emissionRate);});return EmitterBase;})()
var ParticleData=(function(){function ParticleData(){this.position=null;this.velocity=null;this.startColor=null;this.endColor=null;this.sizeRotation=null;this.radius=null;this.radian=null;this.durationAddScale=NaN;this.time=NaN;}
__class(ParticleData,'laya.particle.ParticleData');ParticleData.Create=function(settings,position,velocity,time){var particleData=new ParticleData();particleData.position=position;MathUtil.scaleVector3(velocity,settings.emitterVelocitySensitivity,ParticleData._tempVelocity);var horizontalVelocity=MathUtil.lerp(settings.minHorizontalVelocity,settings.maxHorizontalVelocity,Math.random());var horizontalAngle=Math.random()*Math.PI*2;ParticleData._tempVelocity[0]+=horizontalVelocity*Math.cos(horizontalAngle);ParticleData._tempVelocity[2]+=horizontalVelocity*Math.sin(horizontalAngle);ParticleData._tempVelocity[1]+=MathUtil.lerp(settings.minVerticalVelocity,settings.maxVerticalVelocity,Math.random());particleData.velocity=ParticleData._tempVelocity;particleData.startColor=ParticleData._tempStartColor;particleData.endColor=ParticleData._tempEndColor;var i=0;if(settings.disableColor){for(i=0;i<4;i++){particleData.startColor[i]=1;particleData.endColor[i]=1;}}
else{if(settings.colorComponentInter){for(i=0;i<4;i++){particleData.startColor[i]=MathUtil.lerp(settings.minStartColor[i],settings.maxStartColor[i],Math.random());particleData.endColor[i]=MathUtil.lerp(settings.minEndColor[i],settings.maxEndColor[i],Math.random());}}else{MathUtil.lerpVector4(settings.minStartColor,settings.maxStartColor,Math.random(),particleData.startColor);MathUtil.lerpVector4(settings.minEndColor,settings.maxEndColor,Math.random(),particleData.endColor);}}
particleData.sizeRotation=ParticleData._tempSizeRotation;var sizeRandom=Math.random();particleData.sizeRotation[0]=MathUtil.lerp(settings.minStartSize,settings.maxStartSize,sizeRandom);particleData.sizeRotation[1]=MathUtil.lerp(settings.minEndSize,settings.maxEndSize,sizeRandom);particleData.sizeRotation[2]=MathUtil.lerp(settings.minRotateSpeed,settings.maxRotateSpeed,Math.random());particleData.radius=ParticleData._tempRadius;var radiusRandom=Math.random();particleData.radius[0]=MathUtil.lerp(settings.minStartRadius,settings.maxStartRadius,radiusRandom);particleData.radius[1]=MathUtil.lerp(settings.minEndRadius,settings.maxEndRadius,radiusRandom);particleData.radian=ParticleData._tempRadian;particleData.radian[0]=MathUtil.lerp(settings.minHorizontalStartRadian,settings.maxHorizontalStartRadian,Math.random());particleData.radian[1]=MathUtil.lerp(settings.minVerticalStartRadian,settings.maxVerticalStartRadian,Math.random());var useEndRadian=settings.useEndRadian;particleData.radian[2]=useEndRadian?MathUtil.lerp(settings.minHorizontalEndRadian,settings.maxHorizontalEndRadian,Math.random()):particleData.radian[0];particleData.radian[3]=useEndRadian?MathUtil.lerp(settings.minVerticalEndRadian,settings.maxVerticalEndRadian,Math.random()):particleData.radian[1];particleData.durationAddScale=settings.ageAddScale*Math.random();particleData.time=time;return particleData;}
__static(ParticleData,['_tempVelocity',function(){return this._tempVelocity=new Float32Array(3);},'_tempStartColor',function(){return this._tempStartColor=new Float32Array(4);},'_tempEndColor',function(){return this._tempEndColor=new Float32Array(4);},'_tempSizeRotation',function(){return this._tempSizeRotation=new Float32Array(3);},'_tempRadius',function(){return this._tempRadius=new Float32Array(2);},'_tempRadian',function(){return this._tempRadian=new Float32Array(4);}]);return ParticleData;})()
var ParticleEmitter=(function(){function ParticleEmitter(templet,particlesPerSecond,initialPosition){this._templet=null;this._timeBetweenParticles=NaN;this._previousPosition=null;this._timeLeftOver=0;this._tempVelocity=new Float32Array([0,0,0]);this._tempPosition=new Float32Array([0,0,0]);this._templet=templet;this._timeBetweenParticles=1.0/particlesPerSecond;this._previousPosition=initialPosition;}
__class(ParticleEmitter,'laya.particle.ParticleEmitter');var __proto=ParticleEmitter.prototype;__proto.update=function(elapsedTime,newPosition){elapsedTime=elapsedTime/1000;if(elapsedTime>0){MathUtil.subtractVector3(newPosition,this._previousPosition,this._tempVelocity);MathUtil.scaleVector3(this._tempVelocity,1/elapsedTime,this._tempVelocity);var timeToSpend=this._timeLeftOver+elapsedTime;var currentTime=-this._timeLeftOver;while(timeToSpend>this._timeBetweenParticles){currentTime+=this._timeBetweenParticles;timeToSpend-=this._timeBetweenParticles;MathUtil.lerpVector3(this._previousPosition,newPosition,currentTime/elapsedTime,this._tempPosition);this._templet.addParticleArray(this._tempPosition,this._tempVelocity);}
this._timeLeftOver=timeToSpend;}
this._previousPosition[0]=newPosition[0];this._previousPosition[1]=newPosition[1];this._previousPosition[2]=newPosition[2];}
return ParticleEmitter;})()
var ParticleSetting=(function(){function ParticleSetting(){this.textureName=null;this.textureCount=1;this.maxPartices=100;this.duration=1;this.ageAddScale=0;this.emitterVelocitySensitivity=1;this.minStartSize=100;this.maxStartSize=100;this.minEndSize=100;this.maxEndSize=100;this.minHorizontalVelocity=0;this.maxHorizontalVelocity=0;this.minVerticalVelocity=0;this.maxVerticalVelocity=0;this.endVelocity=1;this.minRotateSpeed=0;this.maxRotateSpeed=0;this.minStartRadius=0;this.maxStartRadius=0;this.minEndRadius=0;this.maxEndRadius=0;this.minHorizontalStartRadian=0;this.maxHorizontalStartRadian=0;this.minVerticalStartRadian=0;this.maxVerticalStartRadian=0;this.useEndRadian=true;this.minHorizontalEndRadian=0;this.maxHorizontalEndRadian=0;this.minVerticalEndRadian=0;this.maxVerticalEndRadian=0;this.colorComponentInter=false;this.disableColor=false;this.blendState=0;this.emitterType="null";this.emissionRate=0;this.sphereEmitterRadius=1;this.sphereEmitterVelocity=0;this.sphereEmitterVelocityAddVariance=0;this.ringEmitterRadius=30;this.ringEmitterVelocity=0;this.ringEmitterVelocityAddVariance=0;this.ringEmitterUp=2;this.gravity=new Float32Array([0,0,0]);this.minStartColor=new Float32Array([1,1,1,1]);this.maxStartColor=new Float32Array([1,1,1,1]);this.minEndColor=new Float32Array([1,1,1,1]);this.maxEndColor=new Float32Array([1,1,1,1]);this.pointEmitterPosition=new Float32Array([0,0,0]);this.pointEmitterPositionVariance=new Float32Array([0,0,0]);this.pointEmitterVelocity=new Float32Array([0,0,0]);this.pointEmitterVelocityAddVariance=new Float32Array([0,0,0]);this.boxEmitterCenterPosition=new Float32Array([0,0,0]);this.boxEmitterSize=new Float32Array([0,0,0]);this.boxEmitterVelocity=new Float32Array([0,0,0]);this.boxEmitterVelocityAddVariance=new Float32Array([0,0,0]);this.sphereEmitterCenterPosition=new Float32Array([0,0,0]);this.ringEmitterCenterPosition=new Float32Array([0,0,0]);this.positionVariance=new Float32Array([0,0,0]);}
__class(ParticleSetting,'laya.particle.ParticleSetting');ParticleSetting.checkSetting=function(setting){var key;for(key in ParticleSetting._defaultSetting){if(!setting.hasOwnProperty(key)){setting[key]=ParticleSetting._defaultSetting[key];}}}
__static(ParticleSetting,['_defaultSetting',function(){return this._defaultSetting=new ParticleSetting();}]);return ParticleSetting;})()
var ParticleTemplateBase=(function(){function ParticleTemplateBase(){this.settings=null;this.texture=null;}
__class(ParticleTemplateBase,'laya.particle.ParticleTemplateBase');var __proto=ParticleTemplateBase.prototype;__proto.addParticleArray=function(position,velocity){}
return ParticleTemplateBase;})()
var CanvasShader=(function(){function CanvasShader(){this.u_Duration=NaN;this.u_EndVelocity=NaN;this.u_Gravity=null;this.a_Position=null;this.a_Velocity=null;this.a_StartColor=null;this.a_EndColor=null;this.a_SizeRotation=null;this.a_Radius=null;this.a_Radian=null;this.a_AgeAddScale=NaN;this.gl_Position=null;this.v_Color=null;this.oSize=NaN;this._color=new Float32Array(4);this._position=new Float32Array(3);}
__class(CanvasShader,'laya.particle.particleUtils.CanvasShader');var __proto=CanvasShader.prototype;__proto.getLen=function(position){return Math.sqrt(position[0]*position[0]+position[1]*position[1]+position[2]*position[2]);}
__proto.ComputeParticlePosition=function(position,velocity,age,normalizedAge){this._position[0]=position[0];this._position[1]=position[1];this._position[2]=position[2];var startVelocity=this.getLen(velocity);var endVelocity=startVelocity*this.u_EndVelocity;var velocityIntegral=startVelocity*normalizedAge+(endVelocity-startVelocity)*normalizedAge*normalizedAge/2.0;var lenVelocity=NaN;lenVelocity=this.getLen(velocity);var i=0,len=0;len=3;for(i=0;i<len;i++){this._position[i]=this._position[i]+(velocity[i]/lenVelocity)*velocityIntegral*this.u_Duration;this._position[i]+=this.u_Gravity[i]*age*normalizedAge;};var radius=MathUtil.lerp(this.a_Radius[0],this.a_Radius[1],normalizedAge);var radianHorizontal=MathUtil.lerp(this.a_Radian[0],this.a_Radian[2],normalizedAge);var radianVertical=MathUtil.lerp(this.a_Radian[1],this.a_Radian[3],normalizedAge);var r=Math.cos(radianVertical)*radius;this._position[1]+=Math.sin(radianVertical)*radius;this._position[0]+=Math.cos(radianHorizontal)*r;this._position[2]+=Math.sin(radianHorizontal)*r;return new Float32Array([this._position[0],this._position[1],0.0,1.0]);}
__proto.ComputeParticleSize=function(startSize,endSize,normalizedAge){var size=MathUtil.lerp(startSize,endSize,normalizedAge);return size;}
__proto.ComputeParticleRotation=function(rot,age){return rot*age;}
__proto.ComputeParticleColor=function(startColor,endColor,normalizedAge){var rst=this._color;MathUtil.lerpVector4(startColor,endColor,normalizedAge,rst);rst[3]=rst[3]*normalizedAge*(1.0-normalizedAge)*(1.0-normalizedAge)*6.7;return rst;}
__proto.clamp=function(value,min,max){if(value<min)return min;if(value>max)return max;return value;}
__proto.getData=function(age){age*=1.0+this.a_AgeAddScale;var normalizedAge=this.clamp(age/this.u_Duration,0.0,1.0);this.gl_Position=this.ComputeParticlePosition(this.a_Position,this.a_Velocity,age,normalizedAge);var pSize=this.ComputeParticleSize(this.a_SizeRotation[0],this.a_SizeRotation[1],normalizedAge);var rotation=this.ComputeParticleRotation(this.a_SizeRotation[2],age);this.v_Color=this.ComputeParticleColor(this.a_StartColor,this.a_EndColor,normalizedAge);var matric=new Matrix();var scale=NaN;scale=pSize/this.oSize*2;matric.scale(scale,scale);matric.rotate(rotation);matric.setTranslate(this.gl_Position[0],-this.gl_Position[1]);var alpha=NaN;alpha=this.v_Color[3];return[this.v_Color,alpha,matric,this.v_Color[0]*alpha,this.v_Color[1]*alpha,this.v_Color[2]*alpha];}
return CanvasShader;})()
var CMDParticle=(function(){function CMDParticle(){this.maxIndex=0;this.cmds=null;this.id=0;}
__class(CMDParticle,'laya.particle.particleUtils.CMDParticle');var __proto=CMDParticle.prototype;__proto.setCmds=function(cmds){this.cmds=cmds;this.maxIndex=cmds.length-1;}
return CMDParticle;})()
var PicTool=(function(){function PicTool(){}
__class(PicTool,'laya.particle.particleUtils.PicTool');PicTool.getCanvasPic=function(img,color){img=img.bitmap;var canvas=new HTMLCanvas("2D");var ctx=canvas.getContext('2d');canvas.size(img.width,img.height);var red=(color>>16&0xFF);var green=(color>>8&0xFF);var blue=(color&0xFF);if(Render.isConchApp){ctx.setFilter(red/255,green/255,blue/255,0);}
ctx.drawImage(img.source,0,0);if(!Render.isConchApp){var imgdata=ctx.getImageData(0,0,canvas.width,canvas.height);var data=imgdata.data;for(var i=0,n=data.length;i<n;i+=4){if(data[i+3]==0)continue;data[i]*=red/255;data[i+1]*=green/255;data[i+2]*=blue/255;}
ctx.putImageData(imgdata,0,0);}
return canvas;}
PicTool.getRGBPic=function(img){var rst;rst=[new Texture(PicTool.getCanvasPic(img,0xFF0000)),new Texture(PicTool.getCanvasPic(img,0x00FF00)),new Texture(PicTool.getCanvasPic(img,0x0000FF))];return rst;}
return PicTool;})()
var Emitter2D=(function(_super){function Emitter2D(_template){this.setting=null;this._posRange=null;this._canvasTemplate=null;this._emitFun=null;Emitter2D.__super.call(this);this.template=_template;}
__class(Emitter2D,'laya.particle.emitter.Emitter2D',_super);var __proto=Emitter2D.prototype;__proto.emit=function(){_super.prototype.emit.call(this);if(this._emitFun!=null)
this._emitFun();}
__proto.getRandom=function(value){return(Math.random()*2-1)*value;}
__proto.webGLEmit=function(){var pos=new Float32Array(3);pos[0]=this.getRandom(this._posRange[0]);pos[1]=this.getRandom(this._posRange[1]);pos[2]=this.getRandom(this._posRange[2]);var v=new Float32Array(3);v[0]=0;v[1]=0;v[2]=0;this._particleTemplate.addParticleArray(pos,v);}
__proto.canvasEmit=function(){var pos=new Float32Array(3);pos[0]=this.getRandom(this._posRange[0]);pos[1]=this.getRandom(this._posRange[1]);pos[2]=this.getRandom(this._posRange[2]);var v=new Float32Array(3);v[0]=0;v[1]=0;v[2]=0;this._particleTemplate.addParticleArray(pos,v);}
__getset(0,__proto,'template',function(){return this._particleTemplate;},function(template){this._particleTemplate=template;if(!template){this._emitFun=null;this.setting=null;this._posRange=null;};this.setting=template.settings;this._posRange=this.setting.positionVariance;if((this._particleTemplate instanceof laya.particle.ParticleTemplate2D)){this._emitFun=this.webGLEmit;}else
if((this._particleTemplate instanceof laya.particle.ParticleTemplateCanvas)){this._canvasTemplate=template;this._emitFun=this.canvasEmit;}});return Emitter2D;})(EmitterBase)
var ParticleTemplateWebGL=(function(_super){function ParticleTemplateWebGL(parSetting){this._vertices=null;this._vertexBuffer=null;this._indexBuffer=null;this._floatCountPerVertex=29;this._firstActiveElement=0;this._firstNewElement=0;this._firstFreeElement=0;this._firstRetiredElement=0;this._currentTime=0;this._drawCounter=0;ParticleTemplateWebGL.__super.call(this);this.settings=parSetting;}
__class(ParticleTemplateWebGL,'laya.particle.ParticleTemplateWebGL',_super);var __proto=ParticleTemplateWebGL.prototype;__proto.initialize=function(){this._vertices=new Float32Array(this.settings.maxPartices*this._floatCountPerVertex*4);var particleOffset=0;for(var i=0;i<this.settings.maxPartices;i++){var random=Math.random();var cornerYSegement=this.settings.textureCount?1.0/this.settings.textureCount:1.0;var cornerY=NaN;for(cornerY=0;cornerY<this.settings.textureCount;cornerY+=cornerYSegement){if(random<cornerY+cornerYSegement)
break;}
particleOffset=i*this._floatCountPerVertex*4;this._vertices[particleOffset+this._floatCountPerVertex*0+0]=-1;this._vertices[particleOffset+this._floatCountPerVertex*0+1]=-1;this._vertices[particleOffset+this._floatCountPerVertex*0+2]=0;this._vertices[particleOffset+this._floatCountPerVertex*0+3]=cornerY;this._vertices[particleOffset+this._floatCountPerVertex*1+0]=1;this._vertices[particleOffset+this._floatCountPerVertex*1+1]=-1;this._vertices[particleOffset+this._floatCountPerVertex*1+2]=1;this._vertices[particleOffset+this._floatCountPerVertex*1+3]=cornerY;this._vertices[particleOffset+this._floatCountPerVertex*2+0]=1;this._vertices[particleOffset+this._floatCountPerVertex*2+1]=1;this._vertices[particleOffset+this._floatCountPerVertex*2+2]=1;this._vertices[particleOffset+this._floatCountPerVertex*2+3]=cornerY+cornerYSegement;this._vertices[particleOffset+this._floatCountPerVertex*3+0]=-1;this._vertices[particleOffset+this._floatCountPerVertex*3+1]=1;this._vertices[particleOffset+this._floatCountPerVertex*3+2]=0;this._vertices[particleOffset+this._floatCountPerVertex*3+3]=cornerY+cornerYSegement;}}
__proto.loadContent=function(){}
__proto.update=function(elapsedTime){this._currentTime+=elapsedTime/1000;this.retireActiveParticles();this.freeRetiredParticles();if(this._firstActiveElement==this._firstFreeElement)
this._currentTime=0;if(this._firstRetiredElement==this._firstActiveElement)
this._drawCounter=0;}
__proto.retireActiveParticles=function(){var epsilon=0.0001;var particleDuration=this.settings.duration;while(this._firstActiveElement!=this._firstNewElement){var offset=this._firstActiveElement*this._floatCountPerVertex*4;var index=offset+28;var particleAge=this._currentTime-this._vertices[index];particleAge*=(1.0+this._vertices[offset+27]);if(particleAge+epsilon<particleDuration)
break;this._vertices[index]=this._drawCounter;this._firstActiveElement++;if(this._firstActiveElement>=this.settings.maxPartices)
this._firstActiveElement=0;}}
__proto.freeRetiredParticles=function(){while(this._firstRetiredElement!=this._firstActiveElement){var age=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*4+28];if(age<3)
break;this._firstRetiredElement++;if(this._firstRetiredElement>=this.settings.maxPartices)
this._firstRetiredElement=0;}}
__proto.addNewParticlesToVertexBuffer=function(){}
__proto.addParticleArray=function(position,velocity){var nextFreeParticle=this._firstFreeElement+1;if(nextFreeParticle>=this.settings.maxPartices)
nextFreeParticle=0;if(nextFreeParticle===this._firstRetiredElement)
return;var particleData=ParticleData.Create(this.settings,position,velocity,this._currentTime);var startIndex=this._firstFreeElement*this._floatCountPerVertex*4;for(var i=0;i<4;i++){var j=0,offset=0;for(j=0,offset=4;j<3;j++)
this._vertices[startIndex+i*this._floatCountPerVertex+offset+j]=particleData.position[j];for(j=0,offset=7;j<3;j++)
this._vertices[startIndex+i*this._floatCountPerVertex+offset+j]=particleData.velocity[j];for(j=0,offset=10;j<4;j++)
this._vertices[startIndex+i*this._floatCountPerVertex+offset+j]=particleData.startColor[j];for(j=0,offset=14;j<4;j++)
this._vertices[startIndex+i*this._floatCountPerVertex+offset+j]=particleData.endColor[j];for(j=0,offset=18;j<3;j++)
this._vertices[startIndex+i*this._floatCountPerVertex+offset+j]=particleData.sizeRotation[j];for(j=0,offset=21;j<2;j++)
this._vertices[startIndex+i*this._floatCountPerVertex+offset+j]=particleData.radius[j];for(j=0,offset=23;j<4;j++)
this._vertices[startIndex+i*this._floatCountPerVertex+offset+j]=particleData.radian[j];this._vertices[startIndex+i*this._floatCountPerVertex+27]=particleData.durationAddScale;this._vertices[startIndex+i*this._floatCountPerVertex+28]=particleData.time;}
this._firstFreeElement=nextFreeParticle;}
return ParticleTemplateWebGL;})(ParticleTemplateBase)
var ParticleTemplateCanvas=(function(_super){function ParticleTemplateCanvas(particleSetting){this._ready=false;this.textureList=[];this.particleList=[];this.pX=0;this.pY=0;this.activeParticles=[];this.deadParticles=[];this.iList=[];this._maxNumParticles=0;this.textureWidth=NaN;this.dTextureWidth=NaN;this.colorChange=true;this.step=1/60;this.canvasShader=new CanvasShader();ParticleTemplateCanvas.__super.call(this);this.settings=particleSetting;this._maxNumParticles=particleSetting.maxPartices;this.texture=new Texture();this.texture.on("loaded",this,this._textureLoaded);this.texture.load(particleSetting.textureName);}
__class(ParticleTemplateCanvas,'laya.particle.ParticleTemplateCanvas',_super);var __proto=ParticleTemplateCanvas.prototype;__proto._textureLoaded=function(e){this.setTexture(this.texture);this._ready=true;}
__proto.clear=function(clearTexture){(clearTexture===void 0)&&(clearTexture=true);this.deadParticles.length=0;this.activeParticles.length=0;this.textureList.length=0;}
__proto.setTexture=function(texture){this.texture=texture;this.textureWidth=texture.width;this.dTextureWidth=1/this.textureWidth;this.pX=-texture.width*0.5;this.pY=-texture.height*0.5;this.textureList=ParticleTemplateCanvas.changeTexture(texture,this.textureList);this.particleList.length=0;this.deadParticles.length=0;this.activeParticles.length=0;}
__proto._createAParticleData=function(position,velocity){this.canvasShader.u_EndVelocity=this.settings.endVelocity;this.canvasShader.u_Gravity=this.settings.gravity;this.canvasShader.u_Duration=this.settings.duration;var particle;particle=ParticleData.Create(this.settings,position,velocity,0);this.canvasShader.a_Position=particle.position;this.canvasShader.a_Velocity=particle.velocity;this.canvasShader.a_StartColor=particle.startColor;this.canvasShader.a_EndColor=particle.endColor;this.canvasShader.a_SizeRotation=particle.sizeRotation;this.canvasShader.a_Radius=particle.radius;this.canvasShader.a_Radian=particle.radian;this.canvasShader.a_AgeAddScale=particle.durationAddScale;this.canvasShader.oSize=this.textureWidth;var rst=new CMDParticle();var i=0,len=this.settings.duration/(1+particle.durationAddScale);var params=[];var mStep=NaN;for(i=0;i<len;i+=this.step){params.push(this.canvasShader.getData(i));}
rst.id=this.particleList.length;this.particleList.push(rst);rst.setCmds(params);return rst;}
__proto.addParticleArray=function(position,velocity){if(!this._ready)return;var tParticle;if(this.particleList.length<this._maxNumParticles){tParticle=this._createAParticleData(position,velocity);this.iList[tParticle.id]=0;this.activeParticles.push(tParticle);}else{if(this.deadParticles.length>0){tParticle=this.deadParticles.pop();this.iList[tParticle.id]=0;this.activeParticles.push(tParticle);}}}
__proto.advanceTime=function(passedTime){(passedTime===void 0)&&(passedTime=1);if(!this._ready)return;var particleList=this.activeParticles;var pool=this.deadParticles;var i=0,len=particleList.length;var tcmd;var tI=0;var iList=this.iList;for(i=len-1;i>-1;i--){tcmd=particleList[i];tI=iList[tcmd.id];if(tI>=tcmd.maxIndex){tI=0;particleList.splice(i,1);pool.push(tcmd);}else{tI+=1;}
iList[tcmd.id]=tI;}}
__proto.render=function(context,x,y){if(!this._ready)return;if(this.activeParticles.length<1)return;if(this.textureList.length<2)return;if(this.settings.disableColor){this.noColorRender(context,x,y);}else{this.canvasRender(context,x,y);}}
__proto.noColorRender=function(context,x,y){var particleList=this.activeParticles;var i=0,len=particleList.length;var tcmd;var tParam;var tAlpha=NaN;var px=this.pX,py=this.pY;var pw=-px*2,ph=-py*2;var tI=0;var textureList=this.textureList;var iList=this.iList;var preAlpha=NaN;context.translate(x,y);preAlpha=context.ctx.globalAlpha;for(i=0;i<len;i++){tcmd=particleList[i];tI=iList[tcmd.id];tParam=tcmd.cmds[tI];if(!tParam)continue;if((tAlpha=tParam[1])<=0.01)continue;context.setAlpha(preAlpha*tAlpha);context.drawTextureWithTransform(this.texture,px,py,pw,ph,tParam[2],1);}
context.setAlpha(preAlpha);context.translate(-x,-y);}
__proto.canvasRender=function(context,x,y){var particleList=this.activeParticles;var i=0,len=particleList.length;var tcmd;var tParam;var tAlpha=NaN;var px=this.pX,py=this.pY;var pw=-px*2,ph=-py*2;var tI=0;var textureList=this.textureList;var iList=this.iList;var preAlpha=NaN;var preB;context.translate(x,y);preAlpha=context.ctx.globalAlpha;preB=context.ctx.globalCompositeOperation;context.blendMode("lighter");for(i=0;i<len;i++){tcmd=particleList[i];tI=iList[tcmd.id];tParam=tcmd.cmds[tI];if(!tParam)continue;if((tAlpha=tParam[1])<=0.01)continue;context.save();context.transformByMatrix(tParam[2]);if(tParam[3]>0.01){context.setAlpha(preAlpha*tParam[3]);context.drawTexture(textureList[0],px,py,pw,ph);}
if(tParam[4]>0.01){context.setAlpha(preAlpha*tParam[4]);context.drawTexture(textureList[1],px,py,pw,ph);}
if(tParam[5]>0.01){context.setAlpha(preAlpha*tParam[5]);context.drawTexture(textureList[2],px,py,pw,ph);}
context.restore();}
context.setAlpha(preAlpha);context.translate(-x,-y);context.blendMode(preB);}
ParticleTemplateCanvas.changeTexture=function(texture,rst,settings){if(!rst)rst=[];rst.length=0;if(settings&&settings.disableColor){rst.push(texture,texture,texture);}else{Utils.copyArray(rst,PicTool.getRGBPic(texture));}
return rst;}
return ParticleTemplateCanvas;})(ParticleTemplateBase)
var ParticleTemplate2D=(function(_super){function ParticleTemplate2D(parSetting){this._vertexBuffer2D=null;this._indexBuffer2D=null;this.x=0;this.y=0;this._blendFn=null;this._startTime=0;this.sv=new ParticleShaderValue();ParticleTemplate2D.__super.call(this,parSetting);var _this=this;Laya.loader.load(this.settings.textureName,Handler.create(null,function(texture){(texture.bitmap).enableMerageInAtlas=false;_this.texture=texture;}));this.sv.u_Duration=this.settings.duration;this.sv.u_Gravity=this.settings.gravity;this.sv.u_EndVelocity=this.settings.endVelocity;this._blendFn=BlendMode.fns[parSetting.blendState];this.initialize();this._vertexBuffer=this._vertexBuffer2D=VertexBuffer2D.create(-1,0x88E8);this._indexBuffer=this._indexBuffer2D=IndexBuffer2D.create(0x88E4);this.loadContent();}
__class(ParticleTemplate2D,'laya.particle.ParticleTemplate2D',_super);var __proto=ParticleTemplate2D.prototype;Laya.imps(__proto,{"laya.webgl.submit.ISubmit":true})
__proto.getRenderType=function(){return-111}
__proto.releaseRender=function(){}
__proto.addParticleArray=function(position,velocity){position[0]+=this.x;position[1]+=this.y;_super.prototype.addParticleArray.call(this,position,velocity);}
__proto.loadContent=function(){var indexes=new Uint16Array(this.settings.maxPartices*6);for(var i=0;i<this.settings.maxPartices;i++){indexes[i*6+0]=(i*4+0);indexes[i*6+1]=(i*4+1);indexes[i*6+2]=(i*4+2);indexes[i*6+3]=(i*4+0);indexes[i*6+4]=(i*4+2);indexes[i*6+5]=(i*4+3);}
this._indexBuffer2D.clear();this._indexBuffer2D.append(indexes);this._indexBuffer2D.upload();}
__proto.addNewParticlesToVertexBuffer=function(){this._vertexBuffer2D.clear();this._vertexBuffer2D.append(this._vertices);var start=0;if(this._firstNewElement<this._firstFreeElement){start=this._firstNewElement*4*this._floatCountPerVertex*4;this._vertexBuffer2D.subUpload(start,start,start+(this._firstFreeElement-this._firstNewElement)*4*this._floatCountPerVertex*4);}else{start=this._firstNewElement*4*this._floatCountPerVertex*4;this._vertexBuffer2D.subUpload(start,start,start+(this.settings.maxPartices-this._firstNewElement)*4*this._floatCountPerVertex*4);if(this._firstFreeElement>0){this._vertexBuffer2D.setNeedUpload();this._vertexBuffer2D.subUpload(0,0,this._firstFreeElement*4*this._floatCountPerVertex*4);}}
this._firstNewElement=this._firstFreeElement;}
__proto.renderSubmit=function(){if(this.texture&&this.texture.loaded){this.update(Laya.timer.delta);this.sv.u_CurrentTime=this._currentTime;if(this._firstNewElement!=this._firstFreeElement){this.addNewParticlesToVertexBuffer();}
this.blend();if(this._firstActiveElement!=this._firstFreeElement){var gl=WebGL.mainContext;this._vertexBuffer2D.bind(this._indexBuffer2D);this.sv.u_texture=this.texture.source;this.sv.upload();if(this._firstActiveElement<this._firstFreeElement){WebGL.mainContext.drawElements(0x0004,(this._firstFreeElement-this._firstActiveElement)*6,0x1403,this._firstActiveElement*6*2);}
else{WebGL.mainContext.drawElements(0x0004,(this.settings.maxPartices-this._firstActiveElement)*6,0x1403,this._firstActiveElement*6*2);if(this._firstFreeElement>0)
WebGL.mainContext.drawElements(0x0004,this._firstFreeElement*6,0x1403,0);}
Stat.drawCall++;}
this._drawCounter++;}
return 1;}
__proto.blend=function(){if(BlendMode.activeBlendFunction!==this._blendFn){var gl=WebGL.mainContext;gl.enable(0x0BE2);this._blendFn(gl);BlendMode.activeBlendFunction=this._blendFn;}}
__proto.dispose=function(){this._vertexBuffer2D.dispose();this._indexBuffer2D.dispose();}
ParticleTemplate2D.activeBlendType=-1;return ParticleTemplate2D;})(ParticleTemplateWebGL)
var ParticleShaderValue=(function(_super){function ParticleShaderValue(){this.a_CornerTextureCoordinate=[4,0x1406,false,116,0];this.a_Position=[3,0x1406,false,116,16];this.a_Velocity=[3,0x1406,false,116,28];this.a_StartColor=[4,0x1406,false,116,40];this.a_EndColor=[4,0x1406,false,116,56];this.a_SizeRotation=[3,0x1406,false,116,72];this.a_Radius=[2,0x1406,false,116,84];this.a_Radian=[4,0x1406,false,116,92];this.a_AgeAddScale=[1,0x1406,false,116,108];this.a_Time=[1,0x1406,false,116,112];this.u_CurrentTime=NaN;this.u_Duration=NaN;this.u_Gravity=null;this.u_EndVelocity=NaN;this.u_texture=null;ParticleShaderValue.__super.call(this,0,0);}
__class(ParticleShaderValue,'laya.particle.shader.value.ParticleShaderValue',_super);var __proto=ParticleShaderValue.prototype;__proto.upload=function(){this.refresh();ParticleShaderValue.pShader.upload(this);}
__static(ParticleShaderValue,['pShader',function(){return this.pShader=new ParticleShader();}]);return ParticleShaderValue;})(Value2D)
var Particle2D=(function(_super){function Particle2D(setting){this._matrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];this._particleTemplate=null;this._canvasTemplate=null;this._emitter=null;this.autoPlay=true;Particle2D.__super.call(this);if(setting)this.setParticleSetting(setting);}
__class(Particle2D,'laya.particle.Particle2D',_super);var __proto=Particle2D.prototype;__proto.load=function(url){Laya.loader.load(url,Handler.create(this,this.setParticleSetting),null,"json");}
__proto.setParticleSetting=function(setting){var _$this=this;if(!setting)return this.stop();ParticleSetting.checkSetting(setting);if(!window.ConchParticleTemplate2D||Render.isWebGL)this.customRenderEnable=true;if(Render.isWebGL){this._particleTemplate=new ParticleTemplate2D(setting);this.graphics._saveToCmd(Render.context._drawParticle,[this._particleTemplate]);}
else if(Render.isConchApp&&window.ConchParticleTemplate2D){this._particleTemplate=new ConchParticleTemplate2D();var _this=this;Laya.loader.load(setting.textureName,Handler.create(null,function(texture){_this._particleTemplate.texture=texture;_this._particleTemplate.settings=setting;if(Render.isConchNode){_this.graphics.drawParticle(_this._particleTemplate);}
else{_this.graphics._saveToCmd(Render.context._drawParticle,[_$this._particleTemplate]);}}));this._emitter={start:function(){}};this.play=this._particleTemplate.play.bind(this._particleTemplate);this.stop=this._particleTemplate.stop.bind(this._particleTemplate);if(this.autoPlay)this.play();return;}
else{this._particleTemplate=this._canvasTemplate=new ParticleTemplateCanvas(setting);}
if(!this._emitter){this._emitter=new Emitter2D(this._particleTemplate);}else{(this._emitter).template=this._particleTemplate;}
if(this.autoPlay){this.emitter.start();this.play();}}
__proto.play=function(){this.timer.frameLoop(1,this,this._loop);}
__proto.stop=function(){this.timer.clear(this,this._loop);}
__proto._loop=function(){this.advanceTime(1/60);}
__proto.advanceTime=function(passedTime){(passedTime===void 0)&&(passedTime=1);if(this._canvasTemplate){this._canvasTemplate.advanceTime(passedTime);}
if(this._emitter){this._emitter.advanceTime(passedTime);}}
__proto.customRender=function(context,x,y){if(Render.isWebGL){this._matrix4[0]=context.ctx._curMat.a;this._matrix4[1]=context.ctx._curMat.b;this._matrix4[4]=context.ctx._curMat.c;this._matrix4[5]=context.ctx._curMat.d;this._matrix4[12]=context.ctx._curMat.tx;this._matrix4[13]=context.ctx._curMat.ty;var sv=(this._particleTemplate).sv;sv.u_mmat=this._matrix4;}
if(this._canvasTemplate){this._canvasTemplate.render(context,x,y);}}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);if((this._particleTemplate instanceof laya.particle.ParticleTemplate2D))
(this._particleTemplate).dispose();_super.prototype.destroy.call(this,destroyChild);}
__getset(0,__proto,'url',null,function(url){this.load(url);});__getset(0,__proto,'emitter',function(){return this._emitter;});return Particle2D;})(Sprite)
var ParticleShader=(function(_super){function ParticleShader(){ParticleShader.__super.call(this,ParticleShader.vs,ParticleShader.ps,"ParticleShader");}
__class(ParticleShader,'laya.particle.shader.ParticleShader',_super);__static(ParticleShader,['vs',function(){return this.vs="attribute vec4 a_CornerTextureCoordinate;\nattribute vec3 a_Position;\nattribute vec3 a_Velocity;\nattribute vec4 a_StartColor;\nattribute vec4 a_EndColor;\nattribute vec3 a_SizeRotation;\nattribute vec2 a_Radius;\nattribute vec4 a_Radian;\nattribute float a_AgeAddScale;\nattribute float a_Time;\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\n\nuniform float u_CurrentTime;\nuniform float u_Duration;\nuniform float u_EndVelocity;\nuniform vec3 u_Gravity;\n\n#ifdef PARTICLE3D\n uniform mat4 u_WorldMat;\n uniform mat4 u_View;\n uniform mat4 u_Projection;\n uniform vec2 u_ViewportScale;\n#else\n uniform vec2 size;\n uniform mat4 mmat;\n uniform mat4 u_mmat;\n#endif\n\nvec4 ComputeParticlePosition(in vec3 position, in vec3 velocity,in float age,in float normalizedAge)\n{\n\n   float startVelocity = length(velocity);//起始标量速度\n   float endVelocity = startVelocity * u_EndVelocity;//结束标量速度\n\n   float velocityIntegral = startVelocity * normalizedAge +(endVelocity - startVelocity) * normalizedAge *normalizedAge/2.0;//计算当前速度的标量（单位空间），vt=v0*t+(1/2)*a*(t^2)\n   \n   vec3 addPosition = normalize(velocity) * velocityIntegral * u_Duration;//计算受自身速度影响的位置，转换标量到矢量    \n   addPosition += u_Gravity * age * normalizedAge;//计算受重力影响的位置\n   \n   float radius=mix(a_Radius.x, a_Radius.y, normalizedAge); //计算粒子受半径和角度影响（无需计算角度和半径时，可用宏定义优化屏蔽此计算）\n   float radianHorizontal =mix(a_Radian.x,a_Radian.z,normalizedAge);\n   float radianVertical =mix(a_Radian.y,a_Radian.w,normalizedAge);\n   \n   float r =cos(radianVertical)* radius;\n   addPosition.y += sin(radianVertical) * radius;\n \n   addPosition.x += cos(radianHorizontal) *r;\n   addPosition.z += sin(radianHorizontal) *r;\n  \n   #ifdef PARTICLE3D\n   position+=addPosition;\n    return  u_Projection*u_View*u_WorldMat*(vec4(position, 1.0));\n   #else\n   addPosition.y=-addPosition.y;//2D粒子位置更新需要取负，2D粒子坐标系Y轴正向朝上\n   position+=addPosition;\n    return  vec4(position,1.0);\n   #endif\n}\n\nfloat ComputeParticleSize(in float startSize,in float endSize, in float normalizedAge)\n{    \n    float size = mix(startSize, endSize, normalizedAge);\n    \n #ifdef PARTICLE3D\n    //Project the size into screen coordinates.\n     return size * u_Projection[1][1];\n #else\n  return size;\n #endif\n}\n\nmat2 ComputeParticleRotation(in float rot,in float age)\n{    \n    float rotation =rot * age;\n    //计算2x2旋转矩阵.\n    float c = cos(rotation);\n    float s = sin(rotation);\n    return mat2(c, -s, s, c);\n}\n\nvec4 ComputeParticleColor(in vec4 startColor,in vec4 endColor,in float normalizedAge)\n{\n vec4 color=mix(startColor,endColor,normalizedAge);\n    //硬编码设置，使粒子淡入很快，淡出很慢,6.7的缩放因子把置归一在0到1之间，可以谷歌x*(1-x)*(1-x)*6.7的制图表\n    color.a *= normalizedAge * (1.0-normalizedAge) * (1.0-normalizedAge) * 6.7;\n   \n    return color;\n}\n\nvoid main()\n{\n   float age = u_CurrentTime - a_Time;\n   age *= 1.0 + a_AgeAddScale;\n   float normalizedAge = clamp(age / u_Duration,0.0,1.0);\n   gl_Position = ComputeParticlePosition(a_Position, a_Velocity, age, normalizedAge);//计算粒子位置\n   float pSize = ComputeParticleSize(a_SizeRotation.x,a_SizeRotation.y, normalizedAge);\n   mat2 rotation = ComputeParticleRotation(a_SizeRotation.z, age);\n \n   #ifdef PARTICLE3D\n gl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize * u_ViewportScale;\n   #else\n    mat4 mat=u_mmat*mmat;\n    gl_Position=vec4((mat*gl_Position).xy,0.0,1.0);\n gl_Position.xy += (rotation*a_CornerTextureCoordinate.xy) * pSize*vec2(mat[0][0],mat[1][1]);\n    gl_Position=vec4((gl_Position.x/size.x-0.5)*2.0,(0.5-gl_Position.y/size.y)*2.0,0.0,1.0);\n   #endif\n   \n   v_Color = ComputeParticleColor(a_StartColor,a_EndColor, normalizedAge);\n   v_TextureCoordinate =a_CornerTextureCoordinate.zw;\n}\n\n";},'ps',function(){return this.ps="#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\n\nvoid main()\n{ \n gl_FragColor=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n gl_FragColor.xyz *= v_Color.w;\n}";}]);return ParticleShader;})(Shader)})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var Browser=laya.utils.Browser,HTMLCanvas=laya.resource.HTMLCanvas,Handler=laya.utils.Handler,Loader=laya.net.Loader;var Point=laya.maths.Point,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext;var Sprite=laya.display.Sprite,Texture=laya.resource.Texture;var TiledMap=(function(){var GRect,TileMapAniData,TileSet;function TiledMap(){this._jsonData=null;this._tileTexSetArr=[];this._texArray=[];this._x=0;this._y=0;this._width=0;this._height=0;this._mapW=0;this._mapH=0;this._mapTileW=0;this._mapTileH=0;this._mapSprite=null;this._layerArray=[];this._renderLayerArray=[];this._gridArray=[];this._showGridKey=false;this._totalGridNum=0;this._gridW=0;this._gridH=0;this._gridWidth=450;this._gridHeight=450;this._jsonLoader=null;this._loader=null;this._tileSetArray=[];this._currTileSet=null;this._completeHandler=null;this._index=0;this._animationDic={};this._properties=null;this._tileProperties={};this._tileProperties2={};this._orientation="orthogonal";this._renderOrder="right-down";this._colorArray=["FF","00","33","66"];this._scale=1;this._pivotScaleX=0.5;this._pivotScaleY=0.5;this._centerX=0;this._centerY=0;this._viewPortX=0;this._viewPortY=0;this._viewPortWidth=0;this._viewPortHeight=0;this._enableLinear=true;this._resPath=null;this._pathArray=null;this._limitRange=false;this._fastDirty=true;this.autoCache=true;this.autoCacheType="normal";this.enableMergeLayer=false;this.removeCoveredTile=false;this.showGridTextureCount=false;this.antiCrack=true;this.cacheAllAfterInit=false;this._texutreStartDic={};this._rect=new Rectangle();this._paddingRect=new Rectangle();this._mapRect=new GRect();this._mapLogicRect=new GRect();this._mapLastRect=new GRect();this._mapSprite=new Sprite();}
__class(TiledMap,'laya.map.TiledMap');var __proto=TiledMap.prototype;__proto.createMap=function(mapName,viewRect,completeHandler,viewRectPadding,gridSize,enableLinear,limitRange){(enableLinear===void 0)&&(enableLinear=true);(limitRange===void 0)&&(limitRange=false);this._enableLinear=enableLinear;this._limitRange=limitRange;this._rect.x=viewRect.x;this._rect.y=viewRect.y;this._rect.width=viewRect.width;this._rect.height=viewRect.height;this._viewPortWidth=viewRect.width/this._scale;this._viewPortHeight=viewRect.height/this._scale;this._completeHandler=completeHandler;if(viewRectPadding){this._paddingRect.copyFrom(viewRectPadding);}
else{this._paddingRect.setTo(0,0,0,0);}
if(gridSize){this._gridWidth=gridSize.x;this._gridHeight=gridSize.y;};var tIndex=mapName.lastIndexOf("/");if(tIndex>-1){this._resPath=mapName.substr(0,tIndex);this._pathArray=this._resPath.split("/");}
else{this._resPath="";this._pathArray=[];}
this._jsonLoader=new Loader();this._jsonLoader.once("complete",this,this.onJsonComplete);this._jsonLoader.load(mapName,"json",false);}
__proto.onJsonComplete=function(e){var tJsonData=this._jsonData=e;this._properties=tJsonData.properties;this._orientation=tJsonData.orientation;this._renderOrder=tJsonData.renderorder;this._mapW=tJsonData.width;this._mapH=tJsonData.height;this._mapTileW=tJsonData.tilewidth;this._mapTileH=tJsonData.tileheight;this._width=this._mapTileW*this._mapW;this._height=this._mapTileH*this._mapH;if(this._orientation=="staggered"){this._height=(0.5+this._mapH*0.5)*this._mapTileH;}
this._mapLastRect.top=this._mapLastRect.bottom=this._mapLastRect.left=this._mapLastRect.right=-1;var tArray=tJsonData.tilesets;var tileset;var tTileSet;var i=0;for(i=0;i<tArray.length;i++){tileset=tArray[i];tTileSet=new TileSet();tTileSet.init(tileset);if(tTileSet.properties&&tTileSet.properties.ignore)continue;this._tileProperties[i]=tTileSet.tileproperties;this.addTileProperties(tTileSet.tileproperties);this._tileSetArray.push(tTileSet);var tTiles=tileset.tiles;if(tTiles){for(var p in tTiles){var tAnimation=tTiles[p].animation;if(tAnimation){var tAniData=new TileMapAniData();this._animationDic[p]=tAniData;tAniData.image=tileset.image;for(var j=0;j<tAnimation.length;j++){var tAnimationItem=tAnimation[j];tAniData.mAniIdArray.push(tAnimationItem.tileid);tAniData.mDurationTimeArray.push(tAnimationItem.duration);}}}}}
this._tileTexSetArr.push(null);if(this._tileSetArray.length>0){tTileSet=this._currTileSet=this._tileSetArray.shift();this._loader=new Loader();this._loader.once("complete",this,this.onTextureComplete);var tPath=this.mergePath(this._resPath,tTileSet.image);this._loader.load(tPath,"image",false);}}
__proto.mergePath=function(resPath,relativePath){var tResultPath="";var tImageArray=relativePath.split("/");var tParentPathNum=0;var i=0;for(i=tImageArray.length-1;i>=0;i--){if(tImageArray[i]==".."){tParentPathNum++;}}
if(tParentPathNum==0){if(this._pathArray.length>0){tResultPath=resPath+"/"+relativePath;}
else{tResultPath=relativePath;}
return tResultPath;};var tSrcNum=this._pathArray.length-tParentPathNum;if(tSrcNum<0){console.log("[error]path does not exist",this._pathArray,tImageArray,resPath,relativePath);}
for(i=0;i<tSrcNum;i++){if(i==0){tResultPath+=this._pathArray[i];}
else{tResultPath=tResultPath+"/"+this._pathArray[i];}}
for(i=tParentPathNum;i<tImageArray.length;i++){tResultPath=tResultPath+"/"+tImageArray[i];}
return tResultPath;}
__proto.onTextureComplete=function(e){var json=this._jsonData;var tTexture=e;if(Render.isWebGL&&(!this._enableLinear)){tTexture.bitmap.minFifter=0x2600;tTexture.bitmap.magFifter=0x2600;tTexture.bitmap.enableMerageInAtlas=false;}
this._texArray.push(tTexture);var tSubTexture=null;var tTileSet=this._currTileSet;var tTileTextureW=tTileSet.tilewidth;var tTileTextureH=tTileSet.tileheight;var tImageWidth=tTileSet.imagewidth;var tImageHeight=tTileSet.imageheight;var tFirstgid=tTileSet.firstgid;var tTileWNum=Math.floor((tImageWidth-tTileSet.margin-tTileTextureW)/(tTileTextureW+tTileSet.spacing))+1;var tTileHNum=Math.floor((tImageHeight-tTileSet.margin-tTileTextureH)/(tTileTextureH+tTileSet.spacing))+1;var tTileTexSet=null;this._texutreStartDic[tTileSet.image]=this._tileTexSetArr.length;for(var i=0;i<tTileHNum;i++){for(var j=0;j<tTileWNum;j++){tTileTexSet=new TileTexSet();tTileTexSet.offX=tTileSet.titleoffsetX;tTileTexSet.offY=tTileSet.titleoffsetY-(tTileTextureH-this._mapTileH);tTileTexSet.texture=Texture.createFromTexture(tTexture,tTileSet.margin+(tTileTextureW+tTileSet.spacing)*j,tTileSet.margin+(tTileTextureH+tTileSet.spacing)*i,tTileTextureW,tTileTextureH);if(this.antiCrack)
this.adptTexture(tTileTexSet.texture);this._tileTexSetArr.push(tTileTexSet);tTileTexSet.gid=this._tileTexSetArr.length;}}
if(this._tileSetArray.length>0){tTileSet=this._currTileSet=this._tileSetArray.shift();this._loader.once("complete",this,this.onTextureComplete);var tPath=this.mergePath(this._resPath,tTileSet.image);this._loader.load(tPath,"image",false);}
else{this._currTileSet=null;this.initMap();}}
__proto.adptTexture=function(tex){if(!tex)return;var pX=tex.uv[0];var pX1=tex.uv[2];var pY=tex.uv[1];var pY1=tex.uv[7];var dW=1/tex.bitmap.width;var dH=1/tex.bitmap.height;tex.uv[0]=tex.uv[6]=pX+dW;tex.uv[2]=tex.uv[4]=pX1-dW;tex.uv[1]=tex.uv[3]=pY+dH;tex.uv[5]=tex.uv[7]=pY1-dH;}
__proto.initMap=function(){var i=0,n=0;for(var p in this._animationDic){var tAniData=this._animationDic[p];var gStart=0;gStart=this._texutreStartDic[tAniData.image];var tTileTexSet=this.getTexture(parseInt(p)+gStart);if(tAniData.mAniIdArray.length>0){tTileTexSet.textureArray=[];tTileTexSet.durationTimeArray=tAniData.mDurationTimeArray;tTileTexSet.isAnimation=true;tTileTexSet.animationTotalTime=0;for(i=0,n=tTileTexSet.durationTimeArray.length;i<n;i++){tTileTexSet.animationTotalTime+=tTileTexSet.durationTimeArray[i];}
for(i=0,n=tAniData.mAniIdArray.length;i<n;i++){var tTexture=this.getTexture(tAniData.mAniIdArray[i]+gStart);tTileTexSet.textureArray.push(tTexture);}}}
this._gridWidth=Math.floor(this._gridWidth/this._mapTileW)*this._mapTileW;this._gridHeight=Math.floor(this._gridHeight/this._mapTileH)*this._mapTileH;if(this._gridWidth<this._mapTileW){this._gridWidth=this._mapTileW;}
if(this._gridHeight<this._mapTileH){this._gridHeight=this._mapTileH;}
this._gridW=Math.ceil(this._width/this._gridWidth);this._gridH=Math.ceil(this._height/this._gridHeight);this._totalGridNum=this._gridW*this._gridH;for(i=0;i<this._gridH;i++){var tGridArray=[];this._gridArray.push(tGridArray);for(var j=0;j<this._gridW;j++){tGridArray.push(null);}};var tLayerArray=this._jsonData.layers;var isFirst=true;var tTarLayerID=1;var tLayerTarLayerName;var preLayerTarName;var preLayer;for(var tLayerLoop=0;tLayerLoop<tLayerArray.length;tLayerLoop++){var tLayerData=tLayerArray[tLayerLoop];if(tLayerData.visible==true){var tMapLayer=new MapLayer();tMapLayer.init(tLayerData,this);if(!this.enableMergeLayer){this._mapSprite.addChild(tMapLayer);this._renderLayerArray.push(tMapLayer);}else{tLayerTarLayerName=tMapLayer.getLayerProperties("layer");isFirst=isFirst||(!preLayer)||(tLayerTarLayerName!=preLayerTarName);if(isFirst){isFirst=false;tMapLayer.tarLayer=tMapLayer;preLayer=tMapLayer;this._mapSprite.addChild(tMapLayer);this._renderLayerArray.push(tMapLayer);}else{tMapLayer.tarLayer=preLayer;}
preLayerTarName=tLayerTarLayerName;}
this._layerArray.push(tMapLayer);}}
if(this.removeCoveredTile){this.adptTiledMapData();}
if(this.cacheAllAfterInit){this.cacheAllGrid();}
this.moveViewPort(this._rect.x,this._rect.y);Laya.stage.addChild(this.mapSprite());if(this._completeHandler!=null){this._completeHandler.run();}}
__proto.addTileProperties=function(tileDataDic){var key;for(key in tileDataDic){this._tileProperties2[key]=tileDataDic[key];}}
__proto.getTileUserData=function(id,sign,defaultV){if(!this._tileProperties2||!this._tileProperties2[id]||!(sign in this._tileProperties2[id]))return defaultV;return this._tileProperties2[id][sign];}
__proto.adptTiledMapData=function(){var i=0,len=0;len=this._layerArray.length;var tLayer;var noNeeds={};var tDatas;for(i=len-1;i>=0;i--){tLayer=this._layerArray[i];tDatas=tLayer._mapData;if(!tDatas)continue;this.removeCoverd(tDatas,noNeeds);this.collectCovers(tDatas,noNeeds,i);}}
__proto.removeCoverd=function(datas,noNeeds){var i=0,len=0;len=datas.length;for(i=0;i<len;i++){if(noNeeds[i]){datas[i]=0;}}}
__proto.collectCovers=function(datas,noNeeds,layer){var i=0,len=0;len=datas.length;var tTileData=0;var isCover=0;for(i=0;i<len;i++){tTileData=datas[i];if(tTileData>0){isCover=this.getTileUserData(tTileData-1,"type",0);if(isCover>0){noNeeds[i]=tTileData;}}}}
__proto.getTexture=function(index){if(index<this._tileTexSetArr.length){return this._tileTexSetArr[index];}
return null;}
__proto.getMapProperties=function(name){if(this._properties){return this._properties[name];}
return null;}
__proto.getTileProperties=function(index,id,name){if(this._tileProperties[index]&&this._tileProperties[index][id]){return this._tileProperties[index][id][name];}
return null;}
__proto.getSprite=function(index,width,height){if(0<this._tileTexSetArr.length){var tGridSprite=new GridSprite();tGridSprite.initData(this,true);tGridSprite.size(width,height);var tTileTexSet=this._tileTexSetArr[index];if(tTileTexSet!=null&&tTileTexSet.texture!=null){if(tTileTexSet.isAnimation){var tAnimationSprite=new TileAniSprite();this._index++;tAnimationSprite.setTileTextureSet(this._index.toString(),tTileTexSet);tGridSprite.addAniSprite(tAnimationSprite);tGridSprite.addChild(tAnimationSprite);}
else{tGridSprite.graphics.drawTexture(tTileTexSet.texture,0,0,width,height);}
tGridSprite.drawImageNum++;}
return tGridSprite;}
return null;}
__proto.setViewPortPivotByScale=function(scaleX,scaleY){this._pivotScaleX=scaleX;this._pivotScaleY=scaleY;this._fastDirty=true;}
__proto.moveViewPort=function(moveX,moveY){this._x=-moveX;this._y=-moveY;if(this._fastDirty){this._rect.x=moveX;this._rect.y=moveY;this.updateViewPort();}else{var dx=NaN,dy=NaN;dx=moveX-this._rect.x;dy=moveY-this._rect.y;this._rect.x=moveX;this._rect.y=moveY;this.updateViewPortFast(dx,dy);}}
__proto.changeViewPort=function(moveX,moveY,width,height){if(moveX==this._rect.x&&moveY==this._rect.y&&width==this._rect.width&&height==this._rect.height)return;if(width==this._rect.width&&height==this._rect.height){this.moveViewPort(moveX,moveY);return;}
this._fastDirty=true;this._x=-moveX;this._y=-moveY;this._rect.x=moveX;this._rect.y=moveY;this._rect.width=width;this._rect.height=height;this._viewPortWidth=width/this._scale;this._viewPortHeight=height/this._scale;this.updateViewPort();}
__proto.changeViewPortBySize=function(width,height,rect){if(rect==null){rect=new Rectangle();}
this._centerX=this._rect.x+this._rect.width*this._pivotScaleX;this._centerY=this._rect.y+this._rect.height*this._pivotScaleY;rect.x=this._centerX-width*this._pivotScaleX;rect.y=this._centerY-height*this._pivotScaleY;rect.width=width;rect.height=height;this.changeViewPort(rect.x,rect.y,rect.width,rect.height);return rect;}
__proto.updateViewPortFast=function(dx,dy){this._centerX+=dx;this._centerY+=dy;this._viewPortX+=dx;this._viewPortY+=dy;var posChanged=false;var dyG=dy/this._gridHeight;var dxG=dx/this._gridWidth;this._mapLogicRect.top+=dyG;this._mapLogicRect.bottom+=dyG;this._mapLogicRect.left+=dxG;this._mapLogicRect.right+=dxG;this._mapRect.top=0|this._mapLogicRect.top;this._mapRect.bottom=0|this._mapLogicRect.bottom;this._mapRect.left=0|this._mapLogicRect.left;this._mapRect.right=0|this._mapLogicRect.right;if(this._mapRect.top!=this._mapLastRect.top||this._mapRect.bottom!=this._mapLastRect.bottom||this._mapRect.left!=this._mapLastRect.left||this._mapRect.right!=this._mapLastRect.right){this.clipViewPort();this._mapLastRect.top=this._mapRect.top;this._mapLastRect.bottom=this._mapRect.bottom;this._mapLastRect.left=this._mapRect.left;this._mapLastRect.right=this._mapRect.right;posChanged=true;};posChanged=posChanged||(dx!=0||dy!=0);if(!posChanged)return;this.updateMapLayersPos();}
__proto.updateMapLayersPos=function(){var tMapLayer;var len=this._renderLayerArray.length;for(var i=0;i<len;i++){tMapLayer=this._renderLayerArray[i];if(tMapLayer._gridSpriteArray.length>0){tMapLayer.updateAloneObject();tMapLayer.pos(-this._viewPortX,-this._viewPortY);}}}
__proto.updateViewPort=function(){this._fastDirty=false;var dw=this._rect.width*this._pivotScaleX;var dh=this._rect.height*this._pivotScaleY;this._centerX=this._rect.x+dw;this._centerY=this._rect.y+dh;var posChanged=false;var preValue=this._viewPortX;this._viewPortX=this._centerX-dw/this._scale;if(preValue!=this._viewPortX){posChanged=true;}else{preValue=this._viewPortY;}
this._viewPortY=this._centerY-dh/this._scale;if(!posChanged&&preValue!=this._viewPortY){posChanged=true;}
if(this._limitRange){var tRight=this._viewPortX+this._viewPortWidth;if(tRight>this._width){this._viewPortX=this._width-this._viewPortWidth;};var tBottom=this._viewPortY+this._viewPortHeight;if(tBottom>this._height){this._viewPortY=this._height-this._viewPortHeight;}
if(this._viewPortX<0){this._viewPortX=0;}
if(this._viewPortY<0){this._viewPortY=0;}};var tPaddingRect=this._paddingRect;this._mapLogicRect.top=(this._viewPortY-tPaddingRect.y)/this._gridHeight;this._mapLogicRect.bottom=(this._viewPortY+this._viewPortHeight+tPaddingRect.height+tPaddingRect.y)/this._gridHeight;this._mapLogicRect.left=(this._viewPortX-tPaddingRect.x)/this._gridWidth;this._mapLogicRect.right=(this._viewPortX+this._viewPortWidth+tPaddingRect.width+tPaddingRect.x)/this._gridWidth;this._mapRect.top=0|this._mapLogicRect.top;this._mapRect.bottom=0|this._mapLogicRect.bottom;this._mapRect.left=0|this._mapLogicRect.left;this._mapRect.right=0|this._mapLogicRect.right;if(this._mapRect.top!=this._mapLastRect.top||this._mapRect.bottom!=this._mapLastRect.bottom||this._mapRect.left!=this._mapLastRect.left||this._mapRect.right!=this._mapLastRect.right){this.clipViewPort();this._mapLastRect.top=this._mapRect.top;this._mapLastRect.bottom=this._mapRect.bottom;this._mapLastRect.left=this._mapRect.left;this._mapLastRect.right=this._mapRect.right;posChanged=true;}
if(!posChanged)return;this.updateMapLayersPos();}
__proto.clipViewPort=function(){var tSpriteNum=0;var tSprite;var tIndex=0;var tSub=0;var tAdd=0;var i=0,j=0;if(this._mapRect.left>this._mapLastRect.left){tSub=this._mapRect.left-this._mapLastRect.left;if(tSub>0){for(j=this._mapLastRect.left;j<this._mapLastRect.left+tSub;j++){for(i=this._mapLastRect.top;i<=this._mapLastRect.bottom;i++){this.hideGrid(j,i);}}}}
else{tAdd=Math.min(this._mapLastRect.left,this._mapRect.right+1)-this._mapRect.left;if(tAdd>0){for(j=this._mapRect.left;j<this._mapRect.left+tAdd;j++){for(i=this._mapRect.top;i<=this._mapRect.bottom;i++){this.showGrid(j,i);}}}}
if(this._mapRect.right>this._mapLastRect.right){tAdd=this._mapRect.right-this._mapLastRect.right;if(tAdd>0){for(j=Math.max(this._mapLastRect.right+1,this._mapRect.left);j<=this._mapLastRect.right+tAdd;j++){for(i=this._mapRect.top;i<=this._mapRect.bottom;i++){this.showGrid(j,i);}}}}
else{tSub=this._mapLastRect.right-this._mapRect.right
if(tSub>0){for(j=this._mapRect.right+1;j<=this._mapRect.right+tSub;j++){for(i=this._mapLastRect.top;i<=this._mapLastRect.bottom;i++){this.hideGrid(j,i);}}}}
if(this._mapRect.top>this._mapLastRect.top){tSub=this._mapRect.top-this._mapLastRect.top;if(tSub>0){for(i=this._mapLastRect.top;i<this._mapLastRect.top+tSub;i++){for(j=this._mapLastRect.left;j<=this._mapLastRect.right;j++){this.hideGrid(j,i);}}}}
else{tAdd=Math.min(this._mapLastRect.top,this._mapRect.bottom+1)-this._mapRect.top;if(tAdd>0){for(i=this._mapRect.top;i<this._mapRect.top+tAdd;i++){for(j=this._mapRect.left;j<=this._mapRect.right;j++){this.showGrid(j,i);}}}}
if(this._mapRect.bottom>this._mapLastRect.bottom){tAdd=this._mapRect.bottom-this._mapLastRect.bottom;if(tAdd>0){for(i=Math.max(this._mapLastRect.bottom+1,this._mapRect.top);i<=this._mapLastRect.bottom+tAdd;i++){for(j=this._mapRect.left;j<=this._mapRect.right;j++){this.showGrid(j,i);}}}}
else{tSub=this._mapLastRect.bottom-this._mapRect.bottom
if(tSub>0){for(i=this._mapRect.bottom+1;i<=this._mapRect.bottom+tSub;i++){for(j=this._mapLastRect.left;j<=this._mapLastRect.right;j++){this.hideGrid(j,i);}}}}}
__proto.showGrid=function(gridX,gridY){if(gridX<0||gridX>=this._gridW||gridY<0||gridY>=this._gridH){return;};var i=0,j=0;var tGridSprite;var tTempArray=this._gridArray[gridY][gridX];if(tTempArray==null){tTempArray=this.getGridArray(gridX,gridY);}
else{for(i=0;i<tTempArray.length&&i<this._layerArray.length;i++){var tLayerSprite=this._layerArray[i];if(tLayerSprite&&tTempArray[i]){tGridSprite=tTempArray[i];if(tGridSprite.visible==false&&tGridSprite.drawImageNum>0){tGridSprite.show();}}}}}
__proto.cacheAllGrid=function(){var i=0,j=0;var tempArr;for(i=0;i<this._gridW;i++){for(j=0;j<this._gridH;j++){tempArr=this.getGridArray(i,j);this.cacheGridsArray(tempArr);}}}
__proto.cacheGridsArray=function(arr){var canvas;if(!TiledMap._tempContext){TiledMap._tempContext=new RenderContext(1,1,HTMLCanvas.create("AUTO"));}
canvas=TiledMap._tempContext.canvas;canvas.context.asBitmap=false;var i=0,len=0;len=arr.length;var tGrid;for(i=0;i<len;i++){tGrid=arr[i];canvas.clear();canvas.size(1,1);tGrid.render(TiledMap._tempContext,0,0);tGrid.hide();}
canvas.clear();canvas.size(1,1);}
__proto.getGridArray=function(gridX,gridY){var i=0,j=0;var tGridSprite;var tTempArray=this._gridArray[gridY][gridX];if(tTempArray==null){tTempArray=this._gridArray[gridY][gridX]=[];var tLeft=0;var tRight=0;var tTop=0;var tBottom=0;var tGridWidth=this._gridWidth;var tGridHeight=this._gridHeight;switch(this.orientation){case"isometric":tLeft=Math.floor(gridX*tGridWidth);tRight=Math.floor(gridX*tGridWidth+tGridWidth);tTop=Math.floor(gridY*tGridHeight);tBottom=Math.floor(gridY*tGridHeight+tGridHeight);var tLeft1=0,tRight1=0,tTop1=0,tBottom1=0;break;case"staggered":tLeft=Math.floor(gridX*tGridWidth/this._mapTileW);tRight=Math.floor((gridX*tGridWidth+tGridWidth)/this._mapTileW);tTop=Math.floor(gridY*tGridHeight/(this._mapTileH/2));tBottom=Math.floor((gridY*tGridHeight+tGridHeight)/(this._mapTileH/2));break;case"orthogonal":tLeft=Math.floor(gridX*tGridWidth/this._mapTileW);tRight=Math.floor((gridX*tGridWidth+tGridWidth)/this._mapTileW);tTop=Math.floor(gridY*tGridHeight/this._mapTileH);tBottom=Math.floor((gridY*tGridHeight+tGridHeight)/this._mapTileH);break;case"hexagonal":;var tHeight=this._mapTileH*2/3;tLeft=Math.floor(gridX*tGridWidth/this._mapTileW);tRight=Math.ceil((gridX*tGridWidth+tGridWidth)/this._mapTileW);tTop=Math.floor(gridY*tGridHeight/tHeight);tBottom=Math.ceil((gridY*tGridHeight+tGridHeight)/tHeight);break;};var tLayer=null;var tTGridSprite;var tDrawMapLayer;for(var z=0;z<this._layerArray.length;z++){tLayer=this._layerArray[z];if(this.enableMergeLayer){if(tLayer.tarLayer!=tDrawMapLayer){tTGridSprite=null;tDrawMapLayer=tLayer.tarLayer;}
if(!tTGridSprite){tTGridSprite=tDrawMapLayer.getDrawSprite(gridX,gridY);tTempArray.push(tTGridSprite);}
tGridSprite=tTGridSprite;}
else{tGridSprite=tLayer.getDrawSprite(gridX,gridY);tTempArray.push(tGridSprite);};var tColorStr;if(this._showGridKey){tColorStr="#";tColorStr+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)];tColorStr+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)];tColorStr+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)];}
switch(this.orientation){case"isometric":;var tHalfTileHeight=this.tileHeight/2;var tHalfTileWidth=this.tileWidth/2;var tHalfMapWidth=this._width/2;tTop1=Math.floor(tTop/tHalfTileHeight);tBottom1=Math.floor(tBottom/tHalfTileHeight);tLeft1=this._mapW+Math.floor((tLeft-tHalfMapWidth)/tHalfTileWidth);tRight1=this._mapW+Math.floor((tRight-tHalfMapWidth)/tHalfTileWidth);var tMapW=this._mapW*2;var tMapH=this._mapH*2;if(tTop1<0){tTop1=0;}
if(tTop1>=tMapH){tTop1=tMapH-1;}
if(tBottom1<0){tBottom=0;}
if(tBottom1>=tMapH){tBottom1=tMapH-1;}
tGridSprite.zOrder=this._totalGridNum*z+gridY*this._gridW+gridX;for(i=tTop1;i<tBottom1;i++){for(j=0;j<=i;j++){var tIndexX=i-j;var tIndexY=j;var tIndexValue=(tIndexX-tIndexY)+this._mapW;if(tIndexValue>tLeft1&&tIndexValue<=tRight1){if(tLayer.drawTileTexture(tGridSprite,tIndexX,tIndexY)){tGridSprite.drawImageNum++;}}}}
break;case"staggered":tGridSprite.zOrder=z*this._totalGridNum+gridY*this._gridW+gridX;for(i=tTop;i<tBottom;i++){for(j=tLeft;j<tRight;j++){if(tLayer.drawTileTexture(tGridSprite,j,i)){tGridSprite.drawImageNum++;}}}
break;case"orthogonal":case"hexagonal":switch(this._renderOrder){case"right-down":tGridSprite.zOrder=z*this._totalGridNum+gridY*this._gridW+gridX;for(i=tTop;i<tBottom;i++){for(j=tLeft;j<tRight;j++){if(tLayer.drawTileTexture(tGridSprite,j,i)){tGridSprite.drawImageNum++;}}}
break;case"right-up":tGridSprite.zOrder=z*this._totalGridNum+(this._gridH-1-gridY)*this._gridW+gridX;for(i=tBottom-1;i>=tTop;i--){for(j=tLeft;j<tRight;j++){if(tLayer.drawTileTexture(tGridSprite,j,i)){tGridSprite.drawImageNum++;}}}
break;case"left-down":tGridSprite.zOrder=z*this._totalGridNum+gridY*this._gridW+(this._gridW-1-gridX);for(i=tTop;i<tBottom;i++){for(j=tRight-1;j>=tLeft;j--){if(tLayer.drawTileTexture(tGridSprite,j,i)){tGridSprite.drawImageNum++;}}}
break;case"left-up":tGridSprite.zOrder=z*this._totalGridNum+(this._gridH-1-gridY)*this._gridW+(this._gridW-1-gridX);for(i=tBottom-1;i>=tTop;i--){for(j=tRight-1;j>=tLeft;j--){if(tLayer.drawTileTexture(tGridSprite,j,i)){tGridSprite.drawImageNum++;}}}
break;}
break;}
if(!tGridSprite.isHaveAnimation){tGridSprite.autoSize=true;if(this.autoCache)
tGridSprite.cacheAs=this.autoCacheType;tGridSprite.autoSize=false;}
if(!this.enableMergeLayer){if(tGridSprite.drawImageNum>0){tLayer.addChild(tGridSprite);tGridSprite.visible=false;tGridSprite.show();}
if(this._showGridKey){tGridSprite.graphics.drawRect(0,0,tGridWidth,tGridHeight,null,tColorStr);}}else{if(tTGridSprite&&tTGridSprite.drawImageNum>0&&tDrawMapLayer){tDrawMapLayer.addChild(tTGridSprite);tTGridSprite.visible=false;tTGridSprite.show();}}}
if(this.enableMergeLayer&&this.showGridTextureCount){if(tTGridSprite){tTGridSprite.graphics.fillText(tTGridSprite.drawImageNum+"",20,20,null,"#ff0000","left");}}}
return tTempArray;}
__proto.hideGrid=function(gridX,gridY){if(gridX<0||gridX>=this._gridW||gridY<0||gridY>=this._gridH){return;};var tTempArray=this._gridArray[gridY][gridX];if(tTempArray){var tGridSprite;for(var i=0;i<tTempArray.length;i++){tGridSprite=tTempArray[i];if(tGridSprite.drawImageNum>0){if(tGridSprite!=null){tGridSprite.hide();}}}}}
__proto.getLayerObject=function(layerName,objectName){var tLayer=null;for(var i=0;i<this._layerArray.length;i++){tLayer=this._layerArray[i];if(tLayer.layerName==layerName){break;}}
if(tLayer){return tLayer.getObjectByName(objectName);}
return null;}
__proto.destroy=function(){this._orientation="orthogonal";this._jsonData=null;var i=0;var j=0;var z=0;this._gridArray=[];var tTileTexSet;for(i=0;i<this._tileTexSetArr.length;i++){tTileTexSet=this._tileTexSetArr[i];if(tTileTexSet){tTileTexSet.clearAll();}}
this._tileTexSetArr=[];var tTexture;for(i=0;i<this._texArray.length;i++){tTexture=this._texArray[i];tTexture.destroy();}
this._texArray=[];this._width=0;this._height=0;this._mapW=0;this._mapH=0;this._mapTileW=0;this._mapTileH=0;this._rect.setTo(0,0,0,0);var tLayer;for(i=0;i<this._layerArray.length;i++){tLayer=this._layerArray[i];tLayer.clearAll();}
this._layerArray=[];this._renderLayerArray=[];if(this._mapSprite){this._mapSprite.destroy();this._mapSprite=null;}
this._jsonLoader=null;this._loader=null;var tDic=this._animationDic;for(var p in tDic){delete tDic[p];}
this._properties=null;tDic=this._tileProperties;for(p in tDic){delete tDic[p];}
this._currTileSet=null;this._completeHandler=null;this._mapRect.clearAll();this._mapLastRect.clearAll();this._tileSetArray=[];this._gridWidth=450;this._gridHeight=450;this._gridW=0;this._gridH=0;this._x=0;this._y=0;this._index=0;this._enableLinear=true;this._resPath=null;this._pathArray=null;}
__proto.mapSprite=function(){return this._mapSprite;}
__proto.getLayerByName=function(layerName){var tMapLayer;for(var i=0;i<this._layerArray.length;i++){tMapLayer=this._layerArray[i];if(layerName==tMapLayer.layerName){return tMapLayer;}}
return null;}
__proto.getLayerByIndex=function(index){if(index<this._layerArray.length){return this._layerArray[index];}
return null;}
__getset(0,__proto,'orientation',function(){return this._orientation;});__getset(0,__proto,'viewPortX',function(){return-this._viewPortX;});__getset(0,__proto,'scale',function(){return this._scale;},function(scale){if(scale<=0)
return;this._scale=scale;this._viewPortWidth=this._rect.width/scale;this._viewPortHeight=this._rect.height/scale;this._mapSprite.scale(this._scale,this._scale);this.updateViewPort();});__getset(0,__proto,'tileWidth',function(){return this._mapTileW;});__getset(0,__proto,'viewPortY',function(){return-this._viewPortY;});__getset(0,__proto,'tileHeight',function(){return this._mapTileH;});__getset(0,__proto,'width',function(){return this._width;});__getset(0,__proto,'numRowsTile',function(){return this._mapH;});__getset(0,__proto,'numColumnsTile',function(){return this._mapW;});__getset(0,__proto,'height',function(){return this._height;});__getset(0,__proto,'viewPortWidth',function(){return this._viewPortWidth;});__getset(0,__proto,'viewPortHeight',function(){return this._viewPortHeight;});__getset(0,__proto,'x',function(){return this._x;});__getset(0,__proto,'y',function(){return this._y;});__getset(0,__proto,'gridWidth',function(){return this._gridWidth;});__getset(0,__proto,'gridHeight',function(){return this._gridHeight;});__getset(0,__proto,'numColumnsGrid',function(){return this._gridW;});__getset(0,__proto,'numRowsGrid',function(){return this._gridH;});__getset(0,__proto,'renderOrder',function(){return this._renderOrder;});TiledMap.ORIENTATION_ORTHOGONAL="orthogonal";TiledMap.ORIENTATION_ISOMETRIC="isometric";TiledMap.ORIENTATION_STAGGERED="staggered";TiledMap.ORIENTATION_HEXAGONAL="hexagonal";TiledMap.RENDERORDER_RIGHTDOWN="right-down";TiledMap.RENDERORDER_RIGHTUP="right-up";TiledMap.RENDERORDER_LEFTDOWN="left-down";TiledMap.RENDERORDER_LEFTUP="left-up";TiledMap._tempContext=null;TiledMap.__init$=function(){GRect=(function(){function GRect(){this.left=0;this.top=0;this.right=0;this.bottom=0;}
__class(GRect,'');var __proto=GRect.prototype;__proto.clearAll=function(){this.left=this.top=this.right=this.bottom=0;}
return GRect;})()
TileMapAniData=(function(){function TileMapAniData(){this.mAniIdArray=[];this.mDurationTimeArray=[];this.mTileTexSetArr=[];this.image=null;}
__class(TileMapAniData,'');return TileMapAniData;})()
TileSet=(function(){function TileSet(){this.firstgid=0;this.image="";this.imageheight=0;this.imagewidth=0;this.margin=0;this.name=0;this.properties=null;this.spacing=0;this.tileheight=0;this.tilewidth=0;this.titleoffsetX=0;this.titleoffsetY=0;this.tileproperties=null;}
__class(TileSet,'');var __proto=TileSet.prototype;__proto.init=function(data){this.firstgid=data.firstgid;this.image=data.image;this.imageheight=data.imageheight;this.imagewidth=data.imagewidth;this.margin=data.margin;this.name=data.name;this.properties=data.properties;this.spacing=data.spacing;this.tileheight=data.tileheight;this.tilewidth=data.tilewidth;this.tileproperties=data.tileproperties;var tTileoffset=data.tileoffset;if(tTileoffset){this.titleoffsetX=tTileoffset.x;this.titleoffsetY=tTileoffset.y;}}
return TileSet;})()}
return TiledMap;})()
var TileTexSet=(function(){function TileTexSet(){this.gid=-1;this.texture=null;this.offX=0;this.offY=0;this.textureArray=null;this.durationTimeArray=null;this.animationTotalTime=0;this.isAnimation=false;this._spriteNum=0;this._aniDic=null;this._frameIndex=0;this._time=0;this._interval=0;this._preFrameTime=0;}
__class(TileTexSet,'laya.map.TileTexSet');var __proto=TileTexSet.prototype;__proto.addAniSprite=function(aniName,sprite){if(this.animationTotalTime==0){return;}
if(this._aniDic==null){this._aniDic={};}
if(this._spriteNum==0){Laya.timer.frameLoop(3,this,this.animate);this._preFrameTime=Browser.now();this._frameIndex=0;this._time=0;this._interval=0;}
this._spriteNum++;this._aniDic[aniName]=sprite;if(this.textureArray&&this._frameIndex<this.textureArray.length){var tTileTextureSet=this.textureArray[this._frameIndex];this.drawTexture(sprite,tTileTextureSet);}}
__proto.animate=function(){if(this.textureArray&&this.textureArray.length>0&&this.durationTimeArray&&this.durationTimeArray.length>0){var tNow=Browser.now();this._interval=tNow-this._preFrameTime;this._preFrameTime=tNow;if(this._interval>this.animationTotalTime){this._interval=this._interval%this.animationTotalTime;}
this._time+=this._interval;var tTime=this.durationTimeArray[this._frameIndex];while(this._time>tTime){this._time-=tTime;this._frameIndex++;if(this._frameIndex>=this.durationTimeArray.length||this._frameIndex>=this.textureArray.length){this._frameIndex=0;};var tTileTextureSet=this.textureArray[this._frameIndex];var tSprite;for(var p in this._aniDic){tSprite=this._aniDic[p];this.drawTexture(tSprite,tTileTextureSet);}
tTime=this.durationTimeArray[this._frameIndex];}}}
__proto.drawTexture=function(sprite,tileTextSet){sprite.graphics.clear();sprite.graphics.drawTexture(tileTextSet.texture,tileTextSet.offX,tileTextSet.offY);}
__proto.removeAniSprite=function(_name){if(this._aniDic&&this._aniDic[_name]){delete this._aniDic[_name];this._spriteNum--
if(this._spriteNum==0){Laya.timer.clear(this,this.animate);}}}
__proto.showDebugInfo=function(){var tInfo=null;if(this._spriteNum>0){tInfo="TileTextureSet::gid:"+this.gid.toString()+" 动画数:"+this._spriteNum.toString();}
return tInfo;}
__proto.clearAll=function(){this.gid=-1;if(this.texture){this.texture.destroy();this.texture=null;}
this.offX=0;this.offY=0;this.textureArray=null;this.durationTimeArray=null;this.isAnimation=false;this._spriteNum=0;this._aniDic=null;this._frameIndex=0;this._preFrameTime=0;this._time=0;this._interval=0;}
return TileTexSet;})()
var GridSprite=(function(_super){function GridSprite(){this.relativeX=0;this.relativeY=0;this.isAloneObject=false;this.isHaveAnimation=false;this.aniSpriteArray=null;this.drawImageNum=0;this._map=null;GridSprite.__super.call(this);}
__class(GridSprite,'laya.map.GridSprite',_super);var __proto=GridSprite.prototype;__proto.initData=function(map,objectKey){(objectKey===void 0)&&(objectKey=false);this._map=map;this.isAloneObject=objectKey;}
__proto._setDisplay=function(value){if(!value){var cc=this._$P.cacheCanvas;if(cc&&cc.ctx){cc.ctx.canvas.destroy();cc.ctx=null;};var fc=this._$P._filterCache;if(fc){fc.destroy();fc.recycle();this._set$P('_filterCache',null);}
this._$P._isHaveGlowFilter&&this._set$P('_isHaveGlowFilter',false);}
_super.prototype._setDisplay.call(this,value);}
__proto.addAniSprite=function(sprite){if(this.aniSpriteArray==null){this.aniSpriteArray=[];}
this.aniSpriteArray.push(sprite);}
__proto.show=function(){if(!this.visible){this.visible=true;if(!this.isAloneObject){var tParent;tParent=this.parent;if(tParent){tParent.showGridSprite(this);}}
if(!Render.isWebGL&&this._map.autoCache){this.cacheAs=this._map.autoCacheType;}
if(this.aniSpriteArray==null){return;};var tAniSprite;for(var i=0;i<this.aniSpriteArray.length;i++){tAniSprite=this.aniSpriteArray[i];tAniSprite.show();}}}
__proto.hide=function(){if(this.visible){this.visible=false;if(!this.isAloneObject){var tParent;tParent=this.parent;if(tParent){tParent.hideGridSprite(this);}}
if(!Render.isWebGL&&this._map.autoCache){this.cacheAs="none";}
if(this.aniSpriteArray==null){return;};var tAniSprite;for(var i=0;i<this.aniSpriteArray.length;i++){tAniSprite=this.aniSpriteArray[i];tAniSprite.hide();}}}
__proto.updatePos=function(){if(this.isAloneObject){if(this._map){this.x=this.relativeX;this.y=this.relativeY;}
if(this.x<0||this.x>this._map.viewPortWidth||this.y<0||this.y>this._map.viewPortHeight){this.hide();}else{this.show();}}else{if(this._map){this.x=this.relativeX;this.y=this.relativeY;}}}
__proto.clearAll=function(){if(this._map){this._map=null;}
this.visible=false;if(this.aniSpriteArray==null){return;};var tAniSprite;for(var i=0;i<this.aniSpriteArray.length;i++){tAniSprite=this.aniSpriteArray[i];tAniSprite.clearAll();}
this.destroy();this.relativeX=0;this.relativeY=0;this.isHaveAnimation=false;this.aniSpriteArray=null;this.drawImageNum=0;}
return GridSprite;})(Sprite)
var MapLayer=(function(_super){function MapLayer(){this._map=null;this._mapData=null;this._tileWidthHalf=0;this._tileHeightHalf=0;this._mapWidthHalf=0;this._mapHeightHalf=0;this._gridSpriteArray=[];this._objDic=null;this._dataDic=null;this._properties=null;this.tarLayer=null;this.layerName=null;this._showGridList=[];this._aloneObjs=[];MapLayer.__super.call(this);this._tempMapPos=new Point();}
__class(MapLayer,'laya.map.MapLayer',_super);var __proto=MapLayer.prototype;__proto.init=function(layerData,map){this._map=map;this._mapData=layerData.data;var tHeight=layerData.height;var tWidth=layerData.width;var tTileW=map.tileWidth;var tTileH=map.tileHeight;this.layerName=layerData.name;this._properties=layerData.properties;this.alpha=layerData.opacity;this._tileWidthHalf=tTileW/2;this._tileHeightHalf=tTileH/2;this._mapWidthHalf=this._map.width/2-this._tileWidthHalf;this._mapHeightHalf=this._map.height/2;switch(layerData.type){case"tilelayer":break;case"objectgroup":;var tObjectGid=0;var tArray=layerData.objects;if(tArray.length>0){this._objDic={};this._dataDic={};};var tObjectData;var tObjWidth=NaN;var tObjHeight=NaN;for(var i=0;i<tArray.length;i++){tObjectData=tArray[i];this._dataDic[tObjectData.name]=tObjectData;if(tObjectData.visible==true){tObjWidth=tObjectData.width;tObjHeight=tObjectData.height;var tSprite=map.getSprite(tObjectData.gid,tObjWidth,tObjHeight);if(tSprite!=null){switch(this._map.orientation){case"isometric":this.getScreenPositionByTilePos(tObjectData.x/tTileH,tObjectData.y/tTileH,Point.TEMP);tSprite.pivot(tObjWidth/2,tObjHeight/2);tSprite.rotation=tObjectData.rotation;tSprite.x=tSprite.relativeX=Point.TEMP.x+this._map.viewPortX;tSprite.y=tSprite.relativeY=Point.TEMP.y+this._map.viewPortY-tObjHeight/2;break;case"staggered":tSprite.pivot(tObjWidth/2,tObjHeight/2);tSprite.rotation=tObjectData.rotation;tSprite.x=tSprite.relativeX=tObjectData.x+tObjWidth/2;tSprite.y=tSprite.relativeY=tObjectData.y-tObjHeight/2;break;case"orthogonal":tSprite.pivot(tObjWidth/2,tObjHeight/2);tSprite.rotation=tObjectData.rotation;tSprite.x=tSprite.relativeX=tObjectData.x+tObjWidth/2;tSprite.y=tSprite.relativeY=tObjectData.y-tObjHeight/2;break;case"hexagonal":tSprite.x=tSprite.relativeX=tObjectData.x;tSprite.y=tSprite.relativeY=tObjectData.y;break;}
this.addChild(tSprite);this._gridSpriteArray.push(tSprite);if(tSprite.isAloneObject){this._showGridList.push(tSprite);this._aloneObjs.push(tSprite);}
this._objDic[tObjectData.name]=tSprite;}}}
break;}}
__proto.getObjectByName=function(objName){if(this._objDic){return this._objDic[objName];}
return null;}
__proto.getObjectDataByName=function(objName){if(this._dataDic){return this._dataDic[objName];}
return null;}
__proto.getLayerProperties=function(name){if(this._properties){return this._properties[name];}
return null;}
__proto.getTileData=function(tileX,tileY){if(tileY>=0&&tileY<this._map.numRowsTile&&tileX>=0&&tileX<this._map.numColumnsTile){var tIndex=tileY*this._map.numColumnsTile+tileX;var tMapData=this._mapData;if(tMapData!=null&&tIndex<tMapData.length){return tMapData[tIndex];}}
return 0;}
__proto.getScreenPositionByTilePos=function(tileX,tileY,screenPos){if(screenPos){switch(this._map.orientation){case"isometric":screenPos.x=this._map.width/2-(tileY-tileX)*this._tileWidthHalf;screenPos.y=(tileY+tileX)*this._tileHeightHalf;break;case"staggered":tileX=Math.floor(tileX);tileY=Math.floor(tileY);screenPos.x=tileX*this._map.tileWidth+(tileY&1)*this._tileWidthHalf;screenPos.y=tileY*this._tileHeightHalf;break;case"orthogonal":screenPos.x=tileX*this._map.tileWidth;screenPos.y=tileY*this._map.tileHeight;break;case"hexagonal":tileX=Math.floor(tileX);tileY=Math.floor(tileY);var tTileHeight=this._map.tileHeight*2/3;screenPos.x=(tileX*this._map.tileWidth+tileY%2*this._tileWidthHalf)%this._map.gridWidth;screenPos.y=(tileY*tTileHeight)%this._map.gridHeight;break;}
screenPos.x=(screenPos.x+this._map.viewPortX)*this._map.scale;screenPos.y=(screenPos.y+this._map.viewPortY)*this._map.scale;}}
__proto.getTileDataByScreenPos=function(screenX,screenY){var tData=0;if(this.getTilePositionByScreenPos(screenX,screenY,this._tempMapPos)){tData=this.getTileData(Math.floor(this._tempMapPos.x),Math.floor(this._tempMapPos.y));}
return tData;}
__proto.getTilePositionByScreenPos=function(screenX,screenY,result){screenX=screenX/this._map.scale-this._map.viewPortX;screenY=screenY/this._map.scale-this._map.viewPortY;var tTileW=this._map.tileWidth;var tTileH=this._map.tileHeight;var tV=0;var tU=0;switch(this._map.orientation){case"isometric":;var tDirX=screenX-this._map.width/2;var tDirY=screenY;tV=-(tDirX/tTileW-tDirY/tTileH);tU=tDirX/tTileW+tDirY/tTileH;if(result){result.x=tU;result.y=tV;}
return true;break;case"staggered":if(result){var cx=0,cy=0,rx=0,ry=0;cx=Math.floor(screenX/tTileW)*tTileW+tTileW/2;cy=Math.floor(screenY/tTileH)*tTileH+tTileH/2;rx=(screenX-cx)*tTileH/2;ry=(screenY-cy)*tTileW/2;if(Math.abs(rx)+Math.abs(ry)<=tTileW*tTileH/4){tU=Math.floor(screenX/tTileW);tV=Math.floor(screenY/tTileH)*2;}else{screenX=screenX-tTileW/2;tU=Math.floor(screenX/tTileW)+1;screenY=screenY-tTileH/2;tV=Math.floor(screenY/tTileH)*2+1;}
result.x=tU-(tV&1);result.y=tV;}
return true;break;case"orthogonal":tU=screenX/tTileW;tV=screenY/tTileH;if(result){result.x=tU;result.y=tV;}
return true;break;case"hexagonal":;var tTileHeight=tTileH*2/3;tV=screenY/tTileHeight;tU=(screenX-tV%2*this._tileWidthHalf)/tTileW;if(result){result.x=tU;result.y=tV;}
break;}
return false;}
__proto.getDrawSprite=function(gridX,gridY){var tSprite=new GridSprite();tSprite.relativeX=gridX*this._map.gridWidth;tSprite.relativeY=gridY*this._map.gridHeight;tSprite.initData(this._map);tSprite.updatePos();this._gridSpriteArray.push(tSprite);return tSprite;}
__proto.showGridSprite=function(gridSprite){var gridList=this._showGridList;var i=0,len=0;len=gridList.length;var ok_i=-1;var tGridSprite;for(i=0;i<len;i++){tGridSprite=gridList[i];if(tGridSprite==gridSprite)return;if(!tGridSprite.isAloneObject&&!tGridSprite.visible){ok_i=i;}}
if(ok_i>=0){gridList[ok_i]=gridSprite;}else{gridList.push(gridSprite);}}
__proto.hideGridSprite=function(gridSprite){gridSprite.visible=false;}
__proto.updateGridPos=function(){var tSprite;var tList;tList=this._showGridList;var len=0;len=tList.length;for(var i=0;i<len;i++){tSprite=tList[i];if((tSprite._style.visible||tSprite.isAloneObject)&&tSprite.drawImageNum>0){tSprite.updatePos();}}}
__proto.updateAloneObject=function(){var tSprite;var tList;tList=this._aloneObjs;var len=0;len=tList.length;for(var i=0;i<len;i++){tSprite=tList[i];if(tSprite.drawImageNum>0){tSprite.updatePos();}}}
__proto.render=function(context,x,y){var childs=this._childs;this._childs=this._showGridList;_super.prototype.render.call(this,context,x,y);this._childs=childs;}
__proto.drawTileTexture=function(gridSprite,tileX,tileY){if(tileY>=0&&tileY<this._map.numRowsTile&&tileX>=0&&tileX<this._map.numColumnsTile){var tIndex=tileY*this._map.numColumnsTile+tileX;var tMapData=this._mapData;if(tMapData!=null&&tIndex<tMapData.length){if(tMapData[tIndex]!=0){var tTileTexSet=this._map.getTexture(tMapData[tIndex]);if(tTileTexSet){var tX=0;var tY=0;var tTexture=tTileTexSet.texture;switch(this._map.orientation){case"staggered":tX=tileX*this._map.tileWidth%this._map.gridWidth+(tileY&1)*this._tileWidthHalf;tY=tileY*this._tileHeightHalf%this._map.gridHeight;break;case"orthogonal":tX=tileX*this._map.tileWidth%this._map.gridWidth;tY=tileY*this._map.tileHeight%this._map.gridHeight;break;case"isometric":tX=(this._mapWidthHalf+(tileX-tileY)*this._tileWidthHalf)%this._map.gridWidth;tY=((tileX+tileY)*this._tileHeightHalf)%this._map.gridHeight;break;case"hexagonal":;var tTileHeight=this._map.tileHeight*2/3;tX=(tileX*this._map.tileWidth+tileY%2*this._tileWidthHalf)%this._map.gridWidth;tY=(tileY*tTileHeight)%this._map.gridHeight;break;}
if(tTileTexSet.isAnimation){var tAnimationSprite=new TileAniSprite();tAnimationSprite.x=tX;tAnimationSprite.y=tY;tAnimationSprite.setTileTextureSet(tIndex.toString(),tTileTexSet);gridSprite.addAniSprite(tAnimationSprite);gridSprite.addChild(tAnimationSprite);gridSprite.isHaveAnimation=true;}else{gridSprite.graphics.drawTexture(tTileTexSet.texture,tX+tTileTexSet.offX,tY+tTileTexSet.offY);}
return true;}}}}
return false;}
__proto.clearAll=function(){this._map=null;this._mapData=null;this._tileWidthHalf=0;this._tileHeightHalf=0;this._mapWidthHalf=0;this._mapHeightHalf=0;this.layerName=null;var i=0;if(this._objDic){for(var p in this._objDic){delete this._objDic[p];}
this._objDic=null;}
if(this._dataDic){for(p in this._dataDic){delete this._dataDic[p];}
this._dataDic=null;};var tGridSprite;for(i=0;i<this._gridSpriteArray.length;i++){tGridSprite=this._gridSpriteArray[i];tGridSprite.clearAll();}
this._properties=null;this._tempMapPos=null;this.tarLayer=null;}
return MapLayer;})(Sprite)
var TileAniSprite=(function(_super){function TileAniSprite(){this._tileTextureSet=null;this._aniName=null;TileAniSprite.__super.call(this);}
__class(TileAniSprite,'laya.map.TileAniSprite',_super);var __proto=TileAniSprite.prototype;__proto.setTileTextureSet=function(aniName,tileTextureSet){this._aniName=aniName;this._tileTextureSet=tileTextureSet;tileTextureSet.addAniSprite(this._aniName,this);}
__proto.show=function(){this._tileTextureSet.addAniSprite(this._aniName,this);}
__proto.hide=function(){this._tileTextureSet.removeAniSprite(this._aniName);}
__proto.clearAll=function(){this._tileTextureSet.removeAniSprite(this._aniName);this.destroy();this._tileTextureSet=null;this._aniName=null;}
return TileAniSprite;})(Sprite)
Laya.__init([TiledMap]);})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
(function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;var Animation=laya.display.Animation,Browser=laya.utils.Browser,ClassUtils=laya.utils.ClassUtils,ColorFilter=laya.filters.ColorFilter;var Ease=laya.utils.Ease,Event=laya.events.Event,EventDispatcher=laya.events.EventDispatcher,Font=laya.display.css.Font;var FrameAnimation=laya.display.FrameAnimation,Graphics=laya.display.Graphics,Handler=laya.utils.Handler;var Input=laya.display.Input,Loader=laya.net.Loader,Node=laya.display.Node,Point=laya.maths.Point,Rectangle=laya.maths.Rectangle;var Render=laya.renders.Render,Sprite=laya.display.Sprite,Text=laya.display.Text,Texture=laya.resource.Texture;var Tween=laya.utils.Tween,Utils=laya.utils.Utils,WeakObject=laya.utils.WeakObject;Laya.interface('laya.ui.IItem');Laya.interface('laya.ui.ISelect');Laya.interface('laya.ui.IRender');Laya.interface('laya.ui.IComponent');Laya.interface('laya.ui.IBox','IComponent');var LayoutStyle=(function(){function LayoutStyle(){this.enable=false;this.top=NaN;this.bottom=NaN;this.left=NaN;this.right=NaN;this.centerX=NaN;this.centerY=NaN;this.anchorX=NaN;this.anchorY=NaN;}
__class(LayoutStyle,'laya.ui.LayoutStyle');__static(LayoutStyle,['EMPTY',function(){return this.EMPTY=new LayoutStyle();}]);return LayoutStyle;})()
var Styles=(function(){function Styles(){}
__class(Styles,'laya.ui.Styles');Styles.labelColor="#000000";Styles.buttonStateNum=3;Styles.scrollBarMinNum=15;Styles.scrollBarDelayTime=500;__static(Styles,['defaultSizeGrid',function(){return this.defaultSizeGrid=[4,4,4,4,0];},'labelPadding',function(){return this.labelPadding=[2,2,2,2];},'inputLabelPadding',function(){return this.inputLabelPadding=[1,1,1,3];},'buttonLabelColors',function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"];},'comboBoxItemColors',function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"];}]);return Styles;})()
var UIUtils=(function(){function UIUtils(){}
__class(UIUtils,'laya.ui.UIUtils');UIUtils.fillArray=function(arr,str,type){var temp=arr.concat();if(str){var a=str.split(",");for(var i=0,n=Math.min(temp.length,a.length);i<n;i++){var value=a[i];temp[i]=(value=="true"?true:(value=="false"?false:value));if(type!=null)temp[i]=type(value);}}
return temp;}
UIUtils.toColor=function(color){return Utils.toHexColor(color);}
UIUtils.gray=function(traget,isGray){(isGray===void 0)&&(isGray=true);if(isGray){UIUtils.addFilter(traget,UIUtils.grayFilter);}else{UIUtils.clearFilter(traget,ColorFilter);}}
UIUtils.addFilter=function(target,filter){var filters=target.filters||[];filters.push(filter);target.filters=filters;}
UIUtils.clearFilter=function(target,filterType){var filters=target.filters;if(filters!=null&&filters.length>0){for(var i=filters.length-1;i>-1;i--){var filter=filters[i];if(Laya.__typeof(filter,filterType))filters.splice(i,1);}
target.filters=filters;}}
UIUtils._getReplaceStr=function(word){return UIUtils.escapeSequence[word];}
UIUtils.adptString=function(str){return str.replace(/\\(\w)/g,UIUtils._getReplaceStr);}
UIUtils.getBindFun=function(value){var fun=UIUtils._funMap.get(value);if(fun==null){var temp="\""+value+"\"";temp=temp.replace(/^"\${|}"$/g,"").replace(/\${/g,"\"+").replace(/}/g,"+\"");var str="(function(data){if(data==null)return;with(data){try{\nreturn "+temp+"\n}catch(e){}}})";fun=Browser.window.eval(str);UIUtils._funMap.set(value,fun);}
return fun;}
__static(UIUtils,['grayFilter',function(){return this.grayFilter=new ColorFilter([0.3086,0.6094,0.082,0,0,0.3086,0.6094,0.082,0,0,0.3086,0.6094,0.082,0,0,0,0,0,1,0]);},'escapeSequence',function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"};},'_funMap',function(){return this._funMap=new WeakObject();}]);return UIUtils;})()
var UIConfig=(function(){function UIConfig(){}
__class(UIConfig,'UIConfig');UIConfig.touchScrollEnable=true;UIConfig.mouseWheelEnable=true;UIConfig.showButtons=true;UIConfig.popupBgColor="#000000";UIConfig.popupBgAlpha=0.5;UIConfig.closeDialogOnSide=true;return UIConfig;})()
var AutoBitmap=(function(_super){function AutoBitmap(){this.autoCacheCmd=true;this._width=0;this._height=0;this._source=null;this._sizeGrid=null;this._isChanged=false;this._offset=null;AutoBitmap.__super.call(this);}
__class(AutoBitmap,'laya.ui.AutoBitmap',_super);var __proto=AutoBitmap.prototype;__proto.destroy=function(){_super.prototype.destroy.call(this);this._source=null;this._sizeGrid=null;this._offset=null;}
__proto._setChanged=function(){if(!this._isChanged){this._isChanged=true;Laya.timer.callLater(this,this.changeSource);}}
__proto.changeSource=function(){this._isChanged=false;var source=this._source;if(!source||!source.bitmap)return;var width=this.width;var height=this.height;var sizeGrid=this._sizeGrid;var sw=source.sourceWidth;var sh=source.sourceHeight;if(!sizeGrid||(sw===width&&sh===height)){this.cleanByTexture(source,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,width,height);}else{source.$_GID||(source.$_GID=Utils.getGID());var key=source.$_GID+"."+width+"."+height+"."+sizeGrid.join(".");if(Utils.isOKCmdList(WeakObject.I.get(key))){this.cmds=WeakObject.I.get(key);return;}
this.clear();var top=sizeGrid[0];var right=sizeGrid[1];var bottom=sizeGrid[2];var left=sizeGrid[3];var repeat=sizeGrid[4];var needClip=false;if(width==sw){left=right=0;}
if(height==sh){top=bottom=0;}
if(left+right>width){var clipWidth=width;needClip=true;width=left+right;this.save();this.clipRect(0,0,clipWidth,height);}
left&&top&&this.drawTexture(AutoBitmap.getTexture(source,0,0,left,top),0,0,left,top);right&&top&&this.drawTexture(AutoBitmap.getTexture(source,sw-right,0,right,top),width-right,0,right,top);left&&bottom&&this.drawTexture(AutoBitmap.getTexture(source,0,sh-bottom,left,bottom),0,height-bottom,left,bottom);right&&bottom&&this.drawTexture(AutoBitmap.getTexture(source,sw-right,sh-bottom,right,bottom),width-right,height-bottom,right,bottom);top&&this.drawBitmap(repeat,AutoBitmap.getTexture(source,left,0,sw-left-right,top),left,0,width-left-right,top);bottom&&this.drawBitmap(repeat,AutoBitmap.getTexture(source,left,sh-bottom,sw-left-right,bottom),left,height-bottom,width-left-right,bottom);left&&this.drawBitmap(repeat,AutoBitmap.getTexture(source,0,top,left,sh-top-bottom),0,top,left,height-top-bottom);right&&this.drawBitmap(repeat,AutoBitmap.getTexture(source,sw-right,top,right,sh-top-bottom),width-right,top,right,height-top-bottom);this.drawBitmap(repeat,AutoBitmap.getTexture(source,left,top,sw-left-right,sh-top-bottom),left,top,width-left-right,height-top-bottom);if(needClip)this.restore();if(this.autoCacheCmd&&!Render.isConchApp)WeakObject.I.set(key,this.cmds);}
this._repaint();}
__proto.drawBitmap=function(repeat,tex,x,y,width,height){(width===void 0)&&(width=0);(height===void 0)&&(height=0);if(width<0.1||height<0.1)return;if(repeat&&(tex.width!=width||tex.height!=height))this.fillTexture(tex,x,y,width,height);else this.drawTexture(tex,x,y,width,height);}
__proto.clear=function(recoverCmds){(recoverCmds===void 0)&&(recoverCmds=true);_super.prototype.clear.call(this,false);}
__getset(0,__proto,'sizeGrid',function(){return this._sizeGrid;},function(value){this._sizeGrid=value;this._setChanged();});__getset(0,__proto,'width',function(){if(this._width)return this._width;if(this._source)return this._source.sourceWidth;return 0;},function(value){if(this._width!=value){this._width=value;this._setChanged();}});__getset(0,__proto,'height',function(){if(this._height)return this._height;if(this._source)return this._source.sourceHeight;return 0;},function(value){if(this._height!=value){this._height=value;this._setChanged();}});__getset(0,__proto,'source',function(){return this._source;},function(value){if(value){this._source=value
this._setChanged();}else{this._source=null;this.clear();}});AutoBitmap.getTexture=function(tex,x,y,width,height){if(width<=0)width=1;if(height<=0)height=1;tex.$_GID||(tex.$_GID=Utils.getGID())
var key=tex.$_GID+"."+x+"."+y+"."+width+"."+height;var texture=WeakObject.I.get(key);if(!texture||!texture.source){texture=Texture.createFromTexture(tex,x,y,width,height);WeakObject.I.set(key,texture);}
return texture;}
return AutoBitmap;})(Graphics)
var UIEvent=(function(_super){function UIEvent(){UIEvent.__super.call(this);;}
__class(UIEvent,'laya.ui.UIEvent',_super);UIEvent.SHOW_TIP="showtip";UIEvent.HIDE_TIP="hidetip";return UIEvent;})(Event)
var Component=(function(_super){function Component(){this._comXml=null;this._dataSource=null;this._toolTip=null;this._tag=null;this._disabled=false;this._gray=false;this.layoutEnabled=true;Component.__super.call(this);this._layout=LayoutStyle.EMPTY;this.preinitialize();this.createChildren();this.initialize();}
__class(Component,'laya.ui.Component',_super);var __proto=Component.prototype;Laya.imps(__proto,{"laya.ui.IComponent":true})
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._dataSource=this._layout=null;this._tag=null;this._toolTip=null;}
__proto.preinitialize=function(){}
__proto.createChildren=function(){}
__proto.initialize=function(){}
__proto.callLater=function(method,args){Laya.timer.callLater(this,method,args);}
__proto.runCallLater=function(method){Laya.timer.runCallLater(this,method);}
__proto.commitMeasure=function(){}
__proto.changeSize=function(){this.event("resize");}
__proto.getLayout=function(){this._layout===LayoutStyle.EMPTY&&(this._layout=new LayoutStyle());return this._layout;}
__proto._setLayoutEnabled=function(value){if(this._layout&&this._layout.enable!=value){this._layout.enable=value;this.on("added",this,this.onAdded);this.on("removed",this,this.onRemoved);if(this.parent){this.onAdded();}}}
__proto.onRemoved=function(){this.parent.off("resize",this,this.onCompResize);}
__proto.onAdded=function(){this.parent.on("resize",this,this.onCompResize);this.resetLayoutX();this.resetLayoutY();}
__proto.onCompResize=function(){if(this._layout&&this._layout.enable){this.resetLayoutX();this.resetLayoutY();}}
__proto.resetLayoutX=function(){var layout=this._layout;if(!isNaN(layout.anchorX))this.pivotX=layout.anchorX*this.width;if(!this.layoutEnabled)return;var parent=this.parent;if(parent){if(!isNaN(layout.centerX)){this.x=Math.round((parent.width-this.displayWidth)*0.5+layout.centerX+this.pivotX*this.scaleX);}else if(!isNaN(layout.left)){this.x=Math.round(layout.left+this.pivotX*this.scaleX);if(!isNaN(layout.right)){this.width=(parent._width-layout.left-layout.right)/(this.scaleX||0.01);}}else if(!isNaN(layout.right)){this.x=Math.round(parent.width-this.displayWidth-layout.right+this.pivotX*this.scaleX);}}}
__proto.resetLayoutY=function(){var layout=this._layout;if(!isNaN(layout.anchorY))this.pivotY=layout.anchorY*this.height;if(!this.layoutEnabled)return;var parent=this.parent;if(parent){if(!isNaN(layout.centerY)){this.y=Math.round((parent.height-this.displayHeight)*0.5+layout.centerY+this.pivotY*this.scaleY);}else if(!isNaN(layout.top)){this.y=Math.round(layout.top+this.pivotY*this.scaleY);if(!isNaN(layout.bottom)){this.height=(parent._height-layout.top-layout.bottom)/(this.scaleY||0.01);}}else if(!isNaN(layout.bottom)){this.y=Math.round(parent.height-this.displayHeight-layout.bottom+this.pivotY*this.scaleY);}}}
__proto.onMouseOver=function(e){Laya.stage.event("showtip",this._toolTip);}
__proto.onMouseOut=function(e){Laya.stage.event("hidetip",this._toolTip);}
__getset(0,__proto,'displayWidth',function(){return this.width*this.scaleX;});__getset(0,__proto,'width',function(){if(this._width)return this._width;return this.measureWidth;},function(value){if(this._width!=value){this._width=value;this.conchModel&&this.conchModel.size(this._width,this._height);this.callLater(this.changeSize);if(this._layout.enable&&(!isNaN(this._layout.centerX)||!isNaN(this._layout.right)||!isNaN(this._layout.anchorX)))this.resetLayoutX();}});__getset(0,__proto,'measureWidth',function(){var max=0;this.commitMeasure();for(var i=this.numChildren-1;i>-1;i--){var comp=this.getChildAt(i);if(comp.visible){max=Math.max(comp.x+comp.width*comp.scaleX,max);}}
return max;});__getset(0,__proto,'displayHeight',function(){return this.height*this.scaleY;});__getset(0,__proto,'height',function(){if(this._height)return this._height;return this.measureHeight;},function(value){if(this._height!=value){this._height=value;this.conchModel&&this.conchModel.size(this._width,this._height);this.callLater(this.changeSize);if(this._layout.enable&&(!isNaN(this._layout.centerY)||!isNaN(this._layout.bottom)||!isNaN(this._layout.anchorY)))this.resetLayoutY();}});__getset(0,__proto,'dataSource',function(){return this._dataSource;},function(value){this._dataSource=value;for(var prop in this._dataSource){if(this.hasOwnProperty(prop)&&!((typeof(this[prop])=='function'))){this[prop]=this._dataSource[prop];}}});__getset(0,__proto,'scaleY',_super.prototype._$get_scaleY,function(value){if(Laya.superGet(Sprite,this,'scaleY')!=value){Laya.superSet(Sprite,this,'scaleY',value);this.callLater(this.changeSize);this._layout.enable&&this.resetLayoutY();}});__getset(0,__proto,'measureHeight',function(){var max=0;this.commitMeasure();for(var i=this.numChildren-1;i>-1;i--){var comp=this.getChildAt(i);if(comp.visible){max=Math.max(comp.y+comp.height*comp.scaleY,max);}}
return max;});__getset(0,__proto,'scaleX',_super.prototype._$get_scaleX,function(value){if(Laya.superGet(Sprite,this,'scaleX')!=value){Laya.superSet(Sprite,this,'scaleX',value);this.callLater(this.changeSize);this._layout.enable&&this.resetLayoutX();}});__getset(0,__proto,'top',function(){return this._layout.top;},function(value){if(value!=this._layout.top){this.getLayout().top=value;this._setLayoutEnabled(true);}
this.resetLayoutY();});__getset(0,__proto,'bottom',function(){return this._layout.bottom;},function(value){if(value!=this._layout.bottom){this.getLayout().bottom=value;this._setLayoutEnabled(true);}
this.resetLayoutY();});__getset(0,__proto,'left',function(){return this._layout.left;},function(value){if(value!=this._layout.left){this.getLayout().left=value;this._setLayoutEnabled(true);}
this.resetLayoutX();});__getset(0,__proto,'right',function(){return this._layout.right;},function(value){if(value!=this._layout.right){this.getLayout().right=value;this._setLayoutEnabled(true);}
this.resetLayoutX();});__getset(0,__proto,'centerX',function(){return this._layout.centerX;},function(value){if(value!=this._layout.centerX){this.getLayout().centerX=value;this._setLayoutEnabled(true);}
this.resetLayoutX();});__getset(0,__proto,'centerY',function(){return this._layout.centerY;},function(value){if(value!=this._layout.centerY){this.getLayout().centerY=value;this._setLayoutEnabled(true);}
this.resetLayoutY();});__getset(0,__proto,'anchorX',function(){return this._layout.anchorX;},function(value){if(value!=this._layout.anchorX){this.getLayout().anchorX=value;this._setLayoutEnabled(true);}
this.resetLayoutX();});__getset(0,__proto,'anchorY',function(){return this._layout.anchorY;},function(value){if(value!=this._layout.anchorY){this.getLayout().anchorY=value;this._setLayoutEnabled(true);}
this.resetLayoutY();});__getset(0,__proto,'tag',function(){return this._tag;},function(value){this._tag=value;});__getset(0,__proto,'toolTip',function(){return this._toolTip;},function(value){if(this._toolTip!=value){this._toolTip=value;if(value!=null){this.on("mouseover",this,this.onMouseOver);this.on("mouseout",this,this.onMouseOut);}else{this.off("mouseover",this,this.onMouseOver);this.off("mouseout",this,this.onMouseOut);}}});__getset(0,__proto,'comXml',function(){return this._comXml;},function(value){this._comXml=value;});__getset(0,__proto,'gray',function(){return this._gray;},function(value){if(value!==this._gray){this._gray=value;UIUtils.gray(this,value);}});__getset(0,__proto,'disabled',function(){return this._disabled;},function(value){if(value!==this._disabled){this.gray=this._disabled=value;this.mouseEnabled=!value;}});return Component;})(Sprite)
var DialogManager=(function(_super){function DialogManager(){this.lockLayer=null;this.popupEffect=function(dialog){dialog.scale(1,1);Tween.from(dialog,{x:Laya.stage.width/2,y:Laya.stage.height/2,scaleX:0,scaleY:0},300,Ease.backOut,Handler.create(this,this.doOpen,[dialog]));}
this.closeEffect=function(dialog,type){Tween.to(dialog,{x:Laya.stage.width/2,y:Laya.stage.height/2,scaleX:0,scaleY:0},300,Ease.strongOut,Handler.create(this,this.doClose,[dialog,type]));}
DialogManager.__super.call(this);this.maskLayer=new Sprite();this.popupEffectHandler=new Handler(this,this.popupEffect);this.closeEffectHandler=new Handler(this,this.closeEffect);this.mouseEnabled=this.maskLayer.mouseEnabled=true;this.zOrder=1000;Laya.stage.addChild(this);Laya.stage.on("resize",this,this._onResize);if(UIConfig.closeDialogOnSide)this.maskLayer.on("click",this,this._closeOnSide);this._onResize(null);}
__class(DialogManager,'laya.ui.DialogManager',_super);var __proto=DialogManager.prototype;__proto._closeOnSide=function(){var dialog=this.getChildAt(this.numChildren-1);if((dialog instanceof laya.ui.Dialog))dialog.close("side");}
__proto.setLockView=function(value){if(!this.lockLayer){this.lockLayer=new Box();this.lockLayer.mouseEnabled=true;this.lockLayer.size(Laya.stage.width,Laya.stage.height);}
this.lockLayer.removeChildren();if(value){value.centerX=value.centerY=0;this.lockLayer.addChild(value);}}
__proto._onResize=function(e){var width=this.maskLayer.width=Laya.stage.width;var height=this.maskLayer.height=Laya.stage.height;if(this.lockLayer)this.lockLayer.size(width,height);this.maskLayer.graphics.clear();this.maskLayer.graphics.drawRect(0,0,width,height,UIConfig.popupBgColor);this.maskLayer.alpha=UIConfig.popupBgAlpha;for(var i=this.numChildren-1;i>-1;i--){var item=this.getChildAt(i);if(item.popupCenter)this._centerDialog(item);}}
__proto._centerDialog=function(dialog){dialog.x=Math.round(((Laya.stage.width-dialog.width)>>1)+dialog.pivotX);dialog.y=Math.round(((Laya.stage.height-dialog.height)>>1)+dialog.pivotY);}
__proto.open=function(dialog,closeOther,showEffect){(closeOther===void 0)&&(closeOther=false);(showEffect===void 0)&&(showEffect=false);if(closeOther)this._closeAll();if(dialog.popupCenter)this._centerDialog(dialog);this.addChild(dialog);if(dialog.isModal||this._$P["hasZorder"])this.timer.callLater(this,this._checkMask);if(showEffect&&dialog.popupEffect!=null)dialog.popupEffect.runWith(dialog);else this.doOpen(dialog);this.event("open");}
__proto.doOpen=function(dialog){dialog.onOpened();}
__proto.lock=function(value){if(this.lockLayer){if(value)this.addChild(this.lockLayer);else this.lockLayer.removeSelf();}}
__proto.close=function(dialog,type,showEffect){(showEffect===void 0)&&(showEffect=false);if(showEffect&&dialog.closeEffect!=null)dialog.closeEffect.runWith([dialog,type]);else this.doClose(dialog,type);this.event("close");}
__proto.doClose=function(dialog,type){dialog.removeSelf();dialog.isModal&&this._checkMask();dialog.closeHandler&&dialog.closeHandler.runWith(type);dialog.onClosed(type);}
__proto.closeAll=function(){this._closeAll();this.event("close");}
__proto._closeAll=function(){for(var i=this.numChildren-1;i>-1;i--){var item=this.getChildAt(i);if(item&&item.close!=null){this.doClose(item);}}}
__proto.getDialogsByGroup=function(group){var arr=[];for(var i=this.numChildren-1;i>-1;i--){var item=this.getChildAt(i);if(item&&item.group===group){arr.push(item);}}
return arr;}
__proto.closeByGroup=function(group){var arr=[];for(var i=this.numChildren-1;i>-1;i--){var item=this.getChildAt(i);if(item&&item.group===group){item.close();arr.push(item);}}
return arr;}
__proto._checkMask=function(){this.maskLayer.removeSelf();for(var i=this.numChildren-1;i>-1;i--){var dialog=this.getChildAt(i);if(dialog&&dialog.isModal){this.addChildAt(this.maskLayer,i);return;}}}
return DialogManager;})(Sprite)
var Box=(function(_super){function Box(){Box.__super.call(this);;}
__class(Box,'laya.ui.Box',_super);var __proto=Box.prototype;Laya.imps(__proto,{"laya.ui.IBox":true})
__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;for(var name in value){var comp=this.getChildByName(name);if(comp)comp.dataSource=value[name];else if(this.hasOwnProperty(name)&&!((typeof(this[name])=='function')))this[name]=value[name];}});return Box;})(Component)
var Button=(function(_super){function Button(skin,label){this.toggle=false;this._bitmap=null;this._text=null;this._strokeColors=null;this._state=0;this._selected=false;this._skin=null;this._autoSize=true;this._sources=null;this._clickHandler=null;this._stateChanged=false;Button.__super.call(this);this._labelColors=Styles.buttonLabelColors;this._stateNum=Styles.buttonStateNum;(label===void 0)&&(label="");this.skin=skin;this.label=label;}
__class(Button,'laya.ui.Button',_super);var __proto=Button.prototype;Laya.imps(__proto,{"laya.ui.ISelect":true})
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._bitmap&&this._bitmap.destroy();this._text&&this._text.destroy(destroyChild);this._bitmap=null;this._text=null;this._clickHandler=null;this._labelColors=this._sources=this._strokeColors=null;}
__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap();}
__proto.createText=function(){if(!this._text){this._text=new Text();this._text.overflow=Text.HIDDEN;this._text.align="center";this._text.valign="middle";this._text.width=this._width;this._text.height=this._height;}}
__proto.initialize=function(){if(this._mouseEnableState!==1){this.mouseEnabled=true;this._setBit(0x2,true);}
this._createListener("mouseover",this,this.onMouse,null,false,false);this._createListener("mouseout",this,this.onMouse,null,false,false);this._createListener("mousedown",this,this.onMouse,null,false,false);this._createListener("mouseup",this,this.onMouse,null,false,false);this._createListener("click",this,this.onMouse,null,false,false);}
__proto.onMouse=function(e){if(this.toggle===false&&this._selected)return;if(e.type==="click"){this.toggle&&(this.selected=!this._selected);this._clickHandler&&this._clickHandler.run();return;}!this._selected&&(this.state=Button.stateMap[e.type]);}
__proto.changeClips=function(){var img=Loader.getRes(this._skin);if(!img){console.log("lose skin",this._skin);return;};var width=img.sourceWidth;var height=img.sourceHeight/this._stateNum;img.$_GID||(img.$_GID=Utils.getGID());var key=img.$_GID+"-"+this._stateNum;var clips=WeakObject.I.get(key);if(!Utils.isOkTextureList(clips)){clips=null;}
if(clips)this._sources=clips;else{this._sources=[];if(this._stateNum===1){this._sources.push(img);}else{for(var i=0;i<this._stateNum;i++){this._sources.push(Texture.createFromTexture(img,0,height*i,width,height));}}
WeakObject.I.set(key,this._sources);}
if(this._autoSize){this._bitmap.width=this._width||width;this._bitmap.height=this._height||height;if(this._text){this._text.width=this._bitmap.width;this._text.height=this._bitmap.height;}}else{this._text&&(this._text.x=width);}}
__proto.changeState=function(){this._stateChanged=false;this.runCallLater(this.changeClips);var index=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[index]);if(this.label){this._text.color=this._labelColors[index];if(this._strokeColors)this._text.strokeColor=this._strokeColors[index];}}
__proto._setStateChanged=function(){if(!this._stateChanged){this._stateChanged=true;this.callLater(this.changeState);}}
__getset(0,__proto,'labelStrokeColor',function(){this.createText();return this._text.strokeColor;},function(value){this.createText();this._text.strokeColor=value});__getset(0,__proto,'measureHeight',function(){this.runCallLater(this.changeClips);return this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height;});__getset(0,__proto,'skin',function(){return this._skin;},function(value){if(this._skin!=value){this._skin=value;this.callLater(this.changeClips);this._setStateChanged();}});__getset(0,__proto,'state',function(){return this._state;},function(value){if(this._state!=value){this._state=value;this._setStateChanged();}});__getset(0,__proto,'text',function(){this.createText();return this._text;});__getset(0,__proto,'stateNum',function(){return this._stateNum;},function(value){if((typeof value=='string')){value=parseInt(value);}
if(this._stateNum!=value){this._stateNum=value<1?1:value>3?3:value;this.callLater(this.changeClips);}});__getset(0,__proto,'strokeColors',function(){return this._strokeColors?this._strokeColors.join(","):"";},function(value){this._strokeColors=UIUtils.fillArray(Styles.buttonLabelColors,value,String);this._setStateChanged();});__getset(0,__proto,'labelColors',function(){return this._labelColors.join(",");},function(value){this._labelColors=UIUtils.fillArray(Styles.buttonLabelColors,value,String);this._setStateChanged();});__getset(0,__proto,'measureWidth',function(){this.runCallLater(this.changeClips);if(this._autoSize)return this._bitmap.width;this.runCallLater(this.changeState);return this._bitmap.width+(this._text?this._text.width:0);});__getset(0,__proto,'label',function(){return this._text?this._text.text:null;},function(value){if(!this._text&&!value)return;this.createText();if(this._text.text!=value){value&&!this._text.parent&&this.addChild(this._text);this._text.text=(value+"").replace(/\\n/g,"\n");this._setStateChanged();}});__getset(0,__proto,'selected',function(){return this._selected;},function(value){if(this._selected!=value){this._selected=value;this.state=this._selected?2:0;this.event("change");}});__getset(0,__proto,'labelPadding',function(){this.createText();return this._text.padding.join(",");},function(value){this.createText();this._text.padding=UIUtils.fillArray(Styles.labelPadding,value,Number);});__getset(0,__proto,'labelSize',function(){this.createText();return this._text.fontSize;},function(value){this.createText();this._text.fontSize=value});__getset(0,__proto,'labelStroke',function(){this.createText();return this._text.stroke;},function(value){this.createText();this._text.stroke=value});__getset(0,__proto,'labelBold',function(){this.createText();return this._text.bold;},function(value){this.createText();this._text.bold=value;});__getset(0,__proto,'labelFont',function(){this.createText();return this._text.font;},function(value){this.createText();this._text.font=value;});__getset(0,__proto,'labelAlign',function(){this.createText()
return this._text.align;},function(value){this.createText()
this._text.align=value;});__getset(0,__proto,'clickHandler',function(){return this._clickHandler;},function(value){this._clickHandler=value;});__getset(0,__proto,'sizeGrid',function(){if(this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(",");return null;},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number);});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Component,this,'width',value);if(this._autoSize){this._bitmap.width=value;this._text&&(this._text.width=value);}});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Component,this,'height',value);if(this._autoSize){this._bitmap.height=value;this._text&&(this._text.height=value);}});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if((typeof value=='number')||(typeof value=='string'))this.label=value+"";else Laya.superSet(Component,this,'dataSource',value);});__getset(0,__proto,'iconOffset',function(){return this._bitmap._offset?this._bitmap._offset.join(","):null;},function(value){if(value)this._bitmap._offset=UIUtils.fillArray([1,1],value,Number);else this._bitmap._offset=[];});__static(Button,['stateMap',function(){return this.stateMap={"mouseup":0,"mouseover":1,"mousedown":2,"mouseout":0};}]);return Button;})(Component)
var Clip=(function(_super){function Clip(url,clipX,clipY){this._sources=null;this._bitmap=null;this._skin=null;this._clipX=1;this._clipY=1;this._clipWidth=0;this._clipHeight=0;this._autoPlay=false;this._interval=50;this._complete=null;this._isPlaying=false;this._index=0;this._clipChanged=false;this._group=null;this._toIndex=-1;Clip.__super.call(this);(clipX===void 0)&&(clipX=1);(clipY===void 0)&&(clipY=1);this._clipX=clipX;this._clipY=clipY;this.skin=url;}
__class(Clip,'laya.ui.Clip',_super);var __proto=Clip.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,true);this._bitmap&&this._bitmap.destroy();this._bitmap=null;this._sources=null;}
__proto.dispose=function(){this.destroy(true);Laya.loader.clearRes(this._skin);}
__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap();}
__proto._onDisplay=function(e){if(this._isPlaying){if(this._displayedInStage)this.play();else this.stop();}else if(this._autoPlay){this.play();}}
__proto.changeClip=function(){this._clipChanged=false;if(!this._skin)return;var img=Loader.getRes(this._skin);if(img){this.loadComplete(this._skin,img);}else{Laya.loader.load(this._skin,Handler.create(this,this.loadComplete,[this._skin]));}}
__proto.loadComplete=function(url,img){if(url===this._skin&&img){var w=this._clipWidth||Math.ceil(img.sourceWidth/this._clipX);var h=this._clipHeight||Math.ceil(img.sourceHeight/this._clipY);var key=this._skin+w+h;var clips=WeakObject.I.get(key);if(!Utils.isOkTextureList(clips)){clips=null;}
if(clips)this._sources=clips;else{this._sources=[];for(var i=0;i<this._clipY;i++){for(var j=0;j<this._clipX;j++){this._sources.push(Texture.createFromTexture(img,w*j,h*i,w,h));}}
WeakObject.I.set(key,this._sources);}
this.index=this._index;this.event("loaded");this.onCompResize();}}
__proto.play=function(from,to){(from===void 0)&&(from=0);(to===void 0)&&(to=-1);this._isPlaying=true;this.index=from;this._toIndex=to;this._index++;Laya.timer.loop(this.interval,this,this._loop);this.on("display",this,this._onDisplay);this.on("undisplay",this,this._onDisplay);}
__proto._loop=function(){if(this._style.visible&&this._sources){this._index++;if(this._toIndex>-1&&this._index>=this._toIndex)this.stop();else if(this._index>=this._sources.length)this._index=0;this.index=this._index;}}
__proto.stop=function(){this._isPlaying=false;Laya.timer.clear(this,this._loop);this.event("complete");}
__proto._setClipChanged=function(){if(!this._clipChanged){this._clipChanged=true;this.callLater(this.changeClip);}}
__getset(0,__proto,'interval',function(){return this._interval;},function(value){if(this._interval!=value){this._interval=value;if(this._isPlaying)this.play();}});__getset(0,__proto,'skin',function(){return this._skin;},function(value){if(this._skin!=value){this._skin=value;if(value){this._setClipChanged()}else{this._bitmap.source=null;}}});__getset(0,__proto,'sources',function(){return this._sources;},function(value){this._sources=value;this.index=this._index;this.event("loaded");});__getset(0,__proto,'clipX',function(){return this._clipX;},function(value){this._clipX=value||1;this._setClipChanged()});__getset(0,__proto,'clipY',function(){return this._clipY;},function(value){this._clipY=value||1;this._setClipChanged()});__getset(0,__proto,'total',function(){this.runCallLater(this.changeClip);return this._sources?this._sources.length:0;});__getset(0,__proto,'clipWidth',function(){return this._clipWidth;},function(value){this._clipWidth=value;this._setClipChanged()});__getset(0,__proto,'sizeGrid',function(){if(this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(",");return null;},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number);});__getset(0,__proto,'group',function(){return this._group;},function(value){if(value&&this._skin)Loader.setGroup(this._skin,value);this._group=value;});__getset(0,__proto,'clipHeight',function(){return this._clipHeight;},function(value){this._clipHeight=value;this._setClipChanged()});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Component,this,'width',value);this._bitmap.width=value;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Component,this,'height',value);this._bitmap.height=value;});__getset(0,__proto,'measureWidth',function(){this.runCallLater(this.changeClip);return this._bitmap.width;});__getset(0,__proto,'measureHeight',function(){this.runCallLater(this.changeClip);return this._bitmap.height;});__getset(0,__proto,'index',function(){return this._index;},function(value){this._index=value;this._bitmap&&this._sources&&(this._bitmap.source=this._sources[value]);this.event("change");});__getset(0,__proto,'autoPlay',function(){return this._autoPlay;},function(value){if(this._autoPlay!=value){this._autoPlay=value;value?this.play():this.stop();}});__getset(0,__proto,'isPlaying',function(){return this._isPlaying;},function(value){this._isPlaying=value;});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if(((typeof value=='number')&&Math.floor(value)==value)||(typeof value=='string'))this.index=parseInt(value);else Laya.superSet(Component,this,'dataSource',value);});__getset(0,__proto,'bitmap',function(){return this._bitmap;});return Clip;})(Component)
var ColorPicker=(function(_super){function ColorPicker(){this.changeHandler=null;this._gridSize=11;this._bgColor="#ffffff";this._borderColor="#000000";this._inputColor="#000000";this._inputBgColor="#efefef";this._colorPanel=null;this._colorTiles=null;this._colorBlock=null;this._colorInput=null;this._colorButton=null;this._colors=[];this._selectedColor="#000000";this._panelChanged=false;ColorPicker.__super.call(this);}
__class(ColorPicker,'laya.ui.ColorPicker',_super);var __proto=ColorPicker.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._colorPanel&&this._colorPanel.destroy(destroyChild);this._colorButton&&this._colorButton.destroy(destroyChild);this._colorPanel=null;this._colorTiles=null;this._colorBlock=null;this._colorInput=null;this._colorButton=null;this._colors=null;this.changeHandler=null;}
__proto.createChildren=function(){this.addChild(this._colorButton=new Button());this._colorPanel=new Box();this._colorPanel.size(230,166);this._colorPanel.addChild(this._colorTiles=new Sprite());this._colorPanel.addChild(this._colorBlock=new Sprite());this._colorPanel.addChild(this._colorInput=new Input());}
__proto.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick);this._colorBlock.pos(5,5);this._colorInput.pos(60,5);this._colorInput.size(60,20);this._colorInput.on("change",this,this.onColorInputChange);this._colorInput.on("keydown",this,this.onColorFieldKeyDown);this._colorTiles.pos(5,30);this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove);this._colorTiles.on("click",this,this.onColorTilesClick);this._colorTiles.size(20*this._gridSize,12*this._gridSize);this._colorPanel.on("mousedown",this,this.onPanelMouseDown);this.bgColor=this._bgColor;}
__proto.onPanelMouseDown=function(e){e.stopPropagation();}
__proto.changePanel=function(){this._panelChanged=false;var g=this._colorPanel.graphics;g.clear();g.drawRect(0,0,230,166,this._bgColor,this._borderColor);this.drawBlock(this._selectedColor);this._colorInput.borderColor=this._borderColor;this._colorInput.bgColor=this._inputBgColor;this._colorInput.color=this._inputColor;g=this._colorTiles.graphics;g.clear();var mainColors=[0x000000,0x333333,0x666666,0x999999,0xCCCCCC,0xFFFFFF,0xFF0000,0x00FF00,0x0000FF,0xFFFF00,0x00FFFF,0xFF00FF];for(var i=0;i<12;i++){for(var j=0;j<20;j++){var color=0;if(j===0)color=mainColors[i];else if(j===1)color=0x000000;else color=(((i*3+j/6)%3<<0)+((i/6)<<0)*3)*0x33<<16|j%6*0x33<<8|(i<<0)%6*0x33;var strColor=UIUtils.toColor(color);this._colors.push(strColor);var x=j*this._gridSize;var y=i*this._gridSize;g.drawRect(x,y,this._gridSize,this._gridSize,strColor,"#000000");}}}
__proto.onColorButtonClick=function(e){if(this._colorPanel.parent)this.close();else this.open();}
__proto.open=function(){var p=this.localToGlobal(new Point());var px=p.x+this._colorPanel.width<=Laya.stage.width?p.x:Laya.stage.width-this._colorPanel.width;var py=p.y+this._colorButton.height;py=py+this._colorPanel.height<=Laya.stage.height?py:p.y-this._colorPanel.height;this._colorPanel.pos(px,py);this._colorPanel.zOrder=1001;Laya._currentStage.addChild(this._colorPanel);Laya.stage.on("mousedown",this,this.removeColorBox);}
__proto.close=function(){Laya.stage.off("mousedown",this,this.removeColorBox);this._colorPanel.removeSelf();}
__proto.removeColorBox=function(e){this.close();}
__proto.onColorFieldKeyDown=function(e){if(e.keyCode==13){if(this._colorInput.text)this.selectedColor=this._colorInput.text;else this.selectedColor=null;this.close();e.stopPropagation();}}
__proto.onColorInputChange=function(e){if(this._colorInput.text)this.drawBlock(this._colorInput.text);else this.drawBlock("#FFFFFF");}
__proto.onColorTilesClick=function(e){this.selectedColor=this.getColorByMouse();this.close();}
__proto.onColorTilesMouseMove=function(e){this._colorInput.focus=false;var color=this.getColorByMouse();this._colorInput.text=color;this.drawBlock(color);}
__proto.getColorByMouse=function(){var point=this._colorTiles.getMousePoint();var x=Math.floor(point.x/this._gridSize);var y=Math.floor(point.y/this._gridSize);return this._colors[y*20+x];}
__proto.drawBlock=function(color){var g=this._colorBlock.graphics;g.clear();var showColor=color?color:"#ffffff";g.drawRect(0,0,50,20,showColor,this._borderColor);color||g.drawLine(0,0,50,20,"#ff0000");}
__proto.changeColor=function(){var g=this.graphics;g.clear();var showColor=this._selectedColor||"#000000";g.drawRect(0,0,this._colorButton.width,this._colorButton.height,showColor);}
__proto._setPanelChanged=function(){if(!this._panelChanged){this._panelChanged=true;this.callLater(this.changePanel);}}
__getset(0,__proto,'inputBgColor',function(){return this._inputBgColor;},function(value){this._inputBgColor=value;this._setPanelChanged();});__getset(0,__proto,'selectedColor',function(){return this._selectedColor;},function(value){if(this._selectedColor!=value){this._selectedColor=this._colorInput.text=value;this.drawBlock(value);this.changeColor();this.changeHandler&&this.changeHandler.runWith(this._selectedColor);this.event("change",Event.EMPTY.setTo("change",this,this));}});__getset(0,__proto,'skin',function(){return this._colorButton.skin;},function(value){this._colorButton.skin=value;this.changeColor();});__getset(0,__proto,'bgColor',function(){return this._bgColor;},function(value){this._bgColor=value;this._setPanelChanged();});__getset(0,__proto,'borderColor',function(){return this._borderColor;},function(value){this._borderColor=value;this._setPanelChanged();});__getset(0,__proto,'inputColor',function(){return this._inputColor;},function(value){this._inputColor=value;this._setPanelChanged();});return ColorPicker;})(Component)
var ComboBox=(function(_super){function ComboBox(skin,labels){this._visibleNum=6;this._button=null;this._list=null;this._isOpen=false;this._itemSize=12;this._labels=[];this._selectedIndex=-1;this._selectHandler=null;this._itemHeight=NaN;this._listHeight=NaN;this._listChanged=false;this._itemChanged=false;this._scrollBarSkin=null;this._isCustomList=false;this.itemRender=null;ComboBox.__super.call(this);this._itemColors=Styles.comboBoxItemColors;this.skin=skin;this.labels=labels;}
__class(ComboBox,'laya.ui.ComboBox',_super);var __proto=ComboBox.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._button&&this._button.destroy(destroyChild);this._list&&this._list.destroy(destroyChild);this._button=null;this._list=null;this._itemColors=null;this._labels=null;this._selectHandler=null;}
__proto.createChildren=function(){this.addChild(this._button=new Button());this._button.text.align="left";this._button.labelPadding="0,0,0,5";this._button.on("mousedown",this,this.onButtonMouseDown);}
__proto._createList=function(){this._list=new List();if(this._scrollBarSkin)this._list.vScrollBarSkin=this._scrollBarSkin;this._setListEvent(this._list);}
__proto._setListEvent=function(list){this._list.selectEnable=true;this._list.on("mousedown",this,this.onListDown);this._list.mouseHandler=Handler.create(this,this.onlistItemMouse,null,false);if(this._list.scrollBar)this._list.scrollBar.on("mousedown",this,this.onScrollBarDown);}
__proto.onListDown=function(e){e.stopPropagation();}
__proto.onScrollBarDown=function(e){e.stopPropagation();}
__proto.onButtonMouseDown=function(e){this.callLater(this.switchTo,[!this._isOpen]);}
__proto.changeList=function(){this._listChanged=false;var labelWidth=this.width-2;var labelColor=this._itemColors[2];this._itemHeight=this._itemSize+6;this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:labelWidth,height:this._itemHeight,fontSize:this._itemSize,color:labelColor}}]};this._list.repeatY=this._visibleNum;this._list.refresh();}
__proto.onlistItemMouse=function(e,index){var type=e.type;if(type==="mouseover"||type==="mouseout"){if(this._isCustomList)return;var box=this._list.getCell(index);if(!box)return;var label=box.getChildByName("label");if(label){if(type==="mouseover"){label.bgColor=this._itemColors[0];label.color=this._itemColors[1];}else{label.bgColor=null;label.color=this._itemColors[2];}}}else if(type==="click"){this.selectedIndex=index;this.isOpen=false;}}
__proto.switchTo=function(value){this.isOpen=value;}
__proto.changeOpen=function(){this.isOpen=!this._isOpen;}
__proto.changeItem=function(){this._itemChanged=false;this._listHeight=this._labels.length>0?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight;if(!this._isCustomList){var g=this._list.graphics;g.clear();g.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3]);};var a=this._list.array||[];a.length=0;for(var i=0,n=this._labels.length;i<n;i++){a.push({label:this._labels[i]});}
this._list.height=this._listHeight;this._list.array=a;}
__proto.changeSelected=function(){this._button.label=this.selectedLabel;}
__proto._onStageMouseWheel=function(e){if(!this._list||this._list.contains(e.target))return;this.removeList(null);}
__proto.removeList=function(e){Laya.stage.off("mousedown",this,this.removeList);Laya.stage.off("mousewheel",this,this._onStageMouseWheel);this.isOpen=false;}
__getset(0,__proto,'selectedIndex',function(){return this._selectedIndex;},function(value){if(this._selectedIndex!=value){this._selectedIndex=value;if(this._labels.length>0)this.changeSelected();else this.callLater(this.changeSelected);this.event("change",[Event.EMPTY.setTo("change",this,this)]);this._selectHandler&&this._selectHandler.runWith(this._selectedIndex);}});__getset(0,__proto,'measureHeight',function(){return this._button.height;});__getset(0,__proto,'skin',function(){return this._button.skin;},function(value){if(this._button.skin!=value){this._button.skin=value;this._listChanged=true;}});__getset(0,__proto,'measureWidth',function(){return this._button.width;});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Component,this,'width',value);this._button.width=this._width;this._itemChanged=true;this._listChanged=true;});__getset(0,__proto,'selectedLabel',function(){return this._selectedIndex>-1&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null;},function(value){this.selectedIndex=this._labels.indexOf(value);});__getset(0,__proto,'labels',function(){return this._labels.join(",");},function(value){if(this._labels.length>0)this.selectedIndex=-1;if(value)this._labels=value.split(",");else this._labels.length=0;this._itemChanged=true;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Component,this,'height',value);this._button.height=this._height;});__getset(0,__proto,'selectHandler',function(){return this._selectHandler;},function(value){this._selectHandler=value;});__getset(0,__proto,'visibleNum',function(){return this._visibleNum;},function(value){this._visibleNum=value;this._listChanged=true;});__getset(0,__proto,'labelBold',function(){return this._button.text.bold;},function(value){this._button.text.bold=value});__getset(0,__proto,'itemColors',function(){return String(this._itemColors)},function(value){this._itemColors=UIUtils.fillArray(this._itemColors,value,String);this._listChanged=true;});__getset(0,__proto,'itemSize',function(){return this._itemSize;},function(value){this._itemSize=value;this._listChanged=true;});__getset(0,__proto,'scrollBar',function(){return this.list.scrollBar;});__getset(0,__proto,'isOpen',function(){return this._isOpen;},function(value){if(this._isOpen!=value){this._isOpen=value;this._button.selected=this._isOpen;if(this._isOpen){this._list||this._createList();this._listChanged&&!this._isCustomList&&this.changeList();this._itemChanged&&this.changeItem();var p=this.localToGlobal(Point.TEMP.setTo(0,0));var py=p.y+this._button.height;py=py+this._listHeight<=Laya.stage.height?py:p.y-this._listHeight;this._list.pos(p.x,py);this._list.zOrder=1001;Laya._currentStage.addChild(this._list);Laya.stage.once("mousedown",this,this.removeList);Laya.stage.on("mousewheel",this,this._onStageMouseWheel);this._list.selectedIndex=this._selectedIndex;}else{this._list&&this._list.removeSelf();}}});__getset(0,__proto,'scrollBarSkin',function(){return this._scrollBarSkin;},function(value){this._scrollBarSkin=value;});__getset(0,__proto,'sizeGrid',function(){return this._button.sizeGrid;},function(value){this._button.sizeGrid=value;});__getset(0,__proto,'button',function(){return this._button;});__getset(0,__proto,'list',function(){this._list||this._createList();return this._list;},function(value){if(value){value.removeSelf();this._isCustomList=true;this._list=value;this._setListEvent(value);this._itemHeight=value.getCell(0).height+value.spaceY;}});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if(((typeof value=='number')&&Math.floor(value)==value)||(typeof value=='string'))this.selectedIndex=parseInt(value);else if((value instanceof Array))this.labels=(value).join(",");else Laya.superSet(Component,this,'dataSource',value);});__getset(0,__proto,'labelColors',function(){return this._button.labelColors;},function(value){if(this._button.labelColors!=value){this._button.labelColors=value;}});__getset(0,__proto,'labelPadding',function(){return this._button.text.padding.join(",");},function(value){this._button.text.padding=UIUtils.fillArray(Styles.labelPadding,value,Number);});__getset(0,__proto,'labelSize',function(){return this._button.text.fontSize;},function(value){this._button.text.fontSize=value});__getset(0,__proto,'labelFont',function(){return this._button.text.font;},function(value){this._button.text.font=value});__getset(0,__proto,'stateNum',function(){return this._button.stateNum;},function(value){this._button.stateNum=value});return ComboBox;})(Component)
var ScrollBar=(function(_super){function ScrollBar(skin){this.rollRatio=0.95;this.changeHandler=null;this.scaleBar=true;this.autoHide=false;this.elasticDistance=0;this.elasticBackTime=500;this.upButton=null;this.downButton=null;this.slider=null;this._scrollSize=1;this._skin=null;this._thumbPercent=1;this._target=null;this._lastPoint=null;this._lastOffset=0;this._checkElastic=false;this._isElastic=false;this._value=NaN;this._hide=false;this._clickOnly=true;this._offsets=null;ScrollBar.__super.call(this);this._showButtons=UIConfig.showButtons;this._touchScrollEnable=UIConfig.touchScrollEnable;this._mouseWheelEnable=UIConfig.mouseWheelEnable;this.skin=skin;this.max=1;}
__class(ScrollBar,'laya.ui.ScrollBar',_super);var __proto=ScrollBar.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);this.stopScroll();this.target=null;_super.prototype.destroy.call(this,destroyChild);this.upButton&&this.upButton.destroy(destroyChild);this.downButton&&this.downButton.destroy(destroyChild);this.slider&&this.slider.destroy(destroyChild);this.upButton=this.downButton=null;this.slider=null;this.changeHandler=null;this._offsets=null;}
__proto.createChildren=function(){this.addChild(this.slider=new Slider());this.addChild(this.upButton=new Button());this.addChild(this.downButton=new Button());}
__proto.initialize=function(){this.slider.showLabel=false;this.slider.on("change",this,this.onSliderChange);this.slider.setSlider(0,0,0);this.upButton.on("mousedown",this,this.onButtonMouseDown);this.downButton.on("mousedown",this,this.onButtonMouseDown);}
__proto.onSliderChange=function(){if(this._value!=this.slider.value)this.value=this.slider.value;}
__proto.onButtonMouseDown=function(e){var isUp=e.currentTarget===this.upButton;this.slide(isUp);Laya.timer.once(Styles.scrollBarDelayTime,this,this.startLoop,[isUp]);Laya.stage.once("mouseup",this,this.onStageMouseUp);}
__proto.startLoop=function(isUp){Laya.timer.frameLoop(1,this,this.slide,[isUp]);}
__proto.slide=function(isUp){if(isUp)this.value-=this._scrollSize;else this.value+=this._scrollSize;}
__proto.onStageMouseUp=function(e){Laya.timer.clear(this,this.startLoop);Laya.timer.clear(this,this.slide);}
__proto.changeScrollBar=function(){this.upButton.visible=this._showButtons;this.downButton.visible=this._showButtons;if(this._showButtons){this.upButton.skin=this._skin.replace(".png","$up.png");this.downButton.skin=this._skin.replace(".png","$down.png");}
if(this.slider.isVertical)this.slider.y=this._showButtons?this.upButton.height:0;else this.slider.x=this._showButtons?this.upButton.width:0;this.resetPositions();this.repaint();}
__proto.changeSize=function(){_super.prototype.changeSize.call(this);this.repaint();this.resetPositions();this.event("change");this.changeHandler&&this.changeHandler.runWith(this.value);}
__proto.resetPositions=function(){if(this.slider.isVertical)this.slider.height=this.height-(this._showButtons?(this.upButton.height+this.downButton.height):0);else this.slider.width=this.width-(this._showButtons?(this.upButton.width+this.downButton.width):0);this.resetButtonPosition();}
__proto.resetButtonPosition=function(){if(this.slider.isVertical)this.downButton.y=this.slider.y+this.slider.height;else this.downButton.x=this.slider.x+this.slider.width;}
__proto.setScroll=function(min,max,value){this.runCallLater(this.changeSize);this.slider.setSlider(min,max,value);this.slider.bar.visible=max>0;if(!this._hide&&this.autoHide)this.visible=false;}
__proto.onTargetMouseWheel=function(e){this.value-=e.delta*this._scrollSize;this.target=this._target;}
__proto.onTargetMouseDown=function(e){this._clickOnly=true;this._lastOffset=0;this._checkElastic=false;this._lastPoint||(this._lastPoint=new Point());this._lastPoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY);Laya.timer.clear(this,this.tweenMove);Tween.clearTween(this);Laya.stage.once("mouseup",this,this.onStageMouseUp2);Laya.stage.once("mouseout",this,this.onStageMouseUp2);Laya.timer.frameLoop(1,this,this.loop);}
__proto.loop=function(){var mouseY=Laya.stage.mouseY;var mouseX=Laya.stage.mouseX;this._lastOffset=this.isVertical?(mouseY-this._lastPoint.y):(mouseX-this._lastPoint.x);if(this._clickOnly){if(Math.abs(this._lastOffset*(this.isVertical?Laya.stage._canvasTransform.getScaleY():Laya.stage._canvasTransform.getScaleX()))>1){this._clickOnly=false;this._offsets||(this._offsets=[]);this._offsets.length=0;this._target.mouseEnabled=false;if(!this.hide&&this.autoHide){this.alpha=1;this.visible=true;}
this.event("start");}else return;}
this._offsets.push(this._lastOffset);this._lastPoint.x=mouseX;this._lastPoint.y=mouseY;if(this._lastOffset===0)return;if(!this._checkElastic){if(this.elasticDistance>0){if(!this._checkElastic&&this._lastOffset!=0){if((this._lastOffset>0&&this._value<=this.min)||(this._lastOffset<0&&this._value>=this.max)){this._isElastic=true;this._checkElastic=true;}else{this._isElastic=false;}}}else{this._checkElastic=true;}}
if(this._isElastic){if(this._value<=this.min){this.value-=this._lastOffset*Math.max(0,(1-((this.min-this._value)/this.elasticDistance)));}else if(this._value>=this.max){this.value-=this._lastOffset*Math.max(0,(1-((this._value-this.max)/this.elasticDistance)));}}else{this.value-=this._lastOffset;}}
__proto.onStageMouseUp2=function(e){Laya.stage.off("mouseup",this,this.onStageMouseUp2);Laya.stage.off("mouseout",this,this.onStageMouseUp2);Laya.timer.clear(this,this.loop);if(this._clickOnly){if(this._value>=this.min&&this._value<=this.max)
return;}
this._target.mouseEnabled=true;if(this._isElastic){if(this._value<this.min){Tween.to(this,{value:this.min},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));}else if(this._value>this.max){Tween.to(this,{value:this.max},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));}}else{if(!this._offsets)return;if(this._offsets.length<1){this._offsets[0]=this.isVertical?Laya.stage.mouseY-this._lastPoint.y:Laya.stage.mouseX-this._lastPoint.x;};var offset=0;var n=Math.min(this._offsets.length,3);for(var i=0;i<n;i++){offset+=this._offsets[this._offsets.length-1-i];}
this._lastOffset=offset/n;offset=Math.abs(this._lastOffset);if(offset<2){this.event("end");return;}
if(offset>60)this._lastOffset=this._lastOffset>0?60:-60;var dis=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/240)));Laya.timer.frameLoop(1,this,this.tweenMove,[dis]);}}
__proto.elasticOver=function(){this._isElastic=false;if(!this.hide&&this.autoHide){Tween.to(this,{alpha:0},500);}
this.event("end");}
__proto.tweenMove=function(maxDistance){this._lastOffset*=this.rollRatio;var tarSpeed=NaN;if(maxDistance>0){if(this._lastOffset>0&&this.value<=this.min){this._isElastic=true;tarSpeed=-(this.min-maxDistance-this.value)*0.5;if(this._lastOffset>tarSpeed)this._lastOffset=tarSpeed;}else if(this._lastOffset<0&&this.value>=this.max){this._isElastic=true;tarSpeed=-(this.max+maxDistance-this.value)*0.5;if(this._lastOffset<tarSpeed)this._lastOffset=tarSpeed;}}
this.value-=this._lastOffset;if(Math.abs(this._lastOffset)<1){Laya.timer.clear(this,this.tweenMove);if(this._isElastic){if(this._value<this.min){Tween.to(this,{value:this.min},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));}else if(this._value>this.max){Tween.to(this,{value:this.max},this.elasticBackTime,Ease.sineOut,Handler.create(this,this.elasticOver));}else{this.elasticOver();}
return;}
this.event("end");if(!this.hide&&this.autoHide){Tween.to(this,{alpha:0},500);}}}
__proto.stopScroll=function(){this.onStageMouseUp2(null);Laya.timer.clear(this,this.tweenMove);Tween.clearTween(this);}
__getset(0,__proto,'measureHeight',function(){if(this.slider.isVertical)return 100;return this.slider.height;});__getset(0,__proto,'skin',function(){return this._skin;},function(value){if(this._skin!=value){this._skin=value;this.slider.skin=this._skin;this.callLater(this.changeScrollBar);}});__getset(0,__proto,'max',function(){return this.slider.max;},function(value){this.slider.max=value;});__getset(0,__proto,'showButtons',function(){return this._showButtons;},function(value){this._showButtons=value;this.callLater(this.changeScrollBar);});__getset(0,__proto,'measureWidth',function(){if(this.slider.isVertical)return this.slider.width;return 100;});__getset(0,__proto,'min',function(){return this.slider.min;},function(value){this.slider.min=value;});__getset(0,__proto,'value',function(){return this._value;},function(v){if(v!==this._value){this._value=v;if(!this._isElastic){if(this.slider._value!=v){this.slider._value=v;this.slider.changeValue();}
this._value=this.slider._value;}
this.event("change");this.changeHandler&&this.changeHandler.runWith(this._value);}});__getset(0,__proto,'isVertical',function(){return this.slider.isVertical;},function(value){this.slider.isVertical=value;});__getset(0,__proto,'sizeGrid',function(){return this.slider.sizeGrid;},function(value){this.slider.sizeGrid=value;});__getset(0,__proto,'scrollSize',function(){return this._scrollSize;},function(value){this._scrollSize=value;});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if((typeof value=='number')||(typeof value=='string'))this.value=Number(value);else Laya.superSet(Component,this,'dataSource',value);});__getset(0,__proto,'thumbPercent',function(){return this._thumbPercent;},function(value){this.runCallLater(this.changeScrollBar);this.runCallLater(this.changeSize);value=value>=1?0.99:value;this._thumbPercent=value;if(this.scaleBar){if(this.slider.isVertical)this.slider.bar.height=Math.max(this.slider.height*value,Styles.scrollBarMinNum);else this.slider.bar.width=Math.max(this.slider.width*value,Styles.scrollBarMinNum);}});__getset(0,__proto,'target',function(){return this._target;},function(value){if(this._target){this._target.off("mousewheel",this,this.onTargetMouseWheel);this._target.off("mousedown",this,this.onTargetMouseDown);}
this._target=value;if(value){this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel);this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown);}});__getset(0,__proto,'hide',function(){return this._hide;},function(value){this._hide=value;this.visible=!value;});__getset(0,__proto,'touchScrollEnable',function(){return this._touchScrollEnable;},function(value){this._touchScrollEnable=value;this.target=this._target;});__getset(0,__proto,'mouseWheelEnable',function(){return this._mouseWheelEnable;},function(value){this._mouseWheelEnable=value;});__getset(0,__proto,'tick',function(){return this.slider.tick;},function(value){this.slider.tick=value;});return ScrollBar;})(Component)
var Slider=(function(_super){function Slider(skin){this.changeHandler=null;this.isVertical=true;this.showLabel=true;this._allowClickBack=false;this._max=100;this._min=0;this._tick=1;this._value=0;this._skin=null;this._bg=null;this._progress=null;this._bar=null;this._tx=NaN;this._ty=NaN;this._maxMove=NaN;this._globalSacle=null;Slider.__super.call(this);this.skin=skin;}
__class(Slider,'laya.ui.Slider',_super);var __proto=Slider.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._bg&&this._bg.destroy(destroyChild);this._bar&&this._bar.destroy(destroyChild);this._progress&&this._progress.destroy(destroyChild);this._bg=null;this._bar=null;this._progress=null;this.changeHandler=null;}
__proto.createChildren=function(){this.addChild(this._bg=new Image());this.addChild(this._bar=new Button());}
__proto.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown);this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0";if(this._progress)this._progress.sizeGrid=this._bar.sizeGrid;this.allowClickBack=true;}
__proto.onBarMouseDown=function(e){this._globalSacle||(this._globalSacle=new Point());this._globalSacle.setTo(this.globalScaleX||0.01,this.globalScaleY||0.01);this._maxMove=this.isVertical?(this.height-this._bar.height):(this.width-this._bar.width);this._tx=Laya.stage.mouseX;this._ty=Laya.stage.mouseY;Laya.stage.on("mousemove",this,this.mouseMove);Laya.stage.once("mouseup",this,this.mouseUp);Laya.stage.once("mouseout",this,this.mouseUp);this.showValueText();}
__proto.showValueText=function(){if(this.showLabel){var label=laya.ui.Slider.label;this.addChild(label);label.textField.changeText(this._value+"");if(this.isVertical){label.x=this._bar.x+20;label.y=(this._bar.height-label.height)*0.5+this._bar.y;}else{label.y=this._bar.y-20;label.x=(this._bar.width-label.width)*0.5+this._bar.x;}}}
__proto.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf();}
__proto.mouseUp=function(e){Laya.stage.off("mousemove",this,this.mouseMove);Laya.stage.off("mouseup",this,this.mouseUp);Laya.stage.off("mouseout",this,this.mouseUp);this.sendChangeEvent("changed");this.hideValueText();}
__proto.mouseMove=function(e){var oldValue=this._value;if(this.isVertical){this._bar.y+=(Laya.stage.mouseY-this._ty)/this._globalSacle.y;if(this._bar.y>this._maxMove)this._bar.y=this._maxMove;else if(this._bar.y<0)this._bar.y=0;this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min;if(this._progress)this._progress.height=this._bar.y+0.5*this._bar.height;}else{this._bar.x+=(Laya.stage.mouseX-this._tx)/this._globalSacle.x;if(this._bar.x>this._maxMove)this._bar.x=this._maxMove;else if(this._bar.x<0)this._bar.x=0;this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min;if(this._progress)this._progress.width=this._bar.x+0.5*this._bar.width;}
this._tx=Laya.stage.mouseX;this._ty=Laya.stage.mouseY;var pow=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*pow)/pow;if(this._value!=oldValue){this.sendChangeEvent();}
this.showValueText();}
__proto.sendChangeEvent=function(type){(type===void 0)&&(type="change");this.event(type);this.changeHandler&&this.changeHandler.runWith(this._value);}
__proto.setBarPoint=function(){if(this.isVertical)this._bar.x=Math.round((this._bg.width-this._bar.width)*0.5);else this._bar.y=Math.round((this._bg.height-this._bar.height)*0.5);}
__proto.changeSize=function(){_super.prototype.changeSize.call(this);if(this.isVertical)this._bg.height=this.height;else this._bg.width=this.width;this.setBarPoint();this.changeValue();}
__proto.setSlider=function(min,max,value){this._value=-1;this._min=min;this._max=max>min?max:min;this.value=value<min?min:value>max?max:value;}
__proto.changeValue=function(){var pow=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*pow)/pow;this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var num=this._max-this._min;if(num===0)num=1;if(this.isVertical){this._bar.y=(this._value-this._min)/num*(this.height-this._bar.height);if(this._progress)this._progress.height=this._bar.y+0.5*this._bar.height;}
else{this._bar.x=(this._value-this._min)/num*(this.width-this._bar.width);if(this._progress)this._progress.width=this._bar.x+0.5*this._bar.width;}}
__proto.onBgMouseDown=function(e){var point=this._bg.getMousePoint();if(this.isVertical)this.value=point.y/(this.height-this._bar.height)*(this._max-this._min)+this._min;else this.value=point.x/(this.width-this._bar.width)*(this._max-this._min)+this._min;}
__getset(0,__proto,'measureHeight',function(){return Math.max(this._bg.height,this._bar.height);});__getset(0,__proto,'skin',function(){return this._skin;},function(value){if(this._skin!=value){this._skin=value;this._bg.skin=this._skin;this._bar.skin=this._skin.replace(".png","$bar.png");var progressSkin=this._skin.replace(".png","$progress.png");if(Loader.getRes(progressSkin)){if(!this._progress){this.addChild(this._progress=new Image());this._progress.sizeGrid=this._bar.sizeGrid;this.setChildIndex(this._progress,1);}
this._progress.skin=progressSkin;}
this.setBarPoint();this.callLater(this.changeValue);}});__getset(0,__proto,'allowClickBack',function(){return this._allowClickBack;},function(value){if(this._allowClickBack!=value){this._allowClickBack=value;if(value)this._bg.on("mousedown",this,this.onBgMouseDown);else this._bg.off("mousedown",this,this.onBgMouseDown);}});__getset(0,__proto,'max',function(){return this._max;},function(value){if(this._max!=value){this._max=value;this.callLater(this.changeValue);}});__getset(0,__proto,'measureWidth',function(){return Math.max(this._bg.width,this._bar.width);});__getset(0,__proto,'tick',function(){return this._tick;},function(value){if(this._tick!=value){this._tick=value;this.callLater(this.changeValue);}});__getset(0,__proto,'sizeGrid',function(){return this._bg.sizeGrid;},function(value){this._bg.sizeGrid=value;this._bar.sizeGrid=value;if(this._progress)this._progress.sizeGrid=this._bar.sizeGrid;});__getset(0,__proto,'min',function(){return this._min;},function(value){if(this._min!=value){this._min=value;this.callLater(this.changeValue);}});__getset(0,__proto,'value',function(){return this._value;},function(num){if(this._value!=num){var oldValue=this._value;this._value=num;this.changeValue();if(this._value!=oldValue){this.sendChangeEvent();}}});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if((typeof value=='number')||(typeof value=='string'))this.value=Number(value);else Laya.superSet(Component,this,'dataSource',value);});__getset(0,__proto,'bar',function(){return this._bar;});__static(Slider,['label',function(){return this.label=new Label();}]);return Slider;})(Component)
var Image=(function(_super){function Image(skin){this._bitmap=null;this._skin=null;this._group=null;Image.__super.call(this);this.skin=skin;}
__class(Image,'laya.ui.Image',_super);var __proto=Image.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,true);this._bitmap&&this._bitmap.destroy();this._bitmap=null;}
__proto.dispose=function(){this.destroy(true);Laya.loader.clearRes(this._skin);}
__proto.createChildren=function(){this.graphics=this._bitmap=new AutoBitmap();this._bitmap.autoCacheCmd=false;}
__proto.setSource=function(url,img){if(url===this._skin&&img){this.source=img
this.onCompResize();}}
__getset(0,__proto,'source',function(){return this._bitmap.source;},function(value){if(!this._bitmap)return;this._bitmap.source=value;this.event("loaded");this.repaint();});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if((typeof value=='string'))this.skin=value;else Laya.superSet(Component,this,'dataSource',value);});__getset(0,__proto,'measureHeight',function(){return this._bitmap.height;});__getset(0,__proto,'skin',function(){return this._skin;},function(value){if(this._skin!=value){this._skin=value;if(value){var source=Loader.getRes(value);if(source){this.source=source;this.onCompResize();}else Laya.loader.load(this._skin,Handler.create(this,this.setSource,[this._skin]),null,"image",1,true,this._group);}else{this.source=null;}}});__getset(0,__proto,'group',function(){return this._group;},function(value){if(value&&this._skin)Loader.setGroup(this._skin,value);this._group=value;});__getset(0,__proto,'sizeGrid',function(){if(this._bitmap.sizeGrid)return this._bitmap.sizeGrid.join(",");return null;},function(value){this._bitmap.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number);});__getset(0,__proto,'measureWidth',function(){return this._bitmap.width;});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Component,this,'width',value);this._bitmap.width=value==0?0.0000001:value;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Component,this,'height',value);this._bitmap.height=value==0?0.0000001:value;});return Image;})(Component)
var Label=(function(_super){function Label(text){this._tf=null;Label.__super.call(this);(text===void 0)&&(text="");Font.defaultColor=Styles.labelColor;this.text=text;}
__class(Label,'laya.ui.Label',_super);var __proto=Label.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._tf=null;}
__proto.createChildren=function(){this.addChild(this._tf=new Text());}
__proto.changeText=function(text){this._tf.changeText(text);}
__getset(0,__proto,'padding',function(){return this._tf.padding.join(",");},function(value){this._tf.padding=UIUtils.fillArray(Styles.labelPadding,value,Number);});__getset(0,__proto,'bold',function(){return this._tf.bold;},function(value){this._tf.bold=value;});__getset(0,__proto,'align',function(){return this._tf.align;},function(value){this._tf.align=value;});__getset(0,__proto,'text',function(){return this._tf.text;},function(value){if(this._tf.text!=value){if(value)
value=UIUtils.adptString(value+"");this._tf.text=value;this.event("change");if(!this._width||!this._height)this.onCompResize();}});__getset(0,__proto,'italic',function(){return this._tf.italic;},function(value){this._tf.italic=value;});__getset(0,__proto,'wordWrap',function(){return this._tf.wordWrap;},function(value){this._tf.wordWrap=value;});__getset(0,__proto,'font',function(){return this._tf.font;},function(value){this._tf.font=value;});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if((typeof value=='number')||(typeof value=='string'))this.text=value+"";else Laya.superSet(Component,this,'dataSource',value);});__getset(0,__proto,'color',function(){return this._tf.color;},function(value){this._tf.color=value;});__getset(0,__proto,'valign',function(){return this._tf.valign;},function(value){this._tf.valign=value;});__getset(0,__proto,'leading',function(){return this._tf.leading;},function(value){this._tf.leading=value;});__getset(0,__proto,'fontSize',function(){return this._tf.fontSize;},function(value){this._tf.fontSize=value;});__getset(0,__proto,'bgColor',function(){return this._tf.bgColor},function(value){this._tf.bgColor=value;});__getset(0,__proto,'borderColor',function(){return this._tf.borderColor},function(value){this._tf.borderColor=value;});__getset(0,__proto,'stroke',function(){return this._tf.stroke;},function(value){this._tf.stroke=value;});__getset(0,__proto,'strokeColor',function(){return this._tf.strokeColor;},function(value){this._tf.strokeColor=value;});__getset(0,__proto,'textField',function(){return this._tf;});__getset(0,__proto,'measureWidth',function(){return this._tf.width;});__getset(0,__proto,'measureHeight',function(){return this._tf.height;});__getset(0,__proto,'width',function(){if(this._width||this._tf.text)return Laya.superGet(Component,this,'width');return 0;},function(value){Laya.superSet(Component,this,'width',value);this._tf.width=value;});__getset(0,__proto,'height',function(){if(this._height||this._tf.text)return Laya.superGet(Component,this,'height');return 0;},function(value){Laya.superSet(Component,this,'height',value);this._tf.height=value;});__getset(0,__proto,'overflow',function(){return this._tf.overflow;},function(value){this._tf.overflow=value;});__getset(0,__proto,'underline',function(){return this._tf.underline;},function(value){this._tf.underline=value;});__getset(0,__proto,'underlineColor',function(){return this._tf.underlineColor;},function(value){this._tf.underlineColor=value;});return Label;})(Component)
var ProgressBar=(function(_super){function ProgressBar(skin){this.changeHandler=null;this._bg=null;this._bar=null;this._skin=null;this._value=0.5;ProgressBar.__super.call(this);this.skin=skin;}
__class(ProgressBar,'laya.ui.ProgressBar',_super);var __proto=ProgressBar.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._bg&&this._bg.destroy(destroyChild);this._bar&&this._bar.destroy(destroyChild);this._bg=this._bar=null;this.changeHandler=null;}
__proto.createChildren=function(){this.addChild(this._bg=new Image());this.addChild(this._bar=new Image());this._bar._bitmap.autoCacheCmd=false;}
__proto.changeValue=function(){if(this.sizeGrid){var grid=this.sizeGrid.split(",");var left=Number(grid[3]);var right=Number(grid[1]);var max=this.width-left-right;var sw=max*this._value;this._bar.width=left+right+sw;this._bar.visible=this._bar.width>left+right;}else{this._bar.width=this.width*this._value;}}
__getset(0,__proto,'measureHeight',function(){return this._bg.height;});__getset(0,__proto,'skin',function(){return this._skin;},function(value){if(this._skin!=value){this._skin=value;this._bg.skin=this._skin;this._bar.skin=this._skin.replace(".png","$bar.png");this.callLater(this.changeValue);}});__getset(0,__proto,'measureWidth',function(){return this._bg.width;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Component,this,'height',value);this._bg.height=this._height;this._bar.height=this._height;});__getset(0,__proto,'bar',function(){return this._bar;});__getset(0,__proto,'value',function(){return this._value;},function(num){if(this._value!=num){num=num>1?1:num<0?0:num;this._value=num;this.callLater(this.changeValue);this.event("change");this.changeHandler&&this.changeHandler.runWith(num);}});__getset(0,__proto,'bg',function(){return this._bg;});__getset(0,__proto,'sizeGrid',function(){return this._bg.sizeGrid;},function(value){this._bg.sizeGrid=this._bar.sizeGrid=value;});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Component,this,'width',value);this._bg.width=this._width;this.callLater(this.changeValue);});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if((typeof value=='number')||(typeof value=='string'))this.value=Number(value);else Laya.superSet(Component,this,'dataSource',value);});return ProgressBar;})(Component)
var TipManager=(function(_super){function TipManager(){this._tipBox=null;this._tipText=null;this._defaultTipHandler=null;TipManager.__super.call(this);this._tipBox=new Component();this._tipBox.addChild(this._tipText=new Text());this._tipText.x=this._tipText.y=5;this._tipText.color=TipManager.tipTextColor;this._defaultTipHandler=this._showDefaultTip;Laya.stage.on("showtip",this,this._onStageShowTip);Laya.stage.on("hidetip",this,this._onStageHideTip);this.zOrder=1100}
__class(TipManager,'laya.ui.TipManager',_super);var __proto=TipManager.prototype;__proto._onStageHideTip=function(e){Laya.timer.clear(this,this._showTip);this.closeAll();this.removeSelf();}
__proto._onStageShowTip=function(data){Laya.timer.once(TipManager.tipDelay,this,this._showTip,[data],true);}
__proto._showTip=function(tip){if((typeof tip=='string')){var text=String(tip);if(Boolean(text)){this._defaultTipHandler(text);}}else if((tip instanceof laya.utils.Handler)){(tip).run();}else if((typeof tip=='function')){(tip).apply();}
if(true){Laya.stage.on("mousemove",this,this._onStageMouseMove);Laya.stage.on("mousedown",this,this._onStageMouseDown);}
this._onStageMouseMove(null);}
__proto._onStageMouseDown=function(e){this.closeAll();}
__proto._onStageMouseMove=function(e){this._showToStage(this,TipManager.offsetX,TipManager.offsetY);}
__proto._showToStage=function(dis,offX,offY){(offX===void 0)&&(offX=0);(offY===void 0)&&(offY=0);var rec=dis.getBounds();dis.x=Laya.stage.mouseX+offX;dis.y=Laya.stage.mouseY+offY;if(dis.x+rec.width>Laya.stage.width){dis.x-=rec.width+offX;}
if(dis.y+rec.height>Laya.stage.height){dis.y-=rec.height+offY;}}
__proto.closeAll=function(){Laya.timer.clear(this,this._showTip);Laya.stage.off("mousemove",this,this._onStageMouseMove);Laya.stage.off("mousedown",this,this._onStageMouseDown);this.removeChildren();}
__proto.showDislayTip=function(tip){this.addChild(tip);this._showToStage(this);Laya._currentStage.addChild(this);}
__proto._showDefaultTip=function(text){this._tipText.text=text;var g=this._tipBox.graphics;g.clear();g.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,TipManager.tipBackColor);this.addChild(this._tipBox);this._showToStage(this);Laya._currentStage.addChild(this);}
__getset(0,__proto,'defaultTipHandler',function(){return this._defaultTipHandler;},function(value){this._defaultTipHandler=value;});TipManager.offsetX=10;TipManager.offsetY=15;TipManager.tipTextColor="#ffffff";TipManager.tipBackColor="#111111";TipManager.tipDelay=200;return TipManager;})(Component)
var View=(function(_super){var DataWatcher;function View(){this._idMap=null;this._aniList=null;this._watchMap={};View.__super.call(this);}
__class(View,'laya.ui.View',_super);var __proto=View.prototype;__proto.createView=function(uiView){if(uiView.animations&&!this._idMap)this._idMap={};View.createComp(uiView,this,this);if(uiView.animations){var anilist=[];var animations=uiView.animations;var i=0,len=animations.length;var tAni;var tAniO;for(i=0;i<len;i++){tAni=new FrameAnimation();tAniO=animations[i];tAni._setUp(this._idMap,tAniO);this[tAniO.name]=tAni;tAni._setControlNode(this);switch(tAniO.action){case 1:tAni.play(0,false);break;case 2:tAni.play(0,true);break;}
anilist.push(tAni);}
this._aniList=anilist;}
if(this._width>0&&uiView.props.hitTestPrior==null&&!this.mouseThrough)this.hitTestPrior=true;}
__proto.onEvent=function(type,event){}
__proto.loadUI=function(path){var uiView=View.uiMap[path];uiView&&this.createView(uiView);}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);if(this._aniList)this._aniList.length=0;this._idMap=null;this._aniList=null;this._watchMap=null;laya.ui.Component.prototype.destroy.call(this,destroyChild);}
__proto.changeData=function(key){var arr=this._watchMap[key];if(!arr)return;console.log("change",key);for(var i=0,n=arr.length;i<n;i++){var watcher=arr[i];watcher.exe(this);}}
View._regs=function(){for(var key in View.uiClassMap){ClassUtils.regClass(key,View.uiClassMap[key]);}}
View.createComp=function(uiView,comp,view,dataMap){comp=comp||View.getCompInstance(uiView);if(!comp){console.warn("can not create:"+uiView.type);return null;};var child=uiView.child;if(child){var isList=(comp instanceof laya.ui.List);for(var i=0,n=child.length;i<n;i++){var node=child[i];if(comp.hasOwnProperty("itemRender")&&(node.props.name=="render"||node.props.renderType==="render")){(comp).itemRender=node;}else if(node.type=="Graphic"){ClassUtils.addGraphicsToSprite(node,comp);}else if(ClassUtils.isDrawType(node.type)){ClassUtils.addGraphicToSprite(node,comp,true);}else{if(isList){var arr=[];var tChild=View.createComp(node,null,view,arr);if(arr.length)tChild["_$bindData"]=arr;}else{tChild=View.createComp(node,null,view,dataMap);}
if(node.type=="Script"){if("owner"in tChild){tChild["owner"]=comp;}else if("target"in tChild){tChild["target"]=comp;}}else if(node.props.renderType=="mask"||node.props.name=="mask"){comp.mask=tChild;}else{(tChild instanceof laya.display.Sprite)&&comp.addChild(tChild);}}}};var props=uiView.props;for(var prop in props){var value=props[prop];if(View.eventDic[prop]){if(value&&view){(comp).on(prop,view,view.onEvent,[value]);}}else
View.setCompValue(comp,prop,value,view,dataMap);}
if(Laya.__typeof(comp,'laya.ui.IItem'))(comp).initItems();if(uiView.compId&&view&&view._idMap){view._idMap[uiView.compId]=comp;}
return comp;}
View.setCompValue=function(comp,prop,value,view,dataMap){if((typeof value=='string')&&value.indexOf("${")>-1){View._sheet||(View._sheet=ClassUtils.getClass("laya.data.Table"));if(!View._sheet){console.warn("Can not find class Sheet");return;}
if(dataMap){dataMap.push(comp,prop,value);}else if(view){if(value.indexOf("].")==-1){value=value.replace(".","[0].");};var watcher=new DataWatcher(comp,prop,value);watcher.exe(view);var one,temp;var str=value.replace(/\[.*?\]\./g,".");while((one=View._parseWatchData.exec(str))!=null){var key1=one[1];while((temp=View._parseKeyWord.exec(key1))!=null){var key2=temp[0];var arr=(view._watchMap[key2]||(view._watchMap[key2]=[]));arr.push(watcher);View._sheet.I.notifer.on(key2,view,view.changeData,[key2]);}
arr=(view._watchMap[key1]||(view._watchMap[key1]=[]));arr.push(watcher);View._sheet.I.notifer.on(key1,view,view.changeData,[key1]);}}
return;}
if(prop==="var"&&view){view[value]=comp;}else if(prop=="onClick"){var fun=Browser.window.eval("(function(){"+value+"})");comp.on("click",view,fun);}else{comp[prop]=(value==="true"?true:(value==="false"?false:value));}}
View.getCompInstance=function(json){var runtime=json.props?json.props.runtime:null;var compClass;compClass=runtime?(View.viewClassMap[runtime]||View.uiClassMap[runtime]||Laya["__classmap"][runtime]):View.uiClassMap[json.type];if(json.props&&json.props.hasOwnProperty("renderType")&&json.props["renderType"]=="instance")return compClass["instance"];return compClass?new compClass():null;}
View.regComponent=function(key,compClass){View.uiClassMap[key]=compClass;ClassUtils.regClass(key,compClass);}
View.regViewRuntime=function(key,compClass){View.viewClassMap[key]=compClass;}
View.uiMap={};View.viewClassMap={};View._sheet=null;__static(View,['uiClassMap',function(){return this.uiClassMap={"ViewStack":ViewStack,"LinkButton":Button,"TextArea":TextArea,"ColorPicker":ColorPicker,"Box":Box,"Button":Button,"CheckBox":CheckBox,"Clip":Clip,"ComboBox":ComboBox,"Component":Component,"HScrollBar":HScrollBar,"HSlider":HSlider,"Image":Image,"Label":Label,"List":List,"Panel":Panel,"ProgressBar":ProgressBar,"Radio":Radio,"RadioGroup":RadioGroup,"ScrollBar":ScrollBar,"Slider":Slider,"Tab":Tab,"TextInput":TextInput,"View":View,"VScrollBar":VScrollBar,"VSlider":VSlider,"Tree":Tree,"HBox":HBox,"VBox":VBox,"Sprite":Sprite,"Animation":Animation,"Text":Text,"FontClip":FontClip};},'eventDic',function(){return this.eventDic={"mousedown":true,"mouseup":true,"mousemove":true,"mouseover":true,"mouseout":true,"click":true,"doubleclick":true,"rightmousedown":true,"rightmouseup":true,"rightclick":true};},'_parseWatchData',function(){return this._parseWatchData=/\${(.*?)}/g;},'_parseKeyWord',function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g;}]);View.__init$=function(){View._regs()
DataWatcher=(function(){function DataWatcher(comp,prop,value){this.comp=null;this.prop=null;this.value=null;this.comp=comp;this.prop=prop;this.value=value;}
__class(DataWatcher,'');var __proto=DataWatcher.prototype;__proto.exe=function(view){var fun=UIUtils.getBindFun(this.value);this.comp[this.prop]=fun.call(this,view);}
return DataWatcher;})()}
return View;})(Box)
var CheckBox=(function(_super){function CheckBox(skin,label){(label===void 0)&&(label="");CheckBox.__super.call(this,skin,label);}
__class(CheckBox,'laya.ui.CheckBox',_super);var __proto=CheckBox.prototype;__proto.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this);this.toggle=true;this._autoSize=false;}
__proto.initialize=function(){_super.prototype.initialize.call(this);this.createText();this._text.align="left";this._text.valign="top";this._text.width=0;}
__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if((typeof value=='boolean'))this.selected=value;else if((typeof value=='string'))this.selected=value==="true";else Laya.superSet(Button,this,'dataSource',value);});return CheckBox;})(Button)
var LayoutBox=(function(_super){function LayoutBox(){this._space=0;this._align="none";this._itemChanged=false;LayoutBox.__super.call(this);}
__class(LayoutBox,'laya.ui.LayoutBox',_super);var __proto=LayoutBox.prototype;__proto.addChild=function(child){child.on("resize",this,this.onResize);this._setItemChanged();return laya.display.Node.prototype.addChild.call(this,child);}
__proto.onResize=function(e){this._setItemChanged();}
__proto.addChildAt=function(child,index){child.on("resize",this,this.onResize);this._setItemChanged();return laya.display.Node.prototype.addChildAt.call(this,child,index);}
__proto.removeChild=function(child){child.off("resize",this,this.onResize);this._setItemChanged();return laya.display.Node.prototype.removeChild.call(this,child);}
__proto.removeChildAt=function(index){this.getChildAt(index).off("resize",this,this.onResize);this._setItemChanged();return laya.display.Node.prototype.removeChildAt.call(this,index);}
__proto.refresh=function(){this._setItemChanged();}
__proto.changeItems=function(){this._itemChanged=false;}
__proto.sortItem=function(items){if(items)items.sort(function(a,b){return a.y-b.y;});}
__proto._setItemChanged=function(){if(!this._itemChanged){this._itemChanged=true;this.callLater(this.changeItems);}}
__getset(0,__proto,'space',function(){return this._space;},function(value){this._space=value;this._setItemChanged();});__getset(0,__proto,'align',function(){return this._align;},function(value){this._align=value;this._setItemChanged();});return LayoutBox;})(Box)
var FontClip=(function(_super){function FontClip(skin,sheet){this._valueArr=null;this._indexMap=null;this._sheet=null;this._direction="horizontal";this._spaceX=0;this._spaceY=0;this._align="left";this._wordsW=0;this._wordsH=0;FontClip.__super.call(this);if(skin)this.skin=skin;if(sheet)this.sheet=sheet;}
__class(FontClip,'laya.ui.FontClip',_super);var __proto=FontClip.prototype;__proto.createChildren=function(){this._bitmap=new AutoBitmap();this.on("loaded",this,this._onClipLoaded);}
__proto._onClipLoaded=function(){this.callLater(this.changeValue);}
__proto.changeValue=function(){if(!this._sources)return;if(!this._valueArr)return;this.graphics.clear(true);var texture;texture=this._sources[0];if(!texture)return;var isHorizontal=(this._direction==="horizontal");if(isHorizontal){this._wordsW=this._valueArr.length*(texture.sourceWidth+this.spaceX);this._wordsH=texture.sourceHeight;}else{this._wordsW=texture.sourceWidth;this._wordsH=(texture.sourceHeight+this.spaceY)*this._valueArr.length;};var dX=0;if(this._width){switch(this._align){case"center":dX=0.5*(this._width-this._wordsW);break;case"right":dX=this._width-this._wordsW;break;default:dX=0;}}
for(var i=0,sz=this._valueArr.length;i<sz;i++){var index=this._indexMap[this._valueArr.charAt(i)];if(!this.sources[index])continue;texture=this.sources[index];if(isHorizontal)this.graphics.drawTexture(texture,dX+i*(texture.sourceWidth+this.spaceX),0,texture.sourceWidth,texture.sourceHeight);else this.graphics.drawTexture(texture,0+dX,i*(texture.sourceHeight+this.spaceY),texture.sourceWidth,texture.sourceHeight);}
if(!this._width){this.resetLayoutX();this.callLater(this.changeSize);}
if(!this._height){this.resetLayoutY();this.callLater(this.changeSize);}}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);this._valueArr=null;this._indexMap=null;this.graphics.clear(true);this.removeSelf();this.off("loaded",this,this._onClipLoaded);_super.prototype.destroy.call(this,destroyChild);}
__getset(0,__proto,'sheet',function(){return this._sheet;},function(value){value+="";this._sheet=value;var arr=value.split(" ");this._clipX=String(arr[0]).length;this.clipY=arr.length;this._indexMap={};for(var i=0;i<this._clipY;i++){var line=arr[i].split("");for(var j=0,n=line.length;j<n;j++){this._indexMap[line[j]]=i*this._clipX+j;}}});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Clip,this,'height',value);this.callLater(this.changeValue);});__getset(0,__proto,'direction',function(){return this._direction;},function(value){this._direction=value;this.callLater(this.changeValue);});__getset(0,__proto,'value',function(){if(!this._valueArr)return"";return this._valueArr;},function(value){value+="";this._valueArr=value;this.callLater(this.changeValue);});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Clip,this,'width',value);this.callLater(this.changeValue);});__getset(0,__proto,'spaceX',function(){return this._spaceX;},function(value){this._spaceX=value;if(this._direction==="horizontal")this.callLater(this.changeValue);});__getset(0,__proto,'spaceY',function(){return this._spaceY;},function(value){this._spaceY=value;if(!(this._direction==="horizontal"))this.callLater(this.changeValue);});__getset(0,__proto,'align',function(){return this._align;},function(v){this._align=v;this.callLater(this.changeValue);});__getset(0,__proto,'measureWidth',function(){return this._wordsW;});__getset(0,__proto,'measureHeight',function(){return this._wordsH;});return FontClip;})(Clip)
var List=(function(_super){function List(){this.selectHandler=null;this.renderHandler=null;this.mouseHandler=null;this.selectEnable=false;this.totalPage=0;this._content=null;this._scrollBar=null;this._itemRender=null;this._repeatX=0;this._repeatY=0;this._repeatX2=0;this._repeatY2=0;this._spaceX=0;this._spaceY=0;this._array=null;this._startIndex=0;this._selectedIndex=-1;this._page=0;this._isVertical=true;this._cellSize=20;this._cellOffset=0;this._isMoved=false;this.cacheContent=false;this._createdLine=0;this._cellChanged=false;List.__super.call(this);this._cells=[];this._offset=new Point();}
__class(List,'laya.ui.List',_super);var __proto=List.prototype;Laya.imps(__proto,{"laya.ui.IRender":true,"laya.ui.IItem":true})
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);this._content&&this._content.destroy(destroyChild);this._scrollBar&&this._scrollBar.destroy(destroyChild);laya.ui.Component.prototype.destroy.call(this,destroyChild);this._content=null;this._scrollBar=null;this._itemRender=null;this._cells=null;this._array=null;this.selectHandler=this.renderHandler=this.mouseHandler=null;}
__proto.createChildren=function(){this.addChild(this._content=new Box());}
__proto.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=Laya.superGet(Box,this,'cacheAs'));Laya.superSet(Box,this,'cacheAs',"none");this._scrollBar.once("end",this,this.onScrollEnd);}
__proto.onScrollEnd=function(){Laya.superSet(Box,this,'cacheAs',this._$P.cacheAs);}
__proto._removePreScrollBar=function(){var preNode=this.removeChildByName("scrollBar");if(preNode)preNode.destroy(true);}
__proto.changeCells=function(){this._cellChanged=false;if(this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var cell=this._getOneCell();var cellWidth=(cell.width+this._spaceX)||1;var cellHeight=(cell.height+this._spaceY)||1;if(this._width>0)this._repeatX2=this._isVertical?Math.round(this._width/cellWidth):Math.ceil(this._width/cellWidth);if(this._height>0)this._repeatY2=this._isVertical?Math.ceil(this._height/cellHeight):Math.round(this._height/cellHeight);var listWidth=this._width?this._width:(cellWidth*this.repeatX-this._spaceX);var listHeight=this._height?this._height:(cellHeight*this.repeatY-this._spaceY);this._cellSize=this._isVertical?cellHeight:cellWidth;this._cellOffset=this._isVertical?(cellHeight*Math.max(this._repeatY2,this._repeatY)-listHeight-this._spaceY):(cellWidth*Math.max(this._repeatX2,this._repeatX)-listWidth-this._spaceX);if(this._isVertical&&this._scrollBar)this._scrollBar.height=listHeight;else if(!this._isVertical&&this._scrollBar)this._scrollBar.width=listWidth;this.setContentSize(listWidth,listHeight);var numX=this._isVertical?this.repeatX:this.repeatY;var numY=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,numX,numY);this._createdLine=numY;if(this._array){this.array=this._array;this.runCallLater(this.renderItems);}}}
__proto._getOneCell=function(){if(this._cells.length===0){var item=this.createItem();this._offset.setTo(item.x,item.y);if(this.cacheContent)return item;this._cells.push(item);}
return this._cells[0];}
__proto._createItems=function(startY,numX,numY){var box=this._content;var cell=this._getOneCell();var cellWidth=cell.width+this._spaceX;var cellHeight=cell.height+this._spaceY;if(this.cacheContent){var cacheBox=new Box();cacheBox.cacheAsBitmap=true;cacheBox.pos((this._isVertical?0:startY)*cellWidth,(this._isVertical?startY:0)*cellHeight);this._content.addChild(cacheBox);this._content.optimizeScrollRect=true;box=cacheBox;}else{var arr=[];for(var i=this._cells.length-1;i>-1;i--){var item=this._cells[i];item.removeSelf();arr.push(item);}
this._cells.length=0;}
for(var k=startY;k<numY;k++){for(var l=0;l<numX;l++){if(arr&&arr.length){cell=arr.pop();}else{cell=this.createItem();}
cell.x=(this._isVertical?l:k)*cellWidth-box.x;cell.y=(this._isVertical?k:l)*cellHeight-box.y;cell.name="item"+(k*numX+l);box.addChild(cell);this.addCell(cell);}}}
__proto.createItem=function(){var arr=[];if((typeof this._itemRender=='function')){var box=new this._itemRender();}else{box=View.createComp(this._itemRender,null,null,arr)}
if(arr.length==0&&box._watchMap){var watchMap=box._watchMap;for(var name in watchMap){var a=watchMap[name];for(var i=0;i<a.length;i++){var watcher=a[i];arr.push(watcher.comp,watcher.prop,watcher.value)}}}
if(arr.length)box["_$bindData"]=arr;return box;}
__proto.addCell=function(cell){cell.on("click",this,this.onCellMouse);cell.on("rightclick",this,this.onCellMouse);cell.on("mouseover",this,this.onCellMouse);cell.on("mouseout",this,this.onCellMouse);cell.on("mousedown",this,this.onCellMouse);cell.on("mouseup",this,this.onCellMouse);this._cells.push(cell);}
__proto.initItems=function(){if(!this._itemRender&&this.getChildByName("item0")!=null){this.repeatX=1;var count=0;count=0;for(var i=0;i<10000;i++){var cell=this.getChildByName("item"+i);if(cell){this.addCell(cell);count++;continue;}
break;}
this.repeatY=count;}}
__proto.setContentSize=function(width,height){this._content.width=width;this._content.height=height;if(this._scrollBar||this._offset.x!=0||this._offset.y!=0){this._content.scrollRect||(this._content.scrollRect=new Rectangle());this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,width,height);this._content.scrollRect=this._content.scrollRect;}
this.event("resize");}
__proto.onCellMouse=function(e){if(e.type==="mousedown")this._isMoved=false;var cell=e.currentTarget;var index=this._startIndex+this._cells.indexOf(cell);if(index<0)return;if(e.type==="click"||e.type==="rightclick"){if(this.selectEnable&&!this._isMoved)this.selectedIndex=index;else this.changeCellState(cell,true,0);}else if((e.type==="mouseover"||e.type==="mouseout")&&this._selectedIndex!==index){this.changeCellState(cell,e.type==="mouseover",0);}
this.mouseHandler&&this.mouseHandler.runWith([e,index]);}
__proto.changeCellState=function(cell,visable,index){var selectBox=cell.getChildByName("selectBox");if(selectBox){this.selectEnable=true;selectBox.visible=visable;selectBox.index=index;}}
__proto.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this);this.setContentSize(this.width,this.height);if(this._scrollBar)this.callLater(this.onScrollBarChange);}
__proto.onScrollBarChange=function(e){this.runCallLater(this.changeCells);var scrollValue=this._scrollBar.value;var lineX=(this._isVertical?this.repeatX:this.repeatY);var lineY=(this._isVertical?this.repeatY:this.repeatX);var scrollLine=Math.floor(scrollValue/this._cellSize);if(!this.cacheContent){var index=scrollLine*lineX;var num=0;if(index>this._startIndex){num=index-this._startIndex;var down=true;var toIndex=this._startIndex+lineX*(lineY+1);this._isMoved=true;}else if(index<this._startIndex){num=this._startIndex-index;down=false;toIndex=this._startIndex-1;this._isMoved=true;}
for(var i=0;i<num;i++){if(down){var cell=this._cells.shift();this._cells[this._cells.length]=cell;var cellIndex=toIndex+i;}else{cell=this._cells.pop();this._cells.unshift(cell);cellIndex=toIndex-i;};var pos=Math.floor(cellIndex/lineX)*this._cellSize;this._isVertical?cell.y=pos:cell.x=pos;this.renderItem(cell,cellIndex);}
this._startIndex=index;this.changeSelectStatus();}else{num=(lineY+1);if(this._createdLine-scrollLine<num){this._createItems(this._createdLine,lineX,this._createdLine+num);this.renderItems(this._createdLine*lineX,0);this._createdLine+=num;}};var r=this._content.scrollRect;if(this._isVertical){r.y=scrollValue-this._offset.y;r.x=-this._offset.x;}else{r.y=-this._offset.y;r.x=scrollValue-this._offset.x;}
this._content.scrollRect=r;}
__proto.posCell=function(cell,cellIndex){if(!this._scrollBar)return;var lineX=(this._isVertical?this.repeatX:this.repeatY);var lineY=(this._isVertical?this.repeatY:this.repeatX);var pos=Math.floor(cellIndex/lineX)*this._cellSize;this._isVertical?cell.y=pos:cell.x=pos;}
__proto.changeSelectStatus=function(){for(var i=0,n=this._cells.length;i<n;i++){this.changeCellState(this._cells[i],this._selectedIndex===this._startIndex+i,1);}}
__proto.renderItems=function(from,to){(from===void 0)&&(from=0);(to===void 0)&&(to=0);for(var i=from,n=to||this._cells.length;i<n;i++){this.renderItem(this._cells[i],this._startIndex+i);}
this.changeSelectStatus();}
__proto.renderItem=function(cell,index){if(this._array&&index>=0&&index<this._array.length){cell.visible=true;if(cell._$bindData){cell._dataSource=this._array[index];this._bindData(cell,this._array[index]);}else cell.dataSource=this._array[index];if(!this.cacheContent){this.posCell(cell,index);}
if(this.hasListener("render"))this.event("render",[cell,index]);if(this.renderHandler)this.renderHandler.runWith([cell,index]);}else{cell.visible=false;cell.dataSource=null;}}
__proto._bindData=function(cell,data){var arr=cell._$bindData;for(var i=0,n=arr.length;i<n;i++){var ele=arr[i++];var prop=arr[i++];var value=arr[i];var fun=UIUtils.getBindFun(value);ele[prop]=fun.call(this,data);}}
__proto.refresh=function(){this.array=this._array;}
__proto.getItem=function(index){if(index>-1&&index<this._array.length){return this._array[index];}
return null;}
__proto.changeItem=function(index,source){if(index>-1&&index<this._array.length){this._array[index]=source;if(index>=this._startIndex&&index<this._startIndex+this._cells.length){this.renderItem(this.getCell(index),index);}}}
__proto.setItem=function(index,source){this.changeItem(index,source);}
__proto.addItem=function(souce){this._array.push(souce);this.array=this._array;}
__proto.addItemAt=function(souce,index){this._array.splice(index,0,souce);this.array=this._array;}
__proto.deleteItem=function(index){this._array.splice(index,1);this.array=this._array;}
__proto.getCell=function(index){this.runCallLater(this.changeCells);if(index>-1&&this._cells){return this._cells[(index-this._startIndex)%this._cells.length];}
return null;}
__proto.scrollTo=function(index){if(this._scrollBar){var numX=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(index/numX)*this._cellSize;}else{this.startIndex=index;}}
__proto.tweenTo=function(index,time,complete){(time===void 0)&&(time=200);if(this._scrollBar){var numX=this._isVertical?this.repeatX:this.repeatY;Tween.to(this._scrollBar,{value:Math.floor(index/numX)*this._cellSize},time,null,complete,0,true);}else{this.startIndex=index;if(complete)complete.run();}}
__proto._setCellChanged=function(){if(!this._cellChanged){this._cellChanged=true;this.callLater(this.changeCells);}}
__proto.commitMeasure=function(){this.runCallLater(this.changeCells);}
__getset(0,__proto,'cacheAs',_super.prototype._$get_cacheAs,function(value){Laya.superSet(Box,this,'cacheAs',value);if(this._scrollBar){this._$P.cacheAs=null;if(value!=="none")this._scrollBar.on("start",this,this.onScrollStart);else this._scrollBar.off("start",this,this.onScrollStart);}});__getset(0,__proto,'content',function(){return this._content;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){if(value!=this._height){Laya.superSet(Box,this,'height',value);this._setCellChanged();}});__getset(0,__proto,'itemRender',function(){return this._itemRender;},function(value){if(this._itemRender!=value){this._itemRender=value;for(var i=this._cells.length-1;i>-1;i--){this._cells[i].destroy();}
this._cells.length=0;this._setCellChanged();}});__getset(0,__proto,'vScrollBarSkin',function(){return this._scrollBar?this._scrollBar.skin:null;},function(value){this._removePreScrollBar();var scrollBar=new VScrollBar();scrollBar.name="scrollBar";scrollBar.right=0;if(value&&value!=" ")
scrollBar.skin=value;this.scrollBar=scrollBar;this.addChild(scrollBar);this._setCellChanged();});__getset(0,__proto,'page',function(){return this._page;},function(value){this._page=value
if(this._array){this._page=value>0?value:0;this._page=this._page<this.totalPage?this._page:this.totalPage-1;this.startIndex=this._page*this.repeatX*this.repeatY;}});__getset(0,__proto,'hScrollBarSkin',function(){return this._scrollBar?this._scrollBar.skin:null;},function(value){this._removePreScrollBar();var scrollBar=new HScrollBar();scrollBar.name="scrollBar";scrollBar.bottom=0;if(value&&value!=" ")
scrollBar.skin=value;this.scrollBar=scrollBar;this.addChild(scrollBar);this._setCellChanged();});__getset(0,__proto,'repeatX',function(){return this._repeatX>0?this._repeatX:this._repeatX2>0?this._repeatX2:1;},function(value){this._repeatX=value;this._setCellChanged();});__getset(0,__proto,'scrollBar',function(){return this._scrollBar;},function(value){if(this._scrollBar!=value){this._scrollBar=value;if(value){this._isVertical=this._scrollBar.isVertical;this.addChild(this._scrollBar);this._scrollBar.on("change",this,this.onScrollBarChange);}}});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){if(value!=this._width){Laya.superSet(Box,this,'width',value);this._setCellChanged();}});__getset(0,__proto,'repeatY',function(){return this._repeatY>0?this._repeatY:this._repeatY2>0?this._repeatY2:1;},function(value){this._repeatY=value;this._setCellChanged();});__getset(0,__proto,'spaceX',function(){return this._spaceX;},function(value){this._spaceX=value;this._setCellChanged();});__getset(0,__proto,'spaceY',function(){return this._spaceY;},function(value){this._spaceY=value;this._setCellChanged();});__getset(0,__proto,'selectedIndex',function(){return this._selectedIndex;},function(value){if(this._selectedIndex!=value){this._selectedIndex=value;this.changeSelectStatus();this.event("change");this.selectHandler&&this.selectHandler.runWith(value);this.startIndex=this._startIndex;}});__getset(0,__proto,'selectedItem',function(){return this._selectedIndex!=-1?this._array[this._selectedIndex]:null;},function(value){this.selectedIndex=this._array.indexOf(value);});__getset(0,__proto,'length',function(){return this._array?this._array.length:0;});__getset(0,__proto,'selection',function(){return this.getCell(this._selectedIndex);},function(value){this.selectedIndex=this._startIndex+this._cells.indexOf(value);});__getset(0,__proto,'startIndex',function(){return this._startIndex;},function(value){this._startIndex=value>0?value:0;this.callLater(this.renderItems);});__getset(0,__proto,'array',function(){return this._array;},function(value){this.runCallLater(this.changeCells);this._array=value||[];var length=this._array.length;this.totalPage=Math.ceil(length/(this.repeatX*this.repeatY));this._selectedIndex=this._selectedIndex<length?this._selectedIndex:length-1;this.startIndex=this._startIndex;if(this._scrollBar){this._scrollBar.stopScroll();var numX=this._isVertical?this.repeatX:this.repeatY;var numY=this._isVertical?this.repeatY:this.repeatX;var lineCount=Math.ceil(length/numX);var total=this._cellOffset>0?this.totalPage+1:this.totalPage;if(total>1){this._scrollBar.scrollSize=this._cellSize;this._scrollBar.thumbPercent=numY/lineCount;this._scrollBar.setScroll(0,(lineCount-numY)*this._cellSize+this._cellOffset,this._scrollBar.value);this._scrollBar.target=this._content;}else{this._scrollBar.setScroll(0,0,0);this._scrollBar.target=this._content;}}});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if(((typeof value=='number')&&Math.floor(value)==value)||(typeof value=='string'))this.selectedIndex=parseInt(value);else if((value instanceof Array))this.array=value
else Laya.superSet(Box,this,'dataSource',value);});__getset(0,__proto,'cells',function(){this.runCallLater(this.changeCells);return this._cells;});return List;})(Box)
var HScrollBar=(function(_super){function HScrollBar(){HScrollBar.__super.call(this);;}
__class(HScrollBar,'laya.ui.HScrollBar',_super);var __proto=HScrollBar.prototype;__proto.initialize=function(){_super.prototype.initialize.call(this);this.slider.isVertical=false;}
return HScrollBar;})(ScrollBar)
var Panel=(function(_super){function Panel(){this._content=null;this._vScrollBar=null;this._hScrollBar=null;this._scrollChanged=false;Panel.__super.call(this);this.width=this.height=100;}
__class(Panel,'laya.ui.Panel',_super);var __proto=Panel.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);laya.ui.Component.prototype.destroy.call(this,destroyChild);this._content&&this._content.destroy(destroyChild);this._vScrollBar&&this._vScrollBar.destroy(destroyChild);this._hScrollBar&&this._hScrollBar.destroy(destroyChild);this._vScrollBar=null;this._hScrollBar=null;this._content=null;}
__proto.destroyChildren=function(){this._content.destroyChildren();}
__proto.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new Box());}
__proto.addChild=function(child){child.on("resize",this,this.onResize);this._setScrollChanged();return this._content.addChild(child);}
__proto.onResize=function(){this._setScrollChanged();}
__proto.addChildAt=function(child,index){child.on("resize",this,this.onResize);this._setScrollChanged();return this._content.addChildAt(child,index);}
__proto.removeChild=function(child){child.off("resize",this,this.onResize);this._setScrollChanged();return this._content.removeChild(child);}
__proto.removeChildAt=function(index){this.getChildAt(index).off("resize",this,this.onResize);this._setScrollChanged();return this._content.removeChildAt(index);}
__proto.removeChildren=function(beginIndex,endIndex){(beginIndex===void 0)&&(beginIndex=0);(endIndex===void 0)&&(endIndex=0x7fffffff);for(var i=this._content.numChildren-1;i>-1;i--){this._content.removeChildAt(i);}
this._setScrollChanged();return this;}
__proto.getChildAt=function(index){return this._content.getChildAt(index);}
__proto.getChildByName=function(name){return this._content.getChildByName(name);}
__proto.getChildIndex=function(child){return this._content.getChildIndex(child);}
__proto.changeScroll=function(){this._scrollChanged=false;var contentW=this.contentWidth||1;var contentH=this.contentHeight||1;var vscroll=this._vScrollBar;var hscroll=this._hScrollBar;var vShow=vscroll&&contentH>this._height;var hShow=hscroll&&contentW>this._width;var showWidth=vShow?this._width-vscroll.width:this._width;var showHeight=hShow?this._height-hscroll.height:this._height;if(vscroll){vscroll.x=this._width-vscroll.width;vscroll.y=0;vscroll.height=this._height-(hShow?hscroll.height:0);vscroll.scrollSize=Math.max(this._height*0.033,1);vscroll.thumbPercent=showHeight/contentH;vscroll.setScroll(0,contentH-showHeight,vscroll.value);}
if(hscroll){hscroll.x=0;hscroll.y=this._height-hscroll.height;hscroll.width=this._width-(vShow?vscroll.width:0);hscroll.scrollSize=Math.max(this._width*0.033,1);hscroll.thumbPercent=showWidth/contentW;hscroll.setScroll(0,contentW-showWidth,hscroll.value);}}
__proto.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this);this.setContentSize(this._width,this._height);}
__proto.setContentSize=function(width,height){var content=this._content;content.width=width;content.height=height;content.scrollRect||(content.scrollRect=new Rectangle());content.scrollRect.setTo(0,0,width,height);content.scrollRect=content.scrollRect;}
__proto.onScrollBarChange=function(scrollBar){var rect=this._content.scrollRect;if(rect){var start=Math.round(scrollBar.value);scrollBar.isVertical?rect.y=start:rect.x=start;this._content.scrollRect=rect;}}
__proto.scrollTo=function(x,y){(x===void 0)&&(x=0);(y===void 0)&&(y=0);if(this.vScrollBar)this.vScrollBar.value=y;if(this.hScrollBar)this.hScrollBar.value=x;}
__proto.refresh=function(){this.changeScroll();}
__proto.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=Laya.superGet(Box,this,'cacheAs'));Laya.superSet(Box,this,'cacheAs',"none");this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd);this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd);}
__proto.onScrollEnd=function(){Laya.superSet(Box,this,'cacheAs',this._$P.cacheAs);}
__proto._setScrollChanged=function(){if(!this._scrollChanged){this._scrollChanged=true;this.callLater(this.changeScroll);}}
__getset(0,__proto,'numChildren',function(){return this._content.numChildren;});__getset(0,__proto,'hScrollBarSkin',function(){return this._hScrollBar?this._hScrollBar.skin:null;},function(value){if(this._hScrollBar==null){laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new HScrollBar());this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]);this._hScrollBar.target=this._content;this._setScrollChanged();}
this._hScrollBar.skin=value;});__getset(0,__proto,'contentWidth',function(){var max=0;for(var i=this._content.numChildren-1;i>-1;i--){var comp=this._content.getChildAt(i);max=Math.max(comp.x+comp.width*comp.scaleX,max);}
return max;});__getset(0,__proto,'contentHeight',function(){var max=0;for(var i=this._content.numChildren-1;i>-1;i--){var comp=this._content.getChildAt(i);max=Math.max(comp.y+comp.height*comp.scaleY,max);}
return max;});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Box,this,'width',value);this._setScrollChanged();});__getset(0,__proto,'hScrollBar',function(){return this._hScrollBar;});__getset(0,__proto,'content',function(){return this._content;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Box,this,'height',value);this._setScrollChanged();});__getset(0,__proto,'vScrollBarSkin',function(){return this._vScrollBar?this._vScrollBar.skin:null;},function(value){if(this._vScrollBar==null){laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new VScrollBar());this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]);this._vScrollBar.target=this._content;this._setScrollChanged();}
this._vScrollBar.skin=value;});__getset(0,__proto,'vScrollBar',function(){return this._vScrollBar;});__getset(0,__proto,'cacheAs',_super.prototype._$get_cacheAs,function(value){Laya.superSet(Box,this,'cacheAs',value);this._$P.cacheAs=null;if(value!=="none"){this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart);this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart);}else{this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart);this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart);}});return Panel;})(Box)
var UIGroup=(function(_super){function UIGroup(labels,skin){this.selectHandler=null;this._items=null;this._selectedIndex=-1;this._skin=null;this._direction="horizontal";this._space=0;this._labels=null;this._labelColors=null;this._labelFont=null;this._labelStrokeColor=null;this._strokeColors=null;this._labelStroke=NaN;this._labelSize=0;this._labelBold=false;this._labelPadding=null;this._labelAlign=null;this._stateNum=0;this._labelChanged=false;UIGroup.__super.call(this);this.skin=skin;this.labels=labels;}
__class(UIGroup,'laya.ui.UIGroup',_super);var __proto=UIGroup.prototype;Laya.imps(__proto,{"laya.ui.IItem":true})
__proto.preinitialize=function(){this.mouseEnabled=true;}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);laya.ui.Component.prototype.destroy.call(this,destroyChild);this._items&&(this._items.length=0);this._items=null;this.selectHandler=null;}
__proto.addItem=function(item,autoLayOut){(autoLayOut===void 0)&&(autoLayOut=true);var display=item;var index=this._items.length;display.name="item"+index;this.addChild(display);this.initItems();if(autoLayOut&&index>0){var preItem=this._items[index-1];if(this._direction=="horizontal"){display.x=preItem.x+preItem.width+this._space;}else{display.y=preItem.y+preItem.height+this._space;}}else{if(autoLayOut){display.x=0;display.y=0;}}
return index;}
__proto.delItem=function(item,autoLayOut){(autoLayOut===void 0)&&(autoLayOut=true);var index=this._items.indexOf(item);if(index!=-1){var display=item;this.removeChild(display);for(var i=index+1,n=this._items.length;i<n;i++){var child=this._items[i];child.name="item"+(i-1);if(autoLayOut){if(this._direction=="horizontal"){child.x-=display.width+this._space;}else{child.y-=display.height+this._space;}}}
this.initItems();if(this._selectedIndex>-1){var newIndex=0;newIndex=this._selectedIndex<this._items.length?this._selectedIndex:(this._selectedIndex-1);this._selectedIndex=-1;this.selectedIndex=newIndex;}}}
__proto.initItems=function(){this._items||(this._items=[]);this._items.length=0;for(var i=0;i<10000;i++){var item=this.getChildByName("item"+i);if(item==null)break;this._items.push(item);item.selected=(i===this._selectedIndex);item.clickHandler=Handler.create(this,this.itemClick,[i],false);}}
__proto.itemClick=function(index){this.selectedIndex=index;}
__proto.setSelect=function(index,selected){if(this._items&&index>-1&&index<this._items.length)this._items[index].selected=selected;}
__proto.createItem=function(skin,label){return null;}
__proto.changeLabels=function(){this._labelChanged=false;if(this._items){var left=0
for(var i=0,n=this._items.length;i<n;i++){var btn=this._items[i];this._skin&&(btn.skin=this._skin);this._labelColors&&(btn.labelColors=this._labelColors);this._labelSize&&(btn.labelSize=this._labelSize);this._labelStroke&&(btn.labelStroke=this._labelStroke);this._labelStrokeColor&&(btn.labelStrokeColor=this._labelStrokeColor);this._strokeColors&&(btn.strokeColors=this._strokeColors);this._labelBold&&(btn.labelBold=this._labelBold);this._labelPadding&&(btn.labelPadding=this._labelPadding);this._labelAlign&&(btn.labelAlign=this._labelAlign);this._stateNum&&(btn.stateNum=this._stateNum);this._labelFont&&(btn.labelFont=this._labelFont);if(this._direction==="horizontal"){btn.y=0;btn.x=left;left+=btn.width+this._space;}else{btn.x=0;btn.y=left;left+=btn.height+this._space;}}}
this.changeSize();}
__proto.commitMeasure=function(){this.runCallLater(this.changeLabels);}
__proto._setLabelChanged=function(){if(!this._labelChanged){this._labelChanged=true;this.callLater(this.changeLabels);}}
__getset(0,__proto,'labelStrokeColor',function(){return this._labelStrokeColor;},function(value){if(this._labelStrokeColor!=value){this._labelStrokeColor=value;this._setLabelChanged();}});__getset(0,__proto,'skin',function(){return this._skin;},function(value){if(this._skin!=value){this._skin=value;this._setLabelChanged();}});__getset(0,__proto,'selectedIndex',function(){return this._selectedIndex;},function(value){if(this._selectedIndex!=value){this.setSelect(this._selectedIndex,false);this._selectedIndex=value;this.setSelect(value,true);this.event("change");this.selectHandler&&this.selectHandler.runWith(this._selectedIndex);}});__getset(0,__proto,'labels',function(){return this._labels;},function(value){if(this._labels!=value){this._labels=value;this.removeChildren();this._setLabelChanged();if(this._labels){var a=this._labels.split(",");for(var i=0,n=a.length;i<n;i++){var item=this.createItem(this._skin,a[i]);item.name="item"+i;this.addChild(item);}}
this.initItems();}});__getset(0,__proto,'strokeColors',function(){return this._strokeColors;},function(value){if(this._strokeColors!=value){this._strokeColors=value;this._setLabelChanged();}});__getset(0,__proto,'labelColors',function(){return this._labelColors;},function(value){if(this._labelColors!=value){this._labelColors=value;this._setLabelChanged();}});__getset(0,__proto,'labelStroke',function(){return this._labelStroke;},function(value){if(this._labelStroke!=value){this._labelStroke=value;this._setLabelChanged();}});__getset(0,__proto,'labelSize',function(){return this._labelSize;},function(value){if(this._labelSize!=value){this._labelSize=value;this._setLabelChanged();}});__getset(0,__proto,'stateNum',function(){return this._stateNum;},function(value){if(this._stateNum!=value){this._stateNum=value;this._setLabelChanged();}});__getset(0,__proto,'labelBold',function(){return this._labelBold;},function(value){if(this._labelBold!=value){this._labelBold=value;this._setLabelChanged();}});__getset(0,__proto,'labelFont',function(){return this._labelFont;},function(value){if(this._labelFont!=value){this._labelFont=value;this._setLabelChanged();}});__getset(0,__proto,'labelPadding',function(){return this._labelPadding;},function(value){if(this._labelPadding!=value){this._labelPadding=value;this._setLabelChanged();}});__getset(0,__proto,'direction',function(){return this._direction;},function(value){this._direction=value;this._setLabelChanged();});__getset(0,__proto,'space',function(){return this._space;},function(value){this._space=value;this._setLabelChanged();});__getset(0,__proto,'items',function(){return this._items;});__getset(0,__proto,'selection',function(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null;},function(value){this.selectedIndex=this._items.indexOf(value);});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if(((typeof value=='number')&&Math.floor(value)==value)||(typeof value=='string'))this.selectedIndex=parseInt(value);else if((value instanceof Array))this.labels=(value).join(",");else Laya.superSet(Box,this,'dataSource',value);});return UIGroup;})(Box)
var HSlider=(function(_super){function HSlider(skin){HSlider.__super.call(this,skin);this.isVertical=false;}
__class(HSlider,'laya.ui.HSlider',_super);return HSlider;})(Slider)
var Radio=(function(_super){function Radio(skin,label){this._value=null;(label===void 0)&&(label="");Radio.__super.call(this,skin,label);}
__class(Radio,'laya.ui.Radio',_super);var __proto=Radio.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._value=null;}
__proto.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this);this.toggle=false;this._autoSize=false;}
__proto.initialize=function(){_super.prototype.initialize.call(this);this.createText();this._text.align="left";this._text.valign="top";this._text.width=0;this.on("click",this,this.onClick);}
__proto.onClick=function(e){this.selected=true;}
__getset(0,__proto,'value',function(){return this._value!=null?this._value:this.label;},function(obj){this._value=obj;});return Radio;})(Button)
var Tree=(function(_super){function Tree(){this._list=null;this._source=null;this._renderHandler=null;this._spaceLeft=10;this._spaceBottom=0;this._keepStatus=true;Tree.__super.call(this);this.width=this.height=200;}
__class(Tree,'laya.ui.Tree',_super);var __proto=Tree.prototype;Laya.imps(__proto,{"laya.ui.IRender":true})
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);laya.ui.Component.prototype.destroy.call(this,destroyChild);this._list&&this._list.destroy(destroyChild);this._list=null;this._source=null;this._renderHandler=null;}
__proto.createChildren=function(){this.addChild(this._list=new List());this._list.renderHandler=Handler.create(this,this.renderItem,null,false);this._list.repeatX=1;this._list.on("change",this,this.onListChange);}
__proto.onListChange=function(e){this.event("change");}
__proto.getArray=function(){var arr=[];var item;for(var $each_item in this._source){item=this._source[$each_item];if(this.getParentOpenStatus(item)){item.x=this._spaceLeft*this.getDepth(item);arr.push(item);}}
return arr;}
__proto.getDepth=function(item,num){(num===void 0)&&(num=0);if(item.nodeParent==null)return num;else return this.getDepth(item.nodeParent,num+1);}
__proto.getParentOpenStatus=function(item){var parent=item.nodeParent;if(parent==null){return true;}else{if(parent.isOpen){if(parent.nodeParent!=null)return this.getParentOpenStatus(parent);else return true;}else{return false;}}}
__proto.renderItem=function(cell,index){var item=cell.dataSource;if(item){cell.left=item.x;var arrow=cell.getChildByName("arrow");if(arrow){if(item.hasChild){arrow.visible=true;arrow.index=item.isOpen?1:0;arrow.tag=index;arrow.off("click",this,this.onArrowClick);arrow.on("click",this,this.onArrowClick);}else{arrow.visible=false;}};var folder=cell.getChildByName("folder");if(folder){if(folder.clipY==2){folder.index=item.isDirectory?0:1;}else{folder.index=item.isDirectory?item.isOpen?1:0:2;}}
this._renderHandler&&this._renderHandler.runWith([cell,index]);}}
__proto.onArrowClick=function(e){var arrow=e.currentTarget;var index=arrow.tag;this._list.array[index].isOpen=!this._list.array[index].isOpen;this.event("open");this._list.array=this.getArray();}
__proto.setItemState=function(index,isOpen){if(!this._list.array[index])return;this._list.array[index].isOpen=isOpen;this._list.array=this.getArray();}
__proto.fresh=function(){this._list.array=this.getArray();this.repaint();}
__proto.parseXml=function(xml,source,nodeParent,isRoot){var obj;var list=xml.childNodes;var childCount=list.length;if(!isRoot){obj={};var list2=xml.attributes;var attrs;for(var $each_attrs in list2){attrs=list2[$each_attrs];var prop=attrs.nodeName;var value=attrs.nodeValue;obj[prop]=value=="true"?true:value=="false"?false:value;}
obj.nodeParent=nodeParent;if(childCount>0)obj.isDirectory=true;obj.hasChild=childCount>0;source.push(obj);}
for(var i=0;i<childCount;i++){var node=list[i];this.parseXml(node,source,obj,false);}}
__proto.parseOpenStatus=function(oldSource,newSource){for(var i=0,n=newSource.length;i<n;i++){var newItem=newSource[i];if(newItem.isDirectory){for(var j=0,m=oldSource.length;j<m;j++){var oldItem=oldSource[j];if(oldItem.isDirectory&&this.isSameParent(oldItem,newItem)&&newItem.label==oldItem.label){newItem.isOpen=oldItem.isOpen;break;}}}}}
__proto.isSameParent=function(item1,item2){if(item1.nodeParent==null&&item2.nodeParent==null)return true;else if(item1.nodeParent==null||item2.nodeParent==null)return false
else{if(item1.nodeParent.label==item2.nodeParent.label)return this.isSameParent(item1.nodeParent,item2.nodeParent);else return false;}}
__proto.filter=function(key){if(Boolean(key)){var result=[];this.getFilterSource(this._source,result,key);this._list.array=result;}else{this._list.array=this.getArray();}}
__proto.getFilterSource=function(array,result,key){key=key.toLocaleLowerCase();var item;for(var $each_item in array){item=array[$each_item];if(!item.isDirectory&&String(item.label).toLowerCase().indexOf(key)>-1){item.x=0;result.push(item);}
if(item.child&&item.child.length>0){this.getFilterSource(item.child,result,key);}}}
__getset(0,__proto,'spaceBottom',function(){return this._list.spaceY;},function(value){this._list.spaceY=value;});__getset(0,__proto,'keepStatus',function(){return this._keepStatus;},function(value){this._keepStatus=value;});__getset(0,__proto,'itemRender',function(){return this._list.itemRender;},function(value){this._list.itemRender=value;});__getset(0,__proto,'array',function(){return this._list.array;},function(value){if(this._keepStatus&&this._list.array&&value){this.parseOpenStatus(this._list.array,value);}
this._source=value;this._list.array=this.getArray();});__getset(0,__proto,'mouseHandler',function(){return this._list.mouseHandler;},function(value){this._list.mouseHandler=value;});__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;Laya.superSet(Box,this,'dataSource',value);});__getset(0,__proto,'source',function(){return this._source;});__getset(0,__proto,'scrollBar',function(){return this._list.scrollBar;});__getset(0,__proto,'list',function(){return this._list;});__getset(0,__proto,'scrollBarSkin',function(){return this._list.vScrollBarSkin;},function(value){this._list.vScrollBarSkin=value;});__getset(0,__proto,'renderHandler',function(){return this._renderHandler;},function(value){this._renderHandler=value;});__getset(0,__proto,'selectedIndex',function(){return this._list.selectedIndex;},function(value){this._list.selectedIndex=value;});__getset(0,__proto,'spaceLeft',function(){return this._spaceLeft;},function(value){this._spaceLeft=value;});__getset(0,__proto,'selectedItem',function(){return this._list.selectedItem;},function(value){this._list.selectedItem=value;});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Box,this,'width',value);this._list.width=value;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Box,this,'height',value);this._list.height=value;});__getset(0,__proto,'xml',null,function(value){var arr=[];this.parseXml(value.childNodes[0],arr,null,true);this.array=arr;});__getset(0,__proto,'selectedPath',function(){if(this._list.selectedItem){return this._list.selectedItem.path;}
return null;});return Tree;})(Box)
var ViewStack=(function(_super){function ViewStack(){this._items=null;this._selectedIndex=0;ViewStack.__super.call(this);this._setIndexHandler=Handler.create(this,this.setIndex,null,false);}
__class(ViewStack,'laya.ui.ViewStack',_super);var __proto=ViewStack.prototype;Laya.imps(__proto,{"laya.ui.IItem":true})
__proto.setItems=function(views){this.removeChildren();var index=0;for(var i=0,n=views.length;i<n;i++){var item=views[i];if(item){item.name="item"+index;this.addChild(item);index++;}}
this.initItems();}
__proto.addItem=function(view){view.name="item"+this._items.length;this.addChild(view);this.initItems();}
__proto.initItems=function(){this._items=[];for(var i=0;i<10000;i++){var item=this.getChildByName("item"+i);if(item==null){break;}
this._items.push(item);item.visible=(i==this._selectedIndex);}}
__proto.setSelect=function(index,selected){if(this._items&&index>-1&&index<this._items.length){this._items[index].visible=selected;}}
__proto.setIndex=function(index){this.selectedIndex=index;}
__getset(0,__proto,'dataSource',_super.prototype._$get_dataSource,function(value){this._dataSource=value;if(((typeof value=='number')&&Math.floor(value)==value)||(typeof value=='string')){this.selectedIndex=parseInt(value);}else{for(var prop in this._dataSource){if(this.hasOwnProperty(prop)){this[prop]=this._dataSource[prop];}}}});__getset(0,__proto,'selectedIndex',function(){return this._selectedIndex;},function(value){if(this._selectedIndex!=value){this.setSelect(this._selectedIndex,false);this._selectedIndex=value;this.setSelect(this._selectedIndex,true);}});__getset(0,__proto,'selection',function(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null;},function(value){this.selectedIndex=this._items.indexOf(value);});__getset(0,__proto,'items',function(){return this._items;});__getset(0,__proto,'setIndexHandler',function(){return this._setIndexHandler;},function(value){this._setIndexHandler=value;});return ViewStack;})(Box)
var VScrollBar=(function(_super){function VScrollBar(){VScrollBar.__super.call(this);;}
__class(VScrollBar,'laya.ui.VScrollBar',_super);return VScrollBar;})(ScrollBar)
var TextInput=(function(_super){function TextInput(text){this._bg=null;this._skin=null;TextInput.__super.call(this);(text===void 0)&&(text="");this.text=text;this.skin=this.skin;}
__class(TextInput,'laya.ui.TextInput',_super);var __proto=TextInput.prototype;__proto.preinitialize=function(){this.mouseEnabled=true;}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._bg&&this._bg.destroy();this._bg=null;}
__proto.createChildren=function(){this.addChild(this._tf=new Input());this._tf.padding=Styles.inputLabelPadding;this._tf.on("input",this,this._onInput);this._tf.on("enter",this,this._onEnter);this._tf.on("blur",this,this._onBlur);this._tf.on("focus",this,this._onFocus);}
__proto._onFocus=function(){this.event("focus",this);}
__proto._onBlur=function(){this.event("blur",this);}
__proto._onInput=function(){this.event("input",this);}
__proto._onEnter=function(){this.event("enter",this);}
__proto.initialize=function(){this.width=128;this.height=22;}
__proto.select=function(){(this._tf).select();}
__proto.setSelection=function(startIndex,endIndex){(this._tf).setSelection(startIndex,endIndex);}
__getset(0,__proto,'text',_super.prototype._$get_text,function(value){if(this._tf.text!=value){value=value+"";this._tf.text=value;this.event("change");}});__getset(0,__proto,'bg',function(){return this._bg;},function(value){this.graphics=this._bg=value;});__getset(0,__proto,'inputElementYAdjuster',function(){return(this._tf).inputElementYAdjuster;},function(value){(this._tf).inputElementYAdjuster=value;});__getset(0,__proto,'multiline',function(){return(this._tf).multiline;},function(value){(this._tf).multiline=value;});__getset(0,__proto,'skin',function(){return this._skin;},function(value){if(this._skin!=value){this._skin=value;this._bg||(this.graphics=this._bg=new AutoBitmap());this._bg.source=Loader.getRes(this._skin);this._width&&(this._bg.width=this._width);this._height&&(this._bg.height=this._height);}});__getset(0,__proto,'sizeGrid',function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null;},function(value){this._bg||(this.graphics=this._bg=new AutoBitmap());this._bg.sizeGrid=UIUtils.fillArray(Styles.defaultSizeGrid,value,Number);});__getset(0,__proto,'inputElementXAdjuster',function(){return(this._tf).inputElementXAdjuster;},function(value){(this._tf).inputElementXAdjuster=value;});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(Label,this,'width',value);this._bg&&(this._bg.width=value);});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(Label,this,'height',value);this._bg&&(this._bg.height=value);});__getset(0,__proto,'editable',function(){return(this._tf).editable;},function(value){(this._tf).editable=value;});__getset(0,__proto,'restrict',function(){return(this._tf).restrict;},function(pattern){(this._tf).restrict=pattern;});__getset(0,__proto,'prompt',function(){return(this._tf).prompt;},function(value){(this._tf).prompt=value;});__getset(0,__proto,'promptColor',function(){return(this._tf).promptColor;},function(value){(this._tf).promptColor=value;});__getset(0,__proto,'maxChars',function(){return(this._tf).maxChars;},function(value){(this._tf).maxChars=value;});__getset(0,__proto,'focus',function(){return(this._tf).focus;},function(value){(this._tf).focus=value;});__getset(0,__proto,'type',function(){return(this._tf).type;},function(value){(this._tf).type=value;});__getset(0,__proto,'asPassword',function(){return(this._tf).asPassword;},function(value){(this._tf).asPassword=value;});return TextInput;})(Label)
var VSlider=(function(_super){function VSlider(){VSlider.__super.call(this);;}
__class(VSlider,'laya.ui.VSlider',_super);return VSlider;})(Slider)
var Dialog=(function(_super){function Dialog(){this.popupCenter=true;this.closeHandler=null;this.popupEffect=null;this.closeEffect=null;this.group=null;this.isModal=false;this._dragArea=null;Dialog.__super.call(this);}
__class(Dialog,'laya.ui.Dialog',_super);var __proto=Dialog.prototype;__proto.initialize=function(){this.popupEffect=Dialog.manager.popupEffectHandler;this.closeEffect=Dialog.manager.closeEffectHandler;this._dealDragArea();this.on("click",this,this._onClick);}
__proto._dealDragArea=function(){var dragTarget=this.getChildByName("drag");if(dragTarget){this.dragArea=dragTarget.x+","+dragTarget.y+","+dragTarget.width+","+dragTarget.height;dragTarget.removeSelf();}}
__proto._onClick=function(e){var btn=e.target;if(btn){switch(btn.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(btn.name);break;}}}
__proto.show=function(closeOther,showEffect){(closeOther===void 0)&&(closeOther=false);(showEffect===void 0)&&(showEffect=true);this._open(false,closeOther,showEffect);}
__proto.popup=function(closeOther,showEffect){(closeOther===void 0)&&(closeOther=false);(showEffect===void 0)&&(showEffect=true);this._open(true,closeOther,showEffect);}
__proto._open=function(modal,closeOther,showEffect){Dialog.manager.lock(false);this.isModal=modal;Dialog.manager.open(this,closeOther,showEffect);}
__proto.onOpened=function(){}
__proto.close=function(type,showEffect){(showEffect===void 0)&&(showEffect=true);Dialog.manager.close(this,type,showEffect);}
__proto.onClosed=function(type){}
__proto._onMouseDown=function(e){var point=this.getMousePoint();if(this._dragArea.contains(point.x,point.y))this.startDrag();else this.stopDrag();}
__getset(0,__proto,'dragArea',function(){if(this._dragArea)return this._dragArea.toString();return null;},function(value){if(value){var a=UIUtils.fillArray([0,0,0,0],value,Number);this._dragArea=new Rectangle(a[0],a[1],a[2],a[3]);this.on("mousedown",this,this._onMouseDown);}else{this._dragArea=null;this.off("mousedown",this,this._onMouseDown);}});__getset(0,__proto,'isPopup',function(){return this.parent!=null;});__getset(0,__proto,'zOrder',_super.prototype._$get_zOrder,function(value){Laya.superSet(View,this,'zOrder',value);Dialog.manager._checkMask();});__getset(1,Dialog,'manager',function(){return Dialog._manager=Dialog._manager||new DialogManager();},function(value){Dialog._manager=value;});Dialog.setLockView=function(view){Dialog.manager.setLockView(view);}
Dialog.lock=function(value){Dialog.manager.lock(value);}
Dialog.closeAll=function(){Dialog.manager.closeAll();}
Dialog.getDialogsByGroup=function(group){return Dialog.manager.getDialogsByGroup(group);}
Dialog.closeByGroup=function(group){return Dialog.manager.closeByGroup(group);}
Dialog.CLOSE="close";Dialog.CANCEL="cancel";Dialog.SURE="sure";Dialog.NO="no";Dialog.OK="ok";Dialog.YES="yes";Dialog._manager=null;return Dialog;})(View)
var HBox=(function(_super){function HBox(){HBox.__super.call(this);;}
__class(HBox,'laya.ui.HBox',_super);var __proto=HBox.prototype;__proto.sortItem=function(items){if(items)items.sort(function(a,b){return a.x-b.x;});}
__proto.changeItems=function(){this._itemChanged=false;var items=[];var maxHeight=0;for(var i=0,n=this.numChildren;i<n;i++){var item=this.getChildAt(i);if(item&&item.layoutEnabled){items.push(item);maxHeight=this._height?this._height:Math.max(maxHeight,item.height*item.scaleY);}}
this.sortItem(items);var left=0;for(i=0,n=items.length;i<n;i++){item=items[i];item.x=left;left+=item.width*item.scaleX+this._space;if(this._align=="top"){item.y=0;}else if(this._align=="middle"){item.y=(maxHeight-item.height*item.scaleY)*0.5;}else if(this._align=="bottom"){item.y=maxHeight-item.height*item.scaleY;}}
this.changeSize();}
__getset(0,__proto,'height',_super.prototype._$get_height,function(value){if(this._height!=value){Laya.superSet(LayoutBox,this,'height',value);this.callLater(this.changeItems);}});HBox.NONE="none";HBox.TOP="top";HBox.MIDDLE="middle";HBox.BOTTOM="bottom";return HBox;})(LayoutBox)
var VBox=(function(_super){function VBox(){VBox.__super.call(this);;}
__class(VBox,'laya.ui.VBox',_super);var __proto=VBox.prototype;__proto.changeItems=function(){this._itemChanged=false;var items=[];var maxWidth=0;for(var i=0,n=this.numChildren;i<n;i++){var item=this.getChildAt(i);if(item&&item.layoutEnabled){items.push(item);maxWidth=this._width?this._width:Math.max(maxWidth,item.width*item.scaleX);}}
this.sortItem(items);var top=0;for(i=0,n=items.length;i<n;i++){item=items[i];item.y=top;top+=item.height*item.scaleY+this._space;if(this._align=="left"){item.x=0;}else if(this._align=="center"){item.x=(maxWidth-item.width*item.scaleX)*0.5;}else if(this._align=="right"){item.x=maxWidth-item.width*item.scaleX;}}
this.changeSize();}
__getset(0,__proto,'width',_super.prototype._$get_width,function(value){if(this._width!=value){Laya.superSet(LayoutBox,this,'width',value);this.callLater(this.changeItems);}});VBox.NONE="none";VBox.LEFT="left";VBox.CENTER="center";VBox.RIGHT="right";return VBox;})(LayoutBox)
var RadioGroup=(function(_super){function RadioGroup(){RadioGroup.__super.call(this);;}
__class(RadioGroup,'laya.ui.RadioGroup',_super);var __proto=RadioGroup.prototype;__proto.createItem=function(skin,label){return new Radio(skin,label);}
return RadioGroup;})(UIGroup)
var Tab=(function(_super){function Tab(){Tab.__super.call(this);;}
__class(Tab,'laya.ui.Tab',_super);var __proto=Tab.prototype;__proto.createItem=function(skin,label){return new Button(skin,label);}
return Tab;})(UIGroup)
var TextArea=(function(_super){function TextArea(text){this._vScrollBar=null;this._hScrollBar=null;(text===void 0)&&(text="");TextArea.__super.call(this,text);}
__class(TextArea,'laya.ui.TextArea',_super);var __proto=TextArea.prototype;__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);_super.prototype.destroy.call(this,destroyChild);this._vScrollBar&&this._vScrollBar.destroy();this._hScrollBar&&this._hScrollBar.destroy();this._vScrollBar=null;this._hScrollBar=null;}
__proto.initialize=function(){this.width=180;this.height=150;this._tf.wordWrap=true;this.multiline=true;}
__proto.onVBarChanged=function(e){if(this._tf.scrollY!=this._vScrollBar.value){this._tf.scrollY=this._vScrollBar.value;}}
__proto.onHBarChanged=function(e){if(this._tf.scrollX!=this._hScrollBar.value){this._tf.scrollX=this._hScrollBar.value;}}
__proto.changeScroll=function(){var vShow=this._vScrollBar&&this._tf.maxScrollY>0;var hShow=this._hScrollBar&&this._tf.maxScrollX>0;var showWidth=vShow?this._width-this._vScrollBar.width:this._width;var showHeight=hShow?this._height-this._hScrollBar.height:this._height;var padding=this._tf.padding||Styles.labelPadding;this._tf.width=showWidth;this._tf.height=showHeight;if(this._vScrollBar){this._vScrollBar.x=this._width-this._vScrollBar.width-padding[2];this._vScrollBar.y=padding[1];this._vScrollBar.height=this._height-(hShow?this._hScrollBar.height:0)-padding[1]-padding[3];this._vScrollBar.scrollSize=1;this._vScrollBar.thumbPercent=showHeight/Math.max(this._tf.textHeight,showHeight);this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY);this._vScrollBar.visible=vShow;}
if(this._hScrollBar){this._hScrollBar.x=padding[0];this._hScrollBar.y=this._height-this._hScrollBar.height-padding[3];this._hScrollBar.width=this._width-(vShow?this._vScrollBar.width:0)-padding[0]-padding[2];this._hScrollBar.scrollSize=Math.max(showWidth*0.033,1);this._hScrollBar.thumbPercent=showWidth/Math.max(this._tf.textWidth,showWidth);this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX);this._hScrollBar.visible=hShow;}}
__proto.scrollTo=function(y){this.commitMeasure();this._tf.scrollY=y;}
__getset(0,__proto,'scrollY',function(){return this._tf.scrollY;});__getset(0,__proto,'width',_super.prototype._$get_width,function(value){Laya.superSet(TextInput,this,'width',value);this.callLater(this.changeScroll);});__getset(0,__proto,'hScrollBar',function(){return this._hScrollBar;});__getset(0,__proto,'height',_super.prototype._$get_height,function(value){Laya.superSet(TextInput,this,'height',value);this.callLater(this.changeScroll);});__getset(0,__proto,'maxScrollX',function(){return this._tf.maxScrollX;});__getset(0,__proto,'vScrollBarSkin',function(){return this._vScrollBar?this._vScrollBar.skin:null;},function(value){if(this._vScrollBar==null){this.addChild(this._vScrollBar=new VScrollBar());this._vScrollBar.on("change",this,this.onVBarChanged);this._vScrollBar.target=this._tf;this.callLater(this.changeScroll);}
this._vScrollBar.skin=value;});__getset(0,__proto,'hScrollBarSkin',function(){return this._hScrollBar?this._hScrollBar.skin:null;},function(value){if(this._hScrollBar==null){this.addChild(this._hScrollBar=new HScrollBar());this._hScrollBar.on("change",this,this.onHBarChanged);this._hScrollBar.mouseWheelEnable=false;this._hScrollBar.target=this._tf;this.callLater(this.changeScroll);}
this._hScrollBar.skin=value;});__getset(0,__proto,'vScrollBar',function(){return this._vScrollBar;});__getset(0,__proto,'maxScrollY',function(){return this._tf.maxScrollY;});__getset(0,__proto,'scrollX',function(){return this._tf.scrollX;});return TextArea;})(TextInput)
var AsynDialog=(function(_super){function AsynDialog(){this._uiView=null;this.isCloseOther=false;AsynDialog.__super.call(this);}
__class(AsynDialog,'laya.ui.AsynDialog',_super);var __proto=AsynDialog.prototype;__proto.createView=function(uiView){this._uiView=uiView;}
__proto._open=function(modal,closeOther,showEffect){this.isModal=modal;this.isCloseOther=closeOther;Dialog.manager.lock(true);if(this._uiView)this.onCreated();else this.onOpen();}
__proto.onCreated=function(){this.createUI();this.onOpen();}
__proto.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView);this._uiView=null;this._dealDragArea();}
__proto.onOpen=function(){Dialog.manager.open(this,this.isCloseOther);Dialog.manager.lock(false);}
__proto.close=function(type,showEffect){(showEffect===void 0)&&(showEffect=true);Dialog.manager.close(this);this.onClose();}
__proto.onClose=function(){}
__proto.destroy=function(destroyChild){(destroyChild===void 0)&&(destroyChild=true);laya.ui.View.prototype.destroy.call(this,destroyChild);this._uiView=null;this.onDestroy();}
__proto.onDestroy=function(){}
return AsynDialog;})(Dialog)
Laya.__init([View]);})(window,document,Laya);if(typeof define==='function'&&define.amd){define('laya.core',['require',"exports"],function(require,exports){'use strict';Object.defineProperty(exports,'__esModule',{value:true});for(var i in Laya){var o=Laya[i];o&&o.__isclass&&(exports[i]=o);}});}
var CLASS$=Laya.class;var STATICATTR$=Laya.static;var View=laya.ui.View;var Dialog=laya.ui.Dialog;var BloodItemUI=(function(_super){function BloodItemUI(){this.img=null;BloodItemUI.__super.call(this);}
CLASS$(BloodItemUI,'ui.BloodItemUI',_super);var __proto__=BloodItemUI.prototype;__proto__.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this);this.createView(BloodItemUI.uiView);}
BloodItemUI.uiView={"type":"View","props":{"width":25,"height":25},"child":[{"type":"Image","props":{"y":0,"x":0,"width":26,"var":"img","skin":"comp/remaining_hp.png","height":25}}]};return BloodItemUI;})(View);var FoodUI=(function(_super){function FoodUI(){FoodUI.__super.call(this);}
CLASS$(FoodUI,'ui.FoodUI',_super);var __proto__=FoodUI.prototype;__proto__.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this);this.createView(FoodUI.uiView);}
FoodUI.uiView={"type":"View","props":{"width":1,"height":1},"child":[{"type":"Image","props":{"y":0,"x":0,"width":126,"skin":"comp/food.png","height":82,"anchorY":0.5,"anchorX":0.5}}]};return FoodUI;})(View);var GameUI=(function(_super){function GameUI(){this.game=null;this.gameBg=null;this.killAll=null;this.killAllLabel=null;this.bloodBg=null;this.bloodIco=null;this.timerBg=null;this.score=null;this.gameOverPanel=null;this.bg_05=null;this.retryBtn=null;this.homeBtn=null;this.shareBtn=null;this.rankBtn=null;this.tips=null;this.backBtn=null;this.shareBtn2=null;GameUI.__super.call(this);}
CLASS$(GameUI,'ui.GameUI',_super);var __proto__=GameUI.prototype;__proto__.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this);this.createView(GameUI.uiView);}
GameUI.uiView={"type":"View","props":{"y":0,"x":0,"width":750,"height":1334,"anchorY":0,"anchorX":0},"child":[{"type":"Box","props":{"y":0,"x":0,"visible":true,"var":"game"},"child":[{"type":"Image","props":{"y":0,"x":0,"width":750,"var":"gameBg","skin":"comp/bg_04.jpg","height":1334,"anchorY":0,"anchorX":0}},{"type":"Image","props":{"y":1158,"x":588,"width":88,"var":"killAll","skin":"comp/killAll.png","height":88},"child":[{"type":"Label","props":{"y":-32,"x":7,"width":73,"var":"killAllLabel","text":"X1","height":27,"fontSize":30,"color":"#2cfd05","align":"center"}}]},{"type":"Image","props":{"y":84,"x":12,"width":212,"var":"bloodBg","skin":"comp/blood_bg.png","height":61}},{"type":"Image","props":{"y":93,"x":31,"var":"bloodIco","skin":"comp/blood_ico.png"}},{"type":"Image","props":{"y":84,"x":316,"width":256,"var":"timerBg","skin":"comp/timer.png","height":61}},{"type":"Label","props":{"y":97,"x":404,"width":131,"visible":true,"var":"score","text":"1000","height":34,"fontSize":35,"color":"#ff6d1e","align":"left"}}]},{"type":"Box","props":{"y":0,"x":0,"visible":false,"var":"gameOverPanel"},"child":[{"type":"Image","props":{"y":0,"x":0,"width":750,"var":"bg_05","skin":"comp/bg_05.jpg","height":1334}},{"type":"Image","props":{"y":760,"x":425,"width":80,"visible":true,"var":"retryBtn","skin":"comp/retryBtn.png","height":78}},{"type":"Image","props":{"y":760,"x":245,"width":80,"var":"homeBtn","skin":"comp/homeBtn.png","height":78}},{"type":"Image","props":{"y":874,"x":252,"width":245,"var":"shareBtn","skin":"comp/shareBtn.png","height":72}},{"type":"Image","props":{"y":994,"x":252,"width":245,"var":"rankBtn","skin":"comp/rankBtn.png","height":72}},{"type":"Label","props":{"y":526,"x":219,"width":324,"var":"tips","height":47,"fontSize":40,"color":"#ff6d1e","align":"center"}},{"type":"Image","props":{"y":1205,"x":336,"width":77,"visible":false,"var":"backBtn","skin":"comp/homeBtn.png","height":77},"child":[{"type":"Label","props":{"y":86,"x":8,"text":"返回","fontSize":30,"color":"#fdfbfb"}}]},{"type":"Image","props":{"y":1057,"x":252,"width":245,"visible":false,"var":"shareBtn2","skin":"comp/shareBtn2.png","height":72}}]}]};return GameUI;})(View);var GameStartUI=(function(_super){function GameStartUI(){this.ani1=null;this.page1=null;this.page3=null;this.page2=null;this.bg_02=null;this.startBtn=null;this.rankBtn=null;this.homeBtn=null;this.shareBtn=null;GameStartUI.__super.call(this);}
CLASS$(GameStartUI,'ui.GameStartUI',_super);var __proto__=GameStartUI.prototype;__proto__.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this);this.createView(GameStartUI.uiView);}
GameStartUI.uiView={"type":"View","props":{"width":750,"visible":true,"height":1334},"child":[{"type":"Image","props":{"y":0,"x":0,"width":750,"var":"page1","skin":"comp/bg_01.jpg","sizeGrid":"","height":1334},"compId":17},{"type":"Image","props":{"y":0,"x":0,"width":750,"visible":false,"var":"page3","skin":"comp/bg_03.jpg","height":1334}},{"type":"Box","props":{"y":0,"x":0,"width":750,"visible":false,"var":"page2","height":1334},"child":[{"type":"Image","props":{"y":0,"x":0,"width":750,"var":"bg_02","skin":"comp/bg_02.jpg","height":1334}},{"type":"Image","props":{"y":864,"x":252,"width":245,"var":"startBtn","skin":"comp/startBtn.png","height":72}},{"type":"Image","props":{"y":697,"x":252,"width":245,"var":"rankBtn","skin":"comp/rankBtn.png","height":72}},{"type":"Image","props":{"y":1178,"x":325,"visible":false,"var":"homeBtn","skin":"comp/homeBtn.png"},"child":[{"type":"Label","props":{"y":115,"x":0,"width":100,"text":"返回","height":30,"fontSize":30,"color":"#fdfbfb","align":"center"}}]},{"type":"Image","props":{"y":1025,"x":252,"width":245,"visible":false,"var":"shareBtn","skin":"comp/shareBtn2.png","height":72}}]}],"animations":[{"nodes":[{"target":17,"keyframes":{"sizeGrid":[{"value":"","tweenMethod":"linearNone","tween":false,"target":17,"key":"sizeGrid","index":0}]}}],"name":"ani1","id":1,"frameRate":24,"action":0}]};return GameStartUI;})(View);var GameStartAnimateUI=(function(_super){function GameStartAnimateUI(){this.ani1=null;this.panel1=null;this.panel2=null;this.seesion2=null;this.panel1=null;this.session3=null;GameStartAnimateUI.__super.call(this);}
CLASS$(GameStartAnimateUI,'ui.GameStartAnimateUI',_super);var __proto__=GameStartAnimateUI.prototype;__proto__.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this);this.createView(GameStartAnimateUI.uiView);}
GameStartAnimateUI.uiView={"type":"View","props":{"width":750,"height":1334},"child":[{"type":"Image","props":{"y":0,"x":0,"width":750,"skin":"comp/bg.jpg","height":1334}},{"type":"Box","props":{"y":38,"x":35,"visible":true,"var":"panel1"},"compId":4,"child":[{"type":"Image","props":{"skin":"comp/ani_01.png"}},{"type":"Image","props":{"y":185,"x":154,"skin":"comp/ani_02.png","rotation":0,"anchorY":0.5,"anchorX":0.5},"compId":3}]},{"type":"Image","props":{"y":377,"x":35,"visible":true,"var":"panel2","skin":"comp/ani_04.png"},"compId":7},{"type":"Image","props":{"y":327,"x":259,"visible":true,"var":"seesion2","skin":"comp/ani_05.png"},"compId":6},{"type":"Image","props":{"y":13,"x":329,"visible":true,"var":"panel1","skin":"comp/ani_03.png"},"compId":5},{"type":"Box","props":{"y":790,"x":35,"width":679,"height":476},"compId":14,"child":[{"type":"Image","props":{"y":11,"x":-5,"visible":true,"skin":"comp/ani_06.png"},"compId":8},{"type":"Image","props":{"y":357,"x":510,"visible":true,"skin":"comp/ani_08.png","rotation":-15,"anchorY":0.5,"anchorX":0.5},"compId":10}]},{"type":"Image","props":{"y":814,"x":313,"width":414,"visible":true,"var":"session3","skin":"comp/ani_07.png","height":300},"compId":9}],"animations":[{"nodes":[{"target":5,"keyframes":{"y":[{"value":20,"tweenMethod":"linearNone","tween":true,"target":5,"key":"y","index":0},{"value":13,"tweenMethod":"linearNone","tween":true,"target":5,"key":"y","index":8}],"x":[{"value":-398,"tweenMethod":"linearNone","tween":true,"target":5,"key":"x","index":0},{"value":329,"tweenMethod":"linearNone","tween":true,"target":5,"key":"x","index":8}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":5,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":5,"key":"visible","index":8}],"var":[{"value":"seesion1","tweenMethod":"linearNone","tween":false,"target":5,"key":"var","index":0},{"value":"panel1","tweenMethod":"linearNone","tween":false,"target":5,"key":"var","index":1}]}},{"target":6,"keyframes":{"y":[{"value":356,"tweenMethod":"linearNone","tween":true,"target":6,"key":"y","index":0},{"value":327,"tweenMethod":"linearNone","tween":true,"target":6,"key":"y","index":18}],"x":[{"value":-538,"tweenMethod":"linearNone","tween":true,"target":6,"key":"x","index":0},{"value":259,"tweenMethod":"linearNone","tween":true,"target":6,"key":"x","index":18}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":6,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":6,"key":"visible","index":18}]}},{"target":4,"keyframes":{"y":[{"value":38,"tweenMethod":"linearNone","tween":true,"target":4,"key":"y","index":0},{"value":38,"tweenMethod":"linearNone","tween":true,"target":4,"key":"y","index":6}],"x":[{"value":-631,"tweenMethod":"linearNone","tween":true,"target":4,"key":"x","index":0},{"value":35,"tweenMethod":"linearNone","tween":true,"target":4,"key":"x","index":6}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":4,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":4,"key":"visible","index":1}]}},{"target":8,"keyframes":{"y":[{"value":833,"tweenMethod":"linearNone","tween":true,"target":8,"key":"y","index":0},{"value":11,"tweenMethod":"linearNone","tween":true,"target":8,"key":"y","index":22}],"x":[{"value":-679,"tweenMethod":"linearNone","tween":true,"target":8,"key":"x","index":0},{"value":-5,"tweenMethod":"linearNone","tween":true,"target":8,"key":"x","index":22}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":8,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":8,"key":"visible","index":22}]}},{"target":9,"keyframes":{"y":[{"value":859,"tweenMethod":"linearNone","tween":true,"target":9,"key":"y","index":0},{"value":814,"tweenMethod":"linearNone","tween":true,"target":9,"key":"y","index":28}],"x":[{"value":-378,"tweenMethod":"linearNone","tween":true,"target":9,"key":"x","index":0},{"value":313,"tweenMethod":"linearNone","tween":true,"target":9,"key":"x","index":28}],"width":[{"value":414,"tweenMethod":"linearNone","tween":true,"target":9,"key":"width","index":0},{"value":414,"tweenMethod":"linearNone","tween":true,"target":9,"key":"width","index":36}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":9,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":9,"key":"visible","index":28}],"height":[{"value":300,"tweenMethod":"linearNone","tween":true,"target":9,"key":"height","index":0},{"value":300,"tweenMethod":"linearNone","tween":true,"target":9,"key":"height","index":36}]}},{"target":10,"keyframes":{"y":[{"value":370,"tweenMethod":"linearNone","tween":true,"target":10,"key":"y","index":0},{"value":353,"tweenMethod":"linearNone","tween":true,"target":10,"key":"y","index":22},{"value":357,"tweenMethod":"linearNone","tween":true,"target":10,"key":"y","index":23}],"x":[{"value":404,"tweenMethod":"linearNone","tween":true,"target":10,"key":"x","index":0},{"value":498,"tweenMethod":"linearNone","tween":true,"target":10,"key":"x","index":22},{"value":510,"tweenMethod":"linearNone","tween":true,"target":10,"key":"x","index":23}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":10,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":10,"key":"visible","index":22}],"rotation":[{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":0},{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":22},{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":23},{"value":-25,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":24},{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":25},{"value":-15,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":26},{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":27},{"value":-15,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":28},{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":29},{"value":-15,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":30},{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":31},{"value":-15,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":32},{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":33},{"value":-15,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":34},{"value":0,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":35},{"value":-15,"tweenMethod":"linearNone","tween":true,"target":10,"key":"rotation","index":36}],"anchorY":[{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":10,"key":"anchorY","index":0},{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":10,"key":"anchorY","index":22},{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":10,"key":"anchorY","index":23}],"anchorX":[{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":10,"key":"anchorX","index":0},{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":10,"key":"anchorX","index":22},{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":10,"key":"anchorX","index":23}]}},{"target":7,"keyframes":{"y":[{"value":377,"tweenMethod":"linearNone","tween":true,"target":7,"key":"y","index":0}],"x":[{"value":761,"tweenMethod":"linearNone","tween":true,"target":7,"key":"x","index":0},{"value":704,"tweenMethod":"linearNone","tween":true,"target":7,"key":"x","index":12},{"value":35,"tweenMethod":"linearNone","tween":true,"target":7,"key":"x","index":17}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":7,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":7,"key":"visible","index":12}]}},{"target":3,"keyframes":{"y":[{"value":76,"tweenMethod":"linearNone","tween":true,"target":3,"key":"y","index":0},{"value":185,"tweenMethod":"linearNone","tween":true,"target":3,"key":"y","index":6},{"value":185,"tweenMethod":"linearNone","tween":true,"target":3,"key":"y","index":7}],"x":[{"value":31,"tweenMethod":"linearNone","tween":true,"target":3,"key":"x","index":0},{"value":154,"tweenMethod":"linearNone","tween":true,"target":3,"key":"x","index":6},{"value":154,"tweenMethod":"linearNone","tween":true,"target":3,"key":"x","index":7}],"rotation":[{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":0},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":6},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":7},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":8},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":9},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":10},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":11},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":12},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":13},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":14},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":15},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":16},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":17},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":18},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":19},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":20},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":21},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":22},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":23},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":24},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":25},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":26},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":27},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":28},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":29},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":30},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":31},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":32},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":33},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":34},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":35},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"rotation","index":36}],"anchorY":[{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"anchorY","index":0},{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":3,"key":"anchorY","index":6},{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":3,"key":"anchorY","index":7}],"anchorX":[{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"anchorX","index":0},{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":3,"key":"anchorX","index":6},{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":3,"key":"anchorX","index":7}]}},{"target":14,"keyframes":{"y":[{"value":824,"tweenMethod":"linearNone","tween":true,"target":14,"key":"y","index":0},{"value":790,"tweenMethod":"linearNone","tween":true,"target":14,"key":"y","index":22},{"value":790,"tweenMethod":"linearNone","tween":true,"target":14,"key":"y","index":27}],"x":[{"value":-632,"tweenMethod":"linearNone","tween":true,"target":14,"key":"x","index":0},{"value":-586,"tweenMethod":"linearNone","tween":true,"target":14,"key":"x","index":22},{"value":35,"tweenMethod":"linearNone","tween":true,"target":14,"key":"x","index":27}],"width":[{"value":679,"tweenMethod":"linearNone","tween":true,"target":14,"key":"width","index":0}],"height":[{"value":476,"tweenMethod":"linearNone","tween":true,"target":14,"key":"height","index":0}]}}],"name":"ani1","id":1,"frameRate":10,"action":0}]};return GameStartAnimateUI;})(View);var shanchongjiUI=(function(_super){function shanchongjiUI(){this.ani1=null;this.ani2=null;this.bright=null;this.bottle=null;shanchongjiUI.__super.call(this);}
CLASS$(shanchongjiUI,'ui.shanchongjiUI',_super);var __proto__=shanchongjiUI.prototype;__proto__.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this);this.createView(shanchongjiUI.uiView);}
shanchongjiUI.uiView={"type":"View","props":{"width":100,"visible":true,"height":100},"compId":1,"child":[{"type":"Image","props":{"y":50,"x":50,"width":100,"visible":true,"var":"bright","skin":"comp/bright.png","height":100,"anchorY":0.5,"anchorX":0.5},"compId":2},{"type":"Image","props":{"y":50,"x":50,"width":100,"visible":false,"var":"bottle","skin":"comp/killAll.png","height":100,"anchorY":0.5,"anchorX":0.5},"compId":3}],"animations":[{"nodes":[{"target":3,"keyframes":{"y":[{"value":50,"tweenMethod":"linearNone","tween":true,"target":3,"key":"y","index":0},{"value":51,"tweenMethod":"linearNone","tween":true,"target":3,"key":"y","index":4},{"value":50,"tweenMethod":"linearNone","tween":true,"target":3,"key":"y","index":7}],"x":[{"value":50,"tweenMethod":"linearNone","tween":true,"target":3,"key":"x","index":0}],"width":[{"value":100,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":0},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":4},{"value":25,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":5},{"value":50,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":6},{"value":100,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":7}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":3,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":3,"key":"visible","index":4}],"var":[{"value":"bottle","tweenMethod":"linearNone","tween":false,"target":3,"key":"var","index":0}],"right":[{"value":null,"tweenMethod":"linearNone","tween":false,"target":3,"key":"right","index":0},{"value":0,"tweenMethod":"linearNone","tween":true,"target":3,"key":"right","index":7}],"height":[{"value":100,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":0},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":4},{"value":25,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":5},{"value":50,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":6},{"value":100,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":7}]}},{"target":2,"keyframes":{"width":[{"value":12,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":0},{"value":25,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":1},{"value":50,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":2},{"value":100,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":3},{"value":35,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":4}],"visible":[{"value":true,"tweenMethod":"linearNone","tween":false,"target":2,"key":"visible","index":0},{"value":false,"tweenMethod":"linearNone","tween":false,"target":2,"key":"visible","index":5}],"var":[{"value":"bright","tweenMethod":"linearNone","tween":false,"target":2,"key":"var","index":0}],"height":[{"value":12,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":0},{"value":25,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":1},{"value":50,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":2},{"value":100,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":3},{"value":35,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":4}]}}],"name":"ani1","id":1,"frameRate":10,"action":0},{"nodes":[{"target":2,"keyframes":{"width":[{"value":100,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":0},{"value":35,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":3},{"value":100,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":4},{"value":50,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":5},{"value":25,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":6},{"value":12,"tweenMethod":"linearNone","tween":true,"target":2,"key":"width","index":7}],"visible":[{"value":false,"tweenMethod":"linearNone","tween":false,"target":2,"key":"visible","index":0},{"value":true,"tweenMethod":"linearNone","tween":false,"target":2,"key":"visible","index":3}],"height":[{"value":100,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":0},{"value":35,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":3},{"value":100,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":4},{"value":50,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":5},{"value":25,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":6},{"value":12,"tweenMethod":"linearNone","tween":true,"target":2,"key":"height","index":7}]}},{"target":3,"keyframes":{"width":[{"value":100,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":0},{"value":50,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":1},{"value":25,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":2},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"width","index":3}],"visible":[{"value":true,"tweenMethod":"linearNone","tween":false,"target":3,"key":"visible","index":0},{"value":false,"tweenMethod":"linearNone","tween":false,"target":3,"key":"visible","index":4}],"height":[{"value":100,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":0},{"value":50,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":1},{"value":25,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":2},{"value":10,"tweenMethod":"linearNone","tween":true,"target":3,"key":"height","index":3}]}},{"target":1,"keyframes":{"visible":[{"value":true,"tweenMethod":"linearNone","tween":false,"target":1,"key":"visible","index":0},{"value":false,"tweenMethod":"linearNone","tween":false,"target":1,"key":"visible","index":8}]}}],"name":"ani2","id":2,"frameRate":10,"action":0}]};return shanchongjiUI;})(View);var shoeUI=(function(_super){function shoeUI(){this.ani1=null;shoeUI.__super.call(this);}
CLASS$(shoeUI,'ui.shoeUI',_super);var __proto__=shoeUI.prototype;__proto__.createChildren=function(){laya.ui.Component.prototype.createChildren.call(this);this.createView(shoeUI.uiView);}
shoeUI.uiView={"type":"View","props":{"width":100,"height":100},"child":[{"type":"Image","props":{"y":50,"x":28,"width":60,"skin":"comp/shoe.png","height":100,"anchorY":0.5,"anchorX":0.5},"compId":2},{"type":"Image","props":{"y":65,"x":63,"width":83,"skin":"comp/hit_effect.png","height":69,"anchorY":0.5,"anchorX":0.5},"compId":4}],"animations":[{"nodes":[{"target":2,"keyframes":{"y":[{"value":50,"tweenMethod":"linearNone","tween":true,"target":2,"key":"y","index":0},{"value":99,"tweenMethod":"linearNone","tween":true,"target":2,"key":"y","index":2}],"x":[{"value":8,"tweenMethod":"linearNone","tween":true,"target":2,"key":"x","index":0},{"value":20,"tweenMethod":"linearNone","tween":true,"target":2,"key":"x","index":2}],"visible":[{"value":true,"tweenMethod":"linearNone","tween":false,"target":2,"key":"visible","index":0},{"value":false,"tweenMethod":"linearNone","tween":false,"target":2,"key":"visible","index":4}],"rotation":[{"value":0,"tweenMethod":"linearNone","tween":true,"target":2,"key":"rotation","index":0},{"value":90,"tweenMethod":"linearNone","tween":true,"target":2,"key":"rotation","index":2}],"anchorY":[{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":2,"key":"anchorY","index":0},{"value":1,"tweenMethod":"linearNone","tween":true,"target":2,"key":"anchorY","index":2}],"anchorX":[{"value":0.5,"tweenMethod":"linearNone","tween":true,"target":2,"key":"anchorX","index":0},{"value":0.8,"tweenMethod":"linearNone","tween":true,"target":2,"key":"anchorX","index":2}]}},{"target":4,"keyframes":{"y":[{"value":65,"tweenMethod":"linearNone","tween":true,"target":4,"key":"y","index":0},{"value":79,"tweenMethod":"linearNone","tween":true,"target":4,"key":"y","index":2}],"x":[{"value":36,"tweenMethod":"linearNone","tween":true,"target":4,"key":"x","index":0},{"value":82,"tweenMethod":"linearNone","tween":true,"target":4,"key":"x","index":2}],"visible":[{"value":true,"tweenMethod":"linearNone","tween":false,"target":4,"key":"visible","index":0},{"value":false,"tweenMethod":"linearNone","tween":false,"target":4,"key":"visible","index":3}],"rotation":[{"value":0,"tweenMethod":"linearNone","tween":true,"target":4,"key":"rotation","index":0},{"value":190,"tweenMethod":"linearNone","tween":true,"target":4,"key":"rotation","index":2}]}}],"name":"ani1","id":1,"frameRate":24,"action":0}]};return shoeUI;})(View);var shanchongji=(function(_super){function shanchongji(){shanchongji.__super.call(this);this.timer=0;}
Laya.class(shanchongji,'view.shanchongji',_super);var _proto=shanchongji.prototype;_proto.appear=function(){this.ani1.play(0,false);this.x=rd(100,650);this.y=rd(100,1240);this.pos(this.x,this.y);console.log("shanchongji appear");}
_proto.isTouch=function(x,y){return new Laya.Rectangle(this.x,this.y,this.width,this.height).contains(x,y);};_proto.disappear=function(){this.ani2.play(0,false);}
return shanchongji;})(shanchongjiUI)
var GameStartAnimate=(function(_super){function GameStartAnimate(){GameStartAnimate.__super.call(this);}
Laya.class(GameStartAnimate,'view.GameStartAnimate',_super);var _proto=GameStartAnimate.prototype;_proto.start=function(){this.ani1.play(0,false);}
return GameStartAnimate;}(GameStartAnimateUI));var Lizard=(function(){function Lizard(x,y){this.initialize(x,y);}
var _proto=Lizard.prototype;_proto.initialize=function(x,y,lv){this.panel=new Laya.Box();this.panel.x=x;this.panel.y=y;this.lv=lv;this.panel.width=100;this.panel.height=200;this.panel.anchorX=.5;this.panel.anchorY=.5;this.live=true;this.blink=0;this.rotate=0;this.generateLizard();this.time=0;this.task=false;}
_proto.generateLizard=function(){var _this=this;var factory=new Laya.Templet();factory.loadAni("res/dragonBones/xiyi_1.sk");factory.on(Laya.Event.COMPLETE,this,function(){_this.ani=factory.buildArmature(1);_this.ani.x=40;_this.ani.y=110;_this.panel.addChild(_this.ani);_this.ani.play(0,true);});this.ani=_this.ani;}
_proto.isTouch=function(x,y){if(this.live){return new Laya.Rectangle(this.panel.x-this.panel.width/4,this.panel.y-this.panel.height/4,this.panel.width/2,this.panel.height/2).contains(x,y);}else{return false;}};_proto.hit=function(){if(this.ani){this.ani.removeSelf();}
LayaApp.game.gameOver();this.live=false;}
_proto.move=function(rot,time,speed){if(this.live){if(this.task){this.time--;var change=false;if(this.panel.x<50&&this.rotate<180){this.rotate=rd(180,360);change=true;}else if(this.panel.x>Laya.stage.width-50&&this.rotate>180){this.rotate=rd(0,180);change=true;}
if(this.panel.y>Laya.stage.height-50&&(this.rotate>0&&this.rotate<90||this.rotate>270)){this.rotate=rd(90,270);change=true;}else if(this.panel.y<50&&(this.rotate>90&&this.rotate<270)){this.rotate=rd(0,1)==0?rd(0,90):rd(270,360);change=true;}
if(change){this.panel.rotation=this.rotate+180;}
this.panel.x+=this.speed*Math.cos((this.rotate+90)/180*Math.PI);this.panel.y+=this.speed*Math.sin((this.rotate+90)/180*Math.PI);if(this.time<=0){this.task=false;}}else{this.time=time/2;this.rotate=rot;this.speed=speed*1;this.task=true;if(this.ani!=null){this.ani.playbackRate(this.speed/2);}
this.panel.rotation=rot+180;}}else{this.blink++;if(this.blink>100){this.remove=true;}}};return Lizard;})()
var BloodItem=(function(_super){function BloodItem(){BloodItem.__super.call(this);}
Laya.class(BloodItem,'view.BloodItem',_super);return BloodItem;})(BloodItemUI)
var Food=(function(_super){function Food(){Food.__super.call(this);this.x=screenWidth/2;this.y=screenHeight/2;this.anchorX=.5;this.anchorY=.5;}
Laya.class(Food,'view.Food',_super);return Food;})(FoodUI)
var shoe=(function(_super){function shoe(){shoe.__super.call(this);}
Laya.class(shoe,'view.shoe',_super);var _proto=shoe.prototype;_proto.start=function(){Laya.stage.on(Laya.Event.CLICK,this,this.onClick);Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove);this.onMouseMove();}
_proto.end=function(){Laya.Mouse.show();Laya.stage.off(Laya.Event.CLICK,this,this.onClick);Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove);}
_proto.onClick=function(){this.ani1.play(0,false);this.pos(Laya.stage.mouseX-this.width/2,Laya.stage.mouseY-this.height/2);}
_proto.onMouseMove=function(){this.pos(Laya.stage.mouseX-this.width/2,Laya.stage.mouseY-this.height/2);}
return shoe;})(shoeUI)
var screenWidth=750;var screenHeight=1334;CrawlRectangleHeight=0.3881*screenHeight;var Handler=Laya.Handler;var clickMusic="res/music/click.mp3";var gameOverMusic="res/music/gameOver.mp3";var killAllMusic="res/music/killAll.mp3";var loseHpMusic="res/music/lose_hp.mp3";var lv1DieMusic="res/music/lv1_die.mp3";var lv2DieMusic="res/music/lv2_die.mp3";var lv2HitMusic="res/music/lv2Hit.mp3";var warningMusic="res/music/warning.mp3";var rd=function(min,max){return Math.round(Math.random()*1e13)%(max-min+1)+min;};var videoAd=window["wx"]?wx.createRewardedVideoAd({adUnitId:"adunit-ee2cfd4009c8bd9c"}):null;function addOnceClick(btn,caller,func){btn.offAll();btn.on(Laya.Event.CLICK,caller,func);}
function http(ip,callback){var xhr=new XMLHttpRequest();xhr.open("GET",ip,true);xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var response=xhr.responseText;var result=JSON.parse(response);if(callback){callback(result);}}};xhr.send();}
function blink(obj,delay,times,show){if(times>0){Laya.Tween.to(obj,{alpha:show?1:0},delay,null,Handler.create(this,function(){blink(obj,delay,--times,!show);}),show?0:100);}}
function showOpenData(parent,arg,showClose){if(showClose===void 0){showClose=null;}
if(window["wx"]){Laya.timer.once(1000,parent,function(){if(Laya.Browser.onMiniGame){parent.rankSprite2=new Laya.Sprite();parent.rankSprite2.pos(0,0);var rankTexture=new Laya.Texture(Laya.Browser.window.sharedCanvas);rankTexture.bitmap.alwaysChange=true;parent.rankSprite2.graphics.drawTexture(rankTexture,0,0,rankTexture.width,rankTexture.height);Laya.stage.addChild(parent.rankSprite2);wx.postMessage(arg);}});}}
function isIPhoneX(){var u=navigator.userAgent;var isIOS=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(isIOS){if(screen.height==812&&screen.width==375){console.log("iphoneX");}else{console.log("not iphoneX");}}}
var shake=function(obj,num,time){var dx=num==0?0:Math.random()*1e8%10*(parseInt(Math.random()*100+"")%2==0?1:-1);var dy=num==0?0:Math.random()*1e8%10*(parseInt(Math.random()*100+"")%2==0?1:-1);Laya.Tween.to(obj,{x:dx,y:dy},time||50,null,Laya.Handler.create(this,function(){if(num>0){shake(obj,num-1,time);}}));};function getAngle(panelX,panelY,foodX,foodY){var cos;var dx=Math.abs(foodX-panelX);var dy=Math.abs(foodY-panelY);var dz=Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2));var cos=dy/dz;var radina=Math.acos(cos);var angle=Math.floor(180/(Math.PI/radina));if(panelX>foodX&&panelY<foodY){angle=angle;}else if(panelX>foodX&&panelY>foodY){angle=180-angle;}else if(panelX<foodX&&panelY>foodY){angle=180+angle;}else if(panelX<foodX&&panelY<foodY){angle=-angle;}
return angle;}
var Blattaria=(function(){function Blattaria(x,y,lv){this.initialize(x,y,lv);}
var _proto=Blattaria.prototype;_proto.initialize=function(x,y,lv){this.panel=new Laya.Box();this.panel.x=x;this.panel.y=y;this.lv=lv;this.panel.width=90;this.panel.height=135;this.panel.anchorX=.5;this.panel.anchorY=.5;this.panel.scale(lv==2?0.8:0.5,lv==2?0.8:0.5);this.live=true;this.time=0;this.task=false;this.blink=0;this.rotate=0;this.speed=0;this.dieImgSrc="comp/lv"+lv+"_die.png";this.hp=lv==1?1:3;this.foodX=LayaApp.game.food.x;this.foodY=LayaApp.game.food.y;this.foodWidth=LayaApp.game.food.width;this.foodHeight=LayaApp.game.food.height;this.angle=getAngle(this.panel.x,this.panel.y,this.foodX,this.foodY);this.panel.rotation=180+this.angle;this.generateBlattaria();}
_proto.generateBlattaria=function(){var _this=this;var factory=new Laya.Templet();factory.loadAni(_this.lv==1?"res/dragonBones/shikelang01_1.sk":"res/dragonBones/woniu_1.sk");factory.on(Laya.Event.COMPLETE,this,function(){_this.ani=factory.buildArmature(1);_this.ani.x=50;_this.ani.y=80;_this.panel.addChild(_this.ani);_this.ani.play(0,true);});this.ani=_this.ani;}
_proto.isTouch=function(x,y){if(this.live){return new Laya.Rectangle(this.panel.x-this.panel.width/2,this.panel.y-this.panel.height/2,this.panel.width,this.panel.height).contains(x,y);}else{return false;}};_proto.hit=function(killAll=false){this.hp--;if(killAll){this.hp=0;}
if(this.hp>0&&this.lv==2&&killAll==false){laya.media.SoundManager.playSound("res/music/lv2Hit.mp3");}
if(this.hp<=0){if(killAll==false){laya.media.SoundManager.playSound("res/music/lv"+this.lv+"_die.mp3");}
if(LayaApp.game.shachongjiAppearSatus&&this.lv==2&&killAll==false){LayaApp.game.killBig+=1;console.log("LayaApp.game.killBig+=1;");}
if(this.ani){this.ani.removeSelf();}
this.dieImg=new Laya.Image(this.dieImgSrc);this.dieImg.centerX=0;this.dieImg.centerY=-30;this.panel.addChild(this.dieImg);this.live=false;}}
_proto.move=function(rot,speed){if(this.live){this.time--;var dX=this.foodX-this.panel.x;var dY=this.foodY-this.panel.y;var dZ=Math.sqrt(Math.pow(dX,2)+Math.pow(dY,2));this.xRate=dX/dZ;this.yRate=dY/dZ;if(!this.checkEat(this.panel.x,this.panel.y)){this.panel.x+=speed*this.xRate;this.panel.y+=speed*this.yRate;}else{this.blink++;if(this.blink>100){this.toRemove=true;LayaApp.game.showScoreAnimate();LayaApp.game.foodBloodLost+=1;if(LayaApp.game.foodBloodLost<LayaApp.game.foodBloodLength){LayaApp.game.updateFoodBloodBar();}else if(LayaApp.game.foodBloodLost==LayaApp.game.foodBloodLength){LayaApp.game.updateFoodBloodBar();LayaApp.game.gameOver();}}}}else{this.blink++;if(this.blink>100){this.toRemove=true;}}}
_proto.checkEat=function(){var rectangle=this.panel.getBounds().intersection(LayaApp.game.food.getBounds());if(rectangle&&rectangle.width*rectangle.height>2500){return true;}
return false;}
return Blattaria;})()
var Game=(function(_super){function Game(){Game.__super.call(this);this.initialize();}
Laya.class(Game,'Game',_super);var _proto=Game.prototype;_proto.initialize=function(){if(Laya.Browser.onMiniGame){console.log("Laya.Browser.onMiniGame in Game");var _this=this;wx.getSystemInfo({success:function(res){console.log(res.model);if(res.screenWidth==375&&res.screenHeight==812){Laya.stage.height=1624;console.log("iPhone X in Game");_this.gameBg.height=1624;_this.bg_05.height=1624;_this.retryBtn.y+=50;_this.homeBtn.y+=50;_this.shareBtn.y+=50;_this.shareBtn2.y+=55;_this.rankBtn.y+=50;_this.tips.y+=55;_this.killAll.y+=50;_this.backBtn.y+=20}else{console.log("not iPhone X in Game");}}})}else{console.log("not Laya.Browser.onMiniGame in Game");}
this.spaceMax=350;this.blaArr=[];this.killTimes=1;this.timeCount=0;this.waitOver=false;this.stageTimeSpace=20;this.difficultyAddRate=0.1;this.overCount=0;this.lv1Space=20000;this.lv2Space=600;this.lizardSpace=1000;this.lizardLife=5000;this.shoe=new shoe();this.shoe.visible=true;this.food=new Food();this.food.visible=true;this.shoe.start();this.count=0;var _this=this;this.scoreNum=0;this.scoreImgArr=[];this.bloodItemSize={width:30,height:30};this.bloodItemMargin=6;this.foodBloodLength=3;this.stages=[{minTimeCount:0,maxTimeCount:1000,lv1Space:400,lv2Space:600,lizardLife:5000,lizardSpace:1000},{minTimeCount:1000,maxTimeCount:3000,lv1Space:100,lv2Space:400,lizardLife:5000,lizardSpace:500},{minTimeCount:3000,maxTimeCount:6000,lv1Space:100,lv2Space:100,lizardLife:5000,lizardSpace:400},{minTimeCount:6000,maxTimeCount:9000,lv1Space:50,lv2Space:100,lizardLife:5000,lizardSpace:400},{minTimeCount:9000,maxTimeCount:900000,lv1Space:40,lv2Space:100,lizardLife:5000,lizardSpace:400}]
this.lizardTimer=0;this.lizardTimer2=0;this.foodBloodLost=0;this.bloodItemArr=[];this.addEventListeners();this.renderPage();this.initializeFoodBloodBar();this.gameBg.zOrder=-10;this.food.zOrder=-9;this.game.addChild(this.shoe);this.game.addChild(this.food);this.killBig=0;this.shachongjiLife=3000;this.shachongjiStartTime=6000;this.timer.visible=true;if(window["wx"]){wx.getSystemInfo({success:function(obj){_this.device=new Laya.Point(obj.windowWidth,obj.windowHeight);}});}}
_proto.addEventListeners=function(){addOnceClick(this.game,this,function(e){if(this.blaArr.length>0){for(var k in this.blaArr){if(this.blaArr[k].isTouch(e.target.mouseX,e.target.mouseY)){this.blaArr[k].hit();}}}
if(this.shachongji&&this.shachongji.isTouch(e.target.mouseX,e.target.mouseY)){this.killTimes++;this.killAllLabel.text="x"+this.killTimes;this.shachongji.removeSelf();this.shachongji=null;}
if(this.lizard&&this.lizard.isTouch(e.target.mouseX,e.target.mouseY)){this.lizard.hit();}
if(this.lizard2&&this.lizard2.isTouch(e.target.mouseX,e.target.mouseY)){this.lizard2.hit();}});addOnceClick(this.rankBtn,this,function(){laya.media.SoundManager.playSound(clickMusic);this.backBtn.visible=true;this.shareBtn.disabled=true;this.shareBtn2.visible=true;this.rankBtn.visible=false;this.retryBtn.disabled=true;this.homeBtn.disabled=true;showOpenData(this,{type:"showRankList"});console.log("主域发送showRankList消息");});addOnceClick(this.backBtn,this,function(){console.log("click backBtn");laya.media.SoundManager.playSound(clickMusic);if(this.rankSprite2){this.rankSprite2.graphics.clear();this.rankSprite2.removeSelf();this.rankSprite2=null;this.backBtn.visible=false;this.shareBtn.disabled=false;this.rankBtn.visible=true;this.shareBtn2.visible=false;this.retryBtn.disabled=false;this.homeBtn.disabled=false;}});addOnceClick(this.killAll,this,function(){laya.media.SoundManager.playSound(killAllMusic);if(this.killTimes>0&&!this.over){this.killTimes--;this.clearBla();}});addOnceClick(this.shareBtn,this,function(){laya.media.SoundManager.playSound(clickMusic);wx.shareAppMessage({imageUrl:"http://www.md-qc.com/share.jpg",title:"我打出了"+this.scoreNum.toFixed(2)+"s的成绩，我不信你能比我更高!"});});addOnceClick(this.shareBtn2,this,function(){laya.media.SoundManager.playSound(clickMusic);wx.shareAppMessage({imageUrl:"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=293976383,147943424&fm=27&gp=0.jpg",title:"仅供测试用！"});});addOnceClick(this.retryBtn,this,function(){laya.media.SoundManager.playSound(clickMusic);this.resetGame();laya.media.SoundManager.playSound("res/music/select.mp3");});addOnceClick(this.homeBtn,this,function(){laya.media.SoundManager.playSound(clickMusic);if(this.bannerAd){this.bannerAd.destroy();this.bannerAd=null;}
if(this.rankSprite2){this.rankSprite2.graphics.clear();this.rankSprite2.removeSelf();this.rankSprite2=null;}
this.removeSelf();LayaApp.game=null;LayaApp.gameStart.page1.visible=true;LayaApp.gameStart.page3.visible=false;Laya.stage.addChild(LayaApp.gameStart)});}
_proto.initializeFoodBloodBar=function(){for(i=this.foodBloodLength;i>0;i--){var bloodItem=new BloodItem();bloodItem.visible=true;bloodItemX=this.bloodBg.x+this.bloodIco.width+i*(this.bloodItemSize.width+this.bloodItemMargin);bloodItemY=this.bloodBg.y+this.bloodBg.height/2-bloodItem.height/2;bloodItem.pos(bloodItemX,bloodItemY);this.bloodItemArr.push(bloodItem);this.game.addChild(bloodItem);}}
_proto.initializeStageParams=function(){var stageObj;for(j=0;j<this.stages.length;j++){if(this.timeCount>=this.stages[j].minTimeCount&&this.timeCount<this.stages[j].maxTimeCount){stageObj=this.stages[j];this.setStageParams(stageObj);break;}}}
_proto.setStageParams=function(stageObj){this.lv1Space=stageObj.lv1Space;this.lv2Space=stageObj.lv2Space;this.lizardLife=stageObj.lizardLife;this.lizardSpace=stageObj.lizardSpace;}
_proto.updateFoodBloodBar=function(){laya.media.SoundManager.playSound(loseHpMusic);this.bloodItemArr[this.foodBloodLost-1].img.skin="comp/lose_hp.png";}
_proto.renderPage=function(){Laya.timer.loop(20,this,function(){if(this.over){return;}
this.scoreNum+=0.02;this.score.text=this.scoreNum.toFixed(2)+"s";this.initializeStageParams();if(this.timeCount%this.lv1Space==0){this.produceBlattaria(1);}
if(this.timeCount>this.shachongjiStartTime){this.shachongjiAppearSatus=true;}
if(this.killBig>=5){this.killBig=0;var rdd=Math.random();if(rdd<0.5){this.shachongji=new shanchongji();this.shachongji.appear();this.game.addChild(this.shachongji);}}
if(this.shachongji){this.shachongji.timer+=20;}
if(this.shachongji&&this.shachongji.timer>=this.shachongjiLife){console.log("this.shachongji.disappear");this.shachongji.disappear();this.shachongji=null;}
if(this.timeCount%this.lv2Space==0){this.produceBlattaria(2);}
this.timeCount+=2;if(this.timeCount%this.lizardSpace==0){this.produceLizard();}
if(this.lizard){this.lizardTimer+=20;this.lizard.move(rd(0,360),rd(100,300),2);}
if(this.lizard2){this.lizardTimer2+=20;this.lizard2.move(rd(0,360),rd(100,300),2);}
if(this.lizard&&this.lizardTimer>=this.lizardLife){this.lizard.panel.removeSelf();this.lizardTimer=0;this.lizard=null;}
if(this.lizard2&&this.lizardTimer2>=this.lizardLife){this.lizard2.panel.removeSelf();this.lizardTimer2=0;this.lizard2=null;}
if(this.blaArr.length>0){var toRm=[];for(var k in this.blaArr){this.blaArr[k].move(rd(0,360),this.blaArr[k].lv==1?1:0.5);if(this.blaArr[k].toRemove){this.blaArr[k].panel.removeSelf();toRm.push(k);}}
for(var i=toRm.length-1;i>=0;i--){this.blaArr.splice(toRm[i],1);}}
this.checkOver();});}
_proto.showScoreAnimate=function(){var scoreImg=new Laya.Sprite();scoreImg.pos(320,400);Laya.stage.addChild(scoreImg);scoreImg.loadImage("comp/score_reduce.png");scoreImg.scale(2,2);scoreImg.visible=true;Laya.Tween.to(scoreImg,{y:scoreImg.y-150},1000,Laya.Ease.backOut);this.scoreImgArr.push(scoreImg);var _this=this;Laya.timer.once(500,this,function(){scoreImg.removeSelf();});}
_proto.produceBlattaria=function(lv){this.count++;var x;var y;if(this.count%8==0){x=-10;y=rd(-10,1350);}else if(this.count%8==4){x=760;y=rd(150,1350);}else if(this.count%8==1||this.count%8==3||this.count%8==6){x=rd(-10,500);y=-20;}else if(this.count%8==2||this.count%8==5||this.count%8==7){x=rd(-10,760);y=1350;}
var bla=new Blattaria(x,y,lv);this.game.addChild(bla.panel);bla.panel.zOrder=-8;this.blaArr.push(bla);};_proto.produceLizard=function(){var x=rd(50,700);var y=rd(50,1330);if(this.lizard){this.lizard2=new Lizard(x,y);this.game.addChild(this.lizard2.panel);this.lizard2.panel.zOrder=-8;}else{this.lizard=new Lizard(x,y);this.game.addChild(this.lizard.panel);this.lizard.panel.zOrder=-8;}}
_proto.clearBla=function(){for(var k in this.blaArr){this.blaArr[k].hit(true);}
this.killAllLabel.text="x"+this.killTimes;shake(this,8,30);};_proto.checkOver=function(){return false;};_proto.aliveOpt=function(){this.recoverPanel.visible=true;this.timeCount.text="30";var self=this;var tick=function(){Laya.timer.once(1e3,self,function(){var tv=parseInt(this.timeCount.text);tv--;if(tv<=0||!this.recoverPanel.visible){this.timeCount.text="0";return;}else{this.timeCount.text=tv+"";tick();}});};tick();this.aliveBtn.offAll();this.aliveBtn.on(Laya.Event.CLICK,this,function(e){if(videoAd){videoAd.load().then(function(){return videoAd.show();}).catch(function(err){return console.log(err.errMsg);});videoAd.onClose(function(res){if(res&&res.isEnded||res===undefined){self.toBeAlive();}});}else{self.toBeAlive();}});if(window["wx"]){if(this.bannerAd){this.bannerAd.destroy();this.bannerAd=null;}
this.bannerAd=wx.createBannerAd({adUnitId:"adunit-ecc6ee807c2bf738",style:{left:0,top:this.device.y-100,width:this.device.x,height:100}});this.bannerAd.show();}};_proto.btnClick=function(e){switch(e.target.name){case"add1Btn":this.lv1Space+=10;this.lv1Text.text=this.lv1Space+"";break;case"minu1Btn":this.lv1Space-=10;if(this.lv1Space<=0){this.lv1Space=10;}
this.lv1Text.text=this.lv1Space+"";break;case"add2Btn":this.lv2Space+=100;this.lv2Text.text=this.lv2Space+"";break;case"minu2Btn":this.lv2Space-=100;if(this.lv2Space<=0){this.lv2Space=100;}
this.lv2Text.text=this.lv2Space+"";break;case"spaceMaxAdd":this.spaceMax+=5;this.timeMax.text=this.spaceMax+"";break;case"spaceMaxMinu":this.spaceMax-=5;this.timeMax.text=this.spaceMax+"";break;}};_proto.gameOver=function(){this.retryBtn.disabled=false;this.homeBtn.disabled=false;laya.media.SoundManager.playSound(gameOverMusic);this.shoe.visible=false;this.shoe.end();shake(this,5);this.food.visible=false;this.game.visible=false;this.gameOverPanel.visible=true;this.gameOverPanel.zOrder=99;this.tips.text="本次成绩："+this.scoreNum.toFixed(2)+"s";this.over=true;var _this=this;for(i=0;i<this.bloodItemArr.length;i++){this.bloodItemArr[i].removeSelf();}
if(Laya.Browser.onMiniGame){var data=[{key:"score",value:this.scoreNum.toFixed(2)+""}];var openDataContext=wx.getOpenDataContext();openDataContext.postMessage({type:'updateMaxScore',score:parseFloat(_this.scoreNum.toFixed(2))});console.log("主域发送updateMaxScore消息");}
for(var i=this.scoreImgArr.length-1;i>=0;i--){this.scoreImgArr[i].removeSelf();}};_proto.resetGame=function(){for(var k in this.blaArr){this.blaArr[k].panel.removeSelf();this.blaArr[k]=null;}
this.game.visible=true;this.gameOverPanel.visible=false;this.blaArr=[];this.waitOver=false;this.overCount=0;this.scoreNum=0;this.over=false;this.killTimes=1;this.killAllLabel.text="x1";this.foodBloodLost=0;this.bloodItemArr=[];this.timer.visible=true;this.lv1Space=200;this.lv2Space=600;this.lizardSpace=1000;this.lizardLife=5000;this.lizardTimer=0;this.lizardTimer2=0;this.timeCount=0;this.killBig=0;this.shachongjiAppearSatus=false;if(this.shachongji){this.shachongji.removeSelf();this.shachongji=null;}
if(this.lizard){this.lizard.panel.removeSelf();this.lizard=null;}
if(this.lizard2){this.lizard2.panel.removeSelf();this.lizard2=null;}
this.initializeFoodBloodBar();};return Game;})(GameUI)
var GameStart=(function(_super){function GameStart(){GameStart.__super.call(this);addOnceClick(this.page1,this,function(){laya.media.SoundManager.playSound(clickMusic);this.page1.visible=false;this.page2.visible=true;})
addOnceClick(this.startBtn,this,function(){laya.media.SoundManager.playSound(clickMusic);this.page2.visible=false;this.page3.visible=true;})
addOnceClick(this.rankBtn,this,function(){laya.media.SoundManager.playSound(clickMusic);this.homeBtn.visible=true;this.startBtn.disabled=true;this.rankBtn.visible=false;this.shareBtn.visible=true;showOpenData(this,{type:"showRankList"});console.log("主域发送showRankList消息");})
addOnceClick(this.homeBtn,this,function(){laya.media.SoundManager.playSound(clickMusic);if(this.rankSprite2){this.rankSprite2.graphics.clear();this.rankSprite2.removeSelf();this.rankSprite2=null;this.homeBtn.visible=false;this.startBtn.disabled=false;this.rankBtn.visible=true;this.shareBtn.visible=false;}});addOnceClick(this.shareBtn,this,function(){laya.media.SoundManager.playSound(clickMusic);wx.shareAppMessage({imageUrl:"http://www.md-qc.com/share.jpg",title:"屎壳郎历险记"});});addOnceClick(this.page3,this,function(){laya.media.SoundManager.playSound(clickMusic);this.removeSelf();if(!LayaApp.game){LayaApp.game=new Game();Laya.stage.addChild(LayaApp.game);}})
if(Laya.Browser.onMiniGame){console.log("Laya.Browser.onMiniGame in GameStart");var _this=this;wx.getSystemInfo({success:function(res){if(res.screenWidth==375&&res.screenHeight==812){Laya.stage.height=1624;console.log("iPhone X in GameStart");_this.page1.height=1624;_this.bg_02.height=1624;_this.page3.height=1624;_this.rankBtn.y+=100;_this.startBtn.y+=100;_this.homeBtn.y+=100;}else{console.log("not iPhone X in GameStart");}}})}else{console.log("not Laya.Browser.onMiniGame in GameStart");}}
Laya.class(GameStart,'view.GameStart',_super);var _proto=GameStart.prototype;return GameStart;})(GameStartUI)
class LayaApp{constructor(){const WebGL=laya.webgl.WebGL
Laya.MiniAdpter.init(true,false);Laya.init(750,1334,WebGL);Laya.stage.scaleMode=Laya.Stage.SCALE_EXACTFIT;Laya.stage.bgColor="#ffffff";if(Laya.Browser.onMiniGame){console.log("Laya.Browser.onMiniGame");this.resizedSharedCanvas();}
this.beginLoad()}
resizedSharedCanvas(){Laya.timer.once(1000,this,function(){window['sharedCanvas'].width=Laya.stage.width;window['sharedCanvas'].height=Laya.stage.height;wx.postMessage({type:"resizeShared",data:{width:Laya.stage.width,height:Laya.stage.height,matrix:Laya.stage._canvasTransform}});console.log("主域发送resizeShared消息！")});}
beginLoad(){Laya.loader.load("res/atlas/comp.atlas",Laya.Handler.create(this,this.onLoaded),null,Laya.Loader.ATLAS)}
onLoaded(){LayaApp.gameStart=new GameStart()
Laya.stage.addChild(LayaApp.gameStart)}}
new LayaApp();